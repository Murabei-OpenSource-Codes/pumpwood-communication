<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>pumpwood_communication.microservices API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pumpwood_communication.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pumpwood_communication</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#break_in_chunks">break_in_chunks</a>
            </li>
            <li>
                    <a class="class" href="#PumpWoodMicroService">PumpWoodMicroService</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PumpWoodMicroService.__init__">PumpWoodMicroService</a>
                        </li>
                        <li>
                                <a class="variable" href="#PumpWoodMicroService.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#PumpWoodMicroService.server_url">server_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#PumpWoodMicroService.verify_ssl">verify_ssl</a>
                        </li>
                        <li>
                                <a class="variable" href="#PumpWoodMicroService.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#PumpWoodMicroService.default_timeout">default_timeout</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.init">init</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.angular_json">angular_json</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.time_to_expiry">time_to_expiry</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.is_credential_set">is_credential_set</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.login">login</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.confirm_mfa_code">confirm_mfa_code</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.logout">logout</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.logout_all">logout_all</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.set_auth_header">set_auth_header</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.get_auth_header">get_auth_header</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.error_handler">error_handler</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.is_invalid_token_response">is_invalid_token_response</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.request_post">request_post</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.request_get">request_get</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.request_delete">request_delete</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_registered_routes">list_registered_routes</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.is_microservice_registered">is_microservice_registered</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_registered_endpoints">list_registered_endpoints</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.dummy_call">dummy_call</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.dummy_raise">dummy_raise</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.get_pks_from_unique_field">get_pks_from_unique_field</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list">list</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_by_chunks">list_by_chunks</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_without_pag">list_without_pag</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_dimensions">list_dimensions</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_dimension_values">list_dimension_values</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_one">list_one</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.retrieve">retrieve</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.retrieve_file">retrieve_file</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.retrieve_streaming_file">retrieve_streaming_file</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.save_streaming_file">save_streaming_file</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.delete">delete</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.remove_file_field">remove_file_field</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.delete_many">delete_many</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_actions">list_actions</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.execute_action">execute_action</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.search_options">search_options</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.fill_options">fill_options</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.list_options">list_options</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.retrieve_options">retrieve_options</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.fill_validation">fill_validation</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.pivot">pivot</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.flat_list_by_chunks">flat_list_by_chunks</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.bulk_save">bulk_save</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.flatten_parallel">flatten_parallel</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_request_get">parallel_request_get</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.paralell_request_post">paralell_request_post</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.paralell_request_delete">paralell_request_delete</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_retrieve">parallel_retrieve</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_retrieve_file">parallel_retrieve_file</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_list">parallel_list</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_list_without_pag">parallel_list_without_pag</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_list_one">parallel_list_one</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_save">parallel_save</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_delete">parallel_delete</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_delete_many">parallel_delete_many</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_execute_action">parallel_execute_action</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_bulk_save">parallel_bulk_save</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.parallel_pivot">parallel_pivot</a>
                        </li>
                        <li>
                                <a class="function" href="#PumpWoodMicroService.get_queue_matrix">get_queue_matrix</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pumpwood_communication.html">pumpwood_communication</a><wbr>.microservices    </h1>

                        <div class="docstring"><p>Module microservice.py.</p>

<p>Class and functions to help communication between PumpWood like systems.</p>
</div>

                        <input id="mod-microservices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-microservices-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;Module microservice.py.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Class and functions to help communication between PumpWood like systems.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">io</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">simplejson</span> <span class="k">as</span> <span class="nn">json</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">gzip</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">geopd</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">geometry</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">ExcelWriter</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">secure_filename</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">pumpwood_communication.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="n">exceptions_dict</span><span class="p">,</span> <span class="n">PumpWoodException</span><span class="p">,</span> <span class="n">PumpWoodUnauthorized</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">PumpWoodObjectSavingException</span><span class="p">,</span> <span class="n">PumpWoodOtherException</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="n">PumpWoodQueryException</span><span class="p">,</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span> <span class="nn">pumpwood_communication.serializers</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>    <span class="n">pumpJsonDump</span><span class="p">,</span> <span class="n">CompositePkBase64Converter</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">pumpwood_communication.misc</span> <span class="kn">import</span> <span class="n">unpack_dict_columns</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="c1"># Importing abstract classes for Micro Service</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span> <span class="nn">pumpwood_communication.microservice_abc.simple</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="n">ABCSimpleBatchMicroservice</span><span class="p">,</span> <span class="n">ABCPermissionMicroservice</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="c1"># Creating logger for Micro Service calls</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="n">_Log_Format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">_Log_Format</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="n">_microservice_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pumpwood_comunication&#39;</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="n">_microservice_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="k">def</span> <span class="nf">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>                    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Break a dataframe in chunks of chunksize.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    Args:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">        df_to_break: Dataframe to be break in chunks of `chunksize` size.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">        chunksize: Length of each chuck of the breaks of `df_to_break`.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    Returns:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        Return a list dataframes with lenght chunksize of data from</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        `df_to_break`.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">to_return</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_to_break</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">))</span> <span class="o">//</span> <span class="n">chunksize</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="k">return</span> <span class="n">to_return</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="k">class</span> <span class="nc">PumpWoodMicroService</span><span class="p">(</span><span class="n">ABCSimpleBatchMicroservice</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>                           <span class="n">ABCPermissionMicroservice</span><span class="p">):</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to define an inter-pumpwood MicroService.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">    Create an object ot help communication with Pumpwood based backends. It</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">    manage login and token refresh if necessary.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    It also implements parallel functions that split requests in parallel</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">    process to reduce processing time.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the MicroService object, can be used for debug proposes.&quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;URL of the Pumpwood server.&quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If SSL certificates will be checked on HTTPs requests.&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    If microservice service is set as debug, if debug=TRUE all request will</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">    refresh authorization token.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="k">def</span> <span class="nf">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">if</span> <span class="n">server_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="k">if</span> <span class="n">server_url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="k">return</span> <span class="n">server_url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="k">return</span> <span class="n">server_url</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>                 <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                 <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new PumpWoodMicroService object.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">        Creates a new microservice object. If just name is passed, object must</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">        be initiate after with init() method.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">        Args:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">            name:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">                are raised.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">            server_url:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">            username:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">            password:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">                with the request.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">            verify_ssl:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">            debug:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">            default_timeout:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">            **kwargs:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        Returns:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">            PumpWoodMicroService: New PumpWoodMicroService object</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        Raises:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">            No particular Raises.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>             <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>             <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>             <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazzy initialization of the MicroService of object.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        This function might be usefull to use the object as a singleton at</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        the backends. Using this function it is possible to instanciate an</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        empty object and them set the attributes latter at the systems.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        Args:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">            name:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">                are raised.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">            server_url:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">            username:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">            password:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">                with the request.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            verify_ssl:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">            debug:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            default_timeout:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            **kwargs:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        Returns:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            No return</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        Raises:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">            No particular Raises</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert text to Json removing any XSSI at the beging of JSON.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        Some backends add `)]}&#39;,\n` at the beginning of the JSON data to</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">        prevent injection of functions. This function remove this characters</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">        if present.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        Args:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">            request_result:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">                JSON Request to be converted</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        Returns:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">            No return</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        Raises:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">            No particular Raises</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>            <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>    <span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return time to token expiry.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        Args:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">            No Args.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        Returns:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">            Return time until token expiration.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">return</span> <span class="n">time_to_expiry</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if username and password are set on object.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Args:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">            No Args.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        Returns:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">            True if usename and password were set during object creation or</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">            later with init function.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log microservice in using username and password provided.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        Args:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">            force_refresh (bool):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">                Force token refresh despise still valid</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">                according to self.__token_expiry.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        Returns:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            No return</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        Raises:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">            Exception: If login response has status diferent from 200.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="c1"># Check if expiry time is 1h from now</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>            <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="c1"># When if debug always refresh token</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>        <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>            <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>            <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>    <span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ask user to confirm MFA code to login.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        Open an input interface at terminal for user to validate MFA token.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        Args:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">            mfa_login_data:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">                Result from login request with &#39;mfa_token&#39;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">                as key.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        Returns:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">            Return login returned with MFA confimation.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">        Raise:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">            Raise error if reponse is not valid using error_handler.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>            <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="c1"># Set _is_mfa_login true to indicate that login required MFA</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout token.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        Args:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">            auth_header:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">                Authentication header.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        Returns:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">            True if logout was ok.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>    <span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout all tokens from user.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        Args:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">                Authentication header.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">        Returns:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">            True if logout all was ok.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                        <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set auth_header and token_expiry date.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        Args:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">            auth_header:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">                Authentication header to be set.</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">            token_expiry:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">                Token expiry datetime to be set.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        Returns:</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">            No return.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve auth_header and token_expiry from object.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        Args:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">            No Args.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        Returns:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">            Return authorization header and token_expiry datetime from object.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="k">def</span> <span class="nf">_check__auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if auth_header is set or auth_header if provided.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">        Args:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">            auth_header:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">                AuthHeader to substitute the microservice original</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">            multipart:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">                Set if call should be made as a multipart instead of JSON.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">        Returns:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">            Return a header dict to be used in requests.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        Raises:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">            PumpWoodUnauthorized:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">                If microservice is not logged and a auth_header method</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">                argument is not provided.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">            PumpWoodUnauthorized:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">                If microservice is logged and a auth_header method argument</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">                is provided.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">if</span> <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="c1"># Login will refresh token if it is 1h to expire, it will also</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="c1"># check if credentials are set.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                <span class="n">msg_tmp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                    <span class="s1">&#39;MicroService </span><span class="si">{name}</span><span class="s1"> already looged and &#39;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                    <span class="s1">&#39;auth_header was provided&#39;</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                    <span class="n">msg_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="c1"># Set base header as JSON since unserialization is done using</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="c1"># Pumpwood Communication serialization funciton</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle request error.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        Check if is a Json and propagate the error with</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        same type if possible. If not Json raises the content.</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        Args:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">            response:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">                response to be handled, it is a PumpWoodException</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">                return it will raise the same exception at microservice</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">                object.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        Returns:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">            No return.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        Raises:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">                If content-type is not application/json.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">                If content-type is application/json, but type not</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">                present or not recognisable at `exceptions.exceptions_dict`.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">            Other PumpWoodException sub-types:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">                If content-type is application/json if type is present and</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">                recognisable.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        Example:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">            No example</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="c1"># Request information</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                <span class="c1"># Raise the exception as first in exception deep.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                    <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                    <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>                    <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                    <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                        <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="c1"># Build error stack</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="c1"># Removing previous error stack</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>            <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="p">}</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>            <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="c1">###################</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="c1"># Propagate error #</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="c1"># get exception using &#39;type&#39; key at response data and get the</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="c1"># exception from exceptions_dict at exceptions</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="n">TempPumpwoodException</span> <span class="o">=</span> <span class="n">exceptions_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exception_type</span><span class="p">)</span> <span class="c1"># NOQA</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>            <span class="k">if</span> <span class="n">TempPumpwoodException</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>                <span class="k">raise</span> <span class="n">TempPumpwoodException</span><span class="p">(</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                    <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="c1"># If token is invalid is at response, return a</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="c1"># PumpWoodUnauthorized error</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                    <span class="c1"># If the error is not mapped return a</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="c1"># PumpWoodOtherException limiting the message size to 1k</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                    <span class="c1"># characters</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                                  <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if reponse has invalid token error.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        Args:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">            response:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">                Request reponse to check for invalid token.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        Returns:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">            Return True if response has an invalid token status.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>    <span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a POST a request to url with data as JSON payload.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        Args:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">            url:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">                URL to make the request.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">            data:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">                Data to be used as Json payload.</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            files:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">                A dictonary with file data, files will be set on field</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">                corresponding.to dictonary key.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">                `{&#39;file1&#39;: open(&#39;file1&#39;, &#39;rb&#39;), {&#39;file2&#39;: open(&#39;file2&#39;, &#39;rb&#39;)}`</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">            parameters:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">                URL parameters.</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">            auth_header:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">                AuthHeader to substitute the microservice original</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        Returns:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">            Return the post response data.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        Raises:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">                Response is passed to error_handler.</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="c1"># If parameters are not none convert them to JSON before</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on Javascript</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="c1"># for exemple</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="c1"># Request with files are done using multipart serializing all fields</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="c1"># as JSON</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="c1"># Check if response is a file</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a GET a request to url with data as JSON payload.</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        Add the auth_header acording to login information and refresh token</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        if auth_header=None and object token is expired.</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        Args:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">            url:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">                URL to make the request.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            parameters:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">                URL parameters to make the request.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">            auth_header:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        Returns:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">            Return the post reponse data.</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        Raises:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="c1"># If parameters are not none convert them to json before</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="c1"># for example</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="c1"># Re-raise Pumpwood exceptions</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>    <span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a DELETE a request to url with data as Json payload.</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        Args:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">            url:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">                Url to make the request.</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">            parameters:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">                Dictionary with Urls parameters.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">            auth_header:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        Returns:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">            Return the delete reponse payload.</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        Raises:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="c1"># Re-raise Pumpwood Exceptions</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a microservice (kong service) is registered at Kong.</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">        Args:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">            microservice:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">                Service associated with microservice registered on</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">                Pumpwood Kong.</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">            auth_header:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        Returns:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">            Return true if microservice is registered.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>    <span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                                  <span class="n">availability</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;front_avaiable&#39;</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all routes and services that have been registed at Kong.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        It is possible to restrict the return to end-points that should be</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        avaiable at the frontend. Using this feature it is possibel to &#39;hide&#39;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        services from GUI keeping them avaiable for programatic calls.</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        Args:</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">            auth_header:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">            availability:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">                Set the availability that is associated with the service.</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">                So far it is implemented &#39;front_avaiable&#39; and &#39;all&#39;.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        Returns:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            Return a list of serialized services objects containing the</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">            routes associated with at `route_set`.</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">            Service and routes have `notes__verbose` and `description__verbose`</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            that are  the repective strings associated with note and</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">            description but translated using Pumpwood&#39;s I8s,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">        Raises:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">            PumpWoodWrongParameters:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">                Raise PumpWoodWrongParameters if availability passed as</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">                paraemter is not implemented.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;availability&#39;</span><span class="p">:</span> <span class="n">availability</span><span class="p">},</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dummy call to ensure headers and payload reaching app.</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">        The request just bounce on the server and return the headers and</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        payload that reached the application. It is usefull for probing</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        proxy servers, API gateways and other security and load balance</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        tools.</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        Args:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">            payload:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">                Payload to be returned by the dummy call end-point.</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">            auth_header:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">        Returns:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">            Return a dictonary with:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">            - **full_path**: Full path of the request.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            - **method**: Method used at the call</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">            - **headers**: Headers at the request.</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">            - **data**: Post payload sent at the request.</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an Pumpwood error with the payload.</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">        This and point raises an Arbitrary PumpWoodException error, it can be</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        used for debuging error treatment.</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        Args:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">            exception_class:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">                Class of the exception to be raised.</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">            exception_deep:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">                Deep of the exception in microservice calls. This arg will</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">                make error recusive, calling the end-point it self for</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">                `exception_deep` time before raising the error.</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">            payload:</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">                Payload that will be returned with error.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">            auth_header:</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">        Returns:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">            Should not return any results, all possible call should result</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">            in raising the correspondent error.</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">        Raises:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">            Should raise the correspondent error passed on exception_class</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">            arg, with payload.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                                  <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pk using unique fields values.</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">        Use unique field values to retrieve pk of the objects. This end-point</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">        is usefull for retrieving pks of the objects associated with unique</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        fields such as `description` (unique on most model of pumpwood).</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        ```python</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        # Using description to fetch pks from objects</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        data: pd.DataFrame = [data with unique description but without pk]</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        data[&#39;attribute_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">            model_class=&quot;DescriptionAttribute&quot;,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">            field=&quot;description&quot;, values=data[&#39;attribute&#39;])[&#39;pk&#39;]</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">        # Using a dimension key to fetch pk of the objects, dimension</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        # key must be unique</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        data[&#39;georea_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">            model_class=&quot;DescriptionGeoarea&quot;, field=&quot;dimension-&gt;city&quot;,</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">            values=data[&#39;city&#39;])[&#39;pk&#39;]</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        ```</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        Args:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">            model_class:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">                Model class of the objects.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">            field:</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">                Unique field to fetch pk. It is possible to use dimension keys</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">                as unique field, for that use `dimension-&gt;[key]` notation.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            values:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">                List of the unique fields used to fetch primary keys.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        Return:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">            Return a dataframe in same order as values with columns:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">            - **pk**: Correspondent primary key of the unique value.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">            - **[field]**: Column with same name of field argument,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">                correspondent to pk.</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">        Raises:</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">                Raises if field is not found on the model and it is note</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">                associated with a dimension tag.</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">                Raises if `field` does not have a unique restriction on</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">                database. Dimension keys does not check for uniqueness on</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">                database, be carefull not to duplicate the lines.</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>            <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                    <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                    <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>            <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="p">})</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="k">def</span> <span class="nf">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>             <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List objects with pagination.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        List end-point (resumed data) of PumpWood like systems,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        results will be paginated. To get next pag, send all recived pk at</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        exclude dict (ex.: `exclude_dict={pk__in: [1,2,...,30]}`).</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        It is possible to return foreign keys objects associated with</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        `model_class`. Use this with carefull since increase the backend</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        infrastructure consumption, each object is a retrieve call per</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        foreign key (otimization in progress).</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        It is possible to use diferent operators using `__` after the name</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">        of the field, some of the operators avaiable:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">        ### General operators</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        - **__eq:** Check if the value is the same, same results if no</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">            operator is passed.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        - **__gt:** Check if value is greter then argument.</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">        - **__lt:** Check if value is less then argument.</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">        - **__gte:** Check if value is greter or equal then argument.</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">        - **__lte:** Check if value is less or equal then argument.</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        - **__in:** Check if value is at a list, the argument of this operator</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">            must be a list.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">        ### Text field operators</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        - **__contains:** Check if value contains a string. It is case and</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">            accent sensitive.</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        - **__icontains:** Check if a values contains a string, It is case</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        - **__unaccent_icontains:** Check if a values contains a string, It is</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">            case insensitive and accent insensitive (consider a, à, á, ã, ...</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">            the same).</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        - **__exact:** Same as __eq or not setting operator.</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        - **__iexact:** Same as __eq, but case insensitive and</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">            accent sensitive.</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        - **__unaccent_iexact:** Same as __eq, but case insensitive and</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">            accent insensitive.</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        - **__startswith:** Check if the value stats with a sub-string.</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">            Case sensitive and accent sensitive.</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        - **__istartswith:** Check if the value stats with a sub-string.</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">            Case insensitive and accent sensitive.</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        - **__unaccent_istartswith:** Check if the value stats with a</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">            sub-string. Case insensitive and accent insensitive.</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        - **__endswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">            sensitive and accent sensitive.</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">        - **__iendswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        - **__unaccent_iendswith:** Check if the value ends with a sub-string.</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">            Case insensitive and accent insensitive.</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">        ### Null operators</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">        - **__isnull:** Check if field is null, it uses as argument a `boolean`</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">            value false will return all non NULL values and true will return</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">            NULL values.</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        ### Date and datetime operators:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        - **__range:** Receive as argument a list of two elements and return</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">            objects that field dates are between those values.</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        - **__year:** Return object that date field value year is equal to</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">            argument.</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">        - **__month:** Return object that date field value month is equal to</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">            argument.</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">        - **__day:** Return object that date field value day is equal to</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">            argument.</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">        ### Dictionary fields operators:</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        - **__json_contained_by:**</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">            Uses the function [contained_by](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by)</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">            from SQLAlchemy to test if keys are a proper subset of the keys of</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">            the argument jsonb expression (extracted from SQLAlchemy). The</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">            argument is a list.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">        - **__json_has_any:**</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">            Uses the function [has_any](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">            from SQLAlchemy to test for presence of a key. Note that the key</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">            may be a SQLA expression. (extracted from SQLAlchemy). The</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">            argument is a list.</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        - **__json_has_key:**</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">            Uses the function [has_key](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">            from SQLAlchemy to Test for presence of a key. Note that the key</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">            may be a SQLA expression. The argument is a str.</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        ### Text similarity operators</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">        To use similariry querys on Postgres it is necessary to `pg_trgm` be</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        instaled on server. Check [oficial documentation]</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        (https://www.postgresql.org/docs/current/pgtrgm.html).</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">        - **__similarity:** Check if two strings are similar uses the `%`</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">            operador.</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">        - **__word_similar_left:** Check if two strings are similar uses the</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">            `&lt;%` operador.</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">        - **__word_similar_right:** Check if two strings are similar uses the</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">            `%&gt;` operador.</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        - **__strict_word__similar_left:** Check if two strings are similar</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">            uses the `&lt;&lt;%` operador.</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">        - **__strict_word__similar_right:** Check if two strings are similar</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">            uses the `%&gt;&gt;` operador.</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        Some usage examples:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">        ```python</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">        # Return the first 3 results ordered decreasing acording to `time` and</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        # them ordered by `modeling_unit_id`. Results must have time greater</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">        # or equal to 2017-01-01 and less or equal to 2017-06-01. It also</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        # must have attribute_id equal to 6 and not contains modeling_unit_id</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        # 3 or 4.</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">        microservice.list(</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">            model_class=&quot;DatabaseVariable&quot;,</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">            filter_dict={</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">                &quot;time__gte&quot;: &quot;2017-01-01 00:00:00&quot;,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">                &quot;time__lte&quot;: &quot;2017-06-01 00:00:00&quot;,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">                &quot;attribute_id&quot;: 6},</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">            exclude_dict={</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">                &quot;modeling_unit_id__in&quot;: [3, 4]},</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">            order_by=[&quot;-time&quot;, &quot;modeling_unit_id&quot;],</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">            limit=3,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">            fields=[&quot;pk&quot;, &quot;model_class&quot;, &quot;time&quot;, &quot;modeling_unit_id&quot;, &quot;value&quot;])</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        # Return all elements that dimensions field has a key type with</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        # value contains `selling` insensitive to case and accent.</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        microservice.list(</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">            model_class=&quot;DatabaseAttribute&quot;,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">            filter_dict={</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">                &quot;dimensions-&gt;type__unaccent_icontains&quot;: &quot;selling&quot;})</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        ```</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        Args:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">            model_class:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">            filter_dict:</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">            exclude_dict:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">            order_by: Order results acording to list of strings</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">            fields:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">            default_fields:</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">            limit:</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">            **kwargs:</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">        Returns:</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">        Raises:</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">          No especific raises.</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span> <span class="c1"># NOQA</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>    <span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                       <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                       <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>                       <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object fetching them by chucks using pk to paginate.</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        List data by chunck to load by datasets without breaking the backend</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        or receive server timeout. It load chunks orderring the results using</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        id of the tables, it can be changed but it should be unique otherwise</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        unexpected results may occur.</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        Args:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">            model_class:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">            filter_dict:</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">            exclude_dict:</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">            fields:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">            default_fields:</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">            chunk_size:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">                Number of objects to be fetched each query.</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">            **kwargs:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">        Returns:</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">        Raises:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">          No especific raises.</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>            <span class="c1"># Break if results is empty</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                <span class="k">break</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>            <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="k">return</span> <span class="n">list_all_results</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>    <span class="k">def</span> <span class="nf">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-without-pag/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>                         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>                         <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>                         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object without pagination.</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">        systems, results won&#39;t be paginated.</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        **Be carefull with large returns.**</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">        Args:</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">            model_class (str):</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">            order_by (bool):</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">                Order results acording to list of strings</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">            limit (int):</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">            convert_geometry (bool):</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">                If geometry columns should be convert to shapely geometry.</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">                Fields with key &#39;geometry&#39; will be considered geometry.</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">            return_type (str):</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">                Set return type to list of dictinary `list` or to a pandas</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">                dataframe `dataframe`.</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">            **kwargs:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">                Other unused arguments for compatibility.</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        Returns:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">        Raises:</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a><span class="sd">          No especific raises.</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="c1">##################################################</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="c1"># Converting geometry to Shapely objects in Python</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="c1">##################################################</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                    <span class="n">geometry_in_results</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="k">def</span> <span class="nf">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimensions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>    <span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class.</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">        Args:</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">            model_class:</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">            filter_dict:</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">            exclude_dict:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">        Returns:</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">            List of keys avaiable in results from the query dict.</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="k">def</span> <span class="nf">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimension-values/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>    <span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List values associated with dimensions key.</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">        Args:</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">            model_class:</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">            filter_dict:</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">            exclude_dict:</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">            key:</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">                Key to list the avaiable values using the query filter</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">                and exclude.</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">        Returns:</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">            List of values associated with dimensions key at the objects that</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">            are returned with `filter_dict` and `exclude_dict`.</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                     <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>    <span class="k">def</span> <span class="nf">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>    <span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object using list serializer (simple).</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">        **# DEPRECTED #** It is the same as retrieve using</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">        `default_fields: bool = True`, if possible migrate to retrieve</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        function.</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">        Args:</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">            model_class:</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">            pk:</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">                Object pk</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">            fields:</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">            default_fields:</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">            related_fields:</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">                carefully.</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">        Returns:</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">        Raises:</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>                 <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>                 <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object from PumpWood.</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="sd">        Function to get object serialized by retrieve end-point</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="sd">        (more detailed data).</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a><span class="sd">        Args:</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">            model_class:</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">            pk:</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">                Object pk</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">            fields:</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">            default_fields:</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">            related_fields:</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a><span class="sd">                carefully.</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">        Returns:</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">        Raises:</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>    <span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>                      <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood.</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">        This function will retrieve file as a single request, depending on the</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        size of the files it would be preferred to use streaming end-point.</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">        Args:</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">            model_class:</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="sd">            pk:</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="sd">            file_field:</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">            save_file:</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="sd">                If data is to be saved as file or return get</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="sd">                response.</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">            save_path:</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a><span class="sd">            file_name:</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">            if_exists:</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}.</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">                Set what to do if there is a file with same name. Skip</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">                will not download file if there is already with same</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="sd">                os.path.join(save_path, file_name), file_name must be set</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">                for skip argument.</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">        Returns:</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">            May return the file name if save_file=True; If false will return</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a><span class="sd">            a dictonary with keys `filename` with original file name and</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a><span class="sd">            `content` with binary data of file content.</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">        Raises:</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="sd">                operations,</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a><span class="sd">                files on storage.</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>                <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>            <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>            <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>                <span class="k">return</span> <span class="n">file_path</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>        <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>            <span class="k">return</span> <span class="n">file_response</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>            <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>                    <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                        <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>                        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>                        <span class="k">break</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>                <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>                        <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>                         <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>            <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>                    <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>                     <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_file_straming_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file-streaming/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>    <span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>                                <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>                                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>                                <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood using streaming to retrieve content.</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="sd">        This funcion uses file streaming to retrieve file content, it should be</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">        prefered when dealing with large (bigger than 10Mb) files transfer.</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">        Using this end-point the file is not loaded on backend memory content</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">        is transfered by chucks that are read at the storage and transfered</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">        to user.</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">        It will necessarily save the content as a file, there is not the</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">        possibility of retrieving the content directly from request.</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">        Args:</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">            model_class:</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a><span class="sd">            pk:</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a><span class="sd">            file_field:</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">            save_path:</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">            file_name:</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">            if_exists:</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}.</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">                Set what to do if there is a file with same name.</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">        Returns:</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">            Returns the file path that recived the file content.</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="sd">        Raises:</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a><span class="sd">                operations,</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">                files on storage.</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="c1"># begin Args check</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>        <span class="c1"># end Args check</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                    <span class="k">break</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>    <span class="k">def</span> <span class="nf">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save or Update a new object.</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a><span class="sd">        Function to save or update a new model_class object. If obj_dict[&#39;pk&#39;]</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a><span class="sd">        is None or not defined a new object will be created. The obj</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="sd">        model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a><span class="sd">        PumpWoodObjectSavingException will be raised.</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a><span class="sd">        If files argument is set, request will be transfered using a multipart</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a><span class="sd">        request file files mapping file key to file field on backend.</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a><span class="sd">        Args:</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a><span class="sd">            obj_dict:</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a><span class="sd">                Model data dictionary. It must have &#39;model_class&#39;</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a><span class="sd">                key and if &#39;pk&#39; key is not defined a new object will</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a><span class="sd">                be created, else object with pk will be updated.</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a><span class="sd">            files:</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a><span class="sd">                bytes.</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a><span class="sd">        Returns:</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a><span class="sd">            Return updated/created object data.</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a><span class="sd">        Raises:</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a><span class="sd">                &#39;To save an object obj_dict must have model_class defined.&#39;</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">                This indicates that the obj_dict must have key `model_class`</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="sd">                indicating model class of the object that will be</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">                updated/created.</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="sd">                indicates that the pk passed on obj_dict was not found on</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a><span class="sd">                backend database.</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a><span class="sd">                Error raised when IntegrityError is raised on database. This</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="sd">                might ocorrur when saving objects that does not respect</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a><span class="sd">                uniqueness restriction on database or other IntegrityError</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a><span class="sd">                like removal of foreign keys with related data.</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="sd">                Return error at object validation on de-serializing the</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="sd">                object or files with unexpected extensions.</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>        <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>            <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>                <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>    <span class="k">def</span> <span class="nf">_build_save_streaming_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">{model_class}</span><span class="s2">/save-file-streaming/</span><span class="si">{pk}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>    <span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>                            <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream file to PumpWood.</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a><span class="sd">        Use streaming to transfer a file content to Pumpwood storage, this</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a><span class="sd">        end-point is prefered when transmiting files bigger than 10Mb. It</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="sd">        is necessary to have the object created before the file transfer.</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="sd">        Args:</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a><span class="sd">            model_class:</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a><span class="sd">                Model class of the object.</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="sd">            pk:</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a><span class="sd">                pk of the object.</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a><span class="sd">            file_field:</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a><span class="sd">                File field that will receive file stream.</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="sd">            file:</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a><span class="sd">                File to upload as a file object with read bytes option.</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a><span class="sd">            file_name:</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a><span class="sd">                Name of the file, if not set it will be saved as</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a><span class="sd">                {pk}__{file_field}.{extension at permited extension}</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a><span class="sd">        Returns:</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a><span class="sd">            Return the file name associated with data at the storage.</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a><span class="sd">        Raises:</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a><span class="sd">                indicates that the `file_field` passed is not associated</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a><span class="sd">                with a file field on the backend.</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a><span class="sd">                &#39;Saved bytes in streaming [{}] differ from file bytes [{}].&#39;.</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a><span class="sd">                This indicates that there was an error when transfering data</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a><span class="sd">                to storage, the file bytes and transfered bytes does not</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a><span class="sd">                match.</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>        <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>        <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>        <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>                <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>                <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span><span class="p">)</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                    <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                        <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>        <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>    <span class="k">def</span> <span class="nf">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a><span class="sd">        Args:</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a><span class="sd">            model_class:</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a><span class="sd">            pk:</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a><span class="sd">                have been implemented). Some model_class with &#39;deleted&#39; field</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a><span class="sd">                does not remove the entry, it will flag deleted=True at this</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a><span class="sd">                cases. Model class with delete=True will be not retrieved</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a><span class="sd">                by default on `list` and `list_without_pag` end-points.</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a><span class="sd">        Returns:</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a><span class="sd">            Returns delete object.</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a><span class="sd">        Raises:</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39; This</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a><span class="sd">                indicates that the pk was not found in database.</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>    <span class="k">def</span> <span class="nf">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/remove-file-field/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>    <span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a><span class="sd">        Args:</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a><span class="sd">            model_class:</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a><span class="sd">            pk:</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a><span class="sd">                have been implemented).</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a><span class="sd">            file_field:</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a><span class="sd">                File field to be removed from storage.</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a><span class="sd">        Returns:</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="sd">            Return True is file was successful removed</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a><span class="sd">        Raises:</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a><span class="sd">                are disable&#39;. This indicates that storage_object is not</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a><span class="sd">                associated with view, not allowing it to make storage</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a><span class="sd">                operations.</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary.&#39;.</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="sd">                This indicates that the `file_field` was not set as a file</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a><span class="sd">                field on the backend.</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="sd">                &#39;File does not exist. File field [{}] is set as None&#39;.</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">                This indicates that the object does not exists on storage,</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a><span class="sd">                it should not occur. It might have been some manual update</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a><span class="sd">                of the database or at the storage level.</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>    <span class="k">def</span> <span class="nf">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove many objects using query to retrict removal.</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a><span class="sd">        CAUTION It is not possible to undo this operation, model_class</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a><span class="sd">        this deleted field will be removed from database when using this</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a><span class="sd">        end-point, different from using delete end-point.</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a><span class="sd">        Args:</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a><span class="sd">            model_class:</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a><span class="sd">            filter_dict:</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a><span class="sd">                Dictionary to make filter query.</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a><span class="sd">            exclude_dict:</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a><span class="sd">                Dictionary to make exclude query.</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a><span class="sd">            auth_header:</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a><span class="sd">        Returns:</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a><span class="sd">            True if delete is ok.</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a><span class="sd">        Raises:</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a><span class="sd">            PumpWoodObjectDeleteException:</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a><span class="sd">                Raises error if there is any error when commiting object</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a><span class="sd">                deletion on database.</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>    <span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all actions avaiable at this model class.</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a><span class="sd">        Args:</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a><span class="sd">          model_class:</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a><span class="sd">              Model class to list possible actions.</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a><span class="sd">          auth_header:</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a><span class="sd">        Returns:</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a><span class="sd">          List of possible actions and its descriptions.</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a><span class="sd">        Raises:</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a><span class="sd">            No particular errors.</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>    <span class="k">def</span> <span class="nf">_build_execute_action_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>                                  <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">action</span><span class="p">)</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>        <span class="k">if</span> <span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>        <span class="k">return</span> <span class="n">url_str</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>                       <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute action associated with a model class.</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a><span class="sd">        If action is static or classfunction no pk is necessary.</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a><span class="sd">        Args:</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a><span class="sd">            pk (int):</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a><span class="sd">                PK of the object to run action at. If not set action will be</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a><span class="sd">                considered a classmethod and will run over the class.</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a><span class="sd">            model_class:</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a><span class="sd">                Model class to run action the object</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a><span class="sd">            action:</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="sd">                Action that will be performed.</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a><span class="sd">            parameters:</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a><span class="sd">                Dictionary with the function parameters.</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a><span class="sd">            files:</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a><span class="sd">                bytes.</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a><span class="sd">        Returns:</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a><span class="sd">            Return a dictonary with keys:</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a><span class="sd">            - **result:**: Result of the action that was performed.</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a><span class="sd">            - **action:**: Information of the action that was performed.</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a><span class="sd">            - **parameters:** Parameters that were passed to perform the</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a><span class="sd">                action.</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a><span class="sd">            - **object:** If a pk was passed to execute and action (not</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a><span class="sd">                classmethod or staticmethod), the object with the correspondent</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a><span class="sd">                pk is returned.</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a><span class="sd">        Raises:</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a><span class="sd">                &#39;There is no method {action} in rest actions for {class_name}&#39;.</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a><span class="sd">                This indicates that action requested is not associated with</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a><span class="sd">                the model_class.</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a><span class="sd">                &#39;Function is not static and pk is Null&#39;. This indicate that</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a><span class="sd">                the action solicitated is not static/class method and a pk</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a><span class="sd">                was not passed as argument.</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a><span class="sd">                &#39;Function is static and pk is not Null&#39;. This indicate that</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a><span class="sd">                the action solicitated is static/class method and a pk</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a><span class="sd">                was passed as argument.</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a><span class="sd">                indicate that pk associated with model class was not found</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a><span class="sd">                on database.</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>    <span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return search options.</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a><span class="sd">        DEPRECTED Use `list_options` function instead.</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a><span class="sd">        Return information of the fields including avaiable options for</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a><span class="sd">        options fields and model associated with the foreign key.</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a><span class="sd">        Args:</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a><span class="sd">            model_class:</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a><span class="sd">        Returns:</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a><span class="sd">                save end-poin.</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a><span class="sd">                as values.</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a><span class="sd">        Raises:</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>    <span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>                     <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a><span class="sd">        DEPRECTED Use `fill_validation` function instead.</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a><span class="sd">        object fillment.</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a><span class="sd">        Args:</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a><span class="sd">            model_class:</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a><span class="sd">                Partial object that is sent to backend for validation and</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a><span class="sd">                update fill options acording to values passed for each field.</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a><span class="sd">            field:</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a><span class="sd">                Retrict validation for an especific field if implemented.</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a><span class="sd">        Returns:</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a><span class="sd">                save end-poin.</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a><span class="sd">                as values.</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a><span class="sd">        Raises:</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>    <span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render list views.</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a><span class="sd">        object fillment.</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a><span class="sd">        Args:</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a><span class="sd">            model_class:</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a><span class="sd">        Returns:</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a><span class="sd">            Dictionary with keys:</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a><span class="sd">            - **default_list_fields:** Default list field defined on the</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a><span class="sd">                application backend.</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a><span class="sd">            - **field_descriptions:** Description of the fields associated</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a><span class="sd">                with the model class.</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a><span class="sd">        Raises:</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a><span class="sd">          No particular raise.</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>    <span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render retrieve views.</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a><span class="sd">        Return information of the field sets that can be used to create</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a><span class="sd">        frontend site. It also return a `verbose_field` which can be used</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a><span class="sd">        to create the tittle of the page substituing the values with</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a><span class="sd">        information of the object.</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="sd">        Args:</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a><span class="sd">          model_class:</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="sd">              Model class to check search parameters.</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a><span class="sd">          auth_header:</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a><span class="sd">        Returns:</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="sd">            - **verbose_field:** String sugesting how the tittle of the</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a><span class="sd">                retrieve might be created. It will use Python format</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a><span class="sd">                information ex.: `&#39;{pk} | {description}&#39;`.</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a><span class="sd">            - **fieldset:** An dictinary with organization of data,</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a><span class="sd">                setting field sets that could be grouped toguether in</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="sd">                tabs.</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="sd">        Raises:</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>    <span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>                        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>                        <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a><span class="sd">        object fillment.</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a><span class="sd">        Args:</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a><span class="sd">            model_class:</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a><span class="sd">                Partial object data to be validated by the backend.</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a><span class="sd">            field:</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a><span class="sd">                Set an especific field to be validated if implemented.</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a><span class="sd">            user_type:</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a><span class="sd">                Set the type of user is requesting fill validation. It is</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a><span class="sd">                possible to set `api` and `gui`. Gui user_type will return</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a><span class="sd">                fields listed in gui_readonly as read-only fields to</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a><span class="sd">                facilitate navegation.</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a><span class="sd">        Returns:</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a><span class="sd">            - **field_descriptions:** Same of fill_options, but setting as</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a><span class="sd">                read_only=True fields listed on gui_readonly if</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a><span class="sd">                user_type=&#39;gui&#39;.</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a><span class="sd">            - **gui_readonly:** Return a list of fields that will be</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a><span class="sd">                considered as read-only if user_type=&#39;gui&#39; is requested.</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a><span class="sd">        Raises:</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>    <span class="k">def</span> <span class="nf">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/pivot/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>              <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>              <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>              <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>              <span class="n">add_pk_column</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pivot object data acording to columns specified.</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a><span class="sd">        Pivoting per-se is not usually used, beeing the name of the function</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a><span class="sd">        a legacy. Normality data transformation is done at the client level.</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a><span class="sd">        Args:</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a><span class="sd">            model_class (str):</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a><span class="sd">            columns (List[str]):</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a><span class="sd">                List of fields to be used as columns when pivoting the data.</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a><span class="sd">            format (str):</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a><span class="sd">                Format to be used to convert pandas.DataFrame to</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a><span class="sd">                dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a><span class="sd">                &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a><span class="sd">                Same as list function.</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a><span class="sd">                Same as list function.</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a><span class="sd">            order_by (List[str]):</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a><span class="sd">                 Same as list function.</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a><span class="sd">            variables (List[str]):</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a><span class="sd">                List of the fields to be returned, if None, the default</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a><span class="sd">                variables will be returned. Same as fields on list functions.</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="sd">                Fields with deleted column will have objects with deleted=True</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a><span class="sd">                omited from results. show_deleted=True will return this</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a><span class="sd">                information.</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a><span class="sd">            add_pk_column (bool):</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">                If add pk values of the objects at pivot results. Adding</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a><span class="sd">                pk key on pivot end-points won&#39;t be possible to pivot since</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a><span class="sd">                pk is unique for each entry.</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a><span class="sd">        Returns:</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a><span class="sd">            Return a list or a dictinary depending on the format set on</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a><span class="sd">            format parameter.</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a><span class="sd">        Raises:</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a><span class="sd">                &#39;Columns must be a list of elements.&#39;. Indicates that the list</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a><span class="sd">                argument was not a list.</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a><span class="sd">                &#39;Column chosen as pivot is not at model variables&#39;. Indicates</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="sd">                that columns that were set to pivot are not present on model</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="sd">                variables.</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a><span class="sd">                &quot;Format must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,&#39;split&#39;,</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a><span class="sd">                &#39;records&#39;,&#39;index&#39;]&quot;. Indicates that format set as paramenter</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a><span class="sd">                is not implemented.</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a><span class="sd">                &quot;Can not add pk column and pivot information&quot;. If</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a><span class="sd">                add_pk_column is True (results will have the pk column), it is</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a><span class="sd">                not possible to pivot the information (pk is an unique value</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a><span class="sd">                for each object, there is no reason to pivot it).</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a><span class="sd">                &quot;&#39;value&#39; column not at melted data, it is not possible</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a><span class="sd">                to pivot dataframe.&quot;. Indicates that data does not have a value</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a><span class="sd">                column, it must have it to populate pivoted table.</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span> <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="n">add_pk_column</span><span class="p">}</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>    <span class="k">def</span> <span class="nf">_flat_list_by_chunks_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a>            <span class="c1"># Unpacking arguments</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;filter_dict&quot;</span><span class="p">]</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>            <span class="n">exclude_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;exclude_dict&quot;</span><span class="p">]</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>            <span class="n">fields</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>            <span class="n">show_deleted</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>            <span class="n">auth_header</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;auth_header&quot;</span><span class="p">]</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>            <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>            <span class="n">max_pk</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>            <span class="c1"># Fetch data until an empty result is returned</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>            <span class="n">list_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>                <span class="n">temp_filter_dict</span><span class="p">[</span><span class="s2">&quot;id__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_pk</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>                <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>                    <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>                    <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>                    <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">,</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>                    <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>                <span class="n">temp_dateframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">))</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>                <span class="c1"># Break if results are less than chunk size, so no more results</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>                <span class="c1"># are avaiable</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chunk_size</span><span class="p">:</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>                    <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>                    <span class="k">break</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>                <span class="n">max_pk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>                <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at flat_list_by_chunks:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>    <span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>                            <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>                            <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>                            <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>                            <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>                            <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>                            <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Incrementally fetch data from pivot end-point.</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a><span class="sd">        Fetch data from pivot end-point paginating by id of chunk_size lenght.</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a><span class="sd">        If table is partitioned it will split the query acording to partition</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a><span class="sd">        to facilitate query at the database.</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a><span class="sd">        If start_date and end_date are set, also breaks the query by month</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="sd">        retrieving each month data in parallel.</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a><span class="sd">        Args:</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a><span class="sd">            model_class (str):</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a><span class="sd">                Model class to be pivoted.</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a><span class="sd">                Dictionary to to be used in objects.filter argument</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a><span class="sd">                Dictionary to to be used in objects.exclude argument</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a><span class="sd">            fields (List[str] | None):</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a><span class="sd">                List of the variables to be returned,</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a><span class="sd">                if None, the default variables will be returned.</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a><span class="sd">                If fields is set, dataframe will return that columns</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a><span class="sd">                even if data is empty.</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a><span class="sd">            start_date (datetime | str):</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a><span class="sd">                Set a begin date for the query. If begin and end date are</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a><span class="sd">                requested in parallel.</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a><span class="sd">            end_date (datetime | str):</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a><span class="sd">                Set a end date for the query. If begin and end date are</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a><span class="sd">                requested in parallel.</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a><span class="sd">                If deleted data should be returned.</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a><span class="sd">            chunk_size (int):</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a><span class="sd">                Limit of data to fetch per call.</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a><span class="sd">                Number of parallel process to perform.</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a><span class="sd">            create_composite_pk (bool):</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a><span class="sd">                If true and table has a composite pk, it will create pk</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a><span class="sd">                value based on the hash on the json serialized dictionary</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a><span class="sd">                of the components of the primary key.</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a><span class="sd">        Returns:</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a><span class="sd">            Returns a dataframe with all information fetched.</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a><span class="sd">        Raises:</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a><span class="sd">            No particular raise.</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>        <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>        <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>        <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>        <span class="c1"># Create a list of month and include start and end dates if not at</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>        <span class="c1"># the beginning of a month</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>        <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>            <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>                <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>            <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>                <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>                <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>                <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>                <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>        <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>        <span class="c1">##########################################################</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>        <span class="c1"># If table have more than one partition, run in parallel #</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>        <span class="c1"># the {partition}__in elements along with dates          #</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>            <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>            <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>            <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>            <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>                <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>                <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>            <span class="c1"># Validating query for partitioned tables</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>            <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>                    <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>                    <span class="s2">&quot;queries without at least first level partition will &quot;</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>                    <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>                    <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>                    <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>                    <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>                    <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>            <span class="c1"># Parallelizing query using partition columns</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>            <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>            <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>                <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>                <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>                <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>                        <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>                            <span class="n">request_filter_dict</span><span class="p">)</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>                        <span class="c1"># If is not the last interval, query using open</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>                        <span class="c1"># right interval so subsequence queries does</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>                        <span class="c1"># not overlap</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>                        <span class="c1"># At the last interval use closed right interval so</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>                        <span class="c1"># last element is also included in the interval</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>                        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>                            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>                            <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>                            <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>                            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>                            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>                            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>                            <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>            <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>                <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>                    <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>                        <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>        <span class="c1">############################################</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>        <span class="c1"># If table have partition, run in parallel #</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>                <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>            <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>                <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>            <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fields</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>        <span class="c1"># Adjust columns to return the columns set at fields</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>            <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>        <span class="k">return</span> <span class="n">resp_df</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>    <span class="k">def</span> <span class="nf">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/bulk-save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>    <span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a list of objects with one request.</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a><span class="sd">        It is used with a unique call save many objects at the same time. It</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a><span class="sd">        is necessary that the end-point is able to receive bulk save requests</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a><span class="sd">        and all objects been of the same model class.</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a><span class="sd">        Args:</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="sd">            model_class:</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a><span class="sd">                Data model class.</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="sd">            data_to_save:</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a><span class="sd">                A list of objects to be saved.</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a><span class="sd">        Returns:</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a><span class="sd">            A dictinary with `saved_count` as key indicating the number of</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a><span class="sd">            objects that were saved in database.</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a><span class="sd">        Raises:</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a><span class="sd">                &#39;Expected columns and data columns do not match: Expected</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a><span class="sd">                columns: {expected} Data columns: {data_cols}&#39;. Indicates</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a><span class="sd">                that the expected fields of the object were not met at the</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a><span class="sd">                objects passed to save.</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a><span class="sd">                Other sqlalchemy and psycopg2 errors not associated with</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a><span class="sd">                IntegrityError.</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a><span class="sd">                &#39;Bulk save not avaiable.&#39;. Indicates that Bulk save end-point</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a><span class="sd">                was not configured for this model_class.</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a><span class="sd">                Raise integrity errors from sqlalchemy and psycopg2. Usually</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a><span class="sd">                associated with uniqueness of some column.</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>    <span class="c1">########################</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>    <span class="c1"># Parallel aux functions</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>    <span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Concat all parallel return to one list.</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a><span class="sd">        Args:</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a><span class="sd">            parallel_result:</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a><span class="sd">                A list of lists to be flated (concatenate</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a><span class="sd">                all lists into one).</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a><span class="sd">        Returns:</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a><span class="sd">            A list with all sub list itens.</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>            <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>    <span class="k">def</span> <span class="nf">_request_get_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error on parallel get: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>    <span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>                             <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel get requests.</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a><span class="sd">        Args:</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a><span class="sd">            urls_list:</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a><span class="sd">            parameters:</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a><span class="sd">                A list of dictionary or a dictionary that will be replicated</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a><span class="sd">                len(urls_list) and passed to parallel request as url</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a><span class="sd">                parameter. If not set, empty dictionary will be passed to all</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a><span class="sd">                request as default.</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a><span class="sd">        Returns:</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a><span class="sd">            Return a list with all get request reponses. The results are</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a><span class="sd">            on the same order of argument list.</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a><span class="sd">        Raises:</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a><span class="sd">                &#39;lenght of urls_list[{}] is different of parameters[{}]&#39;.</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a><span class="sd">                Indicates that the function arguments `urls_list` and</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a><span class="sd">                `parameters` (when passed as a list of dictionaries)</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a><span class="sd">                does not have de same lenght.</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a><span class="sd">            PumpWoodNotImplementedError:</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a><span class="sd">                &#39;paraemters type[{}] is not implemented&#39;. Indicates that</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a><span class="sd">                `parameters` passed as function argument is not a list of dict</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a><span class="sd">                or a dictinary, so not implemented.</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>        <span class="c1"># Run requests in parallel</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>    <span class="k">def</span> <span class="nf">_request_post_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel post: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>    <span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>                              <span class="n">data_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>                              <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel post request.</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a><span class="sd">        Args:</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">            urls_list:</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a><span class="sd">            data_list:</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a><span class="sd">                List of data to be used as post payloads.</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a><span class="sd">            parameters:</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a><span class="sd">        Returns:</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a><span class="sd">            List of the post request reponses.</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a><span class="sd">        Raises:</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a><span class="sd">            No particular raises</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a><span class="sd">        Example:</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a><span class="sd">            No example yet.</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>        <span class="c1"># Validate if length of URL is the same of data_list</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>                <span class="s1">&#39;len(urls_list)[</span><span class="si">{}</span><span class="s1">] must be equal &#39;</span> <span class="o">+</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>                <span class="s1">&#39;to len(data_list)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">))</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>        <span class="c1"># Create the arguments for parallel requests</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>                <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>    <span class="k">def</span> <span class="nf">_request_delete_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel delete: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>    <span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete request.</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a><span class="sd">        Args:</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a><span class="sd">            urls_list:</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a><span class="sd">            parameters:</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a><span class="sd">        Returns:</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a><span class="sd">            list: List of the get request reponses.</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a><span class="sd">        Raises:</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a><span class="sd">        Example:</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a><span class="sd">            No example yet.</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>    <span class="c1">######################</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>    <span class="c1"># Parallel functions #</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>                          <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>                          <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>                          <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel retrieve request.</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a><span class="sd">        Args:</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a><span class="sd">            model_class:</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a><span class="sd">            list_pk:</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a><span class="sd">            fields:</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a><span class="sd">            default_fields:</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a><span class="sd">            related_fields:</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a><span class="sd">                carefully.</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a><span class="sd">            auth_header:</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a><span class="sd">        Returns:</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a><span class="sd">            List of the retrieve request data.</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a><span class="sd">        Raises:</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_pk)[{}]&#39;. Indicates that</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a><span class="sd">                the lenght of the arguments model_class and list_pk are</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a><span class="sd">                incompatible.</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a>                    <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_pk)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>    <span class="k">def</span> <span class="nf">_request_retrieve_file_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel retrieve_file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>                               <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>                               <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>                               <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>                               <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>                               <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] retrieve request.</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a><span class="sd">        Args:</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a><span class="sd">            model_class:</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a><span class="sd">            list_pk:</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a><span class="sd">            file_field:</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a><span class="sd">                Indicates the file field to download from.</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a><span class="sd">            save_path:</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a><span class="sd">                Path to be used to save files.</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a><span class="sd">            save_file:</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a><span class="sd">                True save file locally, False return file content as bites.</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a><span class="sd">            list_file_name:</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a><span class="sd">                Set a file name for each file download.</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a><span class="sd">            if_exists:</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a><span class="sd">                Set how treat when a file will be saved</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a><span class="sd">                and there is another at same path. &quot;fail&quot; will raise an error;</span>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a><span class="sd">                &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a><span class="sd">                when list_file_name is set, check before downloaded it file</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a><span class="sd">                already exists, if so skip the download.</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a><span class="sd">        Returns:</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a><span class="sd">            List of the retrieve file request data.</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a><span class="sd">        Raises:</span>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a><span class="sd">                &#39;Lenght of list_file_name and list_pk are not equal:</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a><span class="sd">                len(list_file_name)={list_file_name}; len(list_pk)={list_pk}&#39;.</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a><span class="sd">                Indicates that len(list_file_name) and len(list_pk) function</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a><span class="sd">                arguments are not equal.</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>                    <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>                    <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span> <span class="o">+</span>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a>                    <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a>                        <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>                        <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>            <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>            <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>                <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>                <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>                <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>                    <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>    <span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>                      <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>                      <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>                      <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list request.</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a><span class="sd">        Args:</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a><span class="sd">            model_class (str):</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a><span class="sd">            list_args (List[dict]):</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a><span class="sd">            limit (int):</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a><span class="sd">        Returns:</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a><span class="sd">        Raises:</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>    <span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>                                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>                                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>                                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_without_pag request.</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a><span class="sd">        Args:</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a><span class="sd">            model_class:</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a><span class="sd">            list_args:</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a><span class="sd">        Returns:</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a><span class="sd">        Raises:</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>    <span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_one request.</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a><span class="sd">        DEPRECTED user retrieve call with default_fields=True.</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a><span class="sd">        Args:</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a><span class="sd">            model_class:</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a><span class="sd">            list_pk:</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a><span class="sd">        Returns:</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a><span class="sd">            List of the list_one request data.</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a><span class="sd">        Raises:</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a><span class="sd">                &#39;len(model_class) != len(list_pk)&#39;. Indicates that lenght</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a><span class="sd">                of model_class and list_pk arguments are not equal.</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>    <span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>                      <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel save requests.</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a><span class="sd">        Args:</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a><span class="sd">            list_obj_dict:</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a><span class="sd">                List of dictionaries containing PumpWood objects</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a><span class="sd">                (must have at least &#39;model_class&#39; key).</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a><span class="sd">        Returns:</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a><span class="sd">            List of the save request data.</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a><span class="sd">        Raises:</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a><span class="sd">            No particular raises</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>    <span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>                        <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] delete requests.</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a><span class="sd">        Args:</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a><span class="sd">            model_class:</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a><span class="sd">            list_pk:</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a><span class="sd">        Returns:</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a><span class="sd">            List of the delete request data.</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a><span class="sd">        Raises:</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a><span class="sd">                that length of model_class and list_args arguments are not</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a><span class="sd">                equal.</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>                                           <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>    <span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>                             <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete_many request.</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a><span class="sd">        Args:</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a><span class="sd">            model_class (str):</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a><span class="sd">                Model Class to delete many.</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a><span class="sd">            list_args (list):</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a><span class="sd">                A list of list request args (filter_dict, exclude_dict).</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a><span class="sd">        Returns:</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a><span class="sd">            List of the delete many request reponses.</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a><span class="sd">        Raises:</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a><span class="sd">                that length of model_class and list_args arguments</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a><span class="sd">                are not equal.</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a><span class="sd">        Example:</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a><span class="sd">            No example yet.</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>    <span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>                                <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>                                <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel execute_action requests.</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a><span class="sd">        Args:</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a><span class="sd">            model_class:</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a><span class="sd">                Model Class to perform action over,</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a><span class="sd">                or a list of model class o make diferent actions.</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a><span class="sd">            pk:</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a><span class="sd">                A list of the pks to perform action or a</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a><span class="sd">                single pk to perform action with different paraemters.</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a><span class="sd">            action:</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a><span class="sd">                A list of actions to perform or a single</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a><span class="sd">                action to perform over all pks and parameters.</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a><span class="sd">            parameters:</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a><span class="sd">                Parameters used to perform actions</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a><span class="sd">                or a single dict to be used in all actions.</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a><span class="sd">        Returns:</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a><span class="sd">            List of the execute_action request data.</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a><span class="sd">        Raises:</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a><span class="sd">                &#39;parallel_length != len([argument])&#39;. Indicates that function</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a><span class="sd">                arguments does not have all the same lenght.</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a><span class="sd">        Example:</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a><span class="sd">            No example yet.</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>        <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>                        <span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>                        <span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>                        <span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>                        <span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a>            <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>        <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>            <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>            <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>            <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a>    <span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a>                           <span class="n">data_to_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]],</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Break data_to_save in many parallel bulk_save requests.</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a><span class="sd">        Args:</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a><span class="sd">            model_class:</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a><span class="sd">                Model class of the data that will be saved.</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a><span class="sd">            data_to_save:</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a><span class="sd">                Data that will be saved</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a><span class="sd">            chunksize:</span>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a><span class="sd">                Length of each parallel bulk save chunk.</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a><span class="sd">        Returns:</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a><span class="sd">            List of the responses of bulk_save.</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a>            <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>    <span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>                       <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>                       <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel pivot request.</span>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a><span class="sd">        Args:</span>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a><span class="sd">            model_class:</span>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a><span class="sd">            list_args:</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a><span class="sd">                A list of list request args (filter_dict,exclude_dict,</span>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a><span class="sd">                order_by).</span>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a><span class="sd">            columns:</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a><span class="sd">                List of columns at the pivoted table.</span>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a><span class="sd">            format:</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a><span class="sd">                Format of returned table. See pandas.DataFrame</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a><span class="sd">                to_dict args.</span>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a><span class="sd">            n_parallel:</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a><span class="sd">            variables:</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a><span class="sd">                Restrict the fields that will be returned at the query.</span>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a><span class="sd">            show_deleted:</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a><span class="sd">                If results should include data with deleted=True. This will</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a><span class="sd">                be ignored if model class does not have deleted field.</span>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a><span class="sd">            auth_header:</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a><span class="sd">        Returns:</span>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a><span class="sd">            List of the pivot request reponses.</span>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a><span class="sd">        Raises:</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a><span class="sd">            No particular raises.</span>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a><span class="sd">        Example:</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a><span class="sd">            No example yet.</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a>        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a>        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a>    <span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a>                         <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix. In development...&quot;&quot;&quot;</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a>        <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a>            <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a>            <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a>            <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a>        <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a>        <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a>        <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a>            <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a>            <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a>                <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a>                <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</span></pre></div>


            </section>
                <section id="break_in_chunks">
                            <input id="break_in_chunks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">break_in_chunks</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df_to_break</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="break_in_chunks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#break_in_chunks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="break_in_chunks-48"><a href="#break_in_chunks-48"><span class="linenos">48</span></a><span class="k">def</span> <span class="nf">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="break_in_chunks-49"><a href="#break_in_chunks-49"><span class="linenos">49</span></a>                    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="break_in_chunks-50"><a href="#break_in_chunks-50"><span class="linenos">50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Break a dataframe in chunks of chunksize.</span>
</span><span id="break_in_chunks-51"><a href="#break_in_chunks-51"><span class="linenos">51</span></a>
</span><span id="break_in_chunks-52"><a href="#break_in_chunks-52"><span class="linenos">52</span></a><span class="sd">    Args:</span>
</span><span id="break_in_chunks-53"><a href="#break_in_chunks-53"><span class="linenos">53</span></a><span class="sd">        df_to_break: Dataframe to be break in chunks of `chunksize` size.</span>
</span><span id="break_in_chunks-54"><a href="#break_in_chunks-54"><span class="linenos">54</span></a><span class="sd">        chunksize: Length of each chuck of the breaks of `df_to_break`.</span>
</span><span id="break_in_chunks-55"><a href="#break_in_chunks-55"><span class="linenos">55</span></a>
</span><span id="break_in_chunks-56"><a href="#break_in_chunks-56"><span class="linenos">56</span></a><span class="sd">    Returns:</span>
</span><span id="break_in_chunks-57"><a href="#break_in_chunks-57"><span class="linenos">57</span></a><span class="sd">        Return a list dataframes with lenght chunksize of data from</span>
</span><span id="break_in_chunks-58"><a href="#break_in_chunks-58"><span class="linenos">58</span></a><span class="sd">        `df_to_break`.</span>
</span><span id="break_in_chunks-59"><a href="#break_in_chunks-59"><span class="linenos">59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="break_in_chunks-60"><a href="#break_in_chunks-60"><span class="linenos">60</span></a>    <span class="n">to_return</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="break_in_chunks-61"><a href="#break_in_chunks-61"><span class="linenos">61</span></a>    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_to_break</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">))</span> <span class="o">//</span> <span class="n">chunksize</span><span class="p">):</span>
</span><span id="break_in_chunks-62"><a href="#break_in_chunks-62"><span class="linenos">62</span></a>        <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="break_in_chunks-63"><a href="#break_in_chunks-63"><span class="linenos">63</span></a>    <span class="k">return</span> <span class="n">to_return</span>
</span></pre></div>


            <div class="docstring"><p>Break a dataframe in chunks of chunksize.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>df_to_break:</strong>  Dataframe to be break in chunks of <code>chunksize</code> size.</li>
<li><strong>chunksize:</strong>  Length of each chuck of the breaks of <code>df_to_break</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a list dataframes with lenght chunksize of data from
  <code>df_to_break</code>.</p>
</blockquote>
</div>


                </section>
                <section id="PumpWoodMicroService">
                            <input id="PumpWoodMicroService-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PumpWoodMicroService</span><wbr>(<span class="base">pumpwood_communication.microservice_abc.simple.batch.ABCSimpleBatchMicroservice</span>, <span class="base">pumpwood_communication.microservice_abc.simple.permission.ABCPermissionMicroservice</span>):

                <label class="view-source-button" for="PumpWoodMicroService-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService-66"><a href="#PumpWoodMicroService-66"><span class="linenos">  66</span></a><span class="k">class</span> <span class="nc">PumpWoodMicroService</span><span class="p">(</span><span class="n">ABCSimpleBatchMicroservice</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-67"><a href="#PumpWoodMicroService-67"><span class="linenos">  67</span></a>                           <span class="n">ABCPermissionMicroservice</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-68"><a href="#PumpWoodMicroService-68"><span class="linenos">  68</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to define an inter-pumpwood MicroService.</span>
</span><span id="PumpWoodMicroService-69"><a href="#PumpWoodMicroService-69"><span class="linenos">  69</span></a>
</span><span id="PumpWoodMicroService-70"><a href="#PumpWoodMicroService-70"><span class="linenos">  70</span></a><span class="sd">    Create an object ot help communication with Pumpwood based backends. It</span>
</span><span id="PumpWoodMicroService-71"><a href="#PumpWoodMicroService-71"><span class="linenos">  71</span></a><span class="sd">    manage login and token refresh if necessary.</span>
</span><span id="PumpWoodMicroService-72"><a href="#PumpWoodMicroService-72"><span class="linenos">  72</span></a>
</span><span id="PumpWoodMicroService-73"><a href="#PumpWoodMicroService-73"><span class="linenos">  73</span></a><span class="sd">    It also implements parallel functions that split requests in parallel</span>
</span><span id="PumpWoodMicroService-74"><a href="#PumpWoodMicroService-74"><span class="linenos">  74</span></a><span class="sd">    process to reduce processing time.</span>
</span><span id="PumpWoodMicroService-75"><a href="#PumpWoodMicroService-75"><span class="linenos">  75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-76"><a href="#PumpWoodMicroService-76"><span class="linenos">  76</span></a>
</span><span id="PumpWoodMicroService-77"><a href="#PumpWoodMicroService-77"><span class="linenos">  77</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="PumpWoodMicroService-78"><a href="#PumpWoodMicroService-78"><span class="linenos">  78</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the MicroService object, can be used for debug proposes.&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-79"><a href="#PumpWoodMicroService-79"><span class="linenos">  79</span></a>    <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="PumpWoodMicroService-80"><a href="#PumpWoodMicroService-80"><span class="linenos">  80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;URL of the Pumpwood server.&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-81"><a href="#PumpWoodMicroService-81"><span class="linenos">  81</span></a>    <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="PumpWoodMicroService-82"><a href="#PumpWoodMicroService-82"><span class="linenos">  82</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If SSL certificates will be checked on HTTPs requests.&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-83"><a href="#PumpWoodMicroService-83"><span class="linenos">  83</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="PumpWoodMicroService-84"><a href="#PumpWoodMicroService-84"><span class="linenos">  84</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-85"><a href="#PumpWoodMicroService-85"><span class="linenos">  85</span></a><span class="sd">    If microservice service is set as debug, if debug=TRUE all request will</span>
</span><span id="PumpWoodMicroService-86"><a href="#PumpWoodMicroService-86"><span class="linenos">  86</span></a><span class="sd">    refresh authorization token.</span>
</span><span id="PumpWoodMicroService-87"><a href="#PumpWoodMicroService-87"><span class="linenos">  87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-88"><a href="#PumpWoodMicroService-88"><span class="linenos">  88</span></a>
</span><span id="PumpWoodMicroService-89"><a href="#PumpWoodMicroService-89"><span class="linenos">  89</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-90"><a href="#PumpWoodMicroService-90"><span class="linenos">  90</span></a>    <span class="k">def</span> <span class="nf">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-91"><a href="#PumpWoodMicroService-91"><span class="linenos">  91</span></a>        <span class="k">if</span> <span class="n">server_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-92"><a href="#PumpWoodMicroService-92"><span class="linenos">  92</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-93"><a href="#PumpWoodMicroService-93"><span class="linenos">  93</span></a>        <span class="k">if</span> <span class="n">server_url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-94"><a href="#PumpWoodMicroService-94"><span class="linenos">  94</span></a>            <span class="k">return</span> <span class="n">server_url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="PumpWoodMicroService-95"><a href="#PumpWoodMicroService-95"><span class="linenos">  95</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-96"><a href="#PumpWoodMicroService-96"><span class="linenos">  96</span></a>            <span class="k">return</span> <span class="n">server_url</span>
</span><span id="PumpWoodMicroService-97"><a href="#PumpWoodMicroService-97"><span class="linenos">  97</span></a>
</span><span id="PumpWoodMicroService-98"><a href="#PumpWoodMicroService-98"><span class="linenos">  98</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-99"><a href="#PumpWoodMicroService-99"><span class="linenos">  99</span></a>                 <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-100"><a href="#PumpWoodMicroService-100"><span class="linenos"> 100</span></a>                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-101"><a href="#PumpWoodMicroService-101"><span class="linenos"> 101</span></a>                 <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="PumpWoodMicroService-102"><a href="#PumpWoodMicroService-102"><span class="linenos"> 102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new PumpWoodMicroService object.</span>
</span><span id="PumpWoodMicroService-103"><a href="#PumpWoodMicroService-103"><span class="linenos"> 103</span></a>
</span><span id="PumpWoodMicroService-104"><a href="#PumpWoodMicroService-104"><span class="linenos"> 104</span></a><span class="sd">        Creates a new microservice object. If just name is passed, object must</span>
</span><span id="PumpWoodMicroService-105"><a href="#PumpWoodMicroService-105"><span class="linenos"> 105</span></a><span class="sd">        be initiate after with init() method.</span>
</span><span id="PumpWoodMicroService-106"><a href="#PumpWoodMicroService-106"><span class="linenos"> 106</span></a>
</span><span id="PumpWoodMicroService-107"><a href="#PumpWoodMicroService-107"><span class="linenos"> 107</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-108"><a href="#PumpWoodMicroService-108"><span class="linenos"> 108</span></a><span class="sd">            name:</span>
</span><span id="PumpWoodMicroService-109"><a href="#PumpWoodMicroService-109"><span class="linenos"> 109</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="PumpWoodMicroService-110"><a href="#PumpWoodMicroService-110"><span class="linenos"> 110</span></a><span class="sd">                are raised.</span>
</span><span id="PumpWoodMicroService-111"><a href="#PumpWoodMicroService-111"><span class="linenos"> 111</span></a><span class="sd">            server_url:</span>
</span><span id="PumpWoodMicroService-112"><a href="#PumpWoodMicroService-112"><span class="linenos"> 112</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="PumpWoodMicroService-113"><a href="#PumpWoodMicroService-113"><span class="linenos"> 113</span></a><span class="sd">            username:</span>
</span><span id="PumpWoodMicroService-114"><a href="#PumpWoodMicroService-114"><span class="linenos"> 114</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="PumpWoodMicroService-115"><a href="#PumpWoodMicroService-115"><span class="linenos"> 115</span></a><span class="sd">            password:</span>
</span><span id="PumpWoodMicroService-116"><a href="#PumpWoodMicroService-116"><span class="linenos"> 116</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="PumpWoodMicroService-117"><a href="#PumpWoodMicroService-117"><span class="linenos"> 117</span></a><span class="sd">                with the request.</span>
</span><span id="PumpWoodMicroService-118"><a href="#PumpWoodMicroService-118"><span class="linenos"> 118</span></a><span class="sd">            verify_ssl:</span>
</span><span id="PumpWoodMicroService-119"><a href="#PumpWoodMicroService-119"><span class="linenos"> 119</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="PumpWoodMicroService-120"><a href="#PumpWoodMicroService-120"><span class="linenos"> 120</span></a><span class="sd">            debug:</span>
</span><span id="PumpWoodMicroService-121"><a href="#PumpWoodMicroService-121"><span class="linenos"> 121</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="PumpWoodMicroService-122"><a href="#PumpWoodMicroService-122"><span class="linenos"> 122</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="PumpWoodMicroService-123"><a href="#PumpWoodMicroService-123"><span class="linenos"> 123</span></a><span class="sd">            default_timeout:</span>
</span><span id="PumpWoodMicroService-124"><a href="#PumpWoodMicroService-124"><span class="linenos"> 124</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="PumpWoodMicroService-125"><a href="#PumpWoodMicroService-125"><span class="linenos"> 125</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService-126"><a href="#PumpWoodMicroService-126"><span class="linenos"> 126</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="PumpWoodMicroService-127"><a href="#PumpWoodMicroService-127"><span class="linenos"> 127</span></a>
</span><span id="PumpWoodMicroService-128"><a href="#PumpWoodMicroService-128"><span class="linenos"> 128</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-129"><a href="#PumpWoodMicroService-129"><span class="linenos"> 129</span></a><span class="sd">            PumpWoodMicroService: New PumpWoodMicroService object</span>
</span><span id="PumpWoodMicroService-130"><a href="#PumpWoodMicroService-130"><span class="linenos"> 130</span></a>
</span><span id="PumpWoodMicroService-131"><a href="#PumpWoodMicroService-131"><span class="linenos"> 131</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-132"><a href="#PumpWoodMicroService-132"><span class="linenos"> 132</span></a><span class="sd">            No particular Raises.</span>
</span><span id="PumpWoodMicroService-133"><a href="#PumpWoodMicroService-133"><span class="linenos"> 133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-134"><a href="#PumpWoodMicroService-134"><span class="linenos"> 134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="PumpWoodMicroService-135"><a href="#PumpWoodMicroService-135"><span class="linenos"> 135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-136"><a href="#PumpWoodMicroService-136"><span class="linenos"> 136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-137"><a href="#PumpWoodMicroService-137"><span class="linenos"> 137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="PumpWoodMicroService-138"><a href="#PumpWoodMicroService-138"><span class="linenos"> 138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="PumpWoodMicroService-139"><a href="#PumpWoodMicroService-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-140"><a href="#PumpWoodMicroService-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="PumpWoodMicroService-141"><a href="#PumpWoodMicroService-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-142"><a href="#PumpWoodMicroService-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-143"><a href="#PumpWoodMicroService-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-144"><a href="#PumpWoodMicroService-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="PumpWoodMicroService-145"><a href="#PumpWoodMicroService-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-146"><a href="#PumpWoodMicroService-146"><span class="linenos"> 146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span><span id="PumpWoodMicroService-147"><a href="#PumpWoodMicroService-147"><span class="linenos"> 147</span></a>
</span><span id="PumpWoodMicroService-148"><a href="#PumpWoodMicroService-148"><span class="linenos"> 148</span></a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-149"><a href="#PumpWoodMicroService-149"><span class="linenos"> 149</span></a>             <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-150"><a href="#PumpWoodMicroService-150"><span class="linenos"> 150</span></a>             <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-151"><a href="#PumpWoodMicroService-151"><span class="linenos"> 151</span></a>             <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="PumpWoodMicroService-152"><a href="#PumpWoodMicroService-152"><span class="linenos"> 152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazzy initialization of the MicroService of object.</span>
</span><span id="PumpWoodMicroService-153"><a href="#PumpWoodMicroService-153"><span class="linenos"> 153</span></a>
</span><span id="PumpWoodMicroService-154"><a href="#PumpWoodMicroService-154"><span class="linenos"> 154</span></a><span class="sd">        This function might be usefull to use the object as a singleton at</span>
</span><span id="PumpWoodMicroService-155"><a href="#PumpWoodMicroService-155"><span class="linenos"> 155</span></a><span class="sd">        the backends. Using this function it is possible to instanciate an</span>
</span><span id="PumpWoodMicroService-156"><a href="#PumpWoodMicroService-156"><span class="linenos"> 156</span></a><span class="sd">        empty object and them set the attributes latter at the systems.</span>
</span><span id="PumpWoodMicroService-157"><a href="#PumpWoodMicroService-157"><span class="linenos"> 157</span></a>
</span><span id="PumpWoodMicroService-158"><a href="#PumpWoodMicroService-158"><span class="linenos"> 158</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-159"><a href="#PumpWoodMicroService-159"><span class="linenos"> 159</span></a><span class="sd">            name:</span>
</span><span id="PumpWoodMicroService-160"><a href="#PumpWoodMicroService-160"><span class="linenos"> 160</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="PumpWoodMicroService-161"><a href="#PumpWoodMicroService-161"><span class="linenos"> 161</span></a><span class="sd">                are raised.</span>
</span><span id="PumpWoodMicroService-162"><a href="#PumpWoodMicroService-162"><span class="linenos"> 162</span></a><span class="sd">            server_url:</span>
</span><span id="PumpWoodMicroService-163"><a href="#PumpWoodMicroService-163"><span class="linenos"> 163</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="PumpWoodMicroService-164"><a href="#PumpWoodMicroService-164"><span class="linenos"> 164</span></a><span class="sd">            username:</span>
</span><span id="PumpWoodMicroService-165"><a href="#PumpWoodMicroService-165"><span class="linenos"> 165</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="PumpWoodMicroService-166"><a href="#PumpWoodMicroService-166"><span class="linenos"> 166</span></a><span class="sd">            password:</span>
</span><span id="PumpWoodMicroService-167"><a href="#PumpWoodMicroService-167"><span class="linenos"> 167</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="PumpWoodMicroService-168"><a href="#PumpWoodMicroService-168"><span class="linenos"> 168</span></a><span class="sd">                with the request.</span>
</span><span id="PumpWoodMicroService-169"><a href="#PumpWoodMicroService-169"><span class="linenos"> 169</span></a><span class="sd">            verify_ssl:</span>
</span><span id="PumpWoodMicroService-170"><a href="#PumpWoodMicroService-170"><span class="linenos"> 170</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="PumpWoodMicroService-171"><a href="#PumpWoodMicroService-171"><span class="linenos"> 171</span></a><span class="sd">            debug:</span>
</span><span id="PumpWoodMicroService-172"><a href="#PumpWoodMicroService-172"><span class="linenos"> 172</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="PumpWoodMicroService-173"><a href="#PumpWoodMicroService-173"><span class="linenos"> 173</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="PumpWoodMicroService-174"><a href="#PumpWoodMicroService-174"><span class="linenos"> 174</span></a><span class="sd">            default_timeout:</span>
</span><span id="PumpWoodMicroService-175"><a href="#PumpWoodMicroService-175"><span class="linenos"> 175</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="PumpWoodMicroService-176"><a href="#PumpWoodMicroService-176"><span class="linenos"> 176</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService-177"><a href="#PumpWoodMicroService-177"><span class="linenos"> 177</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="PumpWoodMicroService-178"><a href="#PumpWoodMicroService-178"><span class="linenos"> 178</span></a>
</span><span id="PumpWoodMicroService-179"><a href="#PumpWoodMicroService-179"><span class="linenos"> 179</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-180"><a href="#PumpWoodMicroService-180"><span class="linenos"> 180</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService-181"><a href="#PumpWoodMicroService-181"><span class="linenos"> 181</span></a>
</span><span id="PumpWoodMicroService-182"><a href="#PumpWoodMicroService-182"><span class="linenos"> 182</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-183"><a href="#PumpWoodMicroService-183"><span class="linenos"> 183</span></a><span class="sd">            No particular Raises</span>
</span><span id="PumpWoodMicroService-184"><a href="#PumpWoodMicroService-184"><span class="linenos"> 184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-185"><a href="#PumpWoodMicroService-185"><span class="linenos"> 185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="PumpWoodMicroService-186"><a href="#PumpWoodMicroService-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-187"><a href="#PumpWoodMicroService-187"><span class="linenos"> 187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="PumpWoodMicroService-188"><a href="#PumpWoodMicroService-188"><span class="linenos"> 188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="PumpWoodMicroService-189"><a href="#PumpWoodMicroService-189"><span class="linenos"> 189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-190"><a href="#PumpWoodMicroService-190"><span class="linenos"> 190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="PumpWoodMicroService-191"><a href="#PumpWoodMicroService-191"><span class="linenos"> 191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span><span id="PumpWoodMicroService-192"><a href="#PumpWoodMicroService-192"><span class="linenos"> 192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="PumpWoodMicroService-193"><a href="#PumpWoodMicroService-193"><span class="linenos"> 193</span></a>
</span><span id="PumpWoodMicroService-194"><a href="#PumpWoodMicroService-194"><span class="linenos"> 194</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-195"><a href="#PumpWoodMicroService-195"><span class="linenos"> 195</span></a>    <span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-196"><a href="#PumpWoodMicroService-196"><span class="linenos"> 196</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert text to Json removing any XSSI at the beging of JSON.</span>
</span><span id="PumpWoodMicroService-197"><a href="#PumpWoodMicroService-197"><span class="linenos"> 197</span></a>
</span><span id="PumpWoodMicroService-198"><a href="#PumpWoodMicroService-198"><span class="linenos"> 198</span></a><span class="sd">        Some backends add `)]}&#39;,\n` at the beginning of the JSON data to</span>
</span><span id="PumpWoodMicroService-199"><a href="#PumpWoodMicroService-199"><span class="linenos"> 199</span></a><span class="sd">        prevent injection of functions. This function remove this characters</span>
</span><span id="PumpWoodMicroService-200"><a href="#PumpWoodMicroService-200"><span class="linenos"> 200</span></a><span class="sd">        if present.</span>
</span><span id="PumpWoodMicroService-201"><a href="#PumpWoodMicroService-201"><span class="linenos"> 201</span></a>
</span><span id="PumpWoodMicroService-202"><a href="#PumpWoodMicroService-202"><span class="linenos"> 202</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-203"><a href="#PumpWoodMicroService-203"><span class="linenos"> 203</span></a><span class="sd">            request_result:</span>
</span><span id="PumpWoodMicroService-204"><a href="#PumpWoodMicroService-204"><span class="linenos"> 204</span></a><span class="sd">                JSON Request to be converted</span>
</span><span id="PumpWoodMicroService-205"><a href="#PumpWoodMicroService-205"><span class="linenos"> 205</span></a>
</span><span id="PumpWoodMicroService-206"><a href="#PumpWoodMicroService-206"><span class="linenos"> 206</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-207"><a href="#PumpWoodMicroService-207"><span class="linenos"> 207</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService-208"><a href="#PumpWoodMicroService-208"><span class="linenos"> 208</span></a>
</span><span id="PumpWoodMicroService-209"><a href="#PumpWoodMicroService-209"><span class="linenos"> 209</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-210"><a href="#PumpWoodMicroService-210"><span class="linenos"> 210</span></a><span class="sd">            No particular Raises</span>
</span><span id="PumpWoodMicroService-211"><a href="#PumpWoodMicroService-211"><span class="linenos"> 211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-212"><a href="#PumpWoodMicroService-212"><span class="linenos"> 212</span></a>        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-213"><a href="#PumpWoodMicroService-213"><span class="linenos"> 213</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-214"><a href="#PumpWoodMicroService-214"><span class="linenos"> 214</span></a>
</span><span id="PumpWoodMicroService-215"><a href="#PumpWoodMicroService-215"><span class="linenos"> 215</span></a>        <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService-216"><a href="#PumpWoodMicroService-216"><span class="linenos"> 216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-217"><a href="#PumpWoodMicroService-217"><span class="linenos"> 217</span></a>            <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-218"><a href="#PumpWoodMicroService-218"><span class="linenos"> 218</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
</span><span id="PumpWoodMicroService-219"><a href="#PumpWoodMicroService-219"><span class="linenos"> 219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-220"><a href="#PumpWoodMicroService-220"><span class="linenos"> 220</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-221"><a href="#PumpWoodMicroService-221"><span class="linenos"> 221</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-222"><a href="#PumpWoodMicroService-222"><span class="linenos"> 222</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-223"><a href="#PumpWoodMicroService-223"><span class="linenos"> 223</span></a>                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-224"><a href="#PumpWoodMicroService-224"><span class="linenos"> 224</span></a>
</span><span id="PumpWoodMicroService-225"><a href="#PumpWoodMicroService-225"><span class="linenos"> 225</span></a>    <span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-226"><a href="#PumpWoodMicroService-226"><span class="linenos"> 226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return time to token expiry.</span>
</span><span id="PumpWoodMicroService-227"><a href="#PumpWoodMicroService-227"><span class="linenos"> 227</span></a>
</span><span id="PumpWoodMicroService-228"><a href="#PumpWoodMicroService-228"><span class="linenos"> 228</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-229"><a href="#PumpWoodMicroService-229"><span class="linenos"> 229</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService-230"><a href="#PumpWoodMicroService-230"><span class="linenos"> 230</span></a>
</span><span id="PumpWoodMicroService-231"><a href="#PumpWoodMicroService-231"><span class="linenos"> 231</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-232"><a href="#PumpWoodMicroService-232"><span class="linenos"> 232</span></a><span class="sd">            Return time until token expiration.</span>
</span><span id="PumpWoodMicroService-233"><a href="#PumpWoodMicroService-233"><span class="linenos"> 233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-234"><a href="#PumpWoodMicroService-234"><span class="linenos"> 234</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-235"><a href="#PumpWoodMicroService-235"><span class="linenos"> 235</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-236"><a href="#PumpWoodMicroService-236"><span class="linenos"> 236</span></a>
</span><span id="PumpWoodMicroService-237"><a href="#PumpWoodMicroService-237"><span class="linenos"> 237</span></a>        <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-238"><a href="#PumpWoodMicroService-238"><span class="linenos"> 238</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-239"><a href="#PumpWoodMicroService-239"><span class="linenos"> 239</span></a>        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
</span><span id="PumpWoodMicroService-240"><a href="#PumpWoodMicroService-240"><span class="linenos"> 240</span></a>        <span class="k">return</span> <span class="n">time_to_expiry</span>
</span><span id="PumpWoodMicroService-241"><a href="#PumpWoodMicroService-241"><span class="linenos"> 241</span></a>
</span><span id="PumpWoodMicroService-242"><a href="#PumpWoodMicroService-242"><span class="linenos"> 242</span></a>    <span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-243"><a href="#PumpWoodMicroService-243"><span class="linenos"> 243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if username and password are set on object.</span>
</span><span id="PumpWoodMicroService-244"><a href="#PumpWoodMicroService-244"><span class="linenos"> 244</span></a>
</span><span id="PumpWoodMicroService-245"><a href="#PumpWoodMicroService-245"><span class="linenos"> 245</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-246"><a href="#PumpWoodMicroService-246"><span class="linenos"> 246</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService-247"><a href="#PumpWoodMicroService-247"><span class="linenos"> 247</span></a>
</span><span id="PumpWoodMicroService-248"><a href="#PumpWoodMicroService-248"><span class="linenos"> 248</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-249"><a href="#PumpWoodMicroService-249"><span class="linenos"> 249</span></a><span class="sd">            True if usename and password were set during object creation or</span>
</span><span id="PumpWoodMicroService-250"><a href="#PumpWoodMicroService-250"><span class="linenos"> 250</span></a><span class="sd">            later with init function.</span>
</span><span id="PumpWoodMicroService-251"><a href="#PumpWoodMicroService-251"><span class="linenos"> 251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-252"><a href="#PumpWoodMicroService-252"><span class="linenos"> 252</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-253"><a href="#PumpWoodMicroService-253"><span class="linenos"> 253</span></a>
</span><span id="PumpWoodMicroService-254"><a href="#PumpWoodMicroService-254"><span class="linenos"> 254</span></a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-255"><a href="#PumpWoodMicroService-255"><span class="linenos"> 255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log microservice in using username and password provided.</span>
</span><span id="PumpWoodMicroService-256"><a href="#PumpWoodMicroService-256"><span class="linenos"> 256</span></a>
</span><span id="PumpWoodMicroService-257"><a href="#PumpWoodMicroService-257"><span class="linenos"> 257</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-258"><a href="#PumpWoodMicroService-258"><span class="linenos"> 258</span></a><span class="sd">            force_refresh (bool):</span>
</span><span id="PumpWoodMicroService-259"><a href="#PumpWoodMicroService-259"><span class="linenos"> 259</span></a><span class="sd">                Force token refresh despise still valid</span>
</span><span id="PumpWoodMicroService-260"><a href="#PumpWoodMicroService-260"><span class="linenos"> 260</span></a><span class="sd">                according to self.__token_expiry.</span>
</span><span id="PumpWoodMicroService-261"><a href="#PumpWoodMicroService-261"><span class="linenos"> 261</span></a>
</span><span id="PumpWoodMicroService-262"><a href="#PumpWoodMicroService-262"><span class="linenos"> 262</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-263"><a href="#PumpWoodMicroService-263"><span class="linenos"> 263</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService-264"><a href="#PumpWoodMicroService-264"><span class="linenos"> 264</span></a>
</span><span id="PumpWoodMicroService-265"><a href="#PumpWoodMicroService-265"><span class="linenos"> 265</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-266"><a href="#PumpWoodMicroService-266"><span class="linenos"> 266</span></a><span class="sd">            Exception: If login response has status diferent from 200.</span>
</span><span id="PumpWoodMicroService-267"><a href="#PumpWoodMicroService-267"><span class="linenos"> 267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-268"><a href="#PumpWoodMicroService-268"><span class="linenos"> 268</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-269"><a href="#PumpWoodMicroService-269"><span class="linenos"> 269</span></a>            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-270"><a href="#PumpWoodMicroService-270"><span class="linenos"> 270</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-271"><a href="#PumpWoodMicroService-271"><span class="linenos"> 271</span></a>
</span><span id="PumpWoodMicroService-272"><a href="#PumpWoodMicroService-272"><span class="linenos"> 272</span></a>        <span class="c1"># Check if expiry time is 1h from now</span>
</span><span id="PumpWoodMicroService-273"><a href="#PumpWoodMicroService-273"><span class="linenos"> 273</span></a>        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-274"><a href="#PumpWoodMicroService-274"><span class="linenos"> 274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-275"><a href="#PumpWoodMicroService-275"><span class="linenos"> 275</span></a>            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-276"><a href="#PumpWoodMicroService-276"><span class="linenos"> 276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-277"><a href="#PumpWoodMicroService-277"><span class="linenos"> 277</span></a>            <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-278"><a href="#PumpWoodMicroService-278"><span class="linenos"> 278</span></a>            <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-279"><a href="#PumpWoodMicroService-279"><span class="linenos"> 279</span></a>                <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-280"><a href="#PumpWoodMicroService-280"><span class="linenos"> 280</span></a>
</span><span id="PumpWoodMicroService-281"><a href="#PumpWoodMicroService-281"><span class="linenos"> 281</span></a>        <span class="c1"># When if debug always refresh token</span>
</span><span id="PumpWoodMicroService-282"><a href="#PumpWoodMicroService-282"><span class="linenos"> 282</span></a>        <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-283"><a href="#PumpWoodMicroService-283"><span class="linenos"> 283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-284"><a href="#PumpWoodMicroService-284"><span class="linenos"> 284</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-285"><a href="#PumpWoodMicroService-285"><span class="linenos"> 285</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
</span><span id="PumpWoodMicroService-286"><a href="#PumpWoodMicroService-286"><span class="linenos"> 286</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-287"><a href="#PumpWoodMicroService-287"><span class="linenos"> 287</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="PumpWoodMicroService-288"><a href="#PumpWoodMicroService-288"><span class="linenos"> 288</span></a>
</span><span id="PumpWoodMicroService-289"><a href="#PumpWoodMicroService-289"><span class="linenos"> 289</span></a>        <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-290"><a href="#PumpWoodMicroService-290"><span class="linenos"> 290</span></a>            <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-291"><a href="#PumpWoodMicroService-291"><span class="linenos"> 291</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-292"><a href="#PumpWoodMicroService-292"><span class="linenos"> 292</span></a>            <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-293"><a href="#PumpWoodMicroService-293"><span class="linenos"> 293</span></a>                <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-294"><a href="#PumpWoodMicroService-294"><span class="linenos"> 294</span></a>                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-295"><a href="#PumpWoodMicroService-295"><span class="linenos"> 295</span></a>                    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-296"><a href="#PumpWoodMicroService-296"><span class="linenos"> 296</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-297"><a href="#PumpWoodMicroService-297"><span class="linenos"> 297</span></a>
</span><span id="PumpWoodMicroService-298"><a href="#PumpWoodMicroService-298"><span class="linenos"> 298</span></a>            <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService-299"><a href="#PumpWoodMicroService-299"><span class="linenos"> 299</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-300"><a href="#PumpWoodMicroService-300"><span class="linenos"> 300</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-301"><a href="#PumpWoodMicroService-301"><span class="linenos"> 301</span></a>                <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-302"><a href="#PumpWoodMicroService-302"><span class="linenos"> 302</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-303"><a href="#PumpWoodMicroService-303"><span class="linenos"> 303</span></a>                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-304"><a href="#PumpWoodMicroService-304"><span class="linenos"> 304</span></a>                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="PumpWoodMicroService-305"><a href="#PumpWoodMicroService-305"><span class="linenos"> 305</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-306"><a href="#PumpWoodMicroService-306"><span class="linenos"> 306</span></a>
</span><span id="PumpWoodMicroService-307"><a href="#PumpWoodMicroService-307"><span class="linenos"> 307</span></a>            <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-308"><a href="#PumpWoodMicroService-308"><span class="linenos"> 308</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-309"><a href="#PumpWoodMicroService-309"><span class="linenos"> 309</span></a>
</span><span id="PumpWoodMicroService-310"><a href="#PumpWoodMicroService-310"><span class="linenos"> 310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-311"><a href="#PumpWoodMicroService-311"><span class="linenos"> 311</span></a>                <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
</span><span id="PumpWoodMicroService-312"><a href="#PumpWoodMicroService-312"><span class="linenos"> 312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-313"><a href="#PumpWoodMicroService-313"><span class="linenos"> 313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-314"><a href="#PumpWoodMicroService-314"><span class="linenos"> 314</span></a>
</span><span id="PumpWoodMicroService-315"><a href="#PumpWoodMicroService-315"><span class="linenos"> 315</span></a>    <span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-316"><a href="#PumpWoodMicroService-316"><span class="linenos"> 316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ask user to confirm MFA code to login.</span>
</span><span id="PumpWoodMicroService-317"><a href="#PumpWoodMicroService-317"><span class="linenos"> 317</span></a>
</span><span id="PumpWoodMicroService-318"><a href="#PumpWoodMicroService-318"><span class="linenos"> 318</span></a><span class="sd">        Open an input interface at terminal for user to validate MFA token.</span>
</span><span id="PumpWoodMicroService-319"><a href="#PumpWoodMicroService-319"><span class="linenos"> 319</span></a>
</span><span id="PumpWoodMicroService-320"><a href="#PumpWoodMicroService-320"><span class="linenos"> 320</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-321"><a href="#PumpWoodMicroService-321"><span class="linenos"> 321</span></a><span class="sd">            mfa_login_data:</span>
</span><span id="PumpWoodMicroService-322"><a href="#PumpWoodMicroService-322"><span class="linenos"> 322</span></a><span class="sd">                Result from login request with &#39;mfa_token&#39;</span>
</span><span id="PumpWoodMicroService-323"><a href="#PumpWoodMicroService-323"><span class="linenos"> 323</span></a><span class="sd">                as key.</span>
</span><span id="PumpWoodMicroService-324"><a href="#PumpWoodMicroService-324"><span class="linenos"> 324</span></a>
</span><span id="PumpWoodMicroService-325"><a href="#PumpWoodMicroService-325"><span class="linenos"> 325</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-326"><a href="#PumpWoodMicroService-326"><span class="linenos"> 326</span></a><span class="sd">            Return login returned with MFA confimation.</span>
</span><span id="PumpWoodMicroService-327"><a href="#PumpWoodMicroService-327"><span class="linenos"> 327</span></a>
</span><span id="PumpWoodMicroService-328"><a href="#PumpWoodMicroService-328"><span class="linenos"> 328</span></a><span class="sd">        Raise:</span>
</span><span id="PumpWoodMicroService-329"><a href="#PumpWoodMicroService-329"><span class="linenos"> 329</span></a><span class="sd">            Raise error if reponse is not valid using error_handler.</span>
</span><span id="PumpWoodMicroService-330"><a href="#PumpWoodMicroService-330"><span class="linenos"> 330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-331"><a href="#PumpWoodMicroService-331"><span class="linenos"> 331</span></a>        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-332"><a href="#PumpWoodMicroService-332"><span class="linenos"> 332</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-333"><a href="#PumpWoodMicroService-333"><span class="linenos"> 333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-334"><a href="#PumpWoodMicroService-334"><span class="linenos"> 334</span></a>        <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-335"><a href="#PumpWoodMicroService-335"><span class="linenos"> 335</span></a>            <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
</span><span id="PumpWoodMicroService-336"><a href="#PumpWoodMicroService-336"><span class="linenos"> 336</span></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-337"><a href="#PumpWoodMicroService-337"><span class="linenos"> 337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-338"><a href="#PumpWoodMicroService-338"><span class="linenos"> 338</span></a>
</span><span id="PumpWoodMicroService-339"><a href="#PumpWoodMicroService-339"><span class="linenos"> 339</span></a>        <span class="c1"># Set _is_mfa_login true to indicate that login required MFA</span>
</span><span id="PumpWoodMicroService-340"><a href="#PumpWoodMicroService-340"><span class="linenos"> 340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-341"><a href="#PumpWoodMicroService-341"><span class="linenos"> 341</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-342"><a href="#PumpWoodMicroService-342"><span class="linenos"> 342</span></a>
</span><span id="PumpWoodMicroService-343"><a href="#PumpWoodMicroService-343"><span class="linenos"> 343</span></a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-344"><a href="#PumpWoodMicroService-344"><span class="linenos"> 344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout token.</span>
</span><span id="PumpWoodMicroService-345"><a href="#PumpWoodMicroService-345"><span class="linenos"> 345</span></a>
</span><span id="PumpWoodMicroService-346"><a href="#PumpWoodMicroService-346"><span class="linenos"> 346</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-347"><a href="#PumpWoodMicroService-347"><span class="linenos"> 347</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-348"><a href="#PumpWoodMicroService-348"><span class="linenos"> 348</span></a><span class="sd">                Authentication header.</span>
</span><span id="PumpWoodMicroService-349"><a href="#PumpWoodMicroService-349"><span class="linenos"> 349</span></a>
</span><span id="PumpWoodMicroService-350"><a href="#PumpWoodMicroService-350"><span class="linenos"> 350</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-351"><a href="#PumpWoodMicroService-351"><span class="linenos"> 351</span></a><span class="sd">            True if logout was ok.</span>
</span><span id="PumpWoodMicroService-352"><a href="#PumpWoodMicroService-352"><span class="linenos"> 352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-353"><a href="#PumpWoodMicroService-353"><span class="linenos"> 353</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-354"><a href="#PumpWoodMicroService-354"><span class="linenos"> 354</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-355"><a href="#PumpWoodMicroService-355"><span class="linenos"> 355</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-356"><a href="#PumpWoodMicroService-356"><span class="linenos"> 356</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-357"><a href="#PumpWoodMicroService-357"><span class="linenos"> 357</span></a>
</span><span id="PumpWoodMicroService-358"><a href="#PumpWoodMicroService-358"><span class="linenos"> 358</span></a>    <span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-359"><a href="#PumpWoodMicroService-359"><span class="linenos"> 359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout all tokens from user.</span>
</span><span id="PumpWoodMicroService-360"><a href="#PumpWoodMicroService-360"><span class="linenos"> 360</span></a>
</span><span id="PumpWoodMicroService-361"><a href="#PumpWoodMicroService-361"><span class="linenos"> 361</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-362"><a href="#PumpWoodMicroService-362"><span class="linenos"> 362</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService-363"><a href="#PumpWoodMicroService-363"><span class="linenos"> 363</span></a><span class="sd">                Authentication header.</span>
</span><span id="PumpWoodMicroService-364"><a href="#PumpWoodMicroService-364"><span class="linenos"> 364</span></a>
</span><span id="PumpWoodMicroService-365"><a href="#PumpWoodMicroService-365"><span class="linenos"> 365</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-366"><a href="#PumpWoodMicroService-366"><span class="linenos"> 366</span></a><span class="sd">            True if logout all was ok.</span>
</span><span id="PumpWoodMicroService-367"><a href="#PumpWoodMicroService-367"><span class="linenos"> 367</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-368"><a href="#PumpWoodMicroService-368"><span class="linenos"> 368</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-369"><a href="#PumpWoodMicroService-369"><span class="linenos"> 369</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-370"><a href="#PumpWoodMicroService-370"><span class="linenos"> 370</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-371"><a href="#PumpWoodMicroService-371"><span class="linenos"> 371</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-372"><a href="#PumpWoodMicroService-372"><span class="linenos"> 372</span></a>
</span><span id="PumpWoodMicroService-373"><a href="#PumpWoodMicroService-373"><span class="linenos"> 373</span></a>    <span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-374"><a href="#PumpWoodMicroService-374"><span class="linenos"> 374</span></a>                        <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-375"><a href="#PumpWoodMicroService-375"><span class="linenos"> 375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set auth_header and token_expiry date.</span>
</span><span id="PumpWoodMicroService-376"><a href="#PumpWoodMicroService-376"><span class="linenos"> 376</span></a>
</span><span id="PumpWoodMicroService-377"><a href="#PumpWoodMicroService-377"><span class="linenos"> 377</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-378"><a href="#PumpWoodMicroService-378"><span class="linenos"> 378</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-379"><a href="#PumpWoodMicroService-379"><span class="linenos"> 379</span></a><span class="sd">                Authentication header to be set.</span>
</span><span id="PumpWoodMicroService-380"><a href="#PumpWoodMicroService-380"><span class="linenos"> 380</span></a><span class="sd">            token_expiry:</span>
</span><span id="PumpWoodMicroService-381"><a href="#PumpWoodMicroService-381"><span class="linenos"> 381</span></a><span class="sd">                Token expiry datetime to be set.</span>
</span><span id="PumpWoodMicroService-382"><a href="#PumpWoodMicroService-382"><span class="linenos"> 382</span></a>
</span><span id="PumpWoodMicroService-383"><a href="#PumpWoodMicroService-383"><span class="linenos"> 383</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-384"><a href="#PumpWoodMicroService-384"><span class="linenos"> 384</span></a><span class="sd">            No return.</span>
</span><span id="PumpWoodMicroService-385"><a href="#PumpWoodMicroService-385"><span class="linenos"> 385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-386"><a href="#PumpWoodMicroService-386"><span class="linenos"> 386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
</span><span id="PumpWoodMicroService-387"><a href="#PumpWoodMicroService-387"><span class="linenos"> 387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-388"><a href="#PumpWoodMicroService-388"><span class="linenos"> 388</span></a>
</span><span id="PumpWoodMicroService-389"><a href="#PumpWoodMicroService-389"><span class="linenos"> 389</span></a>    <span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-390"><a href="#PumpWoodMicroService-390"><span class="linenos"> 390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve auth_header and token_expiry from object.</span>
</span><span id="PumpWoodMicroService-391"><a href="#PumpWoodMicroService-391"><span class="linenos"> 391</span></a>
</span><span id="PumpWoodMicroService-392"><a href="#PumpWoodMicroService-392"><span class="linenos"> 392</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-393"><a href="#PumpWoodMicroService-393"><span class="linenos"> 393</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService-394"><a href="#PumpWoodMicroService-394"><span class="linenos"> 394</span></a>
</span><span id="PumpWoodMicroService-395"><a href="#PumpWoodMicroService-395"><span class="linenos"> 395</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-396"><a href="#PumpWoodMicroService-396"><span class="linenos"> 396</span></a><span class="sd">            Return authorization header and token_expiry datetime from object.</span>
</span><span id="PumpWoodMicroService-397"><a href="#PumpWoodMicroService-397"><span class="linenos"> 397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-398"><a href="#PumpWoodMicroService-398"><span class="linenos"> 398</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-399"><a href="#PumpWoodMicroService-399"><span class="linenos"> 399</span></a>            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-400"><a href="#PumpWoodMicroService-400"><span class="linenos"> 400</span></a>            <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-401"><a href="#PumpWoodMicroService-401"><span class="linenos"> 401</span></a>
</span><span id="PumpWoodMicroService-402"><a href="#PumpWoodMicroService-402"><span class="linenos"> 402</span></a>    <span class="k">def</span> <span class="nf">_check__auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-403"><a href="#PumpWoodMicroService-403"><span class="linenos"> 403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if auth_header is set or auth_header if provided.</span>
</span><span id="PumpWoodMicroService-404"><a href="#PumpWoodMicroService-404"><span class="linenos"> 404</span></a>
</span><span id="PumpWoodMicroService-405"><a href="#PumpWoodMicroService-405"><span class="linenos"> 405</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-406"><a href="#PumpWoodMicroService-406"><span class="linenos"> 406</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-407"><a href="#PumpWoodMicroService-407"><span class="linenos"> 407</span></a><span class="sd">                AuthHeader to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-408"><a href="#PumpWoodMicroService-408"><span class="linenos"> 408</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-409"><a href="#PumpWoodMicroService-409"><span class="linenos"> 409</span></a><span class="sd">            multipart:</span>
</span><span id="PumpWoodMicroService-410"><a href="#PumpWoodMicroService-410"><span class="linenos"> 410</span></a><span class="sd">                Set if call should be made as a multipart instead of JSON.</span>
</span><span id="PumpWoodMicroService-411"><a href="#PumpWoodMicroService-411"><span class="linenos"> 411</span></a>
</span><span id="PumpWoodMicroService-412"><a href="#PumpWoodMicroService-412"><span class="linenos"> 412</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-413"><a href="#PumpWoodMicroService-413"><span class="linenos"> 413</span></a><span class="sd">            Return a header dict to be used in requests.</span>
</span><span id="PumpWoodMicroService-414"><a href="#PumpWoodMicroService-414"><span class="linenos"> 414</span></a>
</span><span id="PumpWoodMicroService-415"><a href="#PumpWoodMicroService-415"><span class="linenos"> 415</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-416"><a href="#PumpWoodMicroService-416"><span class="linenos"> 416</span></a><span class="sd">            PumpWoodUnauthorized:</span>
</span><span id="PumpWoodMicroService-417"><a href="#PumpWoodMicroService-417"><span class="linenos"> 417</span></a><span class="sd">                If microservice is not logged and a auth_header method</span>
</span><span id="PumpWoodMicroService-418"><a href="#PumpWoodMicroService-418"><span class="linenos"> 418</span></a><span class="sd">                argument is not provided.</span>
</span><span id="PumpWoodMicroService-419"><a href="#PumpWoodMicroService-419"><span class="linenos"> 419</span></a><span class="sd">            PumpWoodUnauthorized:</span>
</span><span id="PumpWoodMicroService-420"><a href="#PumpWoodMicroService-420"><span class="linenos"> 420</span></a><span class="sd">                If microservice is logged and a auth_header method argument</span>
</span><span id="PumpWoodMicroService-421"><a href="#PumpWoodMicroService-421"><span class="linenos"> 421</span></a><span class="sd">                is provided.</span>
</span><span id="PumpWoodMicroService-422"><a href="#PumpWoodMicroService-422"><span class="linenos"> 422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-423"><a href="#PumpWoodMicroService-423"><span class="linenos"> 423</span></a>        <span class="k">if</span> <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-424"><a href="#PumpWoodMicroService-424"><span class="linenos"> 424</span></a>            <span class="c1"># Login will refresh token if it is 1h to expire, it will also</span>
</span><span id="PumpWoodMicroService-425"><a href="#PumpWoodMicroService-425"><span class="linenos"> 425</span></a>            <span class="c1"># check if credentials are set.</span>
</span><span id="PumpWoodMicroService-426"><a href="#PumpWoodMicroService-426"><span class="linenos"> 426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-427"><a href="#PumpWoodMicroService-427"><span class="linenos"> 427</span></a>            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-428"><a href="#PumpWoodMicroService-428"><span class="linenos"> 428</span></a>            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-429"><a href="#PumpWoodMicroService-429"><span class="linenos"> 429</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="PumpWoodMicroService-430"><a href="#PumpWoodMicroService-430"><span class="linenos"> 430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-431"><a href="#PumpWoodMicroService-431"><span class="linenos"> 431</span></a>                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-432"><a href="#PumpWoodMicroService-432"><span class="linenos"> 432</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="PumpWoodMicroService-433"><a href="#PumpWoodMicroService-433"><span class="linenos"> 433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-434"><a href="#PumpWoodMicroService-434"><span class="linenos"> 434</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-435"><a href="#PumpWoodMicroService-435"><span class="linenos"> 435</span></a>                <span class="n">msg_tmp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-436"><a href="#PumpWoodMicroService-436"><span class="linenos"> 436</span></a>                    <span class="s1">&#39;MicroService </span><span class="si">{name}</span><span class="s1"> already looged and &#39;</span>
</span><span id="PumpWoodMicroService-437"><a href="#PumpWoodMicroService-437"><span class="linenos"> 437</span></a>                    <span class="s1">&#39;auth_header was provided&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-438"><a href="#PumpWoodMicroService-438"><span class="linenos"> 438</span></a>                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-439"><a href="#PumpWoodMicroService-439"><span class="linenos"> 439</span></a>                    <span class="n">msg_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-440"><a href="#PumpWoodMicroService-440"><span class="linenos"> 440</span></a>
</span><span id="PumpWoodMicroService-441"><a href="#PumpWoodMicroService-441"><span class="linenos"> 441</span></a>            <span class="c1"># Set base header as JSON since unserialization is done using</span>
</span><span id="PumpWoodMicroService-442"><a href="#PumpWoodMicroService-442"><span class="linenos"> 442</span></a>            <span class="c1"># Pumpwood Communication serialization funciton</span>
</span><span id="PumpWoodMicroService-443"><a href="#PumpWoodMicroService-443"><span class="linenos"> 443</span></a>            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-444"><a href="#PumpWoodMicroService-444"><span class="linenos"> 444</span></a>            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-445"><a href="#PumpWoodMicroService-445"><span class="linenos"> 445</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="PumpWoodMicroService-446"><a href="#PumpWoodMicroService-446"><span class="linenos"> 446</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-447"><a href="#PumpWoodMicroService-447"><span class="linenos"> 447</span></a>                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-448"><a href="#PumpWoodMicroService-448"><span class="linenos"> 448</span></a>                <span class="k">return</span> <span class="n">temp__auth_header</span>
</span><span id="PumpWoodMicroService-449"><a href="#PumpWoodMicroService-449"><span class="linenos"> 449</span></a>
</span><span id="PumpWoodMicroService-450"><a href="#PumpWoodMicroService-450"><span class="linenos"> 450</span></a>    <span class="nd">@classmethod</span>
</span><span id="PumpWoodMicroService-451"><a href="#PumpWoodMicroService-451"><span class="linenos"> 451</span></a>    <span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-452"><a href="#PumpWoodMicroService-452"><span class="linenos"> 452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle request error.</span>
</span><span id="PumpWoodMicroService-453"><a href="#PumpWoodMicroService-453"><span class="linenos"> 453</span></a>
</span><span id="PumpWoodMicroService-454"><a href="#PumpWoodMicroService-454"><span class="linenos"> 454</span></a><span class="sd">        Check if is a Json and propagate the error with</span>
</span><span id="PumpWoodMicroService-455"><a href="#PumpWoodMicroService-455"><span class="linenos"> 455</span></a><span class="sd">        same type if possible. If not Json raises the content.</span>
</span><span id="PumpWoodMicroService-456"><a href="#PumpWoodMicroService-456"><span class="linenos"> 456</span></a>
</span><span id="PumpWoodMicroService-457"><a href="#PumpWoodMicroService-457"><span class="linenos"> 457</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-458"><a href="#PumpWoodMicroService-458"><span class="linenos"> 458</span></a><span class="sd">            response:</span>
</span><span id="PumpWoodMicroService-459"><a href="#PumpWoodMicroService-459"><span class="linenos"> 459</span></a><span class="sd">                response to be handled, it is a PumpWoodException</span>
</span><span id="PumpWoodMicroService-460"><a href="#PumpWoodMicroService-460"><span class="linenos"> 460</span></a><span class="sd">                return it will raise the same exception at microservice</span>
</span><span id="PumpWoodMicroService-461"><a href="#PumpWoodMicroService-461"><span class="linenos"> 461</span></a><span class="sd">                object.</span>
</span><span id="PumpWoodMicroService-462"><a href="#PumpWoodMicroService-462"><span class="linenos"> 462</span></a>
</span><span id="PumpWoodMicroService-463"><a href="#PumpWoodMicroService-463"><span class="linenos"> 463</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-464"><a href="#PumpWoodMicroService-464"><span class="linenos"> 464</span></a><span class="sd">            No return.</span>
</span><span id="PumpWoodMicroService-465"><a href="#PumpWoodMicroService-465"><span class="linenos"> 465</span></a>
</span><span id="PumpWoodMicroService-466"><a href="#PumpWoodMicroService-466"><span class="linenos"> 466</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-467"><a href="#PumpWoodMicroService-467"><span class="linenos"> 467</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService-468"><a href="#PumpWoodMicroService-468"><span class="linenos"> 468</span></a><span class="sd">                If content-type is not application/json.</span>
</span><span id="PumpWoodMicroService-469"><a href="#PumpWoodMicroService-469"><span class="linenos"> 469</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService-470"><a href="#PumpWoodMicroService-470"><span class="linenos"> 470</span></a><span class="sd">                If content-type is application/json, but type not</span>
</span><span id="PumpWoodMicroService-471"><a href="#PumpWoodMicroService-471"><span class="linenos"> 471</span></a><span class="sd">                present or not recognisable at `exceptions.exceptions_dict`.</span>
</span><span id="PumpWoodMicroService-472"><a href="#PumpWoodMicroService-472"><span class="linenos"> 472</span></a><span class="sd">            Other PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService-473"><a href="#PumpWoodMicroService-473"><span class="linenos"> 473</span></a><span class="sd">                If content-type is application/json if type is present and</span>
</span><span id="PumpWoodMicroService-474"><a href="#PumpWoodMicroService-474"><span class="linenos"> 474</span></a><span class="sd">                recognisable.</span>
</span><span id="PumpWoodMicroService-475"><a href="#PumpWoodMicroService-475"><span class="linenos"> 475</span></a>
</span><span id="PumpWoodMicroService-476"><a href="#PumpWoodMicroService-476"><span class="linenos"> 476</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-477"><a href="#PumpWoodMicroService-477"><span class="linenos"> 477</span></a><span class="sd">            No example</span>
</span><span id="PumpWoodMicroService-478"><a href="#PumpWoodMicroService-478"><span class="linenos"> 478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-479"><a href="#PumpWoodMicroService-479"><span class="linenos"> 479</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-480"><a href="#PumpWoodMicroService-480"><span class="linenos"> 480</span></a>            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-481"><a href="#PumpWoodMicroService-481"><span class="linenos"> 481</span></a>            <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-482"><a href="#PumpWoodMicroService-482"><span class="linenos"> 482</span></a>
</span><span id="PumpWoodMicroService-483"><a href="#PumpWoodMicroService-483"><span class="linenos"> 483</span></a>            <span class="c1"># Request information</span>
</span><span id="PumpWoodMicroService-484"><a href="#PumpWoodMicroService-484"><span class="linenos"> 484</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
</span><span id="PumpWoodMicroService-485"><a href="#PumpWoodMicroService-485"><span class="linenos"> 485</span></a>            <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
</span><span id="PumpWoodMicroService-486"><a href="#PumpWoodMicroService-486"><span class="linenos"> 486</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-487"><a href="#PumpWoodMicroService-487"><span class="linenos"> 487</span></a>                <span class="c1"># Raise the exception as first in exception deep.</span>
</span><span id="PumpWoodMicroService-488"><a href="#PumpWoodMicroService-488"><span class="linenos"> 488</span></a>                <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="PumpWoodMicroService-489"><a href="#PumpWoodMicroService-489"><span class="linenos"> 489</span></a>                    <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-490"><a href="#PumpWoodMicroService-490"><span class="linenos"> 490</span></a>                    <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-491"><a href="#PumpWoodMicroService-491"><span class="linenos"> 491</span></a>                    <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService-492"><a href="#PumpWoodMicroService-492"><span class="linenos"> 492</span></a>                    <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</span><span id="PumpWoodMicroService-493"><a href="#PumpWoodMicroService-493"><span class="linenos"> 493</span></a>                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-494"><a href="#PumpWoodMicroService-494"><span class="linenos"> 494</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-495"><a href="#PumpWoodMicroService-495"><span class="linenos"> 495</span></a>                        <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-496"><a href="#PumpWoodMicroService-496"><span class="linenos"> 496</span></a>
</span><span id="PumpWoodMicroService-497"><a href="#PumpWoodMicroService-497"><span class="linenos"> 497</span></a>            <span class="c1"># Build error stack</span>
</span><span id="PumpWoodMicroService-498"><a href="#PumpWoodMicroService-498"><span class="linenos"> 498</span></a>            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-499"><a href="#PumpWoodMicroService-499"><span class="linenos"> 499</span></a>
</span><span id="PumpWoodMicroService-500"><a href="#PumpWoodMicroService-500"><span class="linenos"> 500</span></a>            <span class="c1"># Removing previous error stack</span>
</span><span id="PumpWoodMicroService-501"><a href="#PumpWoodMicroService-501"><span class="linenos"> 501</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="PumpWoodMicroService-502"><a href="#PumpWoodMicroService-502"><span class="linenos"> 502</span></a>            <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="PumpWoodMicroService-503"><a href="#PumpWoodMicroService-503"><span class="linenos"> 503</span></a>
</span><span id="PumpWoodMicroService-504"><a href="#PumpWoodMicroService-504"><span class="linenos"> 504</span></a>            <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-505"><a href="#PumpWoodMicroService-505"><span class="linenos"> 505</span></a>            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-506"><a href="#PumpWoodMicroService-506"><span class="linenos"> 506</span></a>                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-507"><a href="#PumpWoodMicroService-507"><span class="linenos"> 507</span></a>                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-508"><a href="#PumpWoodMicroService-508"><span class="linenos"> 508</span></a>                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService-509"><a href="#PumpWoodMicroService-509"><span class="linenos"> 509</span></a>                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService-510"><a href="#PumpWoodMicroService-510"><span class="linenos"> 510</span></a>            <span class="p">}</span>
</span><span id="PumpWoodMicroService-511"><a href="#PumpWoodMicroService-511"><span class="linenos"> 511</span></a>            <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-512"><a href="#PumpWoodMicroService-512"><span class="linenos"> 512</span></a>            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="PumpWoodMicroService-513"><a href="#PumpWoodMicroService-513"><span class="linenos"> 513</span></a>
</span><span id="PumpWoodMicroService-514"><a href="#PumpWoodMicroService-514"><span class="linenos"> 514</span></a>            <span class="c1">###################</span>
</span><span id="PumpWoodMicroService-515"><a href="#PumpWoodMicroService-515"><span class="linenos"> 515</span></a>            <span class="c1"># Propagate error #</span>
</span><span id="PumpWoodMicroService-516"><a href="#PumpWoodMicroService-516"><span class="linenos"> 516</span></a>            <span class="c1"># get exception using &#39;type&#39; key at response data and get the</span>
</span><span id="PumpWoodMicroService-517"><a href="#PumpWoodMicroService-517"><span class="linenos"> 517</span></a>            <span class="c1"># exception from exceptions_dict at exceptions</span>
</span><span id="PumpWoodMicroService-518"><a href="#PumpWoodMicroService-518"><span class="linenos"> 518</span></a>            <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-519"><a href="#PumpWoodMicroService-519"><span class="linenos"> 519</span></a>            <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-520"><a href="#PumpWoodMicroService-520"><span class="linenos"> 520</span></a>            <span class="n">TempPumpwoodException</span> <span class="o">=</span> <span class="n">exceptions_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exception_type</span><span class="p">)</span> <span class="c1"># NOQA</span>
</span><span id="PumpWoodMicroService-521"><a href="#PumpWoodMicroService-521"><span class="linenos"> 521</span></a>            <span class="k">if</span> <span class="n">TempPumpwoodException</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-522"><a href="#PumpWoodMicroService-522"><span class="linenos"> 522</span></a>                <span class="k">raise</span> <span class="n">TempPumpwoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-523"><a href="#PumpWoodMicroService-523"><span class="linenos"> 523</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-524"><a href="#PumpWoodMicroService-524"><span class="linenos"> 524</span></a>                    <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-525"><a href="#PumpWoodMicroService-525"><span class="linenos"> 525</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-526"><a href="#PumpWoodMicroService-526"><span class="linenos"> 526</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-527"><a href="#PumpWoodMicroService-527"><span class="linenos"> 527</span></a>                <span class="c1"># If token is invalid is at response, return a</span>
</span><span id="PumpWoodMicroService-528"><a href="#PumpWoodMicroService-528"><span class="linenos"> 528</span></a>                <span class="c1"># PumpWoodUnauthorized error</span>
</span><span id="PumpWoodMicroService-529"><a href="#PumpWoodMicroService-529"><span class="linenos"> 529</span></a>                <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-530"><a href="#PumpWoodMicroService-530"><span class="linenos"> 530</span></a>                <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="PumpWoodMicroService-531"><a href="#PumpWoodMicroService-531"><span class="linenos"> 531</span></a>                <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-532"><a href="#PumpWoodMicroService-532"><span class="linenos"> 532</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-533"><a href="#PumpWoodMicroService-533"><span class="linenos"> 533</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-534"><a href="#PumpWoodMicroService-534"><span class="linenos"> 534</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-535"><a href="#PumpWoodMicroService-535"><span class="linenos"> 535</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-536"><a href="#PumpWoodMicroService-536"><span class="linenos"> 536</span></a>                    <span class="c1"># If the error is not mapped return a</span>
</span><span id="PumpWoodMicroService-537"><a href="#PumpWoodMicroService-537"><span class="linenos"> 537</span></a>                    <span class="c1"># PumpWoodOtherException limiting the message size to 1k</span>
</span><span id="PumpWoodMicroService-538"><a href="#PumpWoodMicroService-538"><span class="linenos"> 538</span></a>                    <span class="c1"># characters</span>
</span><span id="PumpWoodMicroService-539"><a href="#PumpWoodMicroService-539"><span class="linenos"> 539</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-540"><a href="#PumpWoodMicroService-540"><span class="linenos"> 540</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-541"><a href="#PumpWoodMicroService-541"><span class="linenos"> 541</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-542"><a href="#PumpWoodMicroService-542"><span class="linenos"> 542</span></a>
</span><span id="PumpWoodMicroService-543"><a href="#PumpWoodMicroService-543"><span class="linenos"> 543</span></a>    <span class="nd">@classmethod</span>
</span><span id="PumpWoodMicroService-544"><a href="#PumpWoodMicroService-544"><span class="linenos"> 544</span></a>    <span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-545"><a href="#PumpWoodMicroService-545"><span class="linenos"> 545</span></a>                                  <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-546"><a href="#PumpWoodMicroService-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if reponse has invalid token error.</span>
</span><span id="PumpWoodMicroService-547"><a href="#PumpWoodMicroService-547"><span class="linenos"> 547</span></a>
</span><span id="PumpWoodMicroService-548"><a href="#PumpWoodMicroService-548"><span class="linenos"> 548</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-549"><a href="#PumpWoodMicroService-549"><span class="linenos"> 549</span></a><span class="sd">            response:</span>
</span><span id="PumpWoodMicroService-550"><a href="#PumpWoodMicroService-550"><span class="linenos"> 550</span></a><span class="sd">                Request reponse to check for invalid token.</span>
</span><span id="PumpWoodMicroService-551"><a href="#PumpWoodMicroService-551"><span class="linenos"> 551</span></a>
</span><span id="PumpWoodMicroService-552"><a href="#PumpWoodMicroService-552"><span class="linenos"> 552</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-553"><a href="#PumpWoodMicroService-553"><span class="linenos"> 553</span></a><span class="sd">            Return True if response has an invalid token status.</span>
</span><span id="PumpWoodMicroService-554"><a href="#PumpWoodMicroService-554"><span class="linenos"> 554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-555"><a href="#PumpWoodMicroService-555"><span class="linenos"> 555</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-556"><a href="#PumpWoodMicroService-556"><span class="linenos"> 556</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-557"><a href="#PumpWoodMicroService-557"><span class="linenos"> 557</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-558"><a href="#PumpWoodMicroService-558"><span class="linenos"> 558</span></a>
</span><span id="PumpWoodMicroService-559"><a href="#PumpWoodMicroService-559"><span class="linenos"> 559</span></a>    <span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-560"><a href="#PumpWoodMicroService-560"><span class="linenos"> 560</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-561"><a href="#PumpWoodMicroService-561"><span class="linenos"> 561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a POST a request to url with data as JSON payload.</span>
</span><span id="PumpWoodMicroService-562"><a href="#PumpWoodMicroService-562"><span class="linenos"> 562</span></a>
</span><span id="PumpWoodMicroService-563"><a href="#PumpWoodMicroService-563"><span class="linenos"> 563</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-564"><a href="#PumpWoodMicroService-564"><span class="linenos"> 564</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService-565"><a href="#PumpWoodMicroService-565"><span class="linenos"> 565</span></a><span class="sd">                URL to make the request.</span>
</span><span id="PumpWoodMicroService-566"><a href="#PumpWoodMicroService-566"><span class="linenos"> 566</span></a><span class="sd">            data:</span>
</span><span id="PumpWoodMicroService-567"><a href="#PumpWoodMicroService-567"><span class="linenos"> 567</span></a><span class="sd">                Data to be used as Json payload.</span>
</span><span id="PumpWoodMicroService-568"><a href="#PumpWoodMicroService-568"><span class="linenos"> 568</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService-569"><a href="#PumpWoodMicroService-569"><span class="linenos"> 569</span></a><span class="sd">                A dictonary with file data, files will be set on field</span>
</span><span id="PumpWoodMicroService-570"><a href="#PumpWoodMicroService-570"><span class="linenos"> 570</span></a><span class="sd">                corresponding.to dictonary key.</span>
</span><span id="PumpWoodMicroService-571"><a href="#PumpWoodMicroService-571"><span class="linenos"> 571</span></a><span class="sd">                `{&#39;file1&#39;: open(&#39;file1&#39;, &#39;rb&#39;), {&#39;file2&#39;: open(&#39;file2&#39;, &#39;rb&#39;)}`</span>
</span><span id="PumpWoodMicroService-572"><a href="#PumpWoodMicroService-572"><span class="linenos"> 572</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-573"><a href="#PumpWoodMicroService-573"><span class="linenos"> 573</span></a><span class="sd">                URL parameters.</span>
</span><span id="PumpWoodMicroService-574"><a href="#PumpWoodMicroService-574"><span class="linenos"> 574</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-575"><a href="#PumpWoodMicroService-575"><span class="linenos"> 575</span></a><span class="sd">                AuthHeader to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-576"><a href="#PumpWoodMicroService-576"><span class="linenos"> 576</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-577"><a href="#PumpWoodMicroService-577"><span class="linenos"> 577</span></a>
</span><span id="PumpWoodMicroService-578"><a href="#PumpWoodMicroService-578"><span class="linenos"> 578</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-579"><a href="#PumpWoodMicroService-579"><span class="linenos"> 579</span></a><span class="sd">            Return the post response data.</span>
</span><span id="PumpWoodMicroService-580"><a href="#PumpWoodMicroService-580"><span class="linenos"> 580</span></a>
</span><span id="PumpWoodMicroService-581"><a href="#PumpWoodMicroService-581"><span class="linenos"> 581</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-582"><a href="#PumpWoodMicroService-582"><span class="linenos"> 582</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService-583"><a href="#PumpWoodMicroService-583"><span class="linenos"> 583</span></a><span class="sd">                Response is passed to error_handler.</span>
</span><span id="PumpWoodMicroService-584"><a href="#PumpWoodMicroService-584"><span class="linenos"> 584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-585"><a href="#PumpWoodMicroService-585"><span class="linenos"> 585</span></a>        <span class="c1"># If parameters are not none convert them to JSON before</span>
</span><span id="PumpWoodMicroService-586"><a href="#PumpWoodMicroService-586"><span class="linenos"> 586</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on Javascript</span>
</span><span id="PumpWoodMicroService-587"><a href="#PumpWoodMicroService-587"><span class="linenos"> 587</span></a>        <span class="c1"># for exemple</span>
</span><span id="PumpWoodMicroService-588"><a href="#PumpWoodMicroService-588"><span class="linenos"> 588</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-589"><a href="#PumpWoodMicroService-589"><span class="linenos"> 589</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-590"><a href="#PumpWoodMicroService-590"><span class="linenos"> 590</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-591"><a href="#PumpWoodMicroService-591"><span class="linenos"> 591</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="PumpWoodMicroService-592"><a href="#PumpWoodMicroService-592"><span class="linenos"> 592</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-593"><a href="#PumpWoodMicroService-593"><span class="linenos"> 593</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-594"><a href="#PumpWoodMicroService-594"><span class="linenos"> 594</span></a>
</span><span id="PumpWoodMicroService-595"><a href="#PumpWoodMicroService-595"><span class="linenos"> 595</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-596"><a href="#PumpWoodMicroService-596"><span class="linenos"> 596</span></a>        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-597"><a href="#PumpWoodMicroService-597"><span class="linenos"> 597</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-598"><a href="#PumpWoodMicroService-598"><span class="linenos"> 598</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-599"><a href="#PumpWoodMicroService-599"><span class="linenos"> 599</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-600"><a href="#PumpWoodMicroService-600"><span class="linenos"> 600</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="PumpWoodMicroService-601"><a href="#PumpWoodMicroService-601"><span class="linenos"> 601</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-602"><a href="#PumpWoodMicroService-602"><span class="linenos"> 602</span></a>                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-603"><a href="#PumpWoodMicroService-603"><span class="linenos"> 603</span></a>
</span><span id="PumpWoodMicroService-604"><a href="#PumpWoodMicroService-604"><span class="linenos"> 604</span></a>            <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="PumpWoodMicroService-605"><a href="#PumpWoodMicroService-605"><span class="linenos"> 605</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-606"><a href="#PumpWoodMicroService-606"><span class="linenos"> 606</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService-607"><a href="#PumpWoodMicroService-607"><span class="linenos"> 607</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-608"><a href="#PumpWoodMicroService-608"><span class="linenos"> 608</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-609"><a href="#PumpWoodMicroService-609"><span class="linenos"> 609</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-610"><a href="#PumpWoodMicroService-610"><span class="linenos"> 610</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-611"><a href="#PumpWoodMicroService-611"><span class="linenos"> 611</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-612"><a href="#PumpWoodMicroService-612"><span class="linenos"> 612</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-613"><a href="#PumpWoodMicroService-613"><span class="linenos"> 613</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="PumpWoodMicroService-614"><a href="#PumpWoodMicroService-614"><span class="linenos"> 614</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-615"><a href="#PumpWoodMicroService-615"><span class="linenos"> 615</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-616"><a href="#PumpWoodMicroService-616"><span class="linenos"> 616</span></a>
</span><span id="PumpWoodMicroService-617"><a href="#PumpWoodMicroService-617"><span class="linenos"> 617</span></a>        <span class="c1"># Request with files are done using multipart serializing all fields</span>
</span><span id="PumpWoodMicroService-618"><a href="#PumpWoodMicroService-618"><span class="linenos"> 618</span></a>        <span class="c1"># as JSON</span>
</span><span id="PumpWoodMicroService-619"><a href="#PumpWoodMicroService-619"><span class="linenos"> 619</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-620"><a href="#PumpWoodMicroService-620"><span class="linenos"> 620</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-621"><a href="#PumpWoodMicroService-621"><span class="linenos"> 621</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-622"><a href="#PumpWoodMicroService-622"><span class="linenos"> 622</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-623"><a href="#PumpWoodMicroService-623"><span class="linenos"> 623</span></a>            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
</span><span id="PumpWoodMicroService-624"><a href="#PumpWoodMicroService-624"><span class="linenos"> 624</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-625"><a href="#PumpWoodMicroService-625"><span class="linenos"> 625</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-626"><a href="#PumpWoodMicroService-626"><span class="linenos"> 626</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-627"><a href="#PumpWoodMicroService-627"><span class="linenos"> 627</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-628"><a href="#PumpWoodMicroService-628"><span class="linenos"> 628</span></a>
</span><span id="PumpWoodMicroService-629"><a href="#PumpWoodMicroService-629"><span class="linenos"> 629</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-630"><a href="#PumpWoodMicroService-630"><span class="linenos"> 630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService-631"><a href="#PumpWoodMicroService-631"><span class="linenos"> 631</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-632"><a href="#PumpWoodMicroService-632"><span class="linenos"> 632</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-633"><a href="#PumpWoodMicroService-633"><span class="linenos"> 633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-634"><a href="#PumpWoodMicroService-634"><span class="linenos"> 634</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-635"><a href="#PumpWoodMicroService-635"><span class="linenos"> 635</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-636"><a href="#PumpWoodMicroService-636"><span class="linenos"> 636</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-637"><a href="#PumpWoodMicroService-637"><span class="linenos"> 637</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-638"><a href="#PumpWoodMicroService-638"><span class="linenos"> 638</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-639"><a href="#PumpWoodMicroService-639"><span class="linenos"> 639</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-640"><a href="#PumpWoodMicroService-640"><span class="linenos"> 640</span></a>
</span><span id="PumpWoodMicroService-641"><a href="#PumpWoodMicroService-641"><span class="linenos"> 641</span></a>        <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
</span><span id="PumpWoodMicroService-642"><a href="#PumpWoodMicroService-642"><span class="linenos"> 642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-643"><a href="#PumpWoodMicroService-643"><span class="linenos"> 643</span></a>
</span><span id="PumpWoodMicroService-644"><a href="#PumpWoodMicroService-644"><span class="linenos"> 644</span></a>        <span class="c1"># Check if response is a file</span>
</span><span id="PumpWoodMicroService-645"><a href="#PumpWoodMicroService-645"><span class="linenos"> 645</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="PumpWoodMicroService-646"><a href="#PumpWoodMicroService-646"><span class="linenos"> 646</span></a>        <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-647"><a href="#PumpWoodMicroService-647"><span class="linenos"> 647</span></a>        <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-648"><a href="#PumpWoodMicroService-648"><span class="linenos"> 648</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-649"><a href="#PumpWoodMicroService-649"><span class="linenos"> 649</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-650"><a href="#PumpWoodMicroService-650"><span class="linenos"> 650</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-651"><a href="#PumpWoodMicroService-651"><span class="linenos"> 651</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-652"><a href="#PumpWoodMicroService-652"><span class="linenos"> 652</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-653"><a href="#PumpWoodMicroService-653"><span class="linenos"> 653</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-654"><a href="#PumpWoodMicroService-654"><span class="linenos"> 654</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-655"><a href="#PumpWoodMicroService-655"><span class="linenos"> 655</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-656"><a href="#PumpWoodMicroService-656"><span class="linenos"> 656</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-657"><a href="#PumpWoodMicroService-657"><span class="linenos"> 657</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-658"><a href="#PumpWoodMicroService-658"><span class="linenos"> 658</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-659"><a href="#PumpWoodMicroService-659"><span class="linenos"> 659</span></a>
</span><span id="PumpWoodMicroService-660"><a href="#PumpWoodMicroService-660"><span class="linenos"> 660</span></a>    <span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-661"><a href="#PumpWoodMicroService-661"><span class="linenos"> 661</span></a>                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-662"><a href="#PumpWoodMicroService-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a GET a request to url with data as JSON payload.</span>
</span><span id="PumpWoodMicroService-663"><a href="#PumpWoodMicroService-663"><span class="linenos"> 663</span></a>
</span><span id="PumpWoodMicroService-664"><a href="#PumpWoodMicroService-664"><span class="linenos"> 664</span></a><span class="sd">        Add the auth_header acording to login information and refresh token</span>
</span><span id="PumpWoodMicroService-665"><a href="#PumpWoodMicroService-665"><span class="linenos"> 665</span></a><span class="sd">        if auth_header=None and object token is expired.</span>
</span><span id="PumpWoodMicroService-666"><a href="#PumpWoodMicroService-666"><span class="linenos"> 666</span></a>
</span><span id="PumpWoodMicroService-667"><a href="#PumpWoodMicroService-667"><span class="linenos"> 667</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-668"><a href="#PumpWoodMicroService-668"><span class="linenos"> 668</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService-669"><a href="#PumpWoodMicroService-669"><span class="linenos"> 669</span></a><span class="sd">                URL to make the request.</span>
</span><span id="PumpWoodMicroService-670"><a href="#PumpWoodMicroService-670"><span class="linenos"> 670</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-671"><a href="#PumpWoodMicroService-671"><span class="linenos"> 671</span></a><span class="sd">                URL parameters to make the request.</span>
</span><span id="PumpWoodMicroService-672"><a href="#PumpWoodMicroService-672"><span class="linenos"> 672</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-673"><a href="#PumpWoodMicroService-673"><span class="linenos"> 673</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-674"><a href="#PumpWoodMicroService-674"><span class="linenos"> 674</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-675"><a href="#PumpWoodMicroService-675"><span class="linenos"> 675</span></a>
</span><span id="PumpWoodMicroService-676"><a href="#PumpWoodMicroService-676"><span class="linenos"> 676</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-677"><a href="#PumpWoodMicroService-677"><span class="linenos"> 677</span></a><span class="sd">            Return the post reponse data.</span>
</span><span id="PumpWoodMicroService-678"><a href="#PumpWoodMicroService-678"><span class="linenos"> 678</span></a>
</span><span id="PumpWoodMicroService-679"><a href="#PumpWoodMicroService-679"><span class="linenos"> 679</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-680"><a href="#PumpWoodMicroService-680"><span class="linenos"> 680</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService-681"><a href="#PumpWoodMicroService-681"><span class="linenos"> 681</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="PumpWoodMicroService-682"><a href="#PumpWoodMicroService-682"><span class="linenos"> 682</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="PumpWoodMicroService-683"><a href="#PumpWoodMicroService-683"><span class="linenos"> 683</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="PumpWoodMicroService-684"><a href="#PumpWoodMicroService-684"><span class="linenos"> 684</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService-685"><a href="#PumpWoodMicroService-685"><span class="linenos"> 685</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="PumpWoodMicroService-686"><a href="#PumpWoodMicroService-686"><span class="linenos"> 686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-687"><a href="#PumpWoodMicroService-687"><span class="linenos"> 687</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-688"><a href="#PumpWoodMicroService-688"><span class="linenos"> 688</span></a>
</span><span id="PumpWoodMicroService-689"><a href="#PumpWoodMicroService-689"><span class="linenos"> 689</span></a>        <span class="c1"># If parameters are not none convert them to json before</span>
</span><span id="PumpWoodMicroService-690"><a href="#PumpWoodMicroService-690"><span class="linenos"> 690</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
</span><span id="PumpWoodMicroService-691"><a href="#PumpWoodMicroService-691"><span class="linenos"> 691</span></a>        <span class="c1"># for example</span>
</span><span id="PumpWoodMicroService-692"><a href="#PumpWoodMicroService-692"><span class="linenos"> 692</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-693"><a href="#PumpWoodMicroService-693"><span class="linenos"> 693</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-694"><a href="#PumpWoodMicroService-694"><span class="linenos"> 694</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-695"><a href="#PumpWoodMicroService-695"><span class="linenos"> 695</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="PumpWoodMicroService-696"><a href="#PumpWoodMicroService-696"><span class="linenos"> 696</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-697"><a href="#PumpWoodMicroService-697"><span class="linenos"> 697</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-698"><a href="#PumpWoodMicroService-698"><span class="linenos"> 698</span></a>
</span><span id="PumpWoodMicroService-699"><a href="#PumpWoodMicroService-699"><span class="linenos"> 699</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-700"><a href="#PumpWoodMicroService-700"><span class="linenos"> 700</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-701"><a href="#PumpWoodMicroService-701"><span class="linenos"> 701</span></a>            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-702"><a href="#PumpWoodMicroService-702"><span class="linenos"> 702</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-703"><a href="#PumpWoodMicroService-703"><span class="linenos"> 703</span></a>
</span><span id="PumpWoodMicroService-704"><a href="#PumpWoodMicroService-704"><span class="linenos"> 704</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-705"><a href="#PumpWoodMicroService-705"><span class="linenos"> 705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService-706"><a href="#PumpWoodMicroService-706"><span class="linenos"> 706</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-707"><a href="#PumpWoodMicroService-707"><span class="linenos"> 707</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-708"><a href="#PumpWoodMicroService-708"><span class="linenos"> 708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-709"><a href="#PumpWoodMicroService-709"><span class="linenos"> 709</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-710"><a href="#PumpWoodMicroService-710"><span class="linenos"> 710</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-711"><a href="#PumpWoodMicroService-711"><span class="linenos"> 711</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-712"><a href="#PumpWoodMicroService-712"><span class="linenos"> 712</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-713"><a href="#PumpWoodMicroService-713"><span class="linenos"> 713</span></a>
</span><span id="PumpWoodMicroService-714"><a href="#PumpWoodMicroService-714"><span class="linenos"> 714</span></a>        <span class="c1"># Re-raise Pumpwood exceptions</span>
</span><span id="PumpWoodMicroService-715"><a href="#PumpWoodMicroService-715"><span class="linenos"> 715</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-716"><a href="#PumpWoodMicroService-716"><span class="linenos"> 716</span></a>
</span><span id="PumpWoodMicroService-717"><a href="#PumpWoodMicroService-717"><span class="linenos"> 717</span></a>        <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-718"><a href="#PumpWoodMicroService-718"><span class="linenos"> 718</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-719"><a href="#PumpWoodMicroService-719"><span class="linenos"> 719</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-720"><a href="#PumpWoodMicroService-720"><span class="linenos"> 720</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-721"><a href="#PumpWoodMicroService-721"><span class="linenos"> 721</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-722"><a href="#PumpWoodMicroService-722"><span class="linenos"> 722</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-723"><a href="#PumpWoodMicroService-723"><span class="linenos"> 723</span></a>
</span><span id="PumpWoodMicroService-724"><a href="#PumpWoodMicroService-724"><span class="linenos"> 724</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-725"><a href="#PumpWoodMicroService-725"><span class="linenos"> 725</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-726"><a href="#PumpWoodMicroService-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-727"><a href="#PumpWoodMicroService-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-728"><a href="#PumpWoodMicroService-728"><span class="linenos"> 728</span></a>
</span><span id="PumpWoodMicroService-729"><a href="#PumpWoodMicroService-729"><span class="linenos"> 729</span></a>    <span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-730"><a href="#PumpWoodMicroService-730"><span class="linenos"> 730</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-731"><a href="#PumpWoodMicroService-731"><span class="linenos"> 731</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a DELETE a request to url with data as Json payload.</span>
</span><span id="PumpWoodMicroService-732"><a href="#PumpWoodMicroService-732"><span class="linenos"> 732</span></a>
</span><span id="PumpWoodMicroService-733"><a href="#PumpWoodMicroService-733"><span class="linenos"> 733</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-734"><a href="#PumpWoodMicroService-734"><span class="linenos"> 734</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService-735"><a href="#PumpWoodMicroService-735"><span class="linenos"> 735</span></a><span class="sd">                Url to make the request.</span>
</span><span id="PumpWoodMicroService-736"><a href="#PumpWoodMicroService-736"><span class="linenos"> 736</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-737"><a href="#PumpWoodMicroService-737"><span class="linenos"> 737</span></a><span class="sd">                Dictionary with Urls parameters.</span>
</span><span id="PumpWoodMicroService-738"><a href="#PumpWoodMicroService-738"><span class="linenos"> 738</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-739"><a href="#PumpWoodMicroService-739"><span class="linenos"> 739</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-740"><a href="#PumpWoodMicroService-740"><span class="linenos"> 740</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-741"><a href="#PumpWoodMicroService-741"><span class="linenos"> 741</span></a>
</span><span id="PumpWoodMicroService-742"><a href="#PumpWoodMicroService-742"><span class="linenos"> 742</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-743"><a href="#PumpWoodMicroService-743"><span class="linenos"> 743</span></a><span class="sd">            Return the delete reponse payload.</span>
</span><span id="PumpWoodMicroService-744"><a href="#PumpWoodMicroService-744"><span class="linenos"> 744</span></a>
</span><span id="PumpWoodMicroService-745"><a href="#PumpWoodMicroService-745"><span class="linenos"> 745</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-746"><a href="#PumpWoodMicroService-746"><span class="linenos"> 746</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService-747"><a href="#PumpWoodMicroService-747"><span class="linenos"> 747</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="PumpWoodMicroService-748"><a href="#PumpWoodMicroService-748"><span class="linenos"> 748</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="PumpWoodMicroService-749"><a href="#PumpWoodMicroService-749"><span class="linenos"> 749</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="PumpWoodMicroService-750"><a href="#PumpWoodMicroService-750"><span class="linenos"> 750</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService-751"><a href="#PumpWoodMicroService-751"><span class="linenos"> 751</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="PumpWoodMicroService-752"><a href="#PumpWoodMicroService-752"><span class="linenos"> 752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-753"><a href="#PumpWoodMicroService-753"><span class="linenos"> 753</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-754"><a href="#PumpWoodMicroService-754"><span class="linenos"> 754</span></a>
</span><span id="PumpWoodMicroService-755"><a href="#PumpWoodMicroService-755"><span class="linenos"> 755</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="PumpWoodMicroService-756"><a href="#PumpWoodMicroService-756"><span class="linenos"> 756</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-757"><a href="#PumpWoodMicroService-757"><span class="linenos"> 757</span></a>            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-758"><a href="#PumpWoodMicroService-758"><span class="linenos"> 758</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-759"><a href="#PumpWoodMicroService-759"><span class="linenos"> 759</span></a>
</span><span id="PumpWoodMicroService-760"><a href="#PumpWoodMicroService-760"><span class="linenos"> 760</span></a>        <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="PumpWoodMicroService-761"><a href="#PumpWoodMicroService-761"><span class="linenos"> 761</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-762"><a href="#PumpWoodMicroService-762"><span class="linenos"> 762</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService-763"><a href="#PumpWoodMicroService-763"><span class="linenos"> 763</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-764"><a href="#PumpWoodMicroService-764"><span class="linenos"> 764</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-765"><a href="#PumpWoodMicroService-765"><span class="linenos"> 765</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-766"><a href="#PumpWoodMicroService-766"><span class="linenos"> 766</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-767"><a href="#PumpWoodMicroService-767"><span class="linenos"> 767</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-768"><a href="#PumpWoodMicroService-768"><span class="linenos"> 768</span></a>                <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-769"><a href="#PumpWoodMicroService-769"><span class="linenos"> 769</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-770"><a href="#PumpWoodMicroService-770"><span class="linenos"> 770</span></a>
</span><span id="PumpWoodMicroService-771"><a href="#PumpWoodMicroService-771"><span class="linenos"> 771</span></a>        <span class="c1"># Re-raise Pumpwood Exceptions</span>
</span><span id="PumpWoodMicroService-772"><a href="#PumpWoodMicroService-772"><span class="linenos"> 772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-773"><a href="#PumpWoodMicroService-773"><span class="linenos"> 773</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-774"><a href="#PumpWoodMicroService-774"><span class="linenos"> 774</span></a>
</span><span id="PumpWoodMicroService-775"><a href="#PumpWoodMicroService-775"><span class="linenos"> 775</span></a>    <span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-776"><a href="#PumpWoodMicroService-776"><span class="linenos"> 776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-777"><a href="#PumpWoodMicroService-777"><span class="linenos"> 777</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
</span><span id="PumpWoodMicroService-778"><a href="#PumpWoodMicroService-778"><span class="linenos"> 778</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-779"><a href="#PumpWoodMicroService-779"><span class="linenos"> 779</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-780"><a href="#PumpWoodMicroService-780"><span class="linenos"> 780</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PumpWoodMicroService-781"><a href="#PumpWoodMicroService-781"><span class="linenos"> 781</span></a>            <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-782"><a href="#PumpWoodMicroService-782"><span class="linenos"> 782</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span><span id="PumpWoodMicroService-783"><a href="#PumpWoodMicroService-783"><span class="linenos"> 783</span></a>
</span><span id="PumpWoodMicroService-784"><a href="#PumpWoodMicroService-784"><span class="linenos"> 784</span></a>    <span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-785"><a href="#PumpWoodMicroService-785"><span class="linenos"> 785</span></a>                                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-786"><a href="#PumpWoodMicroService-786"><span class="linenos"> 786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a microservice (kong service) is registered at Kong.</span>
</span><span id="PumpWoodMicroService-787"><a href="#PumpWoodMicroService-787"><span class="linenos"> 787</span></a>
</span><span id="PumpWoodMicroService-788"><a href="#PumpWoodMicroService-788"><span class="linenos"> 788</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-789"><a href="#PumpWoodMicroService-789"><span class="linenos"> 789</span></a><span class="sd">            microservice:</span>
</span><span id="PumpWoodMicroService-790"><a href="#PumpWoodMicroService-790"><span class="linenos"> 790</span></a><span class="sd">                Service associated with microservice registered on</span>
</span><span id="PumpWoodMicroService-791"><a href="#PumpWoodMicroService-791"><span class="linenos"> 791</span></a><span class="sd">                Pumpwood Kong.</span>
</span><span id="PumpWoodMicroService-792"><a href="#PumpWoodMicroService-792"><span class="linenos"> 792</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-793"><a href="#PumpWoodMicroService-793"><span class="linenos"> 793</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-794"><a href="#PumpWoodMicroService-794"><span class="linenos"> 794</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-795"><a href="#PumpWoodMicroService-795"><span class="linenos"> 795</span></a>
</span><span id="PumpWoodMicroService-796"><a href="#PumpWoodMicroService-796"><span class="linenos"> 796</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-797"><a href="#PumpWoodMicroService-797"><span class="linenos"> 797</span></a><span class="sd">            Return true if microservice is registered.</span>
</span><span id="PumpWoodMicroService-798"><a href="#PumpWoodMicroService-798"><span class="linenos"> 798</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-799"><a href="#PumpWoodMicroService-799"><span class="linenos"> 799</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-800"><a href="#PumpWoodMicroService-800"><span class="linenos"> 800</span></a>        <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-801"><a href="#PumpWoodMicroService-801"><span class="linenos"> 801</span></a>
</span><span id="PumpWoodMicroService-802"><a href="#PumpWoodMicroService-802"><span class="linenos"> 802</span></a>    <span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-803"><a href="#PumpWoodMicroService-803"><span class="linenos"> 803</span></a>                                  <span class="n">availability</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;front_avaiable&#39;</span>
</span><span id="PumpWoodMicroService-804"><a href="#PumpWoodMicroService-804"><span class="linenos"> 804</span></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-805"><a href="#PumpWoodMicroService-805"><span class="linenos"> 805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all routes and services that have been registed at Kong.</span>
</span><span id="PumpWoodMicroService-806"><a href="#PumpWoodMicroService-806"><span class="linenos"> 806</span></a>
</span><span id="PumpWoodMicroService-807"><a href="#PumpWoodMicroService-807"><span class="linenos"> 807</span></a><span class="sd">        It is possible to restrict the return to end-points that should be</span>
</span><span id="PumpWoodMicroService-808"><a href="#PumpWoodMicroService-808"><span class="linenos"> 808</span></a><span class="sd">        avaiable at the frontend. Using this feature it is possibel to &#39;hide&#39;</span>
</span><span id="PumpWoodMicroService-809"><a href="#PumpWoodMicroService-809"><span class="linenos"> 809</span></a><span class="sd">        services from GUI keeping them avaiable for programatic calls.</span>
</span><span id="PumpWoodMicroService-810"><a href="#PumpWoodMicroService-810"><span class="linenos"> 810</span></a>
</span><span id="PumpWoodMicroService-811"><a href="#PumpWoodMicroService-811"><span class="linenos"> 811</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-812"><a href="#PumpWoodMicroService-812"><span class="linenos"> 812</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-813"><a href="#PumpWoodMicroService-813"><span class="linenos"> 813</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-814"><a href="#PumpWoodMicroService-814"><span class="linenos"> 814</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-815"><a href="#PumpWoodMicroService-815"><span class="linenos"> 815</span></a><span class="sd">            availability:</span>
</span><span id="PumpWoodMicroService-816"><a href="#PumpWoodMicroService-816"><span class="linenos"> 816</span></a><span class="sd">                Set the availability that is associated with the service.</span>
</span><span id="PumpWoodMicroService-817"><a href="#PumpWoodMicroService-817"><span class="linenos"> 817</span></a><span class="sd">                So far it is implemented &#39;front_avaiable&#39; and &#39;all&#39;.</span>
</span><span id="PumpWoodMicroService-818"><a href="#PumpWoodMicroService-818"><span class="linenos"> 818</span></a>
</span><span id="PumpWoodMicroService-819"><a href="#PumpWoodMicroService-819"><span class="linenos"> 819</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-820"><a href="#PumpWoodMicroService-820"><span class="linenos"> 820</span></a><span class="sd">            Return a list of serialized services objects containing the</span>
</span><span id="PumpWoodMicroService-821"><a href="#PumpWoodMicroService-821"><span class="linenos"> 821</span></a><span class="sd">            routes associated with at `route_set`.</span>
</span><span id="PumpWoodMicroService-822"><a href="#PumpWoodMicroService-822"><span class="linenos"> 822</span></a>
</span><span id="PumpWoodMicroService-823"><a href="#PumpWoodMicroService-823"><span class="linenos"> 823</span></a><span class="sd">            Service and routes have `notes__verbose` and `description__verbose`</span>
</span><span id="PumpWoodMicroService-824"><a href="#PumpWoodMicroService-824"><span class="linenos"> 824</span></a><span class="sd">            that are  the repective strings associated with note and</span>
</span><span id="PumpWoodMicroService-825"><a href="#PumpWoodMicroService-825"><span class="linenos"> 825</span></a><span class="sd">            description but translated using Pumpwood&#39;s I8s,</span>
</span><span id="PumpWoodMicroService-826"><a href="#PumpWoodMicroService-826"><span class="linenos"> 826</span></a>
</span><span id="PumpWoodMicroService-827"><a href="#PumpWoodMicroService-827"><span class="linenos"> 827</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-828"><a href="#PumpWoodMicroService-828"><span class="linenos"> 828</span></a><span class="sd">            PumpWoodWrongParameters:</span>
</span><span id="PumpWoodMicroService-829"><a href="#PumpWoodMicroService-829"><span class="linenos"> 829</span></a><span class="sd">                Raise PumpWoodWrongParameters if availability passed as</span>
</span><span id="PumpWoodMicroService-830"><a href="#PumpWoodMicroService-830"><span class="linenos"> 830</span></a><span class="sd">                paraemter is not implemented.</span>
</span><span id="PumpWoodMicroService-831"><a href="#PumpWoodMicroService-831"><span class="linenos"> 831</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-832"><a href="#PumpWoodMicroService-832"><span class="linenos"> 832</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
</span><span id="PumpWoodMicroService-833"><a href="#PumpWoodMicroService-833"><span class="linenos"> 833</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-834"><a href="#PumpWoodMicroService-834"><span class="linenos"> 834</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;availability&#39;</span><span class="p">:</span> <span class="n">availability</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-835"><a href="#PumpWoodMicroService-835"><span class="linenos"> 835</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-836"><a href="#PumpWoodMicroService-836"><span class="linenos"> 836</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span><span id="PumpWoodMicroService-837"><a href="#PumpWoodMicroService-837"><span class="linenos"> 837</span></a>
</span><span id="PumpWoodMicroService-838"><a href="#PumpWoodMicroService-838"><span class="linenos"> 838</span></a>    <span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-839"><a href="#PumpWoodMicroService-839"><span class="linenos"> 839</span></a>                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-840"><a href="#PumpWoodMicroService-840"><span class="linenos"> 840</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dummy call to ensure headers and payload reaching app.</span>
</span><span id="PumpWoodMicroService-841"><a href="#PumpWoodMicroService-841"><span class="linenos"> 841</span></a>
</span><span id="PumpWoodMicroService-842"><a href="#PumpWoodMicroService-842"><span class="linenos"> 842</span></a><span class="sd">        The request just bounce on the server and return the headers and</span>
</span><span id="PumpWoodMicroService-843"><a href="#PumpWoodMicroService-843"><span class="linenos"> 843</span></a><span class="sd">        payload that reached the application. It is usefull for probing</span>
</span><span id="PumpWoodMicroService-844"><a href="#PumpWoodMicroService-844"><span class="linenos"> 844</span></a><span class="sd">        proxy servers, API gateways and other security and load balance</span>
</span><span id="PumpWoodMicroService-845"><a href="#PumpWoodMicroService-845"><span class="linenos"> 845</span></a><span class="sd">        tools.</span>
</span><span id="PumpWoodMicroService-846"><a href="#PumpWoodMicroService-846"><span class="linenos"> 846</span></a>
</span><span id="PumpWoodMicroService-847"><a href="#PumpWoodMicroService-847"><span class="linenos"> 847</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-848"><a href="#PumpWoodMicroService-848"><span class="linenos"> 848</span></a><span class="sd">            payload:</span>
</span><span id="PumpWoodMicroService-849"><a href="#PumpWoodMicroService-849"><span class="linenos"> 849</span></a><span class="sd">                Payload to be returned by the dummy call end-point.</span>
</span><span id="PumpWoodMicroService-850"><a href="#PumpWoodMicroService-850"><span class="linenos"> 850</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-851"><a href="#PumpWoodMicroService-851"><span class="linenos"> 851</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-852"><a href="#PumpWoodMicroService-852"><span class="linenos"> 852</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-853"><a href="#PumpWoodMicroService-853"><span class="linenos"> 853</span></a>
</span><span id="PumpWoodMicroService-854"><a href="#PumpWoodMicroService-854"><span class="linenos"> 854</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-855"><a href="#PumpWoodMicroService-855"><span class="linenos"> 855</span></a><span class="sd">            Return a dictonary with:</span>
</span><span id="PumpWoodMicroService-856"><a href="#PumpWoodMicroService-856"><span class="linenos"> 856</span></a><span class="sd">            - **full_path**: Full path of the request.</span>
</span><span id="PumpWoodMicroService-857"><a href="#PumpWoodMicroService-857"><span class="linenos"> 857</span></a><span class="sd">            - **method**: Method used at the call</span>
</span><span id="PumpWoodMicroService-858"><a href="#PumpWoodMicroService-858"><span class="linenos"> 858</span></a><span class="sd">            - **headers**: Headers at the request.</span>
</span><span id="PumpWoodMicroService-859"><a href="#PumpWoodMicroService-859"><span class="linenos"> 859</span></a><span class="sd">            - **data**: Post payload sent at the request.</span>
</span><span id="PumpWoodMicroService-860"><a href="#PumpWoodMicroService-860"><span class="linenos"> 860</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-861"><a href="#PumpWoodMicroService-861"><span class="linenos"> 861</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
</span><span id="PumpWoodMicroService-862"><a href="#PumpWoodMicroService-862"><span class="linenos"> 862</span></a>        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-863"><a href="#PumpWoodMicroService-863"><span class="linenos"> 863</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-864"><a href="#PumpWoodMicroService-864"><span class="linenos"> 864</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-865"><a href="#PumpWoodMicroService-865"><span class="linenos"> 865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-866"><a href="#PumpWoodMicroService-866"><span class="linenos"> 866</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-867"><a href="#PumpWoodMicroService-867"><span class="linenos"> 867</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-868"><a href="#PumpWoodMicroService-868"><span class="linenos"> 868</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-869"><a href="#PumpWoodMicroService-869"><span class="linenos"> 869</span></a>
</span><span id="PumpWoodMicroService-870"><a href="#PumpWoodMicroService-870"><span class="linenos"> 870</span></a>    <span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-871"><a href="#PumpWoodMicroService-871"><span class="linenos"> 871</span></a>                    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-872"><a href="#PumpWoodMicroService-872"><span class="linenos"> 872</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an Pumpwood error with the payload.</span>
</span><span id="PumpWoodMicroService-873"><a href="#PumpWoodMicroService-873"><span class="linenos"> 873</span></a>
</span><span id="PumpWoodMicroService-874"><a href="#PumpWoodMicroService-874"><span class="linenos"> 874</span></a><span class="sd">        This and point raises an Arbitrary PumpWoodException error, it can be</span>
</span><span id="PumpWoodMicroService-875"><a href="#PumpWoodMicroService-875"><span class="linenos"> 875</span></a><span class="sd">        used for debuging error treatment.</span>
</span><span id="PumpWoodMicroService-876"><a href="#PumpWoodMicroService-876"><span class="linenos"> 876</span></a>
</span><span id="PumpWoodMicroService-877"><a href="#PumpWoodMicroService-877"><span class="linenos"> 877</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-878"><a href="#PumpWoodMicroService-878"><span class="linenos"> 878</span></a><span class="sd">            exception_class:</span>
</span><span id="PumpWoodMicroService-879"><a href="#PumpWoodMicroService-879"><span class="linenos"> 879</span></a><span class="sd">                Class of the exception to be raised.</span>
</span><span id="PumpWoodMicroService-880"><a href="#PumpWoodMicroService-880"><span class="linenos"> 880</span></a><span class="sd">            exception_deep:</span>
</span><span id="PumpWoodMicroService-881"><a href="#PumpWoodMicroService-881"><span class="linenos"> 881</span></a><span class="sd">                Deep of the exception in microservice calls. This arg will</span>
</span><span id="PumpWoodMicroService-882"><a href="#PumpWoodMicroService-882"><span class="linenos"> 882</span></a><span class="sd">                make error recusive, calling the end-point it self for</span>
</span><span id="PumpWoodMicroService-883"><a href="#PumpWoodMicroService-883"><span class="linenos"> 883</span></a><span class="sd">                `exception_deep` time before raising the error.</span>
</span><span id="PumpWoodMicroService-884"><a href="#PumpWoodMicroService-884"><span class="linenos"> 884</span></a><span class="sd">            payload:</span>
</span><span id="PumpWoodMicroService-885"><a href="#PumpWoodMicroService-885"><span class="linenos"> 885</span></a><span class="sd">                Payload that will be returned with error.</span>
</span><span id="PumpWoodMicroService-886"><a href="#PumpWoodMicroService-886"><span class="linenos"> 886</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-887"><a href="#PumpWoodMicroService-887"><span class="linenos"> 887</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-888"><a href="#PumpWoodMicroService-888"><span class="linenos"> 888</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-889"><a href="#PumpWoodMicroService-889"><span class="linenos"> 889</span></a>
</span><span id="PumpWoodMicroService-890"><a href="#PumpWoodMicroService-890"><span class="linenos"> 890</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-891"><a href="#PumpWoodMicroService-891"><span class="linenos"> 891</span></a><span class="sd">            Should not return any results, all possible call should result</span>
</span><span id="PumpWoodMicroService-892"><a href="#PumpWoodMicroService-892"><span class="linenos"> 892</span></a><span class="sd">            in raising the correspondent error.</span>
</span><span id="PumpWoodMicroService-893"><a href="#PumpWoodMicroService-893"><span class="linenos"> 893</span></a>
</span><span id="PumpWoodMicroService-894"><a href="#PumpWoodMicroService-894"><span class="linenos"> 894</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-895"><a href="#PumpWoodMicroService-895"><span class="linenos"> 895</span></a><span class="sd">            Should raise the correspondent error passed on exception_class</span>
</span><span id="PumpWoodMicroService-896"><a href="#PumpWoodMicroService-896"><span class="linenos"> 896</span></a><span class="sd">            arg, with payload.</span>
</span><span id="PumpWoodMicroService-897"><a href="#PumpWoodMicroService-897"><span class="linenos"> 897</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-898"><a href="#PumpWoodMicroService-898"><span class="linenos"> 898</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
</span><span id="PumpWoodMicroService-899"><a href="#PumpWoodMicroService-899"><span class="linenos"> 899</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
</span><span id="PumpWoodMicroService-900"><a href="#PumpWoodMicroService-900"><span class="linenos"> 900</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
</span><span id="PumpWoodMicroService-901"><a href="#PumpWoodMicroService-901"><span class="linenos"> 901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-902"><a href="#PumpWoodMicroService-902"><span class="linenos"> 902</span></a>
</span><span id="PumpWoodMicroService-903"><a href="#PumpWoodMicroService-903"><span class="linenos"> 903</span></a>    <span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-904"><a href="#PumpWoodMicroService-904"><span class="linenos"> 904</span></a>                                  <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-905"><a href="#PumpWoodMicroService-905"><span class="linenos"> 905</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pk using unique fields values.</span>
</span><span id="PumpWoodMicroService-906"><a href="#PumpWoodMicroService-906"><span class="linenos"> 906</span></a>
</span><span id="PumpWoodMicroService-907"><a href="#PumpWoodMicroService-907"><span class="linenos"> 907</span></a><span class="sd">        Use unique field values to retrieve pk of the objects. This end-point</span>
</span><span id="PumpWoodMicroService-908"><a href="#PumpWoodMicroService-908"><span class="linenos"> 908</span></a><span class="sd">        is usefull for retrieving pks of the objects associated with unique</span>
</span><span id="PumpWoodMicroService-909"><a href="#PumpWoodMicroService-909"><span class="linenos"> 909</span></a><span class="sd">        fields such as `description` (unique on most model of pumpwood).</span>
</span><span id="PumpWoodMicroService-910"><a href="#PumpWoodMicroService-910"><span class="linenos"> 910</span></a>
</span><span id="PumpWoodMicroService-911"><a href="#PumpWoodMicroService-911"><span class="linenos"> 911</span></a><span class="sd">        ```python</span>
</span><span id="PumpWoodMicroService-912"><a href="#PumpWoodMicroService-912"><span class="linenos"> 912</span></a><span class="sd">        # Using description to fetch pks from objects</span>
</span><span id="PumpWoodMicroService-913"><a href="#PumpWoodMicroService-913"><span class="linenos"> 913</span></a><span class="sd">        data: pd.DataFrame = [data with unique description but without pk]</span>
</span><span id="PumpWoodMicroService-914"><a href="#PumpWoodMicroService-914"><span class="linenos"> 914</span></a><span class="sd">        data[&#39;attribute_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="PumpWoodMicroService-915"><a href="#PumpWoodMicroService-915"><span class="linenos"> 915</span></a><span class="sd">            model_class=&quot;DescriptionAttribute&quot;,</span>
</span><span id="PumpWoodMicroService-916"><a href="#PumpWoodMicroService-916"><span class="linenos"> 916</span></a><span class="sd">            field=&quot;description&quot;, values=data[&#39;attribute&#39;])[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService-917"><a href="#PumpWoodMicroService-917"><span class="linenos"> 917</span></a>
</span><span id="PumpWoodMicroService-918"><a href="#PumpWoodMicroService-918"><span class="linenos"> 918</span></a><span class="sd">        # Using a dimension key to fetch pk of the objects, dimension</span>
</span><span id="PumpWoodMicroService-919"><a href="#PumpWoodMicroService-919"><span class="linenos"> 919</span></a><span class="sd">        # key must be unique</span>
</span><span id="PumpWoodMicroService-920"><a href="#PumpWoodMicroService-920"><span class="linenos"> 920</span></a><span class="sd">        data[&#39;georea_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="PumpWoodMicroService-921"><a href="#PumpWoodMicroService-921"><span class="linenos"> 921</span></a><span class="sd">            model_class=&quot;DescriptionGeoarea&quot;, field=&quot;dimension-&gt;city&quot;,</span>
</span><span id="PumpWoodMicroService-922"><a href="#PumpWoodMicroService-922"><span class="linenos"> 922</span></a><span class="sd">            values=data[&#39;city&#39;])[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService-923"><a href="#PumpWoodMicroService-923"><span class="linenos"> 923</span></a><span class="sd">        ```</span>
</span><span id="PumpWoodMicroService-924"><a href="#PumpWoodMicroService-924"><span class="linenos"> 924</span></a>
</span><span id="PumpWoodMicroService-925"><a href="#PumpWoodMicroService-925"><span class="linenos"> 925</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-926"><a href="#PumpWoodMicroService-926"><span class="linenos"> 926</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-927"><a href="#PumpWoodMicroService-927"><span class="linenos"> 927</span></a><span class="sd">                Model class of the objects.</span>
</span><span id="PumpWoodMicroService-928"><a href="#PumpWoodMicroService-928"><span class="linenos"> 928</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService-929"><a href="#PumpWoodMicroService-929"><span class="linenos"> 929</span></a><span class="sd">                Unique field to fetch pk. It is possible to use dimension keys</span>
</span><span id="PumpWoodMicroService-930"><a href="#PumpWoodMicroService-930"><span class="linenos"> 930</span></a><span class="sd">                as unique field, for that use `dimension-&gt;[key]` notation.</span>
</span><span id="PumpWoodMicroService-931"><a href="#PumpWoodMicroService-931"><span class="linenos"> 931</span></a><span class="sd">            values:</span>
</span><span id="PumpWoodMicroService-932"><a href="#PumpWoodMicroService-932"><span class="linenos"> 932</span></a><span class="sd">                List of the unique fields used to fetch primary keys.</span>
</span><span id="PumpWoodMicroService-933"><a href="#PumpWoodMicroService-933"><span class="linenos"> 933</span></a>
</span><span id="PumpWoodMicroService-934"><a href="#PumpWoodMicroService-934"><span class="linenos"> 934</span></a><span class="sd">        Return:</span>
</span><span id="PumpWoodMicroService-935"><a href="#PumpWoodMicroService-935"><span class="linenos"> 935</span></a><span class="sd">            Return a dataframe in same order as values with columns:</span>
</span><span id="PumpWoodMicroService-936"><a href="#PumpWoodMicroService-936"><span class="linenos"> 936</span></a><span class="sd">            - **pk**: Correspondent primary key of the unique value.</span>
</span><span id="PumpWoodMicroService-937"><a href="#PumpWoodMicroService-937"><span class="linenos"> 937</span></a><span class="sd">            - **[field]**: Column with same name of field argument,</span>
</span><span id="PumpWoodMicroService-938"><a href="#PumpWoodMicroService-938"><span class="linenos"> 938</span></a><span class="sd">                correspondent to pk.</span>
</span><span id="PumpWoodMicroService-939"><a href="#PumpWoodMicroService-939"><span class="linenos"> 939</span></a>
</span><span id="PumpWoodMicroService-940"><a href="#PumpWoodMicroService-940"><span class="linenos"> 940</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-941"><a href="#PumpWoodMicroService-941"><span class="linenos"> 941</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="PumpWoodMicroService-942"><a href="#PumpWoodMicroService-942"><span class="linenos"> 942</span></a><span class="sd">                Raises if field is not found on the model and it is note</span>
</span><span id="PumpWoodMicroService-943"><a href="#PumpWoodMicroService-943"><span class="linenos"> 943</span></a><span class="sd">                associated with a dimension tag.</span>
</span><span id="PumpWoodMicroService-944"><a href="#PumpWoodMicroService-944"><span class="linenos"> 944</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="PumpWoodMicroService-945"><a href="#PumpWoodMicroService-945"><span class="linenos"> 945</span></a><span class="sd">                Raises if `field` does not have a unique restriction on</span>
</span><span id="PumpWoodMicroService-946"><a href="#PumpWoodMicroService-946"><span class="linenos"> 946</span></a><span class="sd">                database. Dimension keys does not check for uniqueness on</span>
</span><span id="PumpWoodMicroService-947"><a href="#PumpWoodMicroService-947"><span class="linenos"> 947</span></a><span class="sd">                database, be carefull not to duplicate the lines.</span>
</span><span id="PumpWoodMicroService-948"><a href="#PumpWoodMicroService-948"><span class="linenos"> 948</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-949"><a href="#PumpWoodMicroService-949"><span class="linenos"> 949</span></a>        <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService-950"><a href="#PumpWoodMicroService-950"><span class="linenos"> 950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-951"><a href="#PumpWoodMicroService-951"><span class="linenos"> 951</span></a>            <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-952"><a href="#PumpWoodMicroService-952"><span class="linenos"> 952</span></a>            <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-953"><a href="#PumpWoodMicroService-953"><span class="linenos"> 953</span></a>            <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-954"><a href="#PumpWoodMicroService-954"><span class="linenos"> 954</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-955"><a href="#PumpWoodMicroService-955"><span class="linenos"> 955</span></a>                    <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
</span><span id="PumpWoodMicroService-956"><a href="#PumpWoodMicroService-956"><span class="linenos"> 956</span></a>                    <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-957"><a href="#PumpWoodMicroService-957"><span class="linenos"> 957</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-958"><a href="#PumpWoodMicroService-958"><span class="linenos"> 958</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-959"><a href="#PumpWoodMicroService-959"><span class="linenos"> 959</span></a>
</span><span id="PumpWoodMicroService-960"><a href="#PumpWoodMicroService-960"><span class="linenos"> 960</span></a>            <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-961"><a href="#PumpWoodMicroService-961"><span class="linenos"> 961</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-962"><a href="#PumpWoodMicroService-962"><span class="linenos"> 962</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
</span><span id="PumpWoodMicroService-963"><a href="#PumpWoodMicroService-963"><span class="linenos"> 963</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-964"><a href="#PumpWoodMicroService-964"><span class="linenos"> 964</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-965"><a href="#PumpWoodMicroService-965"><span class="linenos"> 965</span></a>
</span><span id="PumpWoodMicroService-966"><a href="#PumpWoodMicroService-966"><span class="linenos"> 966</span></a>        <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
</span><span id="PumpWoodMicroService-967"><a href="#PumpWoodMicroService-967"><span class="linenos"> 967</span></a>        <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-968"><a href="#PumpWoodMicroService-968"><span class="linenos"> 968</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-969"><a href="#PumpWoodMicroService-969"><span class="linenos"> 969</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-970"><a href="#PumpWoodMicroService-970"><span class="linenos"> 970</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-971"><a href="#PumpWoodMicroService-971"><span class="linenos"> 971</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-972"><a href="#PumpWoodMicroService-972"><span class="linenos"> 972</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-973"><a href="#PumpWoodMicroService-973"><span class="linenos"> 973</span></a>
</span><span id="PumpWoodMicroService-974"><a href="#PumpWoodMicroService-974"><span class="linenos"> 974</span></a>        <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
</span><span id="PumpWoodMicroService-975"><a href="#PumpWoodMicroService-975"><span class="linenos"> 975</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-976"><a href="#PumpWoodMicroService-976"><span class="linenos"> 976</span></a>            <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-977"><a href="#PumpWoodMicroService-977"><span class="linenos"> 977</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-978"><a href="#PumpWoodMicroService-978"><span class="linenos"> 978</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-979"><a href="#PumpWoodMicroService-979"><span class="linenos"> 979</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
</span><span id="PumpWoodMicroService-980"><a href="#PumpWoodMicroService-980"><span class="linenos"> 980</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService-981"><a href="#PumpWoodMicroService-981"><span class="linenos"> 981</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-982"><a href="#PumpWoodMicroService-982"><span class="linenos"> 982</span></a>                <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
</span><span id="PumpWoodMicroService-983"><a href="#PumpWoodMicroService-983"><span class="linenos"> 983</span></a>                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
</span><span id="PumpWoodMicroService-984"><a href="#PumpWoodMicroService-984"><span class="linenos"> 984</span></a>                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-985"><a href="#PumpWoodMicroService-985"><span class="linenos"> 985</span></a>
</span><span id="PumpWoodMicroService-986"><a href="#PumpWoodMicroService-986"><span class="linenos"> 986</span></a>        <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-987"><a href="#PumpWoodMicroService-987"><span class="linenos"> 987</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-988"><a href="#PumpWoodMicroService-988"><span class="linenos"> 988</span></a>            <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService-989"><a href="#PumpWoodMicroService-989"><span class="linenos"> 989</span></a>            <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
</span><span id="PumpWoodMicroService-990"><a href="#PumpWoodMicroService-990"><span class="linenos"> 990</span></a>        <span class="p">})</span>
</span><span id="PumpWoodMicroService-991"><a href="#PumpWoodMicroService-991"><span class="linenos"> 991</span></a>
</span><span id="PumpWoodMicroService-992"><a href="#PumpWoodMicroService-992"><span class="linenos"> 992</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-993"><a href="#PumpWoodMicroService-993"><span class="linenos"> 993</span></a>    <span class="k">def</span> <span class="nf">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-994"><a href="#PumpWoodMicroService-994"><span class="linenos"> 994</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="PumpWoodMicroService-995"><a href="#PumpWoodMicroService-995"><span class="linenos"> 995</span></a>
</span><span id="PumpWoodMicroService-996"><a href="#PumpWoodMicroService-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-997"><a href="#PumpWoodMicroService-997"><span class="linenos"> 997</span></a>             <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService-998"><a href="#PumpWoodMicroService-998"><span class="linenos"> 998</span></a>             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-999"><a href="#PumpWoodMicroService-999"><span class="linenos"> 999</span></a>             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1000"><a href="#PumpWoodMicroService-1000"><span class="linenos">1000</span></a>             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1001"><a href="#PumpWoodMicroService-1001"><span class="linenos">1001</span></a>             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1002"><a href="#PumpWoodMicroService-1002"><span class="linenos">1002</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List objects with pagination.</span>
</span><span id="PumpWoodMicroService-1003"><a href="#PumpWoodMicroService-1003"><span class="linenos">1003</span></a>
</span><span id="PumpWoodMicroService-1004"><a href="#PumpWoodMicroService-1004"><span class="linenos">1004</span></a><span class="sd">        List end-point (resumed data) of PumpWood like systems,</span>
</span><span id="PumpWoodMicroService-1005"><a href="#PumpWoodMicroService-1005"><span class="linenos">1005</span></a><span class="sd">        results will be paginated. To get next pag, send all recived pk at</span>
</span><span id="PumpWoodMicroService-1006"><a href="#PumpWoodMicroService-1006"><span class="linenos">1006</span></a><span class="sd">        exclude dict (ex.: `exclude_dict={pk__in: [1,2,...,30]}`).</span>
</span><span id="PumpWoodMicroService-1007"><a href="#PumpWoodMicroService-1007"><span class="linenos">1007</span></a>
</span><span id="PumpWoodMicroService-1008"><a href="#PumpWoodMicroService-1008"><span class="linenos">1008</span></a><span class="sd">        It is possible to return foreign keys objects associated with</span>
</span><span id="PumpWoodMicroService-1009"><a href="#PumpWoodMicroService-1009"><span class="linenos">1009</span></a><span class="sd">        `model_class`. Use this with carefull since increase the backend</span>
</span><span id="PumpWoodMicroService-1010"><a href="#PumpWoodMicroService-1010"><span class="linenos">1010</span></a><span class="sd">        infrastructure consumption, each object is a retrieve call per</span>
</span><span id="PumpWoodMicroService-1011"><a href="#PumpWoodMicroService-1011"><span class="linenos">1011</span></a><span class="sd">        foreign key (otimization in progress).</span>
</span><span id="PumpWoodMicroService-1012"><a href="#PumpWoodMicroService-1012"><span class="linenos">1012</span></a>
</span><span id="PumpWoodMicroService-1013"><a href="#PumpWoodMicroService-1013"><span class="linenos">1013</span></a><span class="sd">        It is possible to use diferent operators using `__` after the name</span>
</span><span id="PumpWoodMicroService-1014"><a href="#PumpWoodMicroService-1014"><span class="linenos">1014</span></a><span class="sd">        of the field, some of the operators avaiable:</span>
</span><span id="PumpWoodMicroService-1015"><a href="#PumpWoodMicroService-1015"><span class="linenos">1015</span></a>
</span><span id="PumpWoodMicroService-1016"><a href="#PumpWoodMicroService-1016"><span class="linenos">1016</span></a><span class="sd">        ### General operators</span>
</span><span id="PumpWoodMicroService-1017"><a href="#PumpWoodMicroService-1017"><span class="linenos">1017</span></a><span class="sd">        - **__eq:** Check if the value is the same, same results if no</span>
</span><span id="PumpWoodMicroService-1018"><a href="#PumpWoodMicroService-1018"><span class="linenos">1018</span></a><span class="sd">            operator is passed.</span>
</span><span id="PumpWoodMicroService-1019"><a href="#PumpWoodMicroService-1019"><span class="linenos">1019</span></a><span class="sd">        - **__gt:** Check if value is greter then argument.</span>
</span><span id="PumpWoodMicroService-1020"><a href="#PumpWoodMicroService-1020"><span class="linenos">1020</span></a><span class="sd">        - **__lt:** Check if value is less then argument.</span>
</span><span id="PumpWoodMicroService-1021"><a href="#PumpWoodMicroService-1021"><span class="linenos">1021</span></a><span class="sd">        - **__gte:** Check if value is greter or equal then argument.</span>
</span><span id="PumpWoodMicroService-1022"><a href="#PumpWoodMicroService-1022"><span class="linenos">1022</span></a><span class="sd">        - **__lte:** Check if value is less or equal then argument.</span>
</span><span id="PumpWoodMicroService-1023"><a href="#PumpWoodMicroService-1023"><span class="linenos">1023</span></a><span class="sd">        - **__in:** Check if value is at a list, the argument of this operator</span>
</span><span id="PumpWoodMicroService-1024"><a href="#PumpWoodMicroService-1024"><span class="linenos">1024</span></a><span class="sd">            must be a list.</span>
</span><span id="PumpWoodMicroService-1025"><a href="#PumpWoodMicroService-1025"><span class="linenos">1025</span></a>
</span><span id="PumpWoodMicroService-1026"><a href="#PumpWoodMicroService-1026"><span class="linenos">1026</span></a><span class="sd">        ### Text field operators</span>
</span><span id="PumpWoodMicroService-1027"><a href="#PumpWoodMicroService-1027"><span class="linenos">1027</span></a><span class="sd">        - **__contains:** Check if value contains a string. It is case and</span>
</span><span id="PumpWoodMicroService-1028"><a href="#PumpWoodMicroService-1028"><span class="linenos">1028</span></a><span class="sd">            accent sensitive.</span>
</span><span id="PumpWoodMicroService-1029"><a href="#PumpWoodMicroService-1029"><span class="linenos">1029</span></a><span class="sd">        - **__icontains:** Check if a values contains a string, It is case</span>
</span><span id="PumpWoodMicroService-1030"><a href="#PumpWoodMicroService-1030"><span class="linenos">1030</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService-1031"><a href="#PumpWoodMicroService-1031"><span class="linenos">1031</span></a><span class="sd">        - **__unaccent_icontains:** Check if a values contains a string, It is</span>
</span><span id="PumpWoodMicroService-1032"><a href="#PumpWoodMicroService-1032"><span class="linenos">1032</span></a><span class="sd">            case insensitive and accent insensitive (consider a, à, á, ã, ...</span>
</span><span id="PumpWoodMicroService-1033"><a href="#PumpWoodMicroService-1033"><span class="linenos">1033</span></a><span class="sd">            the same).</span>
</span><span id="PumpWoodMicroService-1034"><a href="#PumpWoodMicroService-1034"><span class="linenos">1034</span></a><span class="sd">        - **__exact:** Same as __eq or not setting operator.</span>
</span><span id="PumpWoodMicroService-1035"><a href="#PumpWoodMicroService-1035"><span class="linenos">1035</span></a><span class="sd">        - **__iexact:** Same as __eq, but case insensitive and</span>
</span><span id="PumpWoodMicroService-1036"><a href="#PumpWoodMicroService-1036"><span class="linenos">1036</span></a><span class="sd">            accent sensitive.</span>
</span><span id="PumpWoodMicroService-1037"><a href="#PumpWoodMicroService-1037"><span class="linenos">1037</span></a><span class="sd">        - **__unaccent_iexact:** Same as __eq, but case insensitive and</span>
</span><span id="PumpWoodMicroService-1038"><a href="#PumpWoodMicroService-1038"><span class="linenos">1038</span></a><span class="sd">            accent insensitive.</span>
</span><span id="PumpWoodMicroService-1039"><a href="#PumpWoodMicroService-1039"><span class="linenos">1039</span></a><span class="sd">        - **__startswith:** Check if the value stats with a sub-string.</span>
</span><span id="PumpWoodMicroService-1040"><a href="#PumpWoodMicroService-1040"><span class="linenos">1040</span></a><span class="sd">            Case sensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService-1041"><a href="#PumpWoodMicroService-1041"><span class="linenos">1041</span></a><span class="sd">        - **__istartswith:** Check if the value stats with a sub-string.</span>
</span><span id="PumpWoodMicroService-1042"><a href="#PumpWoodMicroService-1042"><span class="linenos">1042</span></a><span class="sd">            Case insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService-1043"><a href="#PumpWoodMicroService-1043"><span class="linenos">1043</span></a><span class="sd">        - **__unaccent_istartswith:** Check if the value stats with a</span>
</span><span id="PumpWoodMicroService-1044"><a href="#PumpWoodMicroService-1044"><span class="linenos">1044</span></a><span class="sd">            sub-string. Case insensitive and accent insensitive.</span>
</span><span id="PumpWoodMicroService-1045"><a href="#PumpWoodMicroService-1045"><span class="linenos">1045</span></a><span class="sd">        - **__endswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="PumpWoodMicroService-1046"><a href="#PumpWoodMicroService-1046"><span class="linenos">1046</span></a><span class="sd">            sensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService-1047"><a href="#PumpWoodMicroService-1047"><span class="linenos">1047</span></a><span class="sd">        - **__iendswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="PumpWoodMicroService-1048"><a href="#PumpWoodMicroService-1048"><span class="linenos">1048</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService-1049"><a href="#PumpWoodMicroService-1049"><span class="linenos">1049</span></a><span class="sd">        - **__unaccent_iendswith:** Check if the value ends with a sub-string.</span>
</span><span id="PumpWoodMicroService-1050"><a href="#PumpWoodMicroService-1050"><span class="linenos">1050</span></a><span class="sd">            Case insensitive and accent insensitive.</span>
</span><span id="PumpWoodMicroService-1051"><a href="#PumpWoodMicroService-1051"><span class="linenos">1051</span></a>
</span><span id="PumpWoodMicroService-1052"><a href="#PumpWoodMicroService-1052"><span class="linenos">1052</span></a><span class="sd">        ### Null operators</span>
</span><span id="PumpWoodMicroService-1053"><a href="#PumpWoodMicroService-1053"><span class="linenos">1053</span></a><span class="sd">        - **__isnull:** Check if field is null, it uses as argument a `boolean`</span>
</span><span id="PumpWoodMicroService-1054"><a href="#PumpWoodMicroService-1054"><span class="linenos">1054</span></a><span class="sd">            value false will return all non NULL values and true will return</span>
</span><span id="PumpWoodMicroService-1055"><a href="#PumpWoodMicroService-1055"><span class="linenos">1055</span></a><span class="sd">            NULL values.</span>
</span><span id="PumpWoodMicroService-1056"><a href="#PumpWoodMicroService-1056"><span class="linenos">1056</span></a>
</span><span id="PumpWoodMicroService-1057"><a href="#PumpWoodMicroService-1057"><span class="linenos">1057</span></a><span class="sd">        ### Date and datetime operators:</span>
</span><span id="PumpWoodMicroService-1058"><a href="#PumpWoodMicroService-1058"><span class="linenos">1058</span></a><span class="sd">        - **__range:** Receive as argument a list of two elements and return</span>
</span><span id="PumpWoodMicroService-1059"><a href="#PumpWoodMicroService-1059"><span class="linenos">1059</span></a><span class="sd">            objects that field dates are between those values.</span>
</span><span id="PumpWoodMicroService-1060"><a href="#PumpWoodMicroService-1060"><span class="linenos">1060</span></a><span class="sd">        - **__year:** Return object that date field value year is equal to</span>
</span><span id="PumpWoodMicroService-1061"><a href="#PumpWoodMicroService-1061"><span class="linenos">1061</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService-1062"><a href="#PumpWoodMicroService-1062"><span class="linenos">1062</span></a><span class="sd">        - **__month:** Return object that date field value month is equal to</span>
</span><span id="PumpWoodMicroService-1063"><a href="#PumpWoodMicroService-1063"><span class="linenos">1063</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService-1064"><a href="#PumpWoodMicroService-1064"><span class="linenos">1064</span></a><span class="sd">        - **__day:** Return object that date field value day is equal to</span>
</span><span id="PumpWoodMicroService-1065"><a href="#PumpWoodMicroService-1065"><span class="linenos">1065</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService-1066"><a href="#PumpWoodMicroService-1066"><span class="linenos">1066</span></a>
</span><span id="PumpWoodMicroService-1067"><a href="#PumpWoodMicroService-1067"><span class="linenos">1067</span></a><span class="sd">        ### Dictionary fields operators:</span>
</span><span id="PumpWoodMicroService-1068"><a href="#PumpWoodMicroService-1068"><span class="linenos">1068</span></a><span class="sd">        - **__json_contained_by:**</span>
</span><span id="PumpWoodMicroService-1069"><a href="#PumpWoodMicroService-1069"><span class="linenos">1069</span></a><span class="sd">            Uses the function [contained_by](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by)</span>
</span><span id="PumpWoodMicroService-1070"><a href="#PumpWoodMicroService-1070"><span class="linenos">1070</span></a><span class="sd">            from SQLAlchemy to test if keys are a proper subset of the keys of</span>
</span><span id="PumpWoodMicroService-1071"><a href="#PumpWoodMicroService-1071"><span class="linenos">1071</span></a><span class="sd">            the argument jsonb expression (extracted from SQLAlchemy). The</span>
</span><span id="PumpWoodMicroService-1072"><a href="#PumpWoodMicroService-1072"><span class="linenos">1072</span></a><span class="sd">            argument is a list.</span>
</span><span id="PumpWoodMicroService-1073"><a href="#PumpWoodMicroService-1073"><span class="linenos">1073</span></a><span class="sd">        - **__json_has_any:**</span>
</span><span id="PumpWoodMicroService-1074"><a href="#PumpWoodMicroService-1074"><span class="linenos">1074</span></a><span class="sd">            Uses the function [has_any](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any)</span>
</span><span id="PumpWoodMicroService-1075"><a href="#PumpWoodMicroService-1075"><span class="linenos">1075</span></a><span class="sd">            from SQLAlchemy to test for presence of a key. Note that the key</span>
</span><span id="PumpWoodMicroService-1076"><a href="#PumpWoodMicroService-1076"><span class="linenos">1076</span></a><span class="sd">            may be a SQLA expression. (extracted from SQLAlchemy). The</span>
</span><span id="PumpWoodMicroService-1077"><a href="#PumpWoodMicroService-1077"><span class="linenos">1077</span></a><span class="sd">            argument is a list.</span>
</span><span id="PumpWoodMicroService-1078"><a href="#PumpWoodMicroService-1078"><span class="linenos">1078</span></a><span class="sd">        - **__json_has_key:**</span>
</span><span id="PumpWoodMicroService-1079"><a href="#PumpWoodMicroService-1079"><span class="linenos">1079</span></a><span class="sd">            Uses the function [has_key](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key)</span>
</span><span id="PumpWoodMicroService-1080"><a href="#PumpWoodMicroService-1080"><span class="linenos">1080</span></a><span class="sd">            from SQLAlchemy to Test for presence of a key. Note that the key</span>
</span><span id="PumpWoodMicroService-1081"><a href="#PumpWoodMicroService-1081"><span class="linenos">1081</span></a><span class="sd">            may be a SQLA expression. The argument is a str.</span>
</span><span id="PumpWoodMicroService-1082"><a href="#PumpWoodMicroService-1082"><span class="linenos">1082</span></a>
</span><span id="PumpWoodMicroService-1083"><a href="#PumpWoodMicroService-1083"><span class="linenos">1083</span></a><span class="sd">        ### Text similarity operators</span>
</span><span id="PumpWoodMicroService-1084"><a href="#PumpWoodMicroService-1084"><span class="linenos">1084</span></a><span class="sd">        To use similariry querys on Postgres it is necessary to `pg_trgm` be</span>
</span><span id="PumpWoodMicroService-1085"><a href="#PumpWoodMicroService-1085"><span class="linenos">1085</span></a><span class="sd">        instaled on server. Check [oficial documentation]</span>
</span><span id="PumpWoodMicroService-1086"><a href="#PumpWoodMicroService-1086"><span class="linenos">1086</span></a><span class="sd">        (https://www.postgresql.org/docs/current/pgtrgm.html).</span>
</span><span id="PumpWoodMicroService-1087"><a href="#PumpWoodMicroService-1087"><span class="linenos">1087</span></a>
</span><span id="PumpWoodMicroService-1088"><a href="#PumpWoodMicroService-1088"><span class="linenos">1088</span></a><span class="sd">        - **__similarity:** Check if two strings are similar uses the `%`</span>
</span><span id="PumpWoodMicroService-1089"><a href="#PumpWoodMicroService-1089"><span class="linenos">1089</span></a><span class="sd">            operador.</span>
</span><span id="PumpWoodMicroService-1090"><a href="#PumpWoodMicroService-1090"><span class="linenos">1090</span></a><span class="sd">        - **__word_similar_left:** Check if two strings are similar uses the</span>
</span><span id="PumpWoodMicroService-1091"><a href="#PumpWoodMicroService-1091"><span class="linenos">1091</span></a><span class="sd">            `&lt;%` operador.</span>
</span><span id="PumpWoodMicroService-1092"><a href="#PumpWoodMicroService-1092"><span class="linenos">1092</span></a><span class="sd">        - **__word_similar_right:** Check if two strings are similar uses the</span>
</span><span id="PumpWoodMicroService-1093"><a href="#PumpWoodMicroService-1093"><span class="linenos">1093</span></a><span class="sd">            `%&gt;` operador.</span>
</span><span id="PumpWoodMicroService-1094"><a href="#PumpWoodMicroService-1094"><span class="linenos">1094</span></a><span class="sd">        - **__strict_word__similar_left:** Check if two strings are similar</span>
</span><span id="PumpWoodMicroService-1095"><a href="#PumpWoodMicroService-1095"><span class="linenos">1095</span></a><span class="sd">            uses the `&lt;&lt;%` operador.</span>
</span><span id="PumpWoodMicroService-1096"><a href="#PumpWoodMicroService-1096"><span class="linenos">1096</span></a><span class="sd">        - **__strict_word__similar_right:** Check if two strings are similar</span>
</span><span id="PumpWoodMicroService-1097"><a href="#PumpWoodMicroService-1097"><span class="linenos">1097</span></a><span class="sd">            uses the `%&gt;&gt;` operador.</span>
</span><span id="PumpWoodMicroService-1098"><a href="#PumpWoodMicroService-1098"><span class="linenos">1098</span></a>
</span><span id="PumpWoodMicroService-1099"><a href="#PumpWoodMicroService-1099"><span class="linenos">1099</span></a><span class="sd">        Some usage examples:</span>
</span><span id="PumpWoodMicroService-1100"><a href="#PumpWoodMicroService-1100"><span class="linenos">1100</span></a><span class="sd">        ```python</span>
</span><span id="PumpWoodMicroService-1101"><a href="#PumpWoodMicroService-1101"><span class="linenos">1101</span></a><span class="sd">        # Return the first 3 results ordered decreasing acording to `time` and</span>
</span><span id="PumpWoodMicroService-1102"><a href="#PumpWoodMicroService-1102"><span class="linenos">1102</span></a><span class="sd">        # them ordered by `modeling_unit_id`. Results must have time greater</span>
</span><span id="PumpWoodMicroService-1103"><a href="#PumpWoodMicroService-1103"><span class="linenos">1103</span></a><span class="sd">        # or equal to 2017-01-01 and less or equal to 2017-06-01. It also</span>
</span><span id="PumpWoodMicroService-1104"><a href="#PumpWoodMicroService-1104"><span class="linenos">1104</span></a><span class="sd">        # must have attribute_id equal to 6 and not contains modeling_unit_id</span>
</span><span id="PumpWoodMicroService-1105"><a href="#PumpWoodMicroService-1105"><span class="linenos">1105</span></a><span class="sd">        # 3 or 4.</span>
</span><span id="PumpWoodMicroService-1106"><a href="#PumpWoodMicroService-1106"><span class="linenos">1106</span></a><span class="sd">        microservice.list(</span>
</span><span id="PumpWoodMicroService-1107"><a href="#PumpWoodMicroService-1107"><span class="linenos">1107</span></a><span class="sd">            model_class=&quot;DatabaseVariable&quot;,</span>
</span><span id="PumpWoodMicroService-1108"><a href="#PumpWoodMicroService-1108"><span class="linenos">1108</span></a><span class="sd">            filter_dict={</span>
</span><span id="PumpWoodMicroService-1109"><a href="#PumpWoodMicroService-1109"><span class="linenos">1109</span></a><span class="sd">                &quot;time__gte&quot;: &quot;2017-01-01 00:00:00&quot;,</span>
</span><span id="PumpWoodMicroService-1110"><a href="#PumpWoodMicroService-1110"><span class="linenos">1110</span></a><span class="sd">                &quot;time__lte&quot;: &quot;2017-06-01 00:00:00&quot;,</span>
</span><span id="PumpWoodMicroService-1111"><a href="#PumpWoodMicroService-1111"><span class="linenos">1111</span></a><span class="sd">                &quot;attribute_id&quot;: 6},</span>
</span><span id="PumpWoodMicroService-1112"><a href="#PumpWoodMicroService-1112"><span class="linenos">1112</span></a><span class="sd">            exclude_dict={</span>
</span><span id="PumpWoodMicroService-1113"><a href="#PumpWoodMicroService-1113"><span class="linenos">1113</span></a><span class="sd">                &quot;modeling_unit_id__in&quot;: [3, 4]},</span>
</span><span id="PumpWoodMicroService-1114"><a href="#PumpWoodMicroService-1114"><span class="linenos">1114</span></a><span class="sd">            order_by=[&quot;-time&quot;, &quot;modeling_unit_id&quot;],</span>
</span><span id="PumpWoodMicroService-1115"><a href="#PumpWoodMicroService-1115"><span class="linenos">1115</span></a><span class="sd">            limit=3,</span>
</span><span id="PumpWoodMicroService-1116"><a href="#PumpWoodMicroService-1116"><span class="linenos">1116</span></a><span class="sd">            fields=[&quot;pk&quot;, &quot;model_class&quot;, &quot;time&quot;, &quot;modeling_unit_id&quot;, &quot;value&quot;])</span>
</span><span id="PumpWoodMicroService-1117"><a href="#PumpWoodMicroService-1117"><span class="linenos">1117</span></a>
</span><span id="PumpWoodMicroService-1118"><a href="#PumpWoodMicroService-1118"><span class="linenos">1118</span></a><span class="sd">        # Return all elements that dimensions field has a key type with</span>
</span><span id="PumpWoodMicroService-1119"><a href="#PumpWoodMicroService-1119"><span class="linenos">1119</span></a><span class="sd">        # value contains `selling` insensitive to case and accent.</span>
</span><span id="PumpWoodMicroService-1120"><a href="#PumpWoodMicroService-1120"><span class="linenos">1120</span></a><span class="sd">        microservice.list(</span>
</span><span id="PumpWoodMicroService-1121"><a href="#PumpWoodMicroService-1121"><span class="linenos">1121</span></a><span class="sd">            model_class=&quot;DatabaseAttribute&quot;,</span>
</span><span id="PumpWoodMicroService-1122"><a href="#PumpWoodMicroService-1122"><span class="linenos">1122</span></a><span class="sd">            filter_dict={</span>
</span><span id="PumpWoodMicroService-1123"><a href="#PumpWoodMicroService-1123"><span class="linenos">1123</span></a><span class="sd">                &quot;dimensions-&gt;type__unaccent_icontains&quot;: &quot;selling&quot;})</span>
</span><span id="PumpWoodMicroService-1124"><a href="#PumpWoodMicroService-1124"><span class="linenos">1124</span></a><span class="sd">        ```</span>
</span><span id="PumpWoodMicroService-1125"><a href="#PumpWoodMicroService-1125"><span class="linenos">1125</span></a>
</span><span id="PumpWoodMicroService-1126"><a href="#PumpWoodMicroService-1126"><span class="linenos">1126</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1127"><a href="#PumpWoodMicroService-1127"><span class="linenos">1127</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1128"><a href="#PumpWoodMicroService-1128"><span class="linenos">1128</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1129"><a href="#PumpWoodMicroService-1129"><span class="linenos">1129</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService-1130"><a href="#PumpWoodMicroService-1130"><span class="linenos">1130</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService-1131"><a href="#PumpWoodMicroService-1131"><span class="linenos">1131</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1132"><a href="#PumpWoodMicroService-1132"><span class="linenos">1132</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService-1133"><a href="#PumpWoodMicroService-1133"><span class="linenos">1133</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService-1134"><a href="#PumpWoodMicroService-1134"><span class="linenos">1134</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1135"><a href="#PumpWoodMicroService-1135"><span class="linenos">1135</span></a><span class="sd">            order_by: Order results acording to list of strings</span>
</span><span id="PumpWoodMicroService-1136"><a href="#PumpWoodMicroService-1136"><span class="linenos">1136</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="PumpWoodMicroService-1137"><a href="#PumpWoodMicroService-1137"><span class="linenos">1137</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="PumpWoodMicroService-1138"><a href="#PumpWoodMicroService-1138"><span class="linenos">1138</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="PumpWoodMicroService-1139"><a href="#PumpWoodMicroService-1139"><span class="linenos">1139</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="PumpWoodMicroService-1140"><a href="#PumpWoodMicroService-1140"><span class="linenos">1140</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1141"><a href="#PumpWoodMicroService-1141"><span class="linenos">1141</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1142"><a href="#PumpWoodMicroService-1142"><span class="linenos">1142</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1143"><a href="#PumpWoodMicroService-1143"><span class="linenos">1143</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService-1144"><a href="#PumpWoodMicroService-1144"><span class="linenos">1144</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-1145"><a href="#PumpWoodMicroService-1145"><span class="linenos">1145</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService-1146"><a href="#PumpWoodMicroService-1146"><span class="linenos">1146</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-1147"><a href="#PumpWoodMicroService-1147"><span class="linenos">1147</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-1148"><a href="#PumpWoodMicroService-1148"><span class="linenos">1148</span></a><span class="sd">            limit:</span>
</span><span id="PumpWoodMicroService-1149"><a href="#PumpWoodMicroService-1149"><span class="linenos">1149</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService-1150"><a href="#PumpWoodMicroService-1150"><span class="linenos">1150</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService-1151"><a href="#PumpWoodMicroService-1151"><span class="linenos">1151</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService-1152"><a href="#PumpWoodMicroService-1152"><span class="linenos">1152</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-1153"><a href="#PumpWoodMicroService-1153"><span class="linenos">1153</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-1154"><a href="#PumpWoodMicroService-1154"><span class="linenos">1154</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-1155"><a href="#PumpWoodMicroService-1155"><span class="linenos">1155</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-1156"><a href="#PumpWoodMicroService-1156"><span class="linenos">1156</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService-1157"><a href="#PumpWoodMicroService-1157"><span class="linenos">1157</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="PumpWoodMicroService-1158"><a href="#PumpWoodMicroService-1158"><span class="linenos">1158</span></a>
</span><span id="PumpWoodMicroService-1159"><a href="#PumpWoodMicroService-1159"><span class="linenos">1159</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1160"><a href="#PumpWoodMicroService-1160"><span class="linenos">1160</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService-1161"><a href="#PumpWoodMicroService-1161"><span class="linenos">1161</span></a>
</span><span id="PumpWoodMicroService-1162"><a href="#PumpWoodMicroService-1162"><span class="linenos">1162</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1163"><a href="#PumpWoodMicroService-1163"><span class="linenos">1163</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService-1164"><a href="#PumpWoodMicroService-1164"><span class="linenos">1164</span></a><span class="sd">        &quot;&quot;&quot;</span> <span class="c1"># NOQA</span>
</span><span id="PumpWoodMicroService-1165"><a href="#PumpWoodMicroService-1165"><span class="linenos">1165</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1166"><a href="#PumpWoodMicroService-1166"><span class="linenos">1166</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-1167"><a href="#PumpWoodMicroService-1167"><span class="linenos">1167</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1168"><a href="#PumpWoodMicroService-1168"><span class="linenos">1168</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1169"><a href="#PumpWoodMicroService-1169"><span class="linenos">1169</span></a>            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-1170"><a href="#PumpWoodMicroService-1170"><span class="linenos">1170</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1171"><a href="#PumpWoodMicroService-1171"><span class="linenos">1171</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService-1172"><a href="#PumpWoodMicroService-1172"><span class="linenos">1172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1173"><a href="#PumpWoodMicroService-1173"><span class="linenos">1173</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1174"><a href="#PumpWoodMicroService-1174"><span class="linenos">1174</span></a>
</span><span id="PumpWoodMicroService-1175"><a href="#PumpWoodMicroService-1175"><span class="linenos">1175</span></a>    <span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-1176"><a href="#PumpWoodMicroService-1176"><span class="linenos">1176</span></a>                       <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1177"><a href="#PumpWoodMicroService-1177"><span class="linenos">1177</span></a>                       <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1178"><a href="#PumpWoodMicroService-1178"><span class="linenos">1178</span></a>                       <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1179"><a href="#PumpWoodMicroService-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object fetching them by chucks using pk to paginate.</span>
</span><span id="PumpWoodMicroService-1180"><a href="#PumpWoodMicroService-1180"><span class="linenos">1180</span></a>
</span><span id="PumpWoodMicroService-1181"><a href="#PumpWoodMicroService-1181"><span class="linenos">1181</span></a><span class="sd">        List data by chunck to load by datasets without breaking the backend</span>
</span><span id="PumpWoodMicroService-1182"><a href="#PumpWoodMicroService-1182"><span class="linenos">1182</span></a><span class="sd">        or receive server timeout. It load chunks orderring the results using</span>
</span><span id="PumpWoodMicroService-1183"><a href="#PumpWoodMicroService-1183"><span class="linenos">1183</span></a><span class="sd">        id of the tables, it can be changed but it should be unique otherwise</span>
</span><span id="PumpWoodMicroService-1184"><a href="#PumpWoodMicroService-1184"><span class="linenos">1184</span></a><span class="sd">        unexpected results may occur.</span>
</span><span id="PumpWoodMicroService-1185"><a href="#PumpWoodMicroService-1185"><span class="linenos">1185</span></a>
</span><span id="PumpWoodMicroService-1186"><a href="#PumpWoodMicroService-1186"><span class="linenos">1186</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1187"><a href="#PumpWoodMicroService-1187"><span class="linenos">1187</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1188"><a href="#PumpWoodMicroService-1188"><span class="linenos">1188</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1189"><a href="#PumpWoodMicroService-1189"><span class="linenos">1189</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService-1190"><a href="#PumpWoodMicroService-1190"><span class="linenos">1190</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService-1191"><a href="#PumpWoodMicroService-1191"><span class="linenos">1191</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1192"><a href="#PumpWoodMicroService-1192"><span class="linenos">1192</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService-1193"><a href="#PumpWoodMicroService-1193"><span class="linenos">1193</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService-1194"><a href="#PumpWoodMicroService-1194"><span class="linenos">1194</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1195"><a href="#PumpWoodMicroService-1195"><span class="linenos">1195</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1196"><a href="#PumpWoodMicroService-1196"><span class="linenos">1196</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1197"><a href="#PumpWoodMicroService-1197"><span class="linenos">1197</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1198"><a href="#PumpWoodMicroService-1198"><span class="linenos">1198</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService-1199"><a href="#PumpWoodMicroService-1199"><span class="linenos">1199</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-1200"><a href="#PumpWoodMicroService-1200"><span class="linenos">1200</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService-1201"><a href="#PumpWoodMicroService-1201"><span class="linenos">1201</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-1202"><a href="#PumpWoodMicroService-1202"><span class="linenos">1202</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-1203"><a href="#PumpWoodMicroService-1203"><span class="linenos">1203</span></a><span class="sd">            chunk_size:</span>
</span><span id="PumpWoodMicroService-1204"><a href="#PumpWoodMicroService-1204"><span class="linenos">1204</span></a><span class="sd">                Number of objects to be fetched each query.</span>
</span><span id="PumpWoodMicroService-1205"><a href="#PumpWoodMicroService-1205"><span class="linenos">1205</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService-1206"><a href="#PumpWoodMicroService-1206"><span class="linenos">1206</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="PumpWoodMicroService-1207"><a href="#PumpWoodMicroService-1207"><span class="linenos">1207</span></a>
</span><span id="PumpWoodMicroService-1208"><a href="#PumpWoodMicroService-1208"><span class="linenos">1208</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1209"><a href="#PumpWoodMicroService-1209"><span class="linenos">1209</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService-1210"><a href="#PumpWoodMicroService-1210"><span class="linenos">1210</span></a>
</span><span id="PumpWoodMicroService-1211"><a href="#PumpWoodMicroService-1211"><span class="linenos">1211</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1212"><a href="#PumpWoodMicroService-1212"><span class="linenos">1212</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService-1213"><a href="#PumpWoodMicroService-1213"><span class="linenos">1213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1214"><a href="#PumpWoodMicroService-1214"><span class="linenos">1214</span></a>        <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1215"><a href="#PumpWoodMicroService-1215"><span class="linenos">1215</span></a>
</span><span id="PumpWoodMicroService-1216"><a href="#PumpWoodMicroService-1216"><span class="linenos">1216</span></a>        <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-1217"><a href="#PumpWoodMicroService-1217"><span class="linenos">1217</span></a>        <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PumpWoodMicroService-1218"><a href="#PumpWoodMicroService-1218"><span class="linenos">1218</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1219"><a href="#PumpWoodMicroService-1219"><span class="linenos">1219</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1220"><a href="#PumpWoodMicroService-1220"><span class="linenos">1220</span></a>            <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
</span><span id="PumpWoodMicroService-1221"><a href="#PumpWoodMicroService-1221"><span class="linenos">1221</span></a>            <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1222"><a href="#PumpWoodMicroService-1222"><span class="linenos">1222</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1223"><a href="#PumpWoodMicroService-1223"><span class="linenos">1223</span></a>                <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-1224"><a href="#PumpWoodMicroService-1224"><span class="linenos">1224</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1225"><a href="#PumpWoodMicroService-1225"><span class="linenos">1225</span></a>                <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1226"><a href="#PumpWoodMicroService-1226"><span class="linenos">1226</span></a>
</span><span id="PumpWoodMicroService-1227"><a href="#PumpWoodMicroService-1227"><span class="linenos">1227</span></a>            <span class="c1"># Break if results is empty</span>
</span><span id="PumpWoodMicroService-1228"><a href="#PumpWoodMicroService-1228"><span class="linenos">1228</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1229"><a href="#PumpWoodMicroService-1229"><span class="linenos">1229</span></a>                <span class="k">break</span>
</span><span id="PumpWoodMicroService-1230"><a href="#PumpWoodMicroService-1230"><span class="linenos">1230</span></a>
</span><span id="PumpWoodMicroService-1231"><a href="#PumpWoodMicroService-1231"><span class="linenos">1231</span></a>            <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-1232"><a href="#PumpWoodMicroService-1232"><span class="linenos">1232</span></a>            <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1233"><a href="#PumpWoodMicroService-1233"><span class="linenos">1233</span></a>
</span><span id="PumpWoodMicroService-1234"><a href="#PumpWoodMicroService-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="n">list_all_results</span>
</span><span id="PumpWoodMicroService-1235"><a href="#PumpWoodMicroService-1235"><span class="linenos">1235</span></a>
</span><span id="PumpWoodMicroService-1236"><a href="#PumpWoodMicroService-1236"><span class="linenos">1236</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1237"><a href="#PumpWoodMicroService-1237"><span class="linenos">1237</span></a>    <span class="k">def</span> <span class="nf">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1238"><a href="#PumpWoodMicroService-1238"><span class="linenos">1238</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-without-pag/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="PumpWoodMicroService-1239"><a href="#PumpWoodMicroService-1239"><span class="linenos">1239</span></a>
</span><span id="PumpWoodMicroService-1240"><a href="#PumpWoodMicroService-1240"><span class="linenos">1240</span></a>    <span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-1241"><a href="#PumpWoodMicroService-1241"><span class="linenos">1241</span></a>                         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService-1242"><a href="#PumpWoodMicroService-1242"><span class="linenos">1242</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1243"><a href="#PumpWoodMicroService-1243"><span class="linenos">1243</span></a>                         <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1244"><a href="#PumpWoodMicroService-1244"><span class="linenos">1244</span></a>                         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1245"><a href="#PumpWoodMicroService-1245"><span class="linenos">1245</span></a>                         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1246"><a href="#PumpWoodMicroService-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object without pagination.</span>
</span><span id="PumpWoodMicroService-1247"><a href="#PumpWoodMicroService-1247"><span class="linenos">1247</span></a>
</span><span id="PumpWoodMicroService-1248"><a href="#PumpWoodMicroService-1248"><span class="linenos">1248</span></a><span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
</span><span id="PumpWoodMicroService-1249"><a href="#PumpWoodMicroService-1249"><span class="linenos">1249</span></a><span class="sd">        systems, results won&#39;t be paginated.</span>
</span><span id="PumpWoodMicroService-1250"><a href="#PumpWoodMicroService-1250"><span class="linenos">1250</span></a><span class="sd">        **Be carefull with large returns.**</span>
</span><span id="PumpWoodMicroService-1251"><a href="#PumpWoodMicroService-1251"><span class="linenos">1251</span></a>
</span><span id="PumpWoodMicroService-1252"><a href="#PumpWoodMicroService-1252"><span class="linenos">1252</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1253"><a href="#PumpWoodMicroService-1253"><span class="linenos">1253</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService-1254"><a href="#PumpWoodMicroService-1254"><span class="linenos">1254</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1255"><a href="#PumpWoodMicroService-1255"><span class="linenos">1255</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService-1256"><a href="#PumpWoodMicroService-1256"><span class="linenos">1256</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService-1257"><a href="#PumpWoodMicroService-1257"><span class="linenos">1257</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1258"><a href="#PumpWoodMicroService-1258"><span class="linenos">1258</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService-1259"><a href="#PumpWoodMicroService-1259"><span class="linenos">1259</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService-1260"><a href="#PumpWoodMicroService-1260"><span class="linenos">1260</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1261"><a href="#PumpWoodMicroService-1261"><span class="linenos">1261</span></a><span class="sd">            order_by (bool):</span>
</span><span id="PumpWoodMicroService-1262"><a href="#PumpWoodMicroService-1262"><span class="linenos">1262</span></a><span class="sd">                Order results acording to list of strings</span>
</span><span id="PumpWoodMicroService-1263"><a href="#PumpWoodMicroService-1263"><span class="linenos">1263</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="PumpWoodMicroService-1264"><a href="#PumpWoodMicroService-1264"><span class="linenos">1264</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="PumpWoodMicroService-1265"><a href="#PumpWoodMicroService-1265"><span class="linenos">1265</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="PumpWoodMicroService-1266"><a href="#PumpWoodMicroService-1266"><span class="linenos">1266</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="PumpWoodMicroService-1267"><a href="#PumpWoodMicroService-1267"><span class="linenos">1267</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService-1268"><a href="#PumpWoodMicroService-1268"><span class="linenos">1268</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1269"><a href="#PumpWoodMicroService-1269"><span class="linenos">1269</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1270"><a href="#PumpWoodMicroService-1270"><span class="linenos">1270</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="PumpWoodMicroService-1271"><a href="#PumpWoodMicroService-1271"><span class="linenos">1271</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-1272"><a href="#PumpWoodMicroService-1272"><span class="linenos">1272</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="PumpWoodMicroService-1273"><a href="#PumpWoodMicroService-1273"><span class="linenos">1273</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-1274"><a href="#PumpWoodMicroService-1274"><span class="linenos">1274</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-1275"><a href="#PumpWoodMicroService-1275"><span class="linenos">1275</span></a><span class="sd">            limit (int):</span>
</span><span id="PumpWoodMicroService-1276"><a href="#PumpWoodMicroService-1276"><span class="linenos">1276</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService-1277"><a href="#PumpWoodMicroService-1277"><span class="linenos">1277</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService-1278"><a href="#PumpWoodMicroService-1278"><span class="linenos">1278</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="PumpWoodMicroService-1279"><a href="#PumpWoodMicroService-1279"><span class="linenos">1279</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-1280"><a href="#PumpWoodMicroService-1280"><span class="linenos">1280</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-1281"><a href="#PumpWoodMicroService-1281"><span class="linenos">1281</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-1282"><a href="#PumpWoodMicroService-1282"><span class="linenos">1282</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-1283"><a href="#PumpWoodMicroService-1283"><span class="linenos">1283</span></a><span class="sd">            convert_geometry (bool):</span>
</span><span id="PumpWoodMicroService-1284"><a href="#PumpWoodMicroService-1284"><span class="linenos">1284</span></a><span class="sd">                If geometry columns should be convert to shapely geometry.</span>
</span><span id="PumpWoodMicroService-1285"><a href="#PumpWoodMicroService-1285"><span class="linenos">1285</span></a><span class="sd">                Fields with key &#39;geometry&#39; will be considered geometry.</span>
</span><span id="PumpWoodMicroService-1286"><a href="#PumpWoodMicroService-1286"><span class="linenos">1286</span></a><span class="sd">            return_type (str):</span>
</span><span id="PumpWoodMicroService-1287"><a href="#PumpWoodMicroService-1287"><span class="linenos">1287</span></a><span class="sd">                Set return type to list of dictinary `list` or to a pandas</span>
</span><span id="PumpWoodMicroService-1288"><a href="#PumpWoodMicroService-1288"><span class="linenos">1288</span></a><span class="sd">                dataframe `dataframe`.</span>
</span><span id="PumpWoodMicroService-1289"><a href="#PumpWoodMicroService-1289"><span class="linenos">1289</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService-1290"><a href="#PumpWoodMicroService-1290"><span class="linenos">1290</span></a><span class="sd">                Other unused arguments for compatibility.</span>
</span><span id="PumpWoodMicroService-1291"><a href="#PumpWoodMicroService-1291"><span class="linenos">1291</span></a>
</span><span id="PumpWoodMicroService-1292"><a href="#PumpWoodMicroService-1292"><span class="linenos">1292</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1293"><a href="#PumpWoodMicroService-1293"><span class="linenos">1293</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService-1294"><a href="#PumpWoodMicroService-1294"><span class="linenos">1294</span></a>
</span><span id="PumpWoodMicroService-1295"><a href="#PumpWoodMicroService-1295"><span class="linenos">1295</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1296"><a href="#PumpWoodMicroService-1296"><span class="linenos">1296</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService-1297"><a href="#PumpWoodMicroService-1297"><span class="linenos">1297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1298"><a href="#PumpWoodMicroService-1298"><span class="linenos">1298</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1299"><a href="#PumpWoodMicroService-1299"><span class="linenos">1299</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-1300"><a href="#PumpWoodMicroService-1300"><span class="linenos">1300</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1301"><a href="#PumpWoodMicroService-1301"><span class="linenos">1301</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1302"><a href="#PumpWoodMicroService-1302"><span class="linenos">1302</span></a>            <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-1303"><a href="#PumpWoodMicroService-1303"><span class="linenos">1303</span></a>
</span><span id="PumpWoodMicroService-1304"><a href="#PumpWoodMicroService-1304"><span class="linenos">1304</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1305"><a href="#PumpWoodMicroService-1305"><span class="linenos">1305</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService-1306"><a href="#PumpWoodMicroService-1306"><span class="linenos">1306</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1307"><a href="#PumpWoodMicroService-1307"><span class="linenos">1307</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1308"><a href="#PumpWoodMicroService-1308"><span class="linenos">1308</span></a>
</span><span id="PumpWoodMicroService-1309"><a href="#PumpWoodMicroService-1309"><span class="linenos">1309</span></a>        <span class="c1">##################################################</span>
</span><span id="PumpWoodMicroService-1310"><a href="#PumpWoodMicroService-1310"><span class="linenos">1310</span></a>        <span class="c1"># Converting geometry to Shapely objects in Python</span>
</span><span id="PumpWoodMicroService-1311"><a href="#PumpWoodMicroService-1311"><span class="linenos">1311</span></a>        <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-1312"><a href="#PumpWoodMicroService-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1313"><a href="#PumpWoodMicroService-1313"><span class="linenos">1313</span></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1314"><a href="#PumpWoodMicroService-1314"><span class="linenos">1314</span></a>                <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1315"><a href="#PumpWoodMicroService-1315"><span class="linenos">1315</span></a>                <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1316"><a href="#PumpWoodMicroService-1316"><span class="linenos">1316</span></a>                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1317"><a href="#PumpWoodMicroService-1317"><span class="linenos">1317</span></a>                    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-1318"><a href="#PumpWoodMicroService-1318"><span class="linenos">1318</span></a>        <span class="c1">##################################################</span>
</span><span id="PumpWoodMicroService-1319"><a href="#PumpWoodMicroService-1319"><span class="linenos">1319</span></a>
</span><span id="PumpWoodMicroService-1320"><a href="#PumpWoodMicroService-1320"><span class="linenos">1320</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1321"><a href="#PumpWoodMicroService-1321"><span class="linenos">1321</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-1322"><a href="#PumpWoodMicroService-1322"><span class="linenos">1322</span></a>        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1323"><a href="#PumpWoodMicroService-1323"><span class="linenos">1323</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="PumpWoodMicroService-1324"><a href="#PumpWoodMicroService-1324"><span class="linenos">1324</span></a>                    <span class="n">geometry_in_results</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1325"><a href="#PumpWoodMicroService-1325"><span class="linenos">1325</span></a>                <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1326"><a href="#PumpWoodMicroService-1326"><span class="linenos">1326</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1327"><a href="#PumpWoodMicroService-1327"><span class="linenos">1327</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1328"><a href="#PumpWoodMicroService-1328"><span class="linenos">1328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1329"><a href="#PumpWoodMicroService-1329"><span class="linenos">1329</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1330"><a href="#PumpWoodMicroService-1330"><span class="linenos">1330</span></a>
</span><span id="PumpWoodMicroService-1331"><a href="#PumpWoodMicroService-1331"><span class="linenos">1331</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1332"><a href="#PumpWoodMicroService-1332"><span class="linenos">1332</span></a>    <span class="k">def</span> <span class="nf">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1333"><a href="#PumpWoodMicroService-1333"><span class="linenos">1333</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimensions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="PumpWoodMicroService-1334"><a href="#PumpWoodMicroService-1334"><span class="linenos">1334</span></a>
</span><span id="PumpWoodMicroService-1335"><a href="#PumpWoodMicroService-1335"><span class="linenos">1335</span></a>    <span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-1336"><a href="#PumpWoodMicroService-1336"><span class="linenos">1336</span></a>                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-1337"><a href="#PumpWoodMicroService-1337"><span class="linenos">1337</span></a>                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1338"><a href="#PumpWoodMicroService-1338"><span class="linenos">1338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class.</span>
</span><span id="PumpWoodMicroService-1339"><a href="#PumpWoodMicroService-1339"><span class="linenos">1339</span></a>
</span><span id="PumpWoodMicroService-1340"><a href="#PumpWoodMicroService-1340"><span class="linenos">1340</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="PumpWoodMicroService-1341"><a href="#PumpWoodMicroService-1341"><span class="linenos">1341</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService-1342"><a href="#PumpWoodMicroService-1342"><span class="linenos">1342</span></a>
</span><span id="PumpWoodMicroService-1343"><a href="#PumpWoodMicroService-1343"><span class="linenos">1343</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1344"><a href="#PumpWoodMicroService-1344"><span class="linenos">1344</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1345"><a href="#PumpWoodMicroService-1345"><span class="linenos">1345</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1346"><a href="#PumpWoodMicroService-1346"><span class="linenos">1346</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService-1347"><a href="#PumpWoodMicroService-1347"><span class="linenos">1347</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService-1348"><a href="#PumpWoodMicroService-1348"><span class="linenos">1348</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1349"><a href="#PumpWoodMicroService-1349"><span class="linenos">1349</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService-1350"><a href="#PumpWoodMicroService-1350"><span class="linenos">1350</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService-1351"><a href="#PumpWoodMicroService-1351"><span class="linenos">1351</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1352"><a href="#PumpWoodMicroService-1352"><span class="linenos">1352</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1353"><a href="#PumpWoodMicroService-1353"><span class="linenos">1353</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1354"><a href="#PumpWoodMicroService-1354"><span class="linenos">1354</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1355"><a href="#PumpWoodMicroService-1355"><span class="linenos">1355</span></a>
</span><span id="PumpWoodMicroService-1356"><a href="#PumpWoodMicroService-1356"><span class="linenos">1356</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1357"><a href="#PumpWoodMicroService-1357"><span class="linenos">1357</span></a><span class="sd">            List of keys avaiable in results from the query dict.</span>
</span><span id="PumpWoodMicroService-1358"><a href="#PumpWoodMicroService-1358"><span class="linenos">1358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1359"><a href="#PumpWoodMicroService-1359"><span class="linenos">1359</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1360"><a href="#PumpWoodMicroService-1360"><span class="linenos">1360</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-1361"><a href="#PumpWoodMicroService-1361"><span class="linenos">1361</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1362"><a href="#PumpWoodMicroService-1362"><span class="linenos">1362</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1363"><a href="#PumpWoodMicroService-1363"><span class="linenos">1363</span></a>
</span><span id="PumpWoodMicroService-1364"><a href="#PumpWoodMicroService-1364"><span class="linenos">1364</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1365"><a href="#PumpWoodMicroService-1365"><span class="linenos">1365</span></a>    <span class="k">def</span> <span class="nf">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1366"><a href="#PumpWoodMicroService-1366"><span class="linenos">1366</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimension-values/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService-1367"><a href="#PumpWoodMicroService-1367"><span class="linenos">1367</span></a>
</span><span id="PumpWoodMicroService-1368"><a href="#PumpWoodMicroService-1368"><span class="linenos">1368</span></a>    <span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1369"><a href="#PumpWoodMicroService-1369"><span class="linenos">1369</span></a>                              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-1370"><a href="#PumpWoodMicroService-1370"><span class="linenos">1370</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1371"><a href="#PumpWoodMicroService-1371"><span class="linenos">1371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List values associated with dimensions key.</span>
</span><span id="PumpWoodMicroService-1372"><a href="#PumpWoodMicroService-1372"><span class="linenos">1372</span></a>
</span><span id="PumpWoodMicroService-1373"><a href="#PumpWoodMicroService-1373"><span class="linenos">1373</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="PumpWoodMicroService-1374"><a href="#PumpWoodMicroService-1374"><span class="linenos">1374</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService-1375"><a href="#PumpWoodMicroService-1375"><span class="linenos">1375</span></a>
</span><span id="PumpWoodMicroService-1376"><a href="#PumpWoodMicroService-1376"><span class="linenos">1376</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1377"><a href="#PumpWoodMicroService-1377"><span class="linenos">1377</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1378"><a href="#PumpWoodMicroService-1378"><span class="linenos">1378</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1379"><a href="#PumpWoodMicroService-1379"><span class="linenos">1379</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService-1380"><a href="#PumpWoodMicroService-1380"><span class="linenos">1380</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService-1381"><a href="#PumpWoodMicroService-1381"><span class="linenos">1381</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1382"><a href="#PumpWoodMicroService-1382"><span class="linenos">1382</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService-1383"><a href="#PumpWoodMicroService-1383"><span class="linenos">1383</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService-1384"><a href="#PumpWoodMicroService-1384"><span class="linenos">1384</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService-1385"><a href="#PumpWoodMicroService-1385"><span class="linenos">1385</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1386"><a href="#PumpWoodMicroService-1386"><span class="linenos">1386</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1387"><a href="#PumpWoodMicroService-1387"><span class="linenos">1387</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1388"><a href="#PumpWoodMicroService-1388"><span class="linenos">1388</span></a><span class="sd">            key:</span>
</span><span id="PumpWoodMicroService-1389"><a href="#PumpWoodMicroService-1389"><span class="linenos">1389</span></a><span class="sd">                Key to list the avaiable values using the query filter</span>
</span><span id="PumpWoodMicroService-1390"><a href="#PumpWoodMicroService-1390"><span class="linenos">1390</span></a><span class="sd">                and exclude.</span>
</span><span id="PumpWoodMicroService-1391"><a href="#PumpWoodMicroService-1391"><span class="linenos">1391</span></a>
</span><span id="PumpWoodMicroService-1392"><a href="#PumpWoodMicroService-1392"><span class="linenos">1392</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1393"><a href="#PumpWoodMicroService-1393"><span class="linenos">1393</span></a><span class="sd">            List of values associated with dimensions key at the objects that</span>
</span><span id="PumpWoodMicroService-1394"><a href="#PumpWoodMicroService-1394"><span class="linenos">1394</span></a><span class="sd">            are returned with `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService-1395"><a href="#PumpWoodMicroService-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1396"><a href="#PumpWoodMicroService-1396"><span class="linenos">1396</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1397"><a href="#PumpWoodMicroService-1397"><span class="linenos">1397</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1398"><a href="#PumpWoodMicroService-1398"><span class="linenos">1398</span></a>                     <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-1399"><a href="#PumpWoodMicroService-1399"><span class="linenos">1399</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1400"><a href="#PumpWoodMicroService-1400"><span class="linenos">1400</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1401"><a href="#PumpWoodMicroService-1401"><span class="linenos">1401</span></a>
</span><span id="PumpWoodMicroService-1402"><a href="#PumpWoodMicroService-1402"><span class="linenos">1402</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1403"><a href="#PumpWoodMicroService-1403"><span class="linenos">1403</span></a>    <span class="k">def</span> <span class="nf">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1404"><a href="#PumpWoodMicroService-1404"><span class="linenos">1404</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1405"><a href="#PumpWoodMicroService-1405"><span class="linenos">1405</span></a>
</span><span id="PumpWoodMicroService-1406"><a href="#PumpWoodMicroService-1406"><span class="linenos">1406</span></a>    <span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1407"><a href="#PumpWoodMicroService-1407"><span class="linenos">1407</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1408"><a href="#PumpWoodMicroService-1408"><span class="linenos">1408</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1409"><a href="#PumpWoodMicroService-1409"><span class="linenos">1409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object using list serializer (simple).</span>
</span><span id="PumpWoodMicroService-1410"><a href="#PumpWoodMicroService-1410"><span class="linenos">1410</span></a>
</span><span id="PumpWoodMicroService-1411"><a href="#PumpWoodMicroService-1411"><span class="linenos">1411</span></a><span class="sd">        **# DEPRECTED #** It is the same as retrieve using</span>
</span><span id="PumpWoodMicroService-1412"><a href="#PumpWoodMicroService-1412"><span class="linenos">1412</span></a><span class="sd">        `default_fields: bool = True`, if possible migrate to retrieve</span>
</span><span id="PumpWoodMicroService-1413"><a href="#PumpWoodMicroService-1413"><span class="linenos">1413</span></a><span class="sd">        function.</span>
</span><span id="PumpWoodMicroService-1414"><a href="#PumpWoodMicroService-1414"><span class="linenos">1414</span></a>
</span><span id="PumpWoodMicroService-1415"><a href="#PumpWoodMicroService-1415"><span class="linenos">1415</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1416"><a href="#PumpWoodMicroService-1416"><span class="linenos">1416</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1417"><a href="#PumpWoodMicroService-1417"><span class="linenos">1417</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1418"><a href="#PumpWoodMicroService-1418"><span class="linenos">1418</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1419"><a href="#PumpWoodMicroService-1419"><span class="linenos">1419</span></a><span class="sd">                Object pk</span>
</span><span id="PumpWoodMicroService-1420"><a href="#PumpWoodMicroService-1420"><span class="linenos">1420</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1421"><a href="#PumpWoodMicroService-1421"><span class="linenos">1421</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1422"><a href="#PumpWoodMicroService-1422"><span class="linenos">1422</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1423"><a href="#PumpWoodMicroService-1423"><span class="linenos">1423</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService-1424"><a href="#PumpWoodMicroService-1424"><span class="linenos">1424</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-1425"><a href="#PumpWoodMicroService-1425"><span class="linenos">1425</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService-1426"><a href="#PumpWoodMicroService-1426"><span class="linenos">1426</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-1427"><a href="#PumpWoodMicroService-1427"><span class="linenos">1427</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-1428"><a href="#PumpWoodMicroService-1428"><span class="linenos">1428</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService-1429"><a href="#PumpWoodMicroService-1429"><span class="linenos">1429</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-1430"><a href="#PumpWoodMicroService-1430"><span class="linenos">1430</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-1431"><a href="#PumpWoodMicroService-1431"><span class="linenos">1431</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-1432"><a href="#PumpWoodMicroService-1432"><span class="linenos">1432</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-1433"><a href="#PumpWoodMicroService-1433"><span class="linenos">1433</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService-1434"><a href="#PumpWoodMicroService-1434"><span class="linenos">1434</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService-1435"><a href="#PumpWoodMicroService-1435"><span class="linenos">1435</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService-1436"><a href="#PumpWoodMicroService-1436"><span class="linenos">1436</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService-1437"><a href="#PumpWoodMicroService-1437"><span class="linenos">1437</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService-1438"><a href="#PumpWoodMicroService-1438"><span class="linenos">1438</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService-1439"><a href="#PumpWoodMicroService-1439"><span class="linenos">1439</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService-1440"><a href="#PumpWoodMicroService-1440"><span class="linenos">1440</span></a>
</span><span id="PumpWoodMicroService-1441"><a href="#PumpWoodMicroService-1441"><span class="linenos">1441</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1442"><a href="#PumpWoodMicroService-1442"><span class="linenos">1442</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="PumpWoodMicroService-1443"><a href="#PumpWoodMicroService-1443"><span class="linenos">1443</span></a>
</span><span id="PumpWoodMicroService-1444"><a href="#PumpWoodMicroService-1444"><span class="linenos">1444</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1445"><a href="#PumpWoodMicroService-1445"><span class="linenos">1445</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1446"><a href="#PumpWoodMicroService-1446"><span class="linenos">1446</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="PumpWoodMicroService-1447"><a href="#PumpWoodMicroService-1447"><span class="linenos">1447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1448"><a href="#PumpWoodMicroService-1448"><span class="linenos">1448</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1449"><a href="#PumpWoodMicroService-1449"><span class="linenos">1449</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1450"><a href="#PumpWoodMicroService-1450"><span class="linenos">1450</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-1451"><a href="#PumpWoodMicroService-1451"><span class="linenos">1451</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1452"><a href="#PumpWoodMicroService-1452"><span class="linenos">1452</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1453"><a href="#PumpWoodMicroService-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1454"><a href="#PumpWoodMicroService-1454"><span class="linenos">1454</span></a>            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1455"><a href="#PumpWoodMicroService-1455"><span class="linenos">1455</span></a>
</span><span id="PumpWoodMicroService-1456"><a href="#PumpWoodMicroService-1456"><span class="linenos">1456</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1457"><a href="#PumpWoodMicroService-1457"><span class="linenos">1457</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1458"><a href="#PumpWoodMicroService-1458"><span class="linenos">1458</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1459"><a href="#PumpWoodMicroService-1459"><span class="linenos">1459</span></a>
</span><span id="PumpWoodMicroService-1460"><a href="#PumpWoodMicroService-1460"><span class="linenos">1460</span></a>    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1461"><a href="#PumpWoodMicroService-1461"><span class="linenos">1461</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1462"><a href="#PumpWoodMicroService-1462"><span class="linenos">1462</span></a>                 <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1463"><a href="#PumpWoodMicroService-1463"><span class="linenos">1463</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1464"><a href="#PumpWoodMicroService-1464"><span class="linenos">1464</span></a>                 <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1465"><a href="#PumpWoodMicroService-1465"><span class="linenos">1465</span></a>                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1466"><a href="#PumpWoodMicroService-1466"><span class="linenos">1466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object from PumpWood.</span>
</span><span id="PumpWoodMicroService-1467"><a href="#PumpWoodMicroService-1467"><span class="linenos">1467</span></a>
</span><span id="PumpWoodMicroService-1468"><a href="#PumpWoodMicroService-1468"><span class="linenos">1468</span></a><span class="sd">        Function to get object serialized by retrieve end-point</span>
</span><span id="PumpWoodMicroService-1469"><a href="#PumpWoodMicroService-1469"><span class="linenos">1469</span></a><span class="sd">        (more detailed data).</span>
</span><span id="PumpWoodMicroService-1470"><a href="#PumpWoodMicroService-1470"><span class="linenos">1470</span></a>
</span><span id="PumpWoodMicroService-1471"><a href="#PumpWoodMicroService-1471"><span class="linenos">1471</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1472"><a href="#PumpWoodMicroService-1472"><span class="linenos">1472</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1473"><a href="#PumpWoodMicroService-1473"><span class="linenos">1473</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService-1474"><a href="#PumpWoodMicroService-1474"><span class="linenos">1474</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1475"><a href="#PumpWoodMicroService-1475"><span class="linenos">1475</span></a><span class="sd">                Object pk</span>
</span><span id="PumpWoodMicroService-1476"><a href="#PumpWoodMicroService-1476"><span class="linenos">1476</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1477"><a href="#PumpWoodMicroService-1477"><span class="linenos">1477</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1478"><a href="#PumpWoodMicroService-1478"><span class="linenos">1478</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1479"><a href="#PumpWoodMicroService-1479"><span class="linenos">1479</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService-1480"><a href="#PumpWoodMicroService-1480"><span class="linenos">1480</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-1481"><a href="#PumpWoodMicroService-1481"><span class="linenos">1481</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService-1482"><a href="#PumpWoodMicroService-1482"><span class="linenos">1482</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-1483"><a href="#PumpWoodMicroService-1483"><span class="linenos">1483</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-1484"><a href="#PumpWoodMicroService-1484"><span class="linenos">1484</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService-1485"><a href="#PumpWoodMicroService-1485"><span class="linenos">1485</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-1486"><a href="#PumpWoodMicroService-1486"><span class="linenos">1486</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-1487"><a href="#PumpWoodMicroService-1487"><span class="linenos">1487</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-1488"><a href="#PumpWoodMicroService-1488"><span class="linenos">1488</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-1489"><a href="#PumpWoodMicroService-1489"><span class="linenos">1489</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService-1490"><a href="#PumpWoodMicroService-1490"><span class="linenos">1490</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService-1491"><a href="#PumpWoodMicroService-1491"><span class="linenos">1491</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService-1492"><a href="#PumpWoodMicroService-1492"><span class="linenos">1492</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService-1493"><a href="#PumpWoodMicroService-1493"><span class="linenos">1493</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService-1494"><a href="#PumpWoodMicroService-1494"><span class="linenos">1494</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService-1495"><a href="#PumpWoodMicroService-1495"><span class="linenos">1495</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService-1496"><a href="#PumpWoodMicroService-1496"><span class="linenos">1496</span></a>
</span><span id="PumpWoodMicroService-1497"><a href="#PumpWoodMicroService-1497"><span class="linenos">1497</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1498"><a href="#PumpWoodMicroService-1498"><span class="linenos">1498</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="PumpWoodMicroService-1499"><a href="#PumpWoodMicroService-1499"><span class="linenos">1499</span></a>
</span><span id="PumpWoodMicroService-1500"><a href="#PumpWoodMicroService-1500"><span class="linenos">1500</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1501"><a href="#PumpWoodMicroService-1501"><span class="linenos">1501</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1502"><a href="#PumpWoodMicroService-1502"><span class="linenos">1502</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="PumpWoodMicroService-1503"><a href="#PumpWoodMicroService-1503"><span class="linenos">1503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1504"><a href="#PumpWoodMicroService-1504"><span class="linenos">1504</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1505"><a href="#PumpWoodMicroService-1505"><span class="linenos">1505</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1506"><a href="#PumpWoodMicroService-1506"><span class="linenos">1506</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-1507"><a href="#PumpWoodMicroService-1507"><span class="linenos">1507</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1508"><a href="#PumpWoodMicroService-1508"><span class="linenos">1508</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1509"><a href="#PumpWoodMicroService-1509"><span class="linenos">1509</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-1510"><a href="#PumpWoodMicroService-1510"><span class="linenos">1510</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1511"><a href="#PumpWoodMicroService-1511"><span class="linenos">1511</span></a>
</span><span id="PumpWoodMicroService-1512"><a href="#PumpWoodMicroService-1512"><span class="linenos">1512</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1513"><a href="#PumpWoodMicroService-1513"><span class="linenos">1513</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1514"><a href="#PumpWoodMicroService-1514"><span class="linenos">1514</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1515"><a href="#PumpWoodMicroService-1515"><span class="linenos">1515</span></a>
</span><span id="PumpWoodMicroService-1516"><a href="#PumpWoodMicroService-1516"><span class="linenos">1516</span></a>    <span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1517"><a href="#PumpWoodMicroService-1517"><span class="linenos">1517</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1518"><a href="#PumpWoodMicroService-1518"><span class="linenos">1518</span></a>                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1519"><a href="#PumpWoodMicroService-1519"><span class="linenos">1519</span></a>                      <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1520"><a href="#PumpWoodMicroService-1520"><span class="linenos">1520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood.</span>
</span><span id="PumpWoodMicroService-1521"><a href="#PumpWoodMicroService-1521"><span class="linenos">1521</span></a>
</span><span id="PumpWoodMicroService-1522"><a href="#PumpWoodMicroService-1522"><span class="linenos">1522</span></a><span class="sd">        This function will retrieve file as a single request, depending on the</span>
</span><span id="PumpWoodMicroService-1523"><a href="#PumpWoodMicroService-1523"><span class="linenos">1523</span></a><span class="sd">        size of the files it would be preferred to use streaming end-point.</span>
</span><span id="PumpWoodMicroService-1524"><a href="#PumpWoodMicroService-1524"><span class="linenos">1524</span></a>
</span><span id="PumpWoodMicroService-1525"><a href="#PumpWoodMicroService-1525"><span class="linenos">1525</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1526"><a href="#PumpWoodMicroService-1526"><span class="linenos">1526</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1527"><a href="#PumpWoodMicroService-1527"><span class="linenos">1527</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="PumpWoodMicroService-1528"><a href="#PumpWoodMicroService-1528"><span class="linenos">1528</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1529"><a href="#PumpWoodMicroService-1529"><span class="linenos">1529</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="PumpWoodMicroService-1530"><a href="#PumpWoodMicroService-1530"><span class="linenos">1530</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService-1531"><a href="#PumpWoodMicroService-1531"><span class="linenos">1531</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="PumpWoodMicroService-1532"><a href="#PumpWoodMicroService-1532"><span class="linenos">1532</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1533"><a href="#PumpWoodMicroService-1533"><span class="linenos">1533</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="PumpWoodMicroService-1534"><a href="#PumpWoodMicroService-1534"><span class="linenos">1534</span></a><span class="sd">            save_file:</span>
</span><span id="PumpWoodMicroService-1535"><a href="#PumpWoodMicroService-1535"><span class="linenos">1535</span></a><span class="sd">                If data is to be saved as file or return get</span>
</span><span id="PumpWoodMicroService-1536"><a href="#PumpWoodMicroService-1536"><span class="linenos">1536</span></a><span class="sd">                response.</span>
</span><span id="PumpWoodMicroService-1537"><a href="#PumpWoodMicroService-1537"><span class="linenos">1537</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService-1538"><a href="#PumpWoodMicroService-1538"><span class="linenos">1538</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="PumpWoodMicroService-1539"><a href="#PumpWoodMicroService-1539"><span class="linenos">1539</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService-1540"><a href="#PumpWoodMicroService-1540"><span class="linenos">1540</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="PumpWoodMicroService-1541"><a href="#PumpWoodMicroService-1541"><span class="linenos">1541</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="PumpWoodMicroService-1542"><a href="#PumpWoodMicroService-1542"><span class="linenos">1542</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService-1543"><a href="#PumpWoodMicroService-1543"><span class="linenos">1543</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}.</span>
</span><span id="PumpWoodMicroService-1544"><a href="#PumpWoodMicroService-1544"><span class="linenos">1544</span></a><span class="sd">                Set what to do if there is a file with same name. Skip</span>
</span><span id="PumpWoodMicroService-1545"><a href="#PumpWoodMicroService-1545"><span class="linenos">1545</span></a><span class="sd">                will not download file if there is already with same</span>
</span><span id="PumpWoodMicroService-1546"><a href="#PumpWoodMicroService-1546"><span class="linenos">1546</span></a><span class="sd">                os.path.join(save_path, file_name), file_name must be set</span>
</span><span id="PumpWoodMicroService-1547"><a href="#PumpWoodMicroService-1547"><span class="linenos">1547</span></a><span class="sd">                for skip argument.</span>
</span><span id="PumpWoodMicroService-1548"><a href="#PumpWoodMicroService-1548"><span class="linenos">1548</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1549"><a href="#PumpWoodMicroService-1549"><span class="linenos">1549</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1550"><a href="#PumpWoodMicroService-1550"><span class="linenos">1550</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1551"><a href="#PumpWoodMicroService-1551"><span class="linenos">1551</span></a>
</span><span id="PumpWoodMicroService-1552"><a href="#PumpWoodMicroService-1552"><span class="linenos">1552</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1553"><a href="#PumpWoodMicroService-1553"><span class="linenos">1553</span></a><span class="sd">            May return the file name if save_file=True; If false will return</span>
</span><span id="PumpWoodMicroService-1554"><a href="#PumpWoodMicroService-1554"><span class="linenos">1554</span></a><span class="sd">            a dictonary with keys `filename` with original file name and</span>
</span><span id="PumpWoodMicroService-1555"><a href="#PumpWoodMicroService-1555"><span class="linenos">1555</span></a><span class="sd">            `content` with binary data of file content.</span>
</span><span id="PumpWoodMicroService-1556"><a href="#PumpWoodMicroService-1556"><span class="linenos">1556</span></a>
</span><span id="PumpWoodMicroService-1557"><a href="#PumpWoodMicroService-1557"><span class="linenos">1557</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1558"><a href="#PumpWoodMicroService-1558"><span class="linenos">1558</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1559"><a href="#PumpWoodMicroService-1559"><span class="linenos">1559</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService-1560"><a href="#PumpWoodMicroService-1560"><span class="linenos">1560</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="PumpWoodMicroService-1561"><a href="#PumpWoodMicroService-1561"><span class="linenos">1561</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="PumpWoodMicroService-1562"><a href="#PumpWoodMicroService-1562"><span class="linenos">1562</span></a><span class="sd">                operations,</span>
</span><span id="PumpWoodMicroService-1563"><a href="#PumpWoodMicroService-1563"><span class="linenos">1563</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1564"><a href="#PumpWoodMicroService-1564"><span class="linenos">1564</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService-1565"><a href="#PumpWoodMicroService-1565"><span class="linenos">1565</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="PumpWoodMicroService-1566"><a href="#PumpWoodMicroService-1566"><span class="linenos">1566</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="PumpWoodMicroService-1567"><a href="#PumpWoodMicroService-1567"><span class="linenos">1567</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1568"><a href="#PumpWoodMicroService-1568"><span class="linenos">1568</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="PumpWoodMicroService-1569"><a href="#PumpWoodMicroService-1569"><span class="linenos">1569</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="PumpWoodMicroService-1570"><a href="#PumpWoodMicroService-1570"><span class="linenos">1570</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1571"><a href="#PumpWoodMicroService-1571"><span class="linenos">1571</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="PumpWoodMicroService-1572"><a href="#PumpWoodMicroService-1572"><span class="linenos">1572</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="PumpWoodMicroService-1573"><a href="#PumpWoodMicroService-1573"><span class="linenos">1573</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="PumpWoodMicroService-1574"><a href="#PumpWoodMicroService-1574"><span class="linenos">1574</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="PumpWoodMicroService-1575"><a href="#PumpWoodMicroService-1575"><span class="linenos">1575</span></a><span class="sd">                files on storage.</span>
</span><span id="PumpWoodMicroService-1576"><a href="#PumpWoodMicroService-1576"><span class="linenos">1576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1577"><a href="#PumpWoodMicroService-1577"><span class="linenos">1577</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1578"><a href="#PumpWoodMicroService-1578"><span class="linenos">1578</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1579"><a href="#PumpWoodMicroService-1579"><span class="linenos">1579</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
</span><span id="PumpWoodMicroService-1580"><a href="#PumpWoodMicroService-1580"><span class="linenos">1580</span></a>                <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1581"><a href="#PumpWoodMicroService-1581"><span class="linenos">1581</span></a>
</span><span id="PumpWoodMicroService-1582"><a href="#PumpWoodMicroService-1582"><span class="linenos">1582</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1583"><a href="#PumpWoodMicroService-1583"><span class="linenos">1583</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1584"><a href="#PumpWoodMicroService-1584"><span class="linenos">1584</span></a>            <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1585"><a href="#PumpWoodMicroService-1585"><span class="linenos">1585</span></a>            <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1586"><a href="#PumpWoodMicroService-1586"><span class="linenos">1586</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1587"><a href="#PumpWoodMicroService-1587"><span class="linenos">1587</span></a>                <span class="k">return</span> <span class="n">file_path</span>
</span><span id="PumpWoodMicroService-1588"><a href="#PumpWoodMicroService-1588"><span class="linenos">1588</span></a>
</span><span id="PumpWoodMicroService-1589"><a href="#PumpWoodMicroService-1589"><span class="linenos">1589</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1590"><a href="#PumpWoodMicroService-1590"><span class="linenos">1590</span></a>        <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1591"><a href="#PumpWoodMicroService-1591"><span class="linenos">1591</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-1592"><a href="#PumpWoodMicroService-1592"><span class="linenos">1592</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1593"><a href="#PumpWoodMicroService-1593"><span class="linenos">1593</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1594"><a href="#PumpWoodMicroService-1594"><span class="linenos">1594</span></a>            <span class="k">return</span> <span class="n">file_response</span>
</span><span id="PumpWoodMicroService-1595"><a href="#PumpWoodMicroService-1595"><span class="linenos">1595</span></a>
</span><span id="PumpWoodMicroService-1596"><a href="#PumpWoodMicroService-1596"><span class="linenos">1596</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1597"><a href="#PumpWoodMicroService-1597"><span class="linenos">1597</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1598"><a href="#PumpWoodMicroService-1598"><span class="linenos">1598</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1599"><a href="#PumpWoodMicroService-1599"><span class="linenos">1599</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1600"><a href="#PumpWoodMicroService-1600"><span class="linenos">1600</span></a>
</span><span id="PumpWoodMicroService-1601"><a href="#PumpWoodMicroService-1601"><span class="linenos">1601</span></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-1602"><a href="#PumpWoodMicroService-1602"><span class="linenos">1602</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1603"><a href="#PumpWoodMicroService-1603"><span class="linenos">1603</span></a>        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1604"><a href="#PumpWoodMicroService-1604"><span class="linenos">1604</span></a>        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1605"><a href="#PumpWoodMicroService-1605"><span class="linenos">1605</span></a>            <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1606"><a href="#PumpWoodMicroService-1606"><span class="linenos">1606</span></a>                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1607"><a href="#PumpWoodMicroService-1607"><span class="linenos">1607</span></a>                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-1608"><a href="#PumpWoodMicroService-1608"><span class="linenos">1608</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1609"><a href="#PumpWoodMicroService-1609"><span class="linenos">1609</span></a>                    <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1610"><a href="#PumpWoodMicroService-1610"><span class="linenos">1610</span></a>                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1611"><a href="#PumpWoodMicroService-1611"><span class="linenos">1611</span></a>                        <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1612"><a href="#PumpWoodMicroService-1612"><span class="linenos">1612</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1613"><a href="#PumpWoodMicroService-1613"><span class="linenos">1613</span></a>                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="PumpWoodMicroService-1614"><a href="#PumpWoodMicroService-1614"><span class="linenos">1614</span></a>                        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-1615"><a href="#PumpWoodMicroService-1615"><span class="linenos">1615</span></a>                        <span class="k">break</span>
</span><span id="PumpWoodMicroService-1616"><a href="#PumpWoodMicroService-1616"><span class="linenos">1616</span></a>                <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1617"><a href="#PumpWoodMicroService-1617"><span class="linenos">1617</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1618"><a href="#PumpWoodMicroService-1618"><span class="linenos">1618</span></a>                        <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-1619"><a href="#PumpWoodMicroService-1619"><span class="linenos">1619</span></a>                         <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-1620"><a href="#PumpWoodMicroService-1620"><span class="linenos">1620</span></a>
</span><span id="PumpWoodMicroService-1621"><a href="#PumpWoodMicroService-1621"><span class="linenos">1621</span></a>            <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1622"><a href="#PumpWoodMicroService-1622"><span class="linenos">1622</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1623"><a href="#PumpWoodMicroService-1623"><span class="linenos">1623</span></a>                    <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-1624"><a href="#PumpWoodMicroService-1624"><span class="linenos">1624</span></a>                     <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1625"><a href="#PumpWoodMicroService-1625"><span class="linenos">1625</span></a>
</span><span id="PumpWoodMicroService-1626"><a href="#PumpWoodMicroService-1626"><span class="linenos">1626</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1627"><a href="#PumpWoodMicroService-1627"><span class="linenos">1627</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-1628"><a href="#PumpWoodMicroService-1628"><span class="linenos">1628</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="PumpWoodMicroService-1629"><a href="#PumpWoodMicroService-1629"><span class="linenos">1629</span></a>
</span><span id="PumpWoodMicroService-1630"><a href="#PumpWoodMicroService-1630"><span class="linenos">1630</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1631"><a href="#PumpWoodMicroService-1631"><span class="linenos">1631</span></a>    <span class="k">def</span> <span class="nf">_build_retrieve_file_straming_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1632"><a href="#PumpWoodMicroService-1632"><span class="linenos">1632</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file-streaming/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-1633"><a href="#PumpWoodMicroService-1633"><span class="linenos">1633</span></a>            <span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1634"><a href="#PumpWoodMicroService-1634"><span class="linenos">1634</span></a>
</span><span id="PumpWoodMicroService-1635"><a href="#PumpWoodMicroService-1635"><span class="linenos">1635</span></a>    <span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1636"><a href="#PumpWoodMicroService-1636"><span class="linenos">1636</span></a>                                <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1637"><a href="#PumpWoodMicroService-1637"><span class="linenos">1637</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1638"><a href="#PumpWoodMicroService-1638"><span class="linenos">1638</span></a>                                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1639"><a href="#PumpWoodMicroService-1639"><span class="linenos">1639</span></a>                                <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1640"><a href="#PumpWoodMicroService-1640"><span class="linenos">1640</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood using streaming to retrieve content.</span>
</span><span id="PumpWoodMicroService-1641"><a href="#PumpWoodMicroService-1641"><span class="linenos">1641</span></a>
</span><span id="PumpWoodMicroService-1642"><a href="#PumpWoodMicroService-1642"><span class="linenos">1642</span></a><span class="sd">        This funcion uses file streaming to retrieve file content, it should be</span>
</span><span id="PumpWoodMicroService-1643"><a href="#PumpWoodMicroService-1643"><span class="linenos">1643</span></a><span class="sd">        prefered when dealing with large (bigger than 10Mb) files transfer.</span>
</span><span id="PumpWoodMicroService-1644"><a href="#PumpWoodMicroService-1644"><span class="linenos">1644</span></a><span class="sd">        Using this end-point the file is not loaded on backend memory content</span>
</span><span id="PumpWoodMicroService-1645"><a href="#PumpWoodMicroService-1645"><span class="linenos">1645</span></a><span class="sd">        is transfered by chucks that are read at the storage and transfered</span>
</span><span id="PumpWoodMicroService-1646"><a href="#PumpWoodMicroService-1646"><span class="linenos">1646</span></a><span class="sd">        to user.</span>
</span><span id="PumpWoodMicroService-1647"><a href="#PumpWoodMicroService-1647"><span class="linenos">1647</span></a>
</span><span id="PumpWoodMicroService-1648"><a href="#PumpWoodMicroService-1648"><span class="linenos">1648</span></a><span class="sd">        It will necessarily save the content as a file, there is not the</span>
</span><span id="PumpWoodMicroService-1649"><a href="#PumpWoodMicroService-1649"><span class="linenos">1649</span></a><span class="sd">        possibility of retrieving the content directly from request.</span>
</span><span id="PumpWoodMicroService-1650"><a href="#PumpWoodMicroService-1650"><span class="linenos">1650</span></a>
</span><span id="PumpWoodMicroService-1651"><a href="#PumpWoodMicroService-1651"><span class="linenos">1651</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1652"><a href="#PumpWoodMicroService-1652"><span class="linenos">1652</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1653"><a href="#PumpWoodMicroService-1653"><span class="linenos">1653</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="PumpWoodMicroService-1654"><a href="#PumpWoodMicroService-1654"><span class="linenos">1654</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1655"><a href="#PumpWoodMicroService-1655"><span class="linenos">1655</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="PumpWoodMicroService-1656"><a href="#PumpWoodMicroService-1656"><span class="linenos">1656</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService-1657"><a href="#PumpWoodMicroService-1657"><span class="linenos">1657</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="PumpWoodMicroService-1658"><a href="#PumpWoodMicroService-1658"><span class="linenos">1658</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1659"><a href="#PumpWoodMicroService-1659"><span class="linenos">1659</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="PumpWoodMicroService-1660"><a href="#PumpWoodMicroService-1660"><span class="linenos">1660</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService-1661"><a href="#PumpWoodMicroService-1661"><span class="linenos">1661</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="PumpWoodMicroService-1662"><a href="#PumpWoodMicroService-1662"><span class="linenos">1662</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService-1663"><a href="#PumpWoodMicroService-1663"><span class="linenos">1663</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="PumpWoodMicroService-1664"><a href="#PumpWoodMicroService-1664"><span class="linenos">1664</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="PumpWoodMicroService-1665"><a href="#PumpWoodMicroService-1665"><span class="linenos">1665</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService-1666"><a href="#PumpWoodMicroService-1666"><span class="linenos">1666</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}.</span>
</span><span id="PumpWoodMicroService-1667"><a href="#PumpWoodMicroService-1667"><span class="linenos">1667</span></a><span class="sd">                Set what to do if there is a file with same name.</span>
</span><span id="PumpWoodMicroService-1668"><a href="#PumpWoodMicroService-1668"><span class="linenos">1668</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1669"><a href="#PumpWoodMicroService-1669"><span class="linenos">1669</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1670"><a href="#PumpWoodMicroService-1670"><span class="linenos">1670</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1671"><a href="#PumpWoodMicroService-1671"><span class="linenos">1671</span></a>
</span><span id="PumpWoodMicroService-1672"><a href="#PumpWoodMicroService-1672"><span class="linenos">1672</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1673"><a href="#PumpWoodMicroService-1673"><span class="linenos">1673</span></a><span class="sd">            Returns the file path that recived the file content.</span>
</span><span id="PumpWoodMicroService-1674"><a href="#PumpWoodMicroService-1674"><span class="linenos">1674</span></a>
</span><span id="PumpWoodMicroService-1675"><a href="#PumpWoodMicroService-1675"><span class="linenos">1675</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1676"><a href="#PumpWoodMicroService-1676"><span class="linenos">1676</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1677"><a href="#PumpWoodMicroService-1677"><span class="linenos">1677</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService-1678"><a href="#PumpWoodMicroService-1678"><span class="linenos">1678</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="PumpWoodMicroService-1679"><a href="#PumpWoodMicroService-1679"><span class="linenos">1679</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="PumpWoodMicroService-1680"><a href="#PumpWoodMicroService-1680"><span class="linenos">1680</span></a><span class="sd">                operations,</span>
</span><span id="PumpWoodMicroService-1681"><a href="#PumpWoodMicroService-1681"><span class="linenos">1681</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1682"><a href="#PumpWoodMicroService-1682"><span class="linenos">1682</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService-1683"><a href="#PumpWoodMicroService-1683"><span class="linenos">1683</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="PumpWoodMicroService-1684"><a href="#PumpWoodMicroService-1684"><span class="linenos">1684</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="PumpWoodMicroService-1685"><a href="#PumpWoodMicroService-1685"><span class="linenos">1685</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1686"><a href="#PumpWoodMicroService-1686"><span class="linenos">1686</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="PumpWoodMicroService-1687"><a href="#PumpWoodMicroService-1687"><span class="linenos">1687</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="PumpWoodMicroService-1688"><a href="#PumpWoodMicroService-1688"><span class="linenos">1688</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1689"><a href="#PumpWoodMicroService-1689"><span class="linenos">1689</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="PumpWoodMicroService-1690"><a href="#PumpWoodMicroService-1690"><span class="linenos">1690</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="PumpWoodMicroService-1691"><a href="#PumpWoodMicroService-1691"><span class="linenos">1691</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="PumpWoodMicroService-1692"><a href="#PumpWoodMicroService-1692"><span class="linenos">1692</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="PumpWoodMicroService-1693"><a href="#PumpWoodMicroService-1693"><span class="linenos">1693</span></a><span class="sd">                files on storage.</span>
</span><span id="PumpWoodMicroService-1694"><a href="#PumpWoodMicroService-1694"><span class="linenos">1694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1695"><a href="#PumpWoodMicroService-1695"><span class="linenos">1695</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1696"><a href="#PumpWoodMicroService-1696"><span class="linenos">1696</span></a>
</span><span id="PumpWoodMicroService-1697"><a href="#PumpWoodMicroService-1697"><span class="linenos">1697</span></a>        <span class="c1"># begin Args check</span>
</span><span id="PumpWoodMicroService-1698"><a href="#PumpWoodMicroService-1698"><span class="linenos">1698</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1699"><a href="#PumpWoodMicroService-1699"><span class="linenos">1699</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1700"><a href="#PumpWoodMicroService-1700"><span class="linenos">1700</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1701"><a href="#PumpWoodMicroService-1701"><span class="linenos">1701</span></a>
</span><span id="PumpWoodMicroService-1702"><a href="#PumpWoodMicroService-1702"><span class="linenos">1702</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1703"><a href="#PumpWoodMicroService-1703"><span class="linenos">1703</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1704"><a href="#PumpWoodMicroService-1704"><span class="linenos">1704</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1705"><a href="#PumpWoodMicroService-1705"><span class="linenos">1705</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1706"><a href="#PumpWoodMicroService-1706"><span class="linenos">1706</span></a>        <span class="c1"># end Args check</span>
</span><span id="PumpWoodMicroService-1707"><a href="#PumpWoodMicroService-1707"><span class="linenos">1707</span></a>
</span><span id="PumpWoodMicroService-1708"><a href="#PumpWoodMicroService-1708"><span class="linenos">1708</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1709"><a href="#PumpWoodMicroService-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1710"><a href="#PumpWoodMicroService-1710"><span class="linenos">1710</span></a>            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1711"><a href="#PumpWoodMicroService-1711"><span class="linenos">1711</span></a>            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService-1712"><a href="#PumpWoodMicroService-1712"><span class="linenos">1712</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1713"><a href="#PumpWoodMicroService-1713"><span class="linenos">1713</span></a>                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1714"><a href="#PumpWoodMicroService-1714"><span class="linenos">1714</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1715"><a href="#PumpWoodMicroService-1715"><span class="linenos">1715</span></a>                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1716"><a href="#PumpWoodMicroService-1716"><span class="linenos">1716</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1717"><a href="#PumpWoodMicroService-1717"><span class="linenos">1717</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="PumpWoodMicroService-1718"><a href="#PumpWoodMicroService-1718"><span class="linenos">1718</span></a>                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService-1719"><a href="#PumpWoodMicroService-1719"><span class="linenos">1719</span></a>                    <span class="k">break</span>
</span><span id="PumpWoodMicroService-1720"><a href="#PumpWoodMicroService-1720"><span class="linenos">1720</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1721"><a href="#PumpWoodMicroService-1721"><span class="linenos">1721</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1722"><a href="#PumpWoodMicroService-1722"><span class="linenos">1722</span></a>                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-1723"><a href="#PumpWoodMicroService-1723"><span class="linenos">1723</span></a>                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-1724"><a href="#PumpWoodMicroService-1724"><span class="linenos">1724</span></a>
</span><span id="PumpWoodMicroService-1725"><a href="#PumpWoodMicroService-1725"><span class="linenos">1725</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1726"><a href="#PumpWoodMicroService-1726"><span class="linenos">1726</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1727"><a href="#PumpWoodMicroService-1727"><span class="linenos">1727</span></a>                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-1728"><a href="#PumpWoodMicroService-1728"><span class="linenos">1728</span></a>                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1729"><a href="#PumpWoodMicroService-1729"><span class="linenos">1729</span></a>
</span><span id="PumpWoodMicroService-1730"><a href="#PumpWoodMicroService-1730"><span class="linenos">1730</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1731"><a href="#PumpWoodMicroService-1731"><span class="linenos">1731</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1732"><a href="#PumpWoodMicroService-1732"><span class="linenos">1732</span></a>
</span><span id="PumpWoodMicroService-1733"><a href="#PumpWoodMicroService-1733"><span class="linenos">1733</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
</span><span id="PumpWoodMicroService-1734"><a href="#PumpWoodMicroService-1734"><span class="linenos">1734</span></a>        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1735"><a href="#PumpWoodMicroService-1735"><span class="linenos">1735</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1736"><a href="#PumpWoodMicroService-1736"><span class="linenos">1736</span></a>                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-1737"><a href="#PumpWoodMicroService-1737"><span class="linenos">1737</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1738"><a href="#PumpWoodMicroService-1738"><span class="linenos">1738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1739"><a href="#PumpWoodMicroService-1739"><span class="linenos">1739</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1740"><a href="#PumpWoodMicroService-1740"><span class="linenos">1740</span></a>                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1741"><a href="#PumpWoodMicroService-1741"><span class="linenos">1741</span></a>                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1742"><a href="#PumpWoodMicroService-1742"><span class="linenos">1742</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1743"><a href="#PumpWoodMicroService-1743"><span class="linenos">1743</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="PumpWoodMicroService-1744"><a href="#PumpWoodMicroService-1744"><span class="linenos">1744</span></a>
</span><span id="PumpWoodMicroService-1745"><a href="#PumpWoodMicroService-1745"><span class="linenos">1745</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1746"><a href="#PumpWoodMicroService-1746"><span class="linenos">1746</span></a>    <span class="k">def</span> <span class="nf">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1747"><a href="#PumpWoodMicroService-1747"><span class="linenos">1747</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-1748"><a href="#PumpWoodMicroService-1748"><span class="linenos">1748</span></a>
</span><span id="PumpWoodMicroService-1749"><a href="#PumpWoodMicroService-1749"><span class="linenos">1749</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1750"><a href="#PumpWoodMicroService-1750"><span class="linenos">1750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save or Update a new object.</span>
</span><span id="PumpWoodMicroService-1751"><a href="#PumpWoodMicroService-1751"><span class="linenos">1751</span></a>
</span><span id="PumpWoodMicroService-1752"><a href="#PumpWoodMicroService-1752"><span class="linenos">1752</span></a><span class="sd">        Function to save or update a new model_class object. If obj_dict[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService-1753"><a href="#PumpWoodMicroService-1753"><span class="linenos">1753</span></a><span class="sd">        is None or not defined a new object will be created. The obj</span>
</span><span id="PumpWoodMicroService-1754"><a href="#PumpWoodMicroService-1754"><span class="linenos">1754</span></a><span class="sd">        model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
</span><span id="PumpWoodMicroService-1755"><a href="#PumpWoodMicroService-1755"><span class="linenos">1755</span></a><span class="sd">        PumpWoodObjectSavingException will be raised.</span>
</span><span id="PumpWoodMicroService-1756"><a href="#PumpWoodMicroService-1756"><span class="linenos">1756</span></a>
</span><span id="PumpWoodMicroService-1757"><a href="#PumpWoodMicroService-1757"><span class="linenos">1757</span></a><span class="sd">        If files argument is set, request will be transfered using a multipart</span>
</span><span id="PumpWoodMicroService-1758"><a href="#PumpWoodMicroService-1758"><span class="linenos">1758</span></a><span class="sd">        request file files mapping file key to file field on backend.</span>
</span><span id="PumpWoodMicroService-1759"><a href="#PumpWoodMicroService-1759"><span class="linenos">1759</span></a>
</span><span id="PumpWoodMicroService-1760"><a href="#PumpWoodMicroService-1760"><span class="linenos">1760</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1761"><a href="#PumpWoodMicroService-1761"><span class="linenos">1761</span></a><span class="sd">            obj_dict:</span>
</span><span id="PumpWoodMicroService-1762"><a href="#PumpWoodMicroService-1762"><span class="linenos">1762</span></a><span class="sd">                Model data dictionary. It must have &#39;model_class&#39;</span>
</span><span id="PumpWoodMicroService-1763"><a href="#PumpWoodMicroService-1763"><span class="linenos">1763</span></a><span class="sd">                key and if &#39;pk&#39; key is not defined a new object will</span>
</span><span id="PumpWoodMicroService-1764"><a href="#PumpWoodMicroService-1764"><span class="linenos">1764</span></a><span class="sd">                be created, else object with pk will be updated.</span>
</span><span id="PumpWoodMicroService-1765"><a href="#PumpWoodMicroService-1765"><span class="linenos">1765</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService-1766"><a href="#PumpWoodMicroService-1766"><span class="linenos">1766</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="PumpWoodMicroService-1767"><a href="#PumpWoodMicroService-1767"><span class="linenos">1767</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="PumpWoodMicroService-1768"><a href="#PumpWoodMicroService-1768"><span class="linenos">1768</span></a><span class="sd">                bytes.</span>
</span><span id="PumpWoodMicroService-1769"><a href="#PumpWoodMicroService-1769"><span class="linenos">1769</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1770"><a href="#PumpWoodMicroService-1770"><span class="linenos">1770</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1771"><a href="#PumpWoodMicroService-1771"><span class="linenos">1771</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1772"><a href="#PumpWoodMicroService-1772"><span class="linenos">1772</span></a>
</span><span id="PumpWoodMicroService-1773"><a href="#PumpWoodMicroService-1773"><span class="linenos">1773</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1774"><a href="#PumpWoodMicroService-1774"><span class="linenos">1774</span></a><span class="sd">            Return updated/created object data.</span>
</span><span id="PumpWoodMicroService-1775"><a href="#PumpWoodMicroService-1775"><span class="linenos">1775</span></a>
</span><span id="PumpWoodMicroService-1776"><a href="#PumpWoodMicroService-1776"><span class="linenos">1776</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1777"><a href="#PumpWoodMicroService-1777"><span class="linenos">1777</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="PumpWoodMicroService-1778"><a href="#PumpWoodMicroService-1778"><span class="linenos">1778</span></a><span class="sd">                &#39;To save an object obj_dict must have model_class defined.&#39;</span>
</span><span id="PumpWoodMicroService-1779"><a href="#PumpWoodMicroService-1779"><span class="linenos">1779</span></a><span class="sd">                This indicates that the obj_dict must have key `model_class`</span>
</span><span id="PumpWoodMicroService-1780"><a href="#PumpWoodMicroService-1780"><span class="linenos">1780</span></a><span class="sd">                indicating model class of the object that will be</span>
</span><span id="PumpWoodMicroService-1781"><a href="#PumpWoodMicroService-1781"><span class="linenos">1781</span></a><span class="sd">                updated/created.</span>
</span><span id="PumpWoodMicroService-1782"><a href="#PumpWoodMicroService-1782"><span class="linenos">1782</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1783"><a href="#PumpWoodMicroService-1783"><span class="linenos">1783</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="PumpWoodMicroService-1784"><a href="#PumpWoodMicroService-1784"><span class="linenos">1784</span></a><span class="sd">                indicates that the pk passed on obj_dict was not found on</span>
</span><span id="PumpWoodMicroService-1785"><a href="#PumpWoodMicroService-1785"><span class="linenos">1785</span></a><span class="sd">                backend database.</span>
</span><span id="PumpWoodMicroService-1786"><a href="#PumpWoodMicroService-1786"><span class="linenos">1786</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="PumpWoodMicroService-1787"><a href="#PumpWoodMicroService-1787"><span class="linenos">1787</span></a><span class="sd">                Error raised when IntegrityError is raised on database. This</span>
</span><span id="PumpWoodMicroService-1788"><a href="#PumpWoodMicroService-1788"><span class="linenos">1788</span></a><span class="sd">                might ocorrur when saving objects that does not respect</span>
</span><span id="PumpWoodMicroService-1789"><a href="#PumpWoodMicroService-1789"><span class="linenos">1789</span></a><span class="sd">                uniqueness restriction on database or other IntegrityError</span>
</span><span id="PumpWoodMicroService-1790"><a href="#PumpWoodMicroService-1790"><span class="linenos">1790</span></a><span class="sd">                like removal of foreign keys with related data.</span>
</span><span id="PumpWoodMicroService-1791"><a href="#PumpWoodMicroService-1791"><span class="linenos">1791</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="PumpWoodMicroService-1792"><a href="#PumpWoodMicroService-1792"><span class="linenos">1792</span></a><span class="sd">                Return error at object validation on de-serializing the</span>
</span><span id="PumpWoodMicroService-1793"><a href="#PumpWoodMicroService-1793"><span class="linenos">1793</span></a><span class="sd">                object or files with unexpected extensions.</span>
</span><span id="PumpWoodMicroService-1794"><a href="#PumpWoodMicroService-1794"><span class="linenos">1794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1795"><a href="#PumpWoodMicroService-1795"><span class="linenos">1795</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1796"><a href="#PumpWoodMicroService-1796"><span class="linenos">1796</span></a>        <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1797"><a href="#PumpWoodMicroService-1797"><span class="linenos">1797</span></a>            <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1798"><a href="#PumpWoodMicroService-1798"><span class="linenos">1798</span></a>                <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1799"><a href="#PumpWoodMicroService-1799"><span class="linenos">1799</span></a>
</span><span id="PumpWoodMicroService-1800"><a href="#PumpWoodMicroService-1800"><span class="linenos">1800</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1801"><a href="#PumpWoodMicroService-1801"><span class="linenos">1801</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1802"><a href="#PumpWoodMicroService-1802"><span class="linenos">1802</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1803"><a href="#PumpWoodMicroService-1803"><span class="linenos">1803</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1804"><a href="#PumpWoodMicroService-1804"><span class="linenos">1804</span></a>
</span><span id="PumpWoodMicroService-1805"><a href="#PumpWoodMicroService-1805"><span class="linenos">1805</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1806"><a href="#PumpWoodMicroService-1806"><span class="linenos">1806</span></a>    <span class="k">def</span> <span class="nf">_build_save_streaming_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1807"><a href="#PumpWoodMicroService-1807"><span class="linenos">1807</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">{model_class}</span><span class="s2">/save-file-streaming/</span><span class="si">{pk}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1808"><a href="#PumpWoodMicroService-1808"><span class="linenos">1808</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1809"><a href="#PumpWoodMicroService-1809"><span class="linenos">1809</span></a>
</span><span id="PumpWoodMicroService-1810"><a href="#PumpWoodMicroService-1810"><span class="linenos">1810</span></a>    <span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1811"><a href="#PumpWoodMicroService-1811"><span class="linenos">1811</span></a>                            <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1812"><a href="#PumpWoodMicroService-1812"><span class="linenos">1812</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1813"><a href="#PumpWoodMicroService-1813"><span class="linenos">1813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream file to PumpWood.</span>
</span><span id="PumpWoodMicroService-1814"><a href="#PumpWoodMicroService-1814"><span class="linenos">1814</span></a>
</span><span id="PumpWoodMicroService-1815"><a href="#PumpWoodMicroService-1815"><span class="linenos">1815</span></a><span class="sd">        Use streaming to transfer a file content to Pumpwood storage, this</span>
</span><span id="PumpWoodMicroService-1816"><a href="#PumpWoodMicroService-1816"><span class="linenos">1816</span></a><span class="sd">        end-point is prefered when transmiting files bigger than 10Mb. It</span>
</span><span id="PumpWoodMicroService-1817"><a href="#PumpWoodMicroService-1817"><span class="linenos">1817</span></a><span class="sd">        is necessary to have the object created before the file transfer.</span>
</span><span id="PumpWoodMicroService-1818"><a href="#PumpWoodMicroService-1818"><span class="linenos">1818</span></a>
</span><span id="PumpWoodMicroService-1819"><a href="#PumpWoodMicroService-1819"><span class="linenos">1819</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1820"><a href="#PumpWoodMicroService-1820"><span class="linenos">1820</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1821"><a href="#PumpWoodMicroService-1821"><span class="linenos">1821</span></a><span class="sd">                Model class of the object.</span>
</span><span id="PumpWoodMicroService-1822"><a href="#PumpWoodMicroService-1822"><span class="linenos">1822</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1823"><a href="#PumpWoodMicroService-1823"><span class="linenos">1823</span></a><span class="sd">                pk of the object.</span>
</span><span id="PumpWoodMicroService-1824"><a href="#PumpWoodMicroService-1824"><span class="linenos">1824</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService-1825"><a href="#PumpWoodMicroService-1825"><span class="linenos">1825</span></a><span class="sd">                File field that will receive file stream.</span>
</span><span id="PumpWoodMicroService-1826"><a href="#PumpWoodMicroService-1826"><span class="linenos">1826</span></a><span class="sd">            file:</span>
</span><span id="PumpWoodMicroService-1827"><a href="#PumpWoodMicroService-1827"><span class="linenos">1827</span></a><span class="sd">                File to upload as a file object with read bytes option.</span>
</span><span id="PumpWoodMicroService-1828"><a href="#PumpWoodMicroService-1828"><span class="linenos">1828</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1829"><a href="#PumpWoodMicroService-1829"><span class="linenos">1829</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1830"><a href="#PumpWoodMicroService-1830"><span class="linenos">1830</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1831"><a href="#PumpWoodMicroService-1831"><span class="linenos">1831</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService-1832"><a href="#PumpWoodMicroService-1832"><span class="linenos">1832</span></a><span class="sd">                Name of the file, if not set it will be saved as</span>
</span><span id="PumpWoodMicroService-1833"><a href="#PumpWoodMicroService-1833"><span class="linenos">1833</span></a><span class="sd">                {pk}__{file_field}.{extension at permited extension}</span>
</span><span id="PumpWoodMicroService-1834"><a href="#PumpWoodMicroService-1834"><span class="linenos">1834</span></a>
</span><span id="PumpWoodMicroService-1835"><a href="#PumpWoodMicroService-1835"><span class="linenos">1835</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1836"><a href="#PumpWoodMicroService-1836"><span class="linenos">1836</span></a><span class="sd">            Return the file name associated with data at the storage.</span>
</span><span id="PumpWoodMicroService-1837"><a href="#PumpWoodMicroService-1837"><span class="linenos">1837</span></a>
</span><span id="PumpWoodMicroService-1838"><a href="#PumpWoodMicroService-1838"><span class="linenos">1838</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1839"><a href="#PumpWoodMicroService-1839"><span class="linenos">1839</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1840"><a href="#PumpWoodMicroService-1840"><span class="linenos">1840</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService-1841"><a href="#PumpWoodMicroService-1841"><span class="linenos">1841</span></a><span class="sd">                indicates that the `file_field` passed is not associated</span>
</span><span id="PumpWoodMicroService-1842"><a href="#PumpWoodMicroService-1842"><span class="linenos">1842</span></a><span class="sd">                with a file field on the backend.</span>
</span><span id="PumpWoodMicroService-1843"><a href="#PumpWoodMicroService-1843"><span class="linenos">1843</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-1844"><a href="#PumpWoodMicroService-1844"><span class="linenos">1844</span></a><span class="sd">                &#39;Saved bytes in streaming [{}] differ from file bytes [{}].&#39;.</span>
</span><span id="PumpWoodMicroService-1845"><a href="#PumpWoodMicroService-1845"><span class="linenos">1845</span></a><span class="sd">                This indicates that there was an error when transfering data</span>
</span><span id="PumpWoodMicroService-1846"><a href="#PumpWoodMicroService-1846"><span class="linenos">1846</span></a><span class="sd">                to storage, the file bytes and transfered bytes does not</span>
</span><span id="PumpWoodMicroService-1847"><a href="#PumpWoodMicroService-1847"><span class="linenos">1847</span></a><span class="sd">                match.</span>
</span><span id="PumpWoodMicroService-1848"><a href="#PumpWoodMicroService-1848"><span class="linenos">1848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1849"><a href="#PumpWoodMicroService-1849"><span class="linenos">1849</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1850"><a href="#PumpWoodMicroService-1850"><span class="linenos">1850</span></a>        <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
</span><span id="PumpWoodMicroService-1851"><a href="#PumpWoodMicroService-1851"><span class="linenos">1851</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1852"><a href="#PumpWoodMicroService-1852"><span class="linenos">1852</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1853"><a href="#PumpWoodMicroService-1853"><span class="linenos">1853</span></a>
</span><span id="PumpWoodMicroService-1854"><a href="#PumpWoodMicroService-1854"><span class="linenos">1854</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService-1855"><a href="#PumpWoodMicroService-1855"><span class="linenos">1855</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
</span><span id="PumpWoodMicroService-1856"><a href="#PumpWoodMicroService-1856"><span class="linenos">1856</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1857"><a href="#PumpWoodMicroService-1857"><span class="linenos">1857</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
</span><span id="PumpWoodMicroService-1858"><a href="#PumpWoodMicroService-1858"><span class="linenos">1858</span></a>
</span><span id="PumpWoodMicroService-1859"><a href="#PumpWoodMicroService-1859"><span class="linenos">1859</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1860"><a href="#PumpWoodMicroService-1860"><span class="linenos">1860</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1861"><a href="#PumpWoodMicroService-1861"><span class="linenos">1861</span></a>            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1862"><a href="#PumpWoodMicroService-1862"><span class="linenos">1862</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1863"><a href="#PumpWoodMicroService-1863"><span class="linenos">1863</span></a>
</span><span id="PumpWoodMicroService-1864"><a href="#PumpWoodMicroService-1864"><span class="linenos">1864</span></a>        <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-1865"><a href="#PumpWoodMicroService-1865"><span class="linenos">1865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1866"><a href="#PumpWoodMicroService-1866"><span class="linenos">1866</span></a>        <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1867"><a href="#PumpWoodMicroService-1867"><span class="linenos">1867</span></a>
</span><span id="PumpWoodMicroService-1868"><a href="#PumpWoodMicroService-1868"><span class="linenos">1868</span></a>        <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1869"><a href="#PumpWoodMicroService-1869"><span class="linenos">1869</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-1870"><a href="#PumpWoodMicroService-1870"><span class="linenos">1870</span></a>                <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-1871"><a href="#PumpWoodMicroService-1871"><span class="linenos">1871</span></a>                <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1872"><a href="#PumpWoodMicroService-1872"><span class="linenos">1872</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1873"><a href="#PumpWoodMicroService-1873"><span class="linenos">1873</span></a>                    <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1874"><a href="#PumpWoodMicroService-1874"><span class="linenos">1874</span></a>                        <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-1875"><a href="#PumpWoodMicroService-1875"><span class="linenos">1875</span></a>        <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-1876"><a href="#PumpWoodMicroService-1876"><span class="linenos">1876</span></a>
</span><span id="PumpWoodMicroService-1877"><a href="#PumpWoodMicroService-1877"><span class="linenos">1877</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1878"><a href="#PumpWoodMicroService-1878"><span class="linenos">1878</span></a>    <span class="k">def</span> <span class="nf">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1879"><a href="#PumpWoodMicroService-1879"><span class="linenos">1879</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1880"><a href="#PumpWoodMicroService-1880"><span class="linenos">1880</span></a>
</span><span id="PumpWoodMicroService-1881"><a href="#PumpWoodMicroService-1881"><span class="linenos">1881</span></a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1882"><a href="#PumpWoodMicroService-1882"><span class="linenos">1882</span></a>               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1883"><a href="#PumpWoodMicroService-1883"><span class="linenos">1883</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="PumpWoodMicroService-1884"><a href="#PumpWoodMicroService-1884"><span class="linenos">1884</span></a>
</span><span id="PumpWoodMicroService-1885"><a href="#PumpWoodMicroService-1885"><span class="linenos">1885</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="PumpWoodMicroService-1886"><a href="#PumpWoodMicroService-1886"><span class="linenos">1886</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="PumpWoodMicroService-1887"><a href="#PumpWoodMicroService-1887"><span class="linenos">1887</span></a>
</span><span id="PumpWoodMicroService-1888"><a href="#PumpWoodMicroService-1888"><span class="linenos">1888</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1889"><a href="#PumpWoodMicroService-1889"><span class="linenos">1889</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1890"><a href="#PumpWoodMicroService-1890"><span class="linenos">1890</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService-1891"><a href="#PumpWoodMicroService-1891"><span class="linenos">1891</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1892"><a href="#PumpWoodMicroService-1892"><span class="linenos">1892</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="PumpWoodMicroService-1893"><a href="#PumpWoodMicroService-1893"><span class="linenos">1893</span></a><span class="sd">                have been implemented). Some model_class with &#39;deleted&#39; field</span>
</span><span id="PumpWoodMicroService-1894"><a href="#PumpWoodMicroService-1894"><span class="linenos">1894</span></a><span class="sd">                does not remove the entry, it will flag deleted=True at this</span>
</span><span id="PumpWoodMicroService-1895"><a href="#PumpWoodMicroService-1895"><span class="linenos">1895</span></a><span class="sd">                cases. Model class with delete=True will be not retrieved</span>
</span><span id="PumpWoodMicroService-1896"><a href="#PumpWoodMicroService-1896"><span class="linenos">1896</span></a><span class="sd">                by default on `list` and `list_without_pag` end-points.</span>
</span><span id="PumpWoodMicroService-1897"><a href="#PumpWoodMicroService-1897"><span class="linenos">1897</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1898"><a href="#PumpWoodMicroService-1898"><span class="linenos">1898</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1899"><a href="#PumpWoodMicroService-1899"><span class="linenos">1899</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1900"><a href="#PumpWoodMicroService-1900"><span class="linenos">1900</span></a>
</span><span id="PumpWoodMicroService-1901"><a href="#PumpWoodMicroService-1901"><span class="linenos">1901</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1902"><a href="#PumpWoodMicroService-1902"><span class="linenos">1902</span></a><span class="sd">            Returns delete object.</span>
</span><span id="PumpWoodMicroService-1903"><a href="#PumpWoodMicroService-1903"><span class="linenos">1903</span></a>
</span><span id="PumpWoodMicroService-1904"><a href="#PumpWoodMicroService-1904"><span class="linenos">1904</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1905"><a href="#PumpWoodMicroService-1905"><span class="linenos">1905</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1906"><a href="#PumpWoodMicroService-1906"><span class="linenos">1906</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39; This</span>
</span><span id="PumpWoodMicroService-1907"><a href="#PumpWoodMicroService-1907"><span class="linenos">1907</span></a><span class="sd">                indicates that the pk was not found in database.</span>
</span><span id="PumpWoodMicroService-1908"><a href="#PumpWoodMicroService-1908"><span class="linenos">1908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1909"><a href="#PumpWoodMicroService-1909"><span class="linenos">1909</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1910"><a href="#PumpWoodMicroService-1910"><span class="linenos">1910</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1911"><a href="#PumpWoodMicroService-1911"><span class="linenos">1911</span></a>
</span><span id="PumpWoodMicroService-1912"><a href="#PumpWoodMicroService-1912"><span class="linenos">1912</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1913"><a href="#PumpWoodMicroService-1913"><span class="linenos">1913</span></a>    <span class="k">def</span> <span class="nf">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1914"><a href="#PumpWoodMicroService-1914"><span class="linenos">1914</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/remove-file-field/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1915"><a href="#PumpWoodMicroService-1915"><span class="linenos">1915</span></a>
</span><span id="PumpWoodMicroService-1916"><a href="#PumpWoodMicroService-1916"><span class="linenos">1916</span></a>    <span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1917"><a href="#PumpWoodMicroService-1917"><span class="linenos">1917</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1918"><a href="#PumpWoodMicroService-1918"><span class="linenos">1918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="PumpWoodMicroService-1919"><a href="#PumpWoodMicroService-1919"><span class="linenos">1919</span></a>
</span><span id="PumpWoodMicroService-1920"><a href="#PumpWoodMicroService-1920"><span class="linenos">1920</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="PumpWoodMicroService-1921"><a href="#PumpWoodMicroService-1921"><span class="linenos">1921</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="PumpWoodMicroService-1922"><a href="#PumpWoodMicroService-1922"><span class="linenos">1922</span></a>
</span><span id="PumpWoodMicroService-1923"><a href="#PumpWoodMicroService-1923"><span class="linenos">1923</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1924"><a href="#PumpWoodMicroService-1924"><span class="linenos">1924</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1925"><a href="#PumpWoodMicroService-1925"><span class="linenos">1925</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService-1926"><a href="#PumpWoodMicroService-1926"><span class="linenos">1926</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-1927"><a href="#PumpWoodMicroService-1927"><span class="linenos">1927</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="PumpWoodMicroService-1928"><a href="#PumpWoodMicroService-1928"><span class="linenos">1928</span></a><span class="sd">                have been implemented).</span>
</span><span id="PumpWoodMicroService-1929"><a href="#PumpWoodMicroService-1929"><span class="linenos">1929</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService-1930"><a href="#PumpWoodMicroService-1930"><span class="linenos">1930</span></a><span class="sd">                File field to be removed from storage.</span>
</span><span id="PumpWoodMicroService-1931"><a href="#PumpWoodMicroService-1931"><span class="linenos">1931</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1932"><a href="#PumpWoodMicroService-1932"><span class="linenos">1932</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1933"><a href="#PumpWoodMicroService-1933"><span class="linenos">1933</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1934"><a href="#PumpWoodMicroService-1934"><span class="linenos">1934</span></a>
</span><span id="PumpWoodMicroService-1935"><a href="#PumpWoodMicroService-1935"><span class="linenos">1935</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1936"><a href="#PumpWoodMicroService-1936"><span class="linenos">1936</span></a><span class="sd">            Return True is file was successful removed</span>
</span><span id="PumpWoodMicroService-1937"><a href="#PumpWoodMicroService-1937"><span class="linenos">1937</span></a>
</span><span id="PumpWoodMicroService-1938"><a href="#PumpWoodMicroService-1938"><span class="linenos">1938</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1939"><a href="#PumpWoodMicroService-1939"><span class="linenos">1939</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1940"><a href="#PumpWoodMicroService-1940"><span class="linenos">1940</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService-1941"><a href="#PumpWoodMicroService-1941"><span class="linenos">1941</span></a><span class="sd">                are disable&#39;. This indicates that storage_object is not</span>
</span><span id="PumpWoodMicroService-1942"><a href="#PumpWoodMicroService-1942"><span class="linenos">1942</span></a><span class="sd">                associated with view, not allowing it to make storage</span>
</span><span id="PumpWoodMicroService-1943"><a href="#PumpWoodMicroService-1943"><span class="linenos">1943</span></a><span class="sd">                operations.</span>
</span><span id="PumpWoodMicroService-1944"><a href="#PumpWoodMicroService-1944"><span class="linenos">1944</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService-1945"><a href="#PumpWoodMicroService-1945"><span class="linenos">1945</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary.&#39;.</span>
</span><span id="PumpWoodMicroService-1946"><a href="#PumpWoodMicroService-1946"><span class="linenos">1946</span></a><span class="sd">                This indicates that the `file_field` was not set as a file</span>
</span><span id="PumpWoodMicroService-1947"><a href="#PumpWoodMicroService-1947"><span class="linenos">1947</span></a><span class="sd">                field on the backend.</span>
</span><span id="PumpWoodMicroService-1948"><a href="#PumpWoodMicroService-1948"><span class="linenos">1948</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-1949"><a href="#PumpWoodMicroService-1949"><span class="linenos">1949</span></a><span class="sd">                &#39;File does not exist. File field [{}] is set as None&#39;.</span>
</span><span id="PumpWoodMicroService-1950"><a href="#PumpWoodMicroService-1950"><span class="linenos">1950</span></a><span class="sd">                This indicates that the object does not exists on storage,</span>
</span><span id="PumpWoodMicroService-1951"><a href="#PumpWoodMicroService-1951"><span class="linenos">1951</span></a><span class="sd">                it should not occur. It might have been some manual update</span>
</span><span id="PumpWoodMicroService-1952"><a href="#PumpWoodMicroService-1952"><span class="linenos">1952</span></a><span class="sd">                of the database or at the storage level.</span>
</span><span id="PumpWoodMicroService-1953"><a href="#PumpWoodMicroService-1953"><span class="linenos">1953</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1954"><a href="#PumpWoodMicroService-1954"><span class="linenos">1954</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1955"><a href="#PumpWoodMicroService-1955"><span class="linenos">1955</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1956"><a href="#PumpWoodMicroService-1956"><span class="linenos">1956</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1957"><a href="#PumpWoodMicroService-1957"><span class="linenos">1957</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-1958"><a href="#PumpWoodMicroService-1958"><span class="linenos">1958</span></a>
</span><span id="PumpWoodMicroService-1959"><a href="#PumpWoodMicroService-1959"><span class="linenos">1959</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-1960"><a href="#PumpWoodMicroService-1960"><span class="linenos">1960</span></a>    <span class="k">def</span> <span class="nf">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-1961"><a href="#PumpWoodMicroService-1961"><span class="linenos">1961</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService-1962"><a href="#PumpWoodMicroService-1962"><span class="linenos">1962</span></a>
</span><span id="PumpWoodMicroService-1963"><a href="#PumpWoodMicroService-1963"><span class="linenos">1963</span></a>    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-1964"><a href="#PumpWoodMicroService-1964"><span class="linenos">1964</span></a>                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-1965"><a href="#PumpWoodMicroService-1965"><span class="linenos">1965</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove many objects using query to retrict removal.</span>
</span><span id="PumpWoodMicroService-1966"><a href="#PumpWoodMicroService-1966"><span class="linenos">1966</span></a>
</span><span id="PumpWoodMicroService-1967"><a href="#PumpWoodMicroService-1967"><span class="linenos">1967</span></a><span class="sd">        CAUTION It is not possible to undo this operation, model_class</span>
</span><span id="PumpWoodMicroService-1968"><a href="#PumpWoodMicroService-1968"><span class="linenos">1968</span></a><span class="sd">        this deleted field will be removed from database when using this</span>
</span><span id="PumpWoodMicroService-1969"><a href="#PumpWoodMicroService-1969"><span class="linenos">1969</span></a><span class="sd">        end-point, different from using delete end-point.</span>
</span><span id="PumpWoodMicroService-1970"><a href="#PumpWoodMicroService-1970"><span class="linenos">1970</span></a>
</span><span id="PumpWoodMicroService-1971"><a href="#PumpWoodMicroService-1971"><span class="linenos">1971</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-1972"><a href="#PumpWoodMicroService-1972"><span class="linenos">1972</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-1973"><a href="#PumpWoodMicroService-1973"><span class="linenos">1973</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService-1974"><a href="#PumpWoodMicroService-1974"><span class="linenos">1974</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService-1975"><a href="#PumpWoodMicroService-1975"><span class="linenos">1975</span></a><span class="sd">                Dictionary to make filter query.</span>
</span><span id="PumpWoodMicroService-1976"><a href="#PumpWoodMicroService-1976"><span class="linenos">1976</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService-1977"><a href="#PumpWoodMicroService-1977"><span class="linenos">1977</span></a><span class="sd">                Dictionary to make exclude query.</span>
</span><span id="PumpWoodMicroService-1978"><a href="#PumpWoodMicroService-1978"><span class="linenos">1978</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-1979"><a href="#PumpWoodMicroService-1979"><span class="linenos">1979</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-1980"><a href="#PumpWoodMicroService-1980"><span class="linenos">1980</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-1981"><a href="#PumpWoodMicroService-1981"><span class="linenos">1981</span></a>
</span><span id="PumpWoodMicroService-1982"><a href="#PumpWoodMicroService-1982"><span class="linenos">1982</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-1983"><a href="#PumpWoodMicroService-1983"><span class="linenos">1983</span></a><span class="sd">            True if delete is ok.</span>
</span><span id="PumpWoodMicroService-1984"><a href="#PumpWoodMicroService-1984"><span class="linenos">1984</span></a>
</span><span id="PumpWoodMicroService-1985"><a href="#PumpWoodMicroService-1985"><span class="linenos">1985</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-1986"><a href="#PumpWoodMicroService-1986"><span class="linenos">1986</span></a><span class="sd">            PumpWoodObjectDeleteException:</span>
</span><span id="PumpWoodMicroService-1987"><a href="#PumpWoodMicroService-1987"><span class="linenos">1987</span></a><span class="sd">                Raises error if there is any error when commiting object</span>
</span><span id="PumpWoodMicroService-1988"><a href="#PumpWoodMicroService-1988"><span class="linenos">1988</span></a><span class="sd">                deletion on database.</span>
</span><span id="PumpWoodMicroService-1989"><a href="#PumpWoodMicroService-1989"><span class="linenos">1989</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-1990"><a href="#PumpWoodMicroService-1990"><span class="linenos">1990</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1991"><a href="#PumpWoodMicroService-1991"><span class="linenos">1991</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-1992"><a href="#PumpWoodMicroService-1992"><span class="linenos">1992</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1993"><a href="#PumpWoodMicroService-1993"><span class="linenos">1993</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-1994"><a href="#PumpWoodMicroService-1994"><span class="linenos">1994</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-1995"><a href="#PumpWoodMicroService-1995"><span class="linenos">1995</span></a>
</span><span id="PumpWoodMicroService-1996"><a href="#PumpWoodMicroService-1996"><span class="linenos">1996</span></a>    <span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-1997"><a href="#PumpWoodMicroService-1997"><span class="linenos">1997</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-1998"><a href="#PumpWoodMicroService-1998"><span class="linenos">1998</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all actions avaiable at this model class.</span>
</span><span id="PumpWoodMicroService-1999"><a href="#PumpWoodMicroService-1999"><span class="linenos">1999</span></a>
</span><span id="PumpWoodMicroService-2000"><a href="#PumpWoodMicroService-2000"><span class="linenos">2000</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2001"><a href="#PumpWoodMicroService-2001"><span class="linenos">2001</span></a><span class="sd">          model_class:</span>
</span><span id="PumpWoodMicroService-2002"><a href="#PumpWoodMicroService-2002"><span class="linenos">2002</span></a><span class="sd">              Model class to list possible actions.</span>
</span><span id="PumpWoodMicroService-2003"><a href="#PumpWoodMicroService-2003"><span class="linenos">2003</span></a><span class="sd">          auth_header:</span>
</span><span id="PumpWoodMicroService-2004"><a href="#PumpWoodMicroService-2004"><span class="linenos">2004</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2005"><a href="#PumpWoodMicroService-2005"><span class="linenos">2005</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2006"><a href="#PumpWoodMicroService-2006"><span class="linenos">2006</span></a>
</span><span id="PumpWoodMicroService-2007"><a href="#PumpWoodMicroService-2007"><span class="linenos">2007</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2008"><a href="#PumpWoodMicroService-2008"><span class="linenos">2008</span></a><span class="sd">          List of possible actions and its descriptions.</span>
</span><span id="PumpWoodMicroService-2009"><a href="#PumpWoodMicroService-2009"><span class="linenos">2009</span></a>
</span><span id="PumpWoodMicroService-2010"><a href="#PumpWoodMicroService-2010"><span class="linenos">2010</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2011"><a href="#PumpWoodMicroService-2011"><span class="linenos">2011</span></a><span class="sd">            No particular errors.</span>
</span><span id="PumpWoodMicroService-2012"><a href="#PumpWoodMicroService-2012"><span class="linenos">2012</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2013"><a href="#PumpWoodMicroService-2013"><span class="linenos">2013</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2014"><a href="#PumpWoodMicroService-2014"><span class="linenos">2014</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2015"><a href="#PumpWoodMicroService-2015"><span class="linenos">2015</span></a>
</span><span id="PumpWoodMicroService-2016"><a href="#PumpWoodMicroService-2016"><span class="linenos">2016</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-2017"><a href="#PumpWoodMicroService-2017"><span class="linenos">2017</span></a>    <span class="k">def</span> <span class="nf">_build_execute_action_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2018"><a href="#PumpWoodMicroService-2018"><span class="linenos">2018</span></a>                                  <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2019"><a href="#PumpWoodMicroService-2019"><span class="linenos">2019</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">action</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2020"><a href="#PumpWoodMicroService-2020"><span class="linenos">2020</span></a>        <span class="k">if</span> <span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2021"><a href="#PumpWoodMicroService-2021"><span class="linenos">2021</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="PumpWoodMicroService-2022"><a href="#PumpWoodMicroService-2022"><span class="linenos">2022</span></a>        <span class="k">return</span> <span class="n">url_str</span>
</span><span id="PumpWoodMicroService-2023"><a href="#PumpWoodMicroService-2023"><span class="linenos">2023</span></a>
</span><span id="PumpWoodMicroService-2024"><a href="#PumpWoodMicroService-2024"><span class="linenos">2024</span></a>    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2025"><a href="#PumpWoodMicroService-2025"><span class="linenos">2025</span></a>                       <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2026"><a href="#PumpWoodMicroService-2026"><span class="linenos">2026</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2027"><a href="#PumpWoodMicroService-2027"><span class="linenos">2027</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute action associated with a model class.</span>
</span><span id="PumpWoodMicroService-2028"><a href="#PumpWoodMicroService-2028"><span class="linenos">2028</span></a>
</span><span id="PumpWoodMicroService-2029"><a href="#PumpWoodMicroService-2029"><span class="linenos">2029</span></a><span class="sd">        If action is static or classfunction no pk is necessary.</span>
</span><span id="PumpWoodMicroService-2030"><a href="#PumpWoodMicroService-2030"><span class="linenos">2030</span></a>
</span><span id="PumpWoodMicroService-2031"><a href="#PumpWoodMicroService-2031"><span class="linenos">2031</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2032"><a href="#PumpWoodMicroService-2032"><span class="linenos">2032</span></a><span class="sd">            pk (int):</span>
</span><span id="PumpWoodMicroService-2033"><a href="#PumpWoodMicroService-2033"><span class="linenos">2033</span></a><span class="sd">                PK of the object to run action at. If not set action will be</span>
</span><span id="PumpWoodMicroService-2034"><a href="#PumpWoodMicroService-2034"><span class="linenos">2034</span></a><span class="sd">                considered a classmethod and will run over the class.</span>
</span><span id="PumpWoodMicroService-2035"><a href="#PumpWoodMicroService-2035"><span class="linenos">2035</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2036"><a href="#PumpWoodMicroService-2036"><span class="linenos">2036</span></a><span class="sd">                Model class to run action the object</span>
</span><span id="PumpWoodMicroService-2037"><a href="#PumpWoodMicroService-2037"><span class="linenos">2037</span></a><span class="sd">            action:</span>
</span><span id="PumpWoodMicroService-2038"><a href="#PumpWoodMicroService-2038"><span class="linenos">2038</span></a><span class="sd">                Action that will be performed.</span>
</span><span id="PumpWoodMicroService-2039"><a href="#PumpWoodMicroService-2039"><span class="linenos">2039</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2040"><a href="#PumpWoodMicroService-2040"><span class="linenos">2040</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2041"><a href="#PumpWoodMicroService-2041"><span class="linenos">2041</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2042"><a href="#PumpWoodMicroService-2042"><span class="linenos">2042</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-2043"><a href="#PumpWoodMicroService-2043"><span class="linenos">2043</span></a><span class="sd">                Dictionary with the function parameters.</span>
</span><span id="PumpWoodMicroService-2044"><a href="#PumpWoodMicroService-2044"><span class="linenos">2044</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService-2045"><a href="#PumpWoodMicroService-2045"><span class="linenos">2045</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="PumpWoodMicroService-2046"><a href="#PumpWoodMicroService-2046"><span class="linenos">2046</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="PumpWoodMicroService-2047"><a href="#PumpWoodMicroService-2047"><span class="linenos">2047</span></a><span class="sd">                bytes.</span>
</span><span id="PumpWoodMicroService-2048"><a href="#PumpWoodMicroService-2048"><span class="linenos">2048</span></a>
</span><span id="PumpWoodMicroService-2049"><a href="#PumpWoodMicroService-2049"><span class="linenos">2049</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2050"><a href="#PumpWoodMicroService-2050"><span class="linenos">2050</span></a><span class="sd">            Return a dictonary with keys:</span>
</span><span id="PumpWoodMicroService-2051"><a href="#PumpWoodMicroService-2051"><span class="linenos">2051</span></a><span class="sd">            - **result:**: Result of the action that was performed.</span>
</span><span id="PumpWoodMicroService-2052"><a href="#PumpWoodMicroService-2052"><span class="linenos">2052</span></a><span class="sd">            - **action:**: Information of the action that was performed.</span>
</span><span id="PumpWoodMicroService-2053"><a href="#PumpWoodMicroService-2053"><span class="linenos">2053</span></a><span class="sd">            - **parameters:** Parameters that were passed to perform the</span>
</span><span id="PumpWoodMicroService-2054"><a href="#PumpWoodMicroService-2054"><span class="linenos">2054</span></a><span class="sd">                action.</span>
</span><span id="PumpWoodMicroService-2055"><a href="#PumpWoodMicroService-2055"><span class="linenos">2055</span></a><span class="sd">            - **object:** If a pk was passed to execute and action (not</span>
</span><span id="PumpWoodMicroService-2056"><a href="#PumpWoodMicroService-2056"><span class="linenos">2056</span></a><span class="sd">                classmethod or staticmethod), the object with the correspondent</span>
</span><span id="PumpWoodMicroService-2057"><a href="#PumpWoodMicroService-2057"><span class="linenos">2057</span></a><span class="sd">                pk is returned.</span>
</span><span id="PumpWoodMicroService-2058"><a href="#PumpWoodMicroService-2058"><span class="linenos">2058</span></a>
</span><span id="PumpWoodMicroService-2059"><a href="#PumpWoodMicroService-2059"><span class="linenos">2059</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2060"><a href="#PumpWoodMicroService-2060"><span class="linenos">2060</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2061"><a href="#PumpWoodMicroService-2061"><span class="linenos">2061</span></a><span class="sd">                &#39;There is no method {action} in rest actions for {class_name}&#39;.</span>
</span><span id="PumpWoodMicroService-2062"><a href="#PumpWoodMicroService-2062"><span class="linenos">2062</span></a><span class="sd">                This indicates that action requested is not associated with</span>
</span><span id="PumpWoodMicroService-2063"><a href="#PumpWoodMicroService-2063"><span class="linenos">2063</span></a><span class="sd">                the model_class.</span>
</span><span id="PumpWoodMicroService-2064"><a href="#PumpWoodMicroService-2064"><span class="linenos">2064</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="PumpWoodMicroService-2065"><a href="#PumpWoodMicroService-2065"><span class="linenos">2065</span></a><span class="sd">                &#39;Function is not static and pk is Null&#39;. This indicate that</span>
</span><span id="PumpWoodMicroService-2066"><a href="#PumpWoodMicroService-2066"><span class="linenos">2066</span></a><span class="sd">                the action solicitated is not static/class method and a pk</span>
</span><span id="PumpWoodMicroService-2067"><a href="#PumpWoodMicroService-2067"><span class="linenos">2067</span></a><span class="sd">                was not passed as argument.</span>
</span><span id="PumpWoodMicroService-2068"><a href="#PumpWoodMicroService-2068"><span class="linenos">2068</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="PumpWoodMicroService-2069"><a href="#PumpWoodMicroService-2069"><span class="linenos">2069</span></a><span class="sd">                &#39;Function is static and pk is not Null&#39;. This indicate that</span>
</span><span id="PumpWoodMicroService-2070"><a href="#PumpWoodMicroService-2070"><span class="linenos">2070</span></a><span class="sd">                the action solicitated is static/class method and a pk</span>
</span><span id="PumpWoodMicroService-2071"><a href="#PumpWoodMicroService-2071"><span class="linenos">2071</span></a><span class="sd">                was passed as argument.</span>
</span><span id="PumpWoodMicroService-2072"><a href="#PumpWoodMicroService-2072"><span class="linenos">2072</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService-2073"><a href="#PumpWoodMicroService-2073"><span class="linenos">2073</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="PumpWoodMicroService-2074"><a href="#PumpWoodMicroService-2074"><span class="linenos">2074</span></a><span class="sd">                indicate that pk associated with model class was not found</span>
</span><span id="PumpWoodMicroService-2075"><a href="#PumpWoodMicroService-2075"><span class="linenos">2075</span></a><span class="sd">                on database.</span>
</span><span id="PumpWoodMicroService-2076"><a href="#PumpWoodMicroService-2076"><span class="linenos">2076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2077"><a href="#PumpWoodMicroService-2077"><span class="linenos">2077</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2078"><a href="#PumpWoodMicroService-2078"><span class="linenos">2078</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2079"><a href="#PumpWoodMicroService-2079"><span class="linenos">2079</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2080"><a href="#PumpWoodMicroService-2080"><span class="linenos">2080</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2081"><a href="#PumpWoodMicroService-2081"><span class="linenos">2081</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2082"><a href="#PumpWoodMicroService-2082"><span class="linenos">2082</span></a>
</span><span id="PumpWoodMicroService-2083"><a href="#PumpWoodMicroService-2083"><span class="linenos">2083</span></a>    <span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2084"><a href="#PumpWoodMicroService-2084"><span class="linenos">2084</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2085"><a href="#PumpWoodMicroService-2085"><span class="linenos">2085</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return search options.</span>
</span><span id="PumpWoodMicroService-2086"><a href="#PumpWoodMicroService-2086"><span class="linenos">2086</span></a>
</span><span id="PumpWoodMicroService-2087"><a href="#PumpWoodMicroService-2087"><span class="linenos">2087</span></a><span class="sd">        DEPRECTED Use `list_options` function instead.</span>
</span><span id="PumpWoodMicroService-2088"><a href="#PumpWoodMicroService-2088"><span class="linenos">2088</span></a>
</span><span id="PumpWoodMicroService-2089"><a href="#PumpWoodMicroService-2089"><span class="linenos">2089</span></a><span class="sd">        Return information of the fields including avaiable options for</span>
</span><span id="PumpWoodMicroService-2090"><a href="#PumpWoodMicroService-2090"><span class="linenos">2090</span></a><span class="sd">        options fields and model associated with the foreign key.</span>
</span><span id="PumpWoodMicroService-2091"><a href="#PumpWoodMicroService-2091"><span class="linenos">2091</span></a>
</span><span id="PumpWoodMicroService-2092"><a href="#PumpWoodMicroService-2092"><span class="linenos">2092</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2093"><a href="#PumpWoodMicroService-2093"><span class="linenos">2093</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2094"><a href="#PumpWoodMicroService-2094"><span class="linenos">2094</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="PumpWoodMicroService-2095"><a href="#PumpWoodMicroService-2095"><span class="linenos">2095</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2096"><a href="#PumpWoodMicroService-2096"><span class="linenos">2096</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2097"><a href="#PumpWoodMicroService-2097"><span class="linenos">2097</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2098"><a href="#PumpWoodMicroService-2098"><span class="linenos">2098</span></a>
</span><span id="PumpWoodMicroService-2099"><a href="#PumpWoodMicroService-2099"><span class="linenos">2099</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2100"><a href="#PumpWoodMicroService-2100"><span class="linenos">2100</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="PumpWoodMicroService-2101"><a href="#PumpWoodMicroService-2101"><span class="linenos">2101</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="PumpWoodMicroService-2102"><a href="#PumpWoodMicroService-2102"><span class="linenos">2102</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="PumpWoodMicroService-2103"><a href="#PumpWoodMicroService-2103"><span class="linenos">2103</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="PumpWoodMicroService-2104"><a href="#PumpWoodMicroService-2104"><span class="linenos">2104</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="PumpWoodMicroService-2105"><a href="#PumpWoodMicroService-2105"><span class="linenos">2105</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="PumpWoodMicroService-2106"><a href="#PumpWoodMicroService-2106"><span class="linenos">2106</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService-2107"><a href="#PumpWoodMicroService-2107"><span class="linenos">2107</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="PumpWoodMicroService-2108"><a href="#PumpWoodMicroService-2108"><span class="linenos">2108</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="PumpWoodMicroService-2109"><a href="#PumpWoodMicroService-2109"><span class="linenos">2109</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService-2110"><a href="#PumpWoodMicroService-2110"><span class="linenos">2110</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="PumpWoodMicroService-2111"><a href="#PumpWoodMicroService-2111"><span class="linenos">2111</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="PumpWoodMicroService-2112"><a href="#PumpWoodMicroService-2112"><span class="linenos">2112</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="PumpWoodMicroService-2113"><a href="#PumpWoodMicroService-2113"><span class="linenos">2113</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="PumpWoodMicroService-2114"><a href="#PumpWoodMicroService-2114"><span class="linenos">2114</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="PumpWoodMicroService-2115"><a href="#PumpWoodMicroService-2115"><span class="linenos">2115</span></a><span class="sd">                save end-poin.</span>
</span><span id="PumpWoodMicroService-2116"><a href="#PumpWoodMicroService-2116"><span class="linenos">2116</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="PumpWoodMicroService-2117"><a href="#PumpWoodMicroService-2117"><span class="linenos">2117</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="PumpWoodMicroService-2118"><a href="#PumpWoodMicroService-2118"><span class="linenos">2118</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="PumpWoodMicroService-2119"><a href="#PumpWoodMicroService-2119"><span class="linenos">2119</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="PumpWoodMicroService-2120"><a href="#PumpWoodMicroService-2120"><span class="linenos">2120</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="PumpWoodMicroService-2121"><a href="#PumpWoodMicroService-2121"><span class="linenos">2121</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="PumpWoodMicroService-2122"><a href="#PumpWoodMicroService-2122"><span class="linenos">2122</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="PumpWoodMicroService-2123"><a href="#PumpWoodMicroService-2123"><span class="linenos">2123</span></a><span class="sd">                as values.</span>
</span><span id="PumpWoodMicroService-2124"><a href="#PumpWoodMicroService-2124"><span class="linenos">2124</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="PumpWoodMicroService-2125"><a href="#PumpWoodMicroService-2125"><span class="linenos">2125</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="PumpWoodMicroService-2126"><a href="#PumpWoodMicroService-2126"><span class="linenos">2126</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="PumpWoodMicroService-2127"><a href="#PumpWoodMicroService-2127"><span class="linenos">2127</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="PumpWoodMicroService-2128"><a href="#PumpWoodMicroService-2128"><span class="linenos">2128</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="PumpWoodMicroService-2129"><a href="#PumpWoodMicroService-2129"><span class="linenos">2129</span></a>
</span><span id="PumpWoodMicroService-2130"><a href="#PumpWoodMicroService-2130"><span class="linenos">2130</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2131"><a href="#PumpWoodMicroService-2131"><span class="linenos">2131</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-2132"><a href="#PumpWoodMicroService-2132"><span class="linenos">2132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2133"><a href="#PumpWoodMicroService-2133"><span class="linenos">2133</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService-2134"><a href="#PumpWoodMicroService-2134"><span class="linenos">2134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2135"><a href="#PumpWoodMicroService-2135"><span class="linenos">2135</span></a>
</span><span id="PumpWoodMicroService-2136"><a href="#PumpWoodMicroService-2136"><span class="linenos">2136</span></a>    <span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-2137"><a href="#PumpWoodMicroService-2137"><span class="linenos">2137</span></a>                     <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2138"><a href="#PumpWoodMicroService-2138"><span class="linenos">2138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="PumpWoodMicroService-2139"><a href="#PumpWoodMicroService-2139"><span class="linenos">2139</span></a>
</span><span id="PumpWoodMicroService-2140"><a href="#PumpWoodMicroService-2140"><span class="linenos">2140</span></a><span class="sd">        DEPRECTED Use `fill_validation` function instead.</span>
</span><span id="PumpWoodMicroService-2141"><a href="#PumpWoodMicroService-2141"><span class="linenos">2141</span></a>
</span><span id="PumpWoodMicroService-2142"><a href="#PumpWoodMicroService-2142"><span class="linenos">2142</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService-2143"><a href="#PumpWoodMicroService-2143"><span class="linenos">2143</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService-2144"><a href="#PumpWoodMicroService-2144"><span class="linenos">2144</span></a>
</span><span id="PumpWoodMicroService-2145"><a href="#PumpWoodMicroService-2145"><span class="linenos">2145</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2146"><a href="#PumpWoodMicroService-2146"><span class="linenos">2146</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2147"><a href="#PumpWoodMicroService-2147"><span class="linenos">2147</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="PumpWoodMicroService-2148"><a href="#PumpWoodMicroService-2148"><span class="linenos">2148</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2149"><a href="#PumpWoodMicroService-2149"><span class="linenos">2149</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2150"><a href="#PumpWoodMicroService-2150"><span class="linenos">2150</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2151"><a href="#PumpWoodMicroService-2151"><span class="linenos">2151</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="PumpWoodMicroService-2152"><a href="#PumpWoodMicroService-2152"><span class="linenos">2152</span></a><span class="sd">                Partial object that is sent to backend for validation and</span>
</span><span id="PumpWoodMicroService-2153"><a href="#PumpWoodMicroService-2153"><span class="linenos">2153</span></a><span class="sd">                update fill options acording to values passed for each field.</span>
</span><span id="PumpWoodMicroService-2154"><a href="#PumpWoodMicroService-2154"><span class="linenos">2154</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService-2155"><a href="#PumpWoodMicroService-2155"><span class="linenos">2155</span></a><span class="sd">                Retrict validation for an especific field if implemented.</span>
</span><span id="PumpWoodMicroService-2156"><a href="#PumpWoodMicroService-2156"><span class="linenos">2156</span></a>
</span><span id="PumpWoodMicroService-2157"><a href="#PumpWoodMicroService-2157"><span class="linenos">2157</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2158"><a href="#PumpWoodMicroService-2158"><span class="linenos">2158</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="PumpWoodMicroService-2159"><a href="#PumpWoodMicroService-2159"><span class="linenos">2159</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="PumpWoodMicroService-2160"><a href="#PumpWoodMicroService-2160"><span class="linenos">2160</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="PumpWoodMicroService-2161"><a href="#PumpWoodMicroService-2161"><span class="linenos">2161</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="PumpWoodMicroService-2162"><a href="#PumpWoodMicroService-2162"><span class="linenos">2162</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="PumpWoodMicroService-2163"><a href="#PumpWoodMicroService-2163"><span class="linenos">2163</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="PumpWoodMicroService-2164"><a href="#PumpWoodMicroService-2164"><span class="linenos">2164</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService-2165"><a href="#PumpWoodMicroService-2165"><span class="linenos">2165</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="PumpWoodMicroService-2166"><a href="#PumpWoodMicroService-2166"><span class="linenos">2166</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="PumpWoodMicroService-2167"><a href="#PumpWoodMicroService-2167"><span class="linenos">2167</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService-2168"><a href="#PumpWoodMicroService-2168"><span class="linenos">2168</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="PumpWoodMicroService-2169"><a href="#PumpWoodMicroService-2169"><span class="linenos">2169</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="PumpWoodMicroService-2170"><a href="#PumpWoodMicroService-2170"><span class="linenos">2170</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="PumpWoodMicroService-2171"><a href="#PumpWoodMicroService-2171"><span class="linenos">2171</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="PumpWoodMicroService-2172"><a href="#PumpWoodMicroService-2172"><span class="linenos">2172</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="PumpWoodMicroService-2173"><a href="#PumpWoodMicroService-2173"><span class="linenos">2173</span></a><span class="sd">                save end-poin.</span>
</span><span id="PumpWoodMicroService-2174"><a href="#PumpWoodMicroService-2174"><span class="linenos">2174</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="PumpWoodMicroService-2175"><a href="#PumpWoodMicroService-2175"><span class="linenos">2175</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="PumpWoodMicroService-2176"><a href="#PumpWoodMicroService-2176"><span class="linenos">2176</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="PumpWoodMicroService-2177"><a href="#PumpWoodMicroService-2177"><span class="linenos">2177</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="PumpWoodMicroService-2178"><a href="#PumpWoodMicroService-2178"><span class="linenos">2178</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="PumpWoodMicroService-2179"><a href="#PumpWoodMicroService-2179"><span class="linenos">2179</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="PumpWoodMicroService-2180"><a href="#PumpWoodMicroService-2180"><span class="linenos">2180</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="PumpWoodMicroService-2181"><a href="#PumpWoodMicroService-2181"><span class="linenos">2181</span></a><span class="sd">                as values.</span>
</span><span id="PumpWoodMicroService-2182"><a href="#PumpWoodMicroService-2182"><span class="linenos">2182</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="PumpWoodMicroService-2183"><a href="#PumpWoodMicroService-2183"><span class="linenos">2183</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="PumpWoodMicroService-2184"><a href="#PumpWoodMicroService-2184"><span class="linenos">2184</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="PumpWoodMicroService-2185"><a href="#PumpWoodMicroService-2185"><span class="linenos">2185</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="PumpWoodMicroService-2186"><a href="#PumpWoodMicroService-2186"><span class="linenos">2186</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="PumpWoodMicroService-2187"><a href="#PumpWoodMicroService-2187"><span class="linenos">2187</span></a>
</span><span id="PumpWoodMicroService-2188"><a href="#PumpWoodMicroService-2188"><span class="linenos">2188</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2189"><a href="#PumpWoodMicroService-2189"><span class="linenos">2189</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-2190"><a href="#PumpWoodMicroService-2190"><span class="linenos">2190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2191"><a href="#PumpWoodMicroService-2191"><span class="linenos">2191</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService-2192"><a href="#PumpWoodMicroService-2192"><span class="linenos">2192</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2193"><a href="#PumpWoodMicroService-2193"><span class="linenos">2193</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService-2194"><a href="#PumpWoodMicroService-2194"><span class="linenos">2194</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2195"><a href="#PumpWoodMicroService-2195"><span class="linenos">2195</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2196"><a href="#PumpWoodMicroService-2196"><span class="linenos">2196</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2197"><a href="#PumpWoodMicroService-2197"><span class="linenos">2197</span></a>
</span><span id="PumpWoodMicroService-2198"><a href="#PumpWoodMicroService-2198"><span class="linenos">2198</span></a>    <span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2199"><a href="#PumpWoodMicroService-2199"><span class="linenos">2199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render list views.</span>
</span><span id="PumpWoodMicroService-2200"><a href="#PumpWoodMicroService-2200"><span class="linenos">2200</span></a>
</span><span id="PumpWoodMicroService-2201"><a href="#PumpWoodMicroService-2201"><span class="linenos">2201</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService-2202"><a href="#PumpWoodMicroService-2202"><span class="linenos">2202</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService-2203"><a href="#PumpWoodMicroService-2203"><span class="linenos">2203</span></a>
</span><span id="PumpWoodMicroService-2204"><a href="#PumpWoodMicroService-2204"><span class="linenos">2204</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2205"><a href="#PumpWoodMicroService-2205"><span class="linenos">2205</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2206"><a href="#PumpWoodMicroService-2206"><span class="linenos">2206</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService-2207"><a href="#PumpWoodMicroService-2207"><span class="linenos">2207</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2208"><a href="#PumpWoodMicroService-2208"><span class="linenos">2208</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2209"><a href="#PumpWoodMicroService-2209"><span class="linenos">2209</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2210"><a href="#PumpWoodMicroService-2210"><span class="linenos">2210</span></a>
</span><span id="PumpWoodMicroService-2211"><a href="#PumpWoodMicroService-2211"><span class="linenos">2211</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2212"><a href="#PumpWoodMicroService-2212"><span class="linenos">2212</span></a><span class="sd">            Dictionary with keys:</span>
</span><span id="PumpWoodMicroService-2213"><a href="#PumpWoodMicroService-2213"><span class="linenos">2213</span></a><span class="sd">            - **default_list_fields:** Default list field defined on the</span>
</span><span id="PumpWoodMicroService-2214"><a href="#PumpWoodMicroService-2214"><span class="linenos">2214</span></a><span class="sd">                application backend.</span>
</span><span id="PumpWoodMicroService-2215"><a href="#PumpWoodMicroService-2215"><span class="linenos">2215</span></a><span class="sd">            - **field_descriptions:** Description of the fields associated</span>
</span><span id="PumpWoodMicroService-2216"><a href="#PumpWoodMicroService-2216"><span class="linenos">2216</span></a><span class="sd">                with the model class.</span>
</span><span id="PumpWoodMicroService-2217"><a href="#PumpWoodMicroService-2217"><span class="linenos">2217</span></a>
</span><span id="PumpWoodMicroService-2218"><a href="#PumpWoodMicroService-2218"><span class="linenos">2218</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2219"><a href="#PumpWoodMicroService-2219"><span class="linenos">2219</span></a><span class="sd">          No particular raise.</span>
</span><span id="PumpWoodMicroService-2220"><a href="#PumpWoodMicroService-2220"><span class="linenos">2220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2221"><a href="#PumpWoodMicroService-2221"><span class="linenos">2221</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2222"><a href="#PumpWoodMicroService-2222"><span class="linenos">2222</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2223"><a href="#PumpWoodMicroService-2223"><span class="linenos">2223</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2224"><a href="#PumpWoodMicroService-2224"><span class="linenos">2224</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2225"><a href="#PumpWoodMicroService-2225"><span class="linenos">2225</span></a>
</span><span id="PumpWoodMicroService-2226"><a href="#PumpWoodMicroService-2226"><span class="linenos">2226</span></a>    <span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2227"><a href="#PumpWoodMicroService-2227"><span class="linenos">2227</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2228"><a href="#PumpWoodMicroService-2228"><span class="linenos">2228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render retrieve views.</span>
</span><span id="PumpWoodMicroService-2229"><a href="#PumpWoodMicroService-2229"><span class="linenos">2229</span></a>
</span><span id="PumpWoodMicroService-2230"><a href="#PumpWoodMicroService-2230"><span class="linenos">2230</span></a><span class="sd">        Return information of the field sets that can be used to create</span>
</span><span id="PumpWoodMicroService-2231"><a href="#PumpWoodMicroService-2231"><span class="linenos">2231</span></a><span class="sd">        frontend site. It also return a `verbose_field` which can be used</span>
</span><span id="PumpWoodMicroService-2232"><a href="#PumpWoodMicroService-2232"><span class="linenos">2232</span></a><span class="sd">        to create the tittle of the page substituing the values with</span>
</span><span id="PumpWoodMicroService-2233"><a href="#PumpWoodMicroService-2233"><span class="linenos">2233</span></a><span class="sd">        information of the object.</span>
</span><span id="PumpWoodMicroService-2234"><a href="#PumpWoodMicroService-2234"><span class="linenos">2234</span></a>
</span><span id="PumpWoodMicroService-2235"><a href="#PumpWoodMicroService-2235"><span class="linenos">2235</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2236"><a href="#PumpWoodMicroService-2236"><span class="linenos">2236</span></a><span class="sd">          model_class:</span>
</span><span id="PumpWoodMicroService-2237"><a href="#PumpWoodMicroService-2237"><span class="linenos">2237</span></a><span class="sd">              Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService-2238"><a href="#PumpWoodMicroService-2238"><span class="linenos">2238</span></a><span class="sd">          auth_header:</span>
</span><span id="PumpWoodMicroService-2239"><a href="#PumpWoodMicroService-2239"><span class="linenos">2239</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2240"><a href="#PumpWoodMicroService-2240"><span class="linenos">2240</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2241"><a href="#PumpWoodMicroService-2241"><span class="linenos">2241</span></a>
</span><span id="PumpWoodMicroService-2242"><a href="#PumpWoodMicroService-2242"><span class="linenos">2242</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2243"><a href="#PumpWoodMicroService-2243"><span class="linenos">2243</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="PumpWoodMicroService-2244"><a href="#PumpWoodMicroService-2244"><span class="linenos">2244</span></a><span class="sd">            - **verbose_field:** String sugesting how the tittle of the</span>
</span><span id="PumpWoodMicroService-2245"><a href="#PumpWoodMicroService-2245"><span class="linenos">2245</span></a><span class="sd">                retrieve might be created. It will use Python format</span>
</span><span id="PumpWoodMicroService-2246"><a href="#PumpWoodMicroService-2246"><span class="linenos">2246</span></a><span class="sd">                information ex.: `&#39;{pk} | {description}&#39;`.</span>
</span><span id="PumpWoodMicroService-2247"><a href="#PumpWoodMicroService-2247"><span class="linenos">2247</span></a><span class="sd">            - **fieldset:** An dictinary with organization of data,</span>
</span><span id="PumpWoodMicroService-2248"><a href="#PumpWoodMicroService-2248"><span class="linenos">2248</span></a><span class="sd">                setting field sets that could be grouped toguether in</span>
</span><span id="PumpWoodMicroService-2249"><a href="#PumpWoodMicroService-2249"><span class="linenos">2249</span></a><span class="sd">                tabs.</span>
</span><span id="PumpWoodMicroService-2250"><a href="#PumpWoodMicroService-2250"><span class="linenos">2250</span></a>
</span><span id="PumpWoodMicroService-2251"><a href="#PumpWoodMicroService-2251"><span class="linenos">2251</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2252"><a href="#PumpWoodMicroService-2252"><span class="linenos">2252</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-2253"><a href="#PumpWoodMicroService-2253"><span class="linenos">2253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2254"><a href="#PumpWoodMicroService-2254"><span class="linenos">2254</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2255"><a href="#PumpWoodMicroService-2255"><span class="linenos">2255</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2256"><a href="#PumpWoodMicroService-2256"><span class="linenos">2256</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2257"><a href="#PumpWoodMicroService-2257"><span class="linenos">2257</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2258"><a href="#PumpWoodMicroService-2258"><span class="linenos">2258</span></a>
</span><span id="PumpWoodMicroService-2259"><a href="#PumpWoodMicroService-2259"><span class="linenos">2259</span></a>    <span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-2260"><a href="#PumpWoodMicroService-2260"><span class="linenos">2260</span></a>                        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2261"><a href="#PumpWoodMicroService-2261"><span class="linenos">2261</span></a>                        <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2262"><a href="#PumpWoodMicroService-2262"><span class="linenos">2262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="PumpWoodMicroService-2263"><a href="#PumpWoodMicroService-2263"><span class="linenos">2263</span></a>
</span><span id="PumpWoodMicroService-2264"><a href="#PumpWoodMicroService-2264"><span class="linenos">2264</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService-2265"><a href="#PumpWoodMicroService-2265"><span class="linenos">2265</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService-2266"><a href="#PumpWoodMicroService-2266"><span class="linenos">2266</span></a>
</span><span id="PumpWoodMicroService-2267"><a href="#PumpWoodMicroService-2267"><span class="linenos">2267</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2268"><a href="#PumpWoodMicroService-2268"><span class="linenos">2268</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2269"><a href="#PumpWoodMicroService-2269"><span class="linenos">2269</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService-2270"><a href="#PumpWoodMicroService-2270"><span class="linenos">2270</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2271"><a href="#PumpWoodMicroService-2271"><span class="linenos">2271</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2272"><a href="#PumpWoodMicroService-2272"><span class="linenos">2272</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2273"><a href="#PumpWoodMicroService-2273"><span class="linenos">2273</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="PumpWoodMicroService-2274"><a href="#PumpWoodMicroService-2274"><span class="linenos">2274</span></a><span class="sd">                Partial object data to be validated by the backend.</span>
</span><span id="PumpWoodMicroService-2275"><a href="#PumpWoodMicroService-2275"><span class="linenos">2275</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService-2276"><a href="#PumpWoodMicroService-2276"><span class="linenos">2276</span></a><span class="sd">                Set an especific field to be validated if implemented.</span>
</span><span id="PumpWoodMicroService-2277"><a href="#PumpWoodMicroService-2277"><span class="linenos">2277</span></a><span class="sd">            user_type:</span>
</span><span id="PumpWoodMicroService-2278"><a href="#PumpWoodMicroService-2278"><span class="linenos">2278</span></a><span class="sd">                Set the type of user is requesting fill validation. It is</span>
</span><span id="PumpWoodMicroService-2279"><a href="#PumpWoodMicroService-2279"><span class="linenos">2279</span></a><span class="sd">                possible to set `api` and `gui`. Gui user_type will return</span>
</span><span id="PumpWoodMicroService-2280"><a href="#PumpWoodMicroService-2280"><span class="linenos">2280</span></a><span class="sd">                fields listed in gui_readonly as read-only fields to</span>
</span><span id="PumpWoodMicroService-2281"><a href="#PumpWoodMicroService-2281"><span class="linenos">2281</span></a><span class="sd">                facilitate navegation.</span>
</span><span id="PumpWoodMicroService-2282"><a href="#PumpWoodMicroService-2282"><span class="linenos">2282</span></a>
</span><span id="PumpWoodMicroService-2283"><a href="#PumpWoodMicroService-2283"><span class="linenos">2283</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2284"><a href="#PumpWoodMicroService-2284"><span class="linenos">2284</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="PumpWoodMicroService-2285"><a href="#PumpWoodMicroService-2285"><span class="linenos">2285</span></a><span class="sd">            - **field_descriptions:** Same of fill_options, but setting as</span>
</span><span id="PumpWoodMicroService-2286"><a href="#PumpWoodMicroService-2286"><span class="linenos">2286</span></a><span class="sd">                read_only=True fields listed on gui_readonly if</span>
</span><span id="PumpWoodMicroService-2287"><a href="#PumpWoodMicroService-2287"><span class="linenos">2287</span></a><span class="sd">                user_type=&#39;gui&#39;.</span>
</span><span id="PumpWoodMicroService-2288"><a href="#PumpWoodMicroService-2288"><span class="linenos">2288</span></a><span class="sd">            - **gui_readonly:** Return a list of fields that will be</span>
</span><span id="PumpWoodMicroService-2289"><a href="#PumpWoodMicroService-2289"><span class="linenos">2289</span></a><span class="sd">                considered as read-only if user_type=&#39;gui&#39; is requested.</span>
</span><span id="PumpWoodMicroService-2290"><a href="#PumpWoodMicroService-2290"><span class="linenos">2290</span></a>
</span><span id="PumpWoodMicroService-2291"><a href="#PumpWoodMicroService-2291"><span class="linenos">2291</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2292"><a href="#PumpWoodMicroService-2292"><span class="linenos">2292</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-2293"><a href="#PumpWoodMicroService-2293"><span class="linenos">2293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2294"><a href="#PumpWoodMicroService-2294"><span class="linenos">2294</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2295"><a href="#PumpWoodMicroService-2295"><span class="linenos">2295</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2296"><a href="#PumpWoodMicroService-2296"><span class="linenos">2296</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-2297"><a href="#PumpWoodMicroService-2297"><span class="linenos">2297</span></a>        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2298"><a href="#PumpWoodMicroService-2298"><span class="linenos">2298</span></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService-2299"><a href="#PumpWoodMicroService-2299"><span class="linenos">2299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2300"><a href="#PumpWoodMicroService-2300"><span class="linenos">2300</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2301"><a href="#PumpWoodMicroService-2301"><span class="linenos">2301</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2302"><a href="#PumpWoodMicroService-2302"><span class="linenos">2302</span></a>
</span><span id="PumpWoodMicroService-2303"><a href="#PumpWoodMicroService-2303"><span class="linenos">2303</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-2304"><a href="#PumpWoodMicroService-2304"><span class="linenos">2304</span></a>    <span class="k">def</span> <span class="nf">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2305"><a href="#PumpWoodMicroService-2305"><span class="linenos">2305</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/pivot/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService-2306"><a href="#PumpWoodMicroService-2306"><span class="linenos">2306</span></a>
</span><span id="PumpWoodMicroService-2307"><a href="#PumpWoodMicroService-2307"><span class="linenos">2307</span></a>    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService-2308"><a href="#PumpWoodMicroService-2308"><span class="linenos">2308</span></a>              <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-2309"><a href="#PumpWoodMicroService-2309"><span class="linenos">2309</span></a>              <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService-2310"><a href="#PumpWoodMicroService-2310"><span class="linenos">2310</span></a>              <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2311"><a href="#PumpWoodMicroService-2311"><span class="linenos">2311</span></a>              <span class="n">add_pk_column</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2312"><a href="#PumpWoodMicroService-2312"><span class="linenos">2312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pivot object data acording to columns specified.</span>
</span><span id="PumpWoodMicroService-2313"><a href="#PumpWoodMicroService-2313"><span class="linenos">2313</span></a>
</span><span id="PumpWoodMicroService-2314"><a href="#PumpWoodMicroService-2314"><span class="linenos">2314</span></a><span class="sd">        Pivoting per-se is not usually used, beeing the name of the function</span>
</span><span id="PumpWoodMicroService-2315"><a href="#PumpWoodMicroService-2315"><span class="linenos">2315</span></a><span class="sd">        a legacy. Normality data transformation is done at the client level.</span>
</span><span id="PumpWoodMicroService-2316"><a href="#PumpWoodMicroService-2316"><span class="linenos">2316</span></a>
</span><span id="PumpWoodMicroService-2317"><a href="#PumpWoodMicroService-2317"><span class="linenos">2317</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2318"><a href="#PumpWoodMicroService-2318"><span class="linenos">2318</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService-2319"><a href="#PumpWoodMicroService-2319"><span class="linenos">2319</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService-2320"><a href="#PumpWoodMicroService-2320"><span class="linenos">2320</span></a><span class="sd">            columns (List[str]):</span>
</span><span id="PumpWoodMicroService-2321"><a href="#PumpWoodMicroService-2321"><span class="linenos">2321</span></a><span class="sd">                List of fields to be used as columns when pivoting the data.</span>
</span><span id="PumpWoodMicroService-2322"><a href="#PumpWoodMicroService-2322"><span class="linenos">2322</span></a><span class="sd">            format (str):</span>
</span><span id="PumpWoodMicroService-2323"><a href="#PumpWoodMicroService-2323"><span class="linenos">2323</span></a><span class="sd">                Format to be used to convert pandas.DataFrame to</span>
</span><span id="PumpWoodMicroService-2324"><a href="#PumpWoodMicroService-2324"><span class="linenos">2324</span></a><span class="sd">                dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
</span><span id="PumpWoodMicroService-2325"><a href="#PumpWoodMicroService-2325"><span class="linenos">2325</span></a><span class="sd">                &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
</span><span id="PumpWoodMicroService-2326"><a href="#PumpWoodMicroService-2326"><span class="linenos">2326</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService-2327"><a href="#PumpWoodMicroService-2327"><span class="linenos">2327</span></a><span class="sd">                Same as list function.</span>
</span><span id="PumpWoodMicroService-2328"><a href="#PumpWoodMicroService-2328"><span class="linenos">2328</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService-2329"><a href="#PumpWoodMicroService-2329"><span class="linenos">2329</span></a><span class="sd">                Same as list function.</span>
</span><span id="PumpWoodMicroService-2330"><a href="#PumpWoodMicroService-2330"><span class="linenos">2330</span></a><span class="sd">            order_by (List[str]):</span>
</span><span id="PumpWoodMicroService-2331"><a href="#PumpWoodMicroService-2331"><span class="linenos">2331</span></a><span class="sd">                 Same as list function.</span>
</span><span id="PumpWoodMicroService-2332"><a href="#PumpWoodMicroService-2332"><span class="linenos">2332</span></a><span class="sd">            variables (List[str]):</span>
</span><span id="PumpWoodMicroService-2333"><a href="#PumpWoodMicroService-2333"><span class="linenos">2333</span></a><span class="sd">                List of the fields to be returned, if None, the default</span>
</span><span id="PumpWoodMicroService-2334"><a href="#PumpWoodMicroService-2334"><span class="linenos">2334</span></a><span class="sd">                variables will be returned. Same as fields on list functions.</span>
</span><span id="PumpWoodMicroService-2335"><a href="#PumpWoodMicroService-2335"><span class="linenos">2335</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="PumpWoodMicroService-2336"><a href="#PumpWoodMicroService-2336"><span class="linenos">2336</span></a><span class="sd">                Fields with deleted column will have objects with deleted=True</span>
</span><span id="PumpWoodMicroService-2337"><a href="#PumpWoodMicroService-2337"><span class="linenos">2337</span></a><span class="sd">                omited from results. show_deleted=True will return this</span>
</span><span id="PumpWoodMicroService-2338"><a href="#PumpWoodMicroService-2338"><span class="linenos">2338</span></a><span class="sd">                information.</span>
</span><span id="PumpWoodMicroService-2339"><a href="#PumpWoodMicroService-2339"><span class="linenos">2339</span></a><span class="sd">            add_pk_column (bool):</span>
</span><span id="PumpWoodMicroService-2340"><a href="#PumpWoodMicroService-2340"><span class="linenos">2340</span></a><span class="sd">                If add pk values of the objects at pivot results. Adding</span>
</span><span id="PumpWoodMicroService-2341"><a href="#PumpWoodMicroService-2341"><span class="linenos">2341</span></a><span class="sd">                pk key on pivot end-points won&#39;t be possible to pivot since</span>
</span><span id="PumpWoodMicroService-2342"><a href="#PumpWoodMicroService-2342"><span class="linenos">2342</span></a><span class="sd">                pk is unique for each entry.</span>
</span><span id="PumpWoodMicroService-2343"><a href="#PumpWoodMicroService-2343"><span class="linenos">2343</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService-2344"><a href="#PumpWoodMicroService-2344"><span class="linenos">2344</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2345"><a href="#PumpWoodMicroService-2345"><span class="linenos">2345</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2346"><a href="#PumpWoodMicroService-2346"><span class="linenos">2346</span></a>
</span><span id="PumpWoodMicroService-2347"><a href="#PumpWoodMicroService-2347"><span class="linenos">2347</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2348"><a href="#PumpWoodMicroService-2348"><span class="linenos">2348</span></a><span class="sd">            Return a list or a dictinary depending on the format set on</span>
</span><span id="PumpWoodMicroService-2349"><a href="#PumpWoodMicroService-2349"><span class="linenos">2349</span></a><span class="sd">            format parameter.</span>
</span><span id="PumpWoodMicroService-2350"><a href="#PumpWoodMicroService-2350"><span class="linenos">2350</span></a>
</span><span id="PumpWoodMicroService-2351"><a href="#PumpWoodMicroService-2351"><span class="linenos">2351</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2352"><a href="#PumpWoodMicroService-2352"><span class="linenos">2352</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2353"><a href="#PumpWoodMicroService-2353"><span class="linenos">2353</span></a><span class="sd">                &#39;Columns must be a list of elements.&#39;. Indicates that the list</span>
</span><span id="PumpWoodMicroService-2354"><a href="#PumpWoodMicroService-2354"><span class="linenos">2354</span></a><span class="sd">                argument was not a list.</span>
</span><span id="PumpWoodMicroService-2355"><a href="#PumpWoodMicroService-2355"><span class="linenos">2355</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2356"><a href="#PumpWoodMicroService-2356"><span class="linenos">2356</span></a><span class="sd">                &#39;Column chosen as pivot is not at model variables&#39;. Indicates</span>
</span><span id="PumpWoodMicroService-2357"><a href="#PumpWoodMicroService-2357"><span class="linenos">2357</span></a><span class="sd">                that columns that were set to pivot are not present on model</span>
</span><span id="PumpWoodMicroService-2358"><a href="#PumpWoodMicroService-2358"><span class="linenos">2358</span></a><span class="sd">                variables.</span>
</span><span id="PumpWoodMicroService-2359"><a href="#PumpWoodMicroService-2359"><span class="linenos">2359</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2360"><a href="#PumpWoodMicroService-2360"><span class="linenos">2360</span></a><span class="sd">                &quot;Format must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,&#39;split&#39;,</span>
</span><span id="PumpWoodMicroService-2361"><a href="#PumpWoodMicroService-2361"><span class="linenos">2361</span></a><span class="sd">                &#39;records&#39;,&#39;index&#39;]&quot;. Indicates that format set as paramenter</span>
</span><span id="PumpWoodMicroService-2362"><a href="#PumpWoodMicroService-2362"><span class="linenos">2362</span></a><span class="sd">                is not implemented.</span>
</span><span id="PumpWoodMicroService-2363"><a href="#PumpWoodMicroService-2363"><span class="linenos">2363</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2364"><a href="#PumpWoodMicroService-2364"><span class="linenos">2364</span></a><span class="sd">                &quot;Can not add pk column and pivot information&quot;. If</span>
</span><span id="PumpWoodMicroService-2365"><a href="#PumpWoodMicroService-2365"><span class="linenos">2365</span></a><span class="sd">                add_pk_column is True (results will have the pk column), it is</span>
</span><span id="PumpWoodMicroService-2366"><a href="#PumpWoodMicroService-2366"><span class="linenos">2366</span></a><span class="sd">                not possible to pivot the information (pk is an unique value</span>
</span><span id="PumpWoodMicroService-2367"><a href="#PumpWoodMicroService-2367"><span class="linenos">2367</span></a><span class="sd">                for each object, there is no reason to pivot it).</span>
</span><span id="PumpWoodMicroService-2368"><a href="#PumpWoodMicroService-2368"><span class="linenos">2368</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2369"><a href="#PumpWoodMicroService-2369"><span class="linenos">2369</span></a><span class="sd">                &quot;&#39;value&#39; column not at melted data, it is not possible</span>
</span><span id="PumpWoodMicroService-2370"><a href="#PumpWoodMicroService-2370"><span class="linenos">2370</span></a><span class="sd">                to pivot dataframe.&quot;. Indicates that data does not have a value</span>
</span><span id="PumpWoodMicroService-2371"><a href="#PumpWoodMicroService-2371"><span class="linenos">2371</span></a><span class="sd">                column, it must have it to populate pivoted table.</span>
</span><span id="PumpWoodMicroService-2372"><a href="#PumpWoodMicroService-2372"><span class="linenos">2372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2373"><a href="#PumpWoodMicroService-2373"><span class="linenos">2373</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2374"><a href="#PumpWoodMicroService-2374"><span class="linenos">2374</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-2375"><a href="#PumpWoodMicroService-2375"><span class="linenos">2375</span></a>            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2376"><a href="#PumpWoodMicroService-2376"><span class="linenos">2376</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2377"><a href="#PumpWoodMicroService-2377"><span class="linenos">2377</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2378"><a href="#PumpWoodMicroService-2378"><span class="linenos">2378</span></a>            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span> <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="n">add_pk_column</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-2379"><a href="#PumpWoodMicroService-2379"><span class="linenos">2379</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2380"><a href="#PumpWoodMicroService-2380"><span class="linenos">2380</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2381"><a href="#PumpWoodMicroService-2381"><span class="linenos">2381</span></a>
</span><span id="PumpWoodMicroService-2382"><a href="#PumpWoodMicroService-2382"><span class="linenos">2382</span></a>    <span class="k">def</span> <span class="nf">_flat_list_by_chunks_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2383"><a href="#PumpWoodMicroService-2383"><span class="linenos">2383</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2384"><a href="#PumpWoodMicroService-2384"><span class="linenos">2384</span></a>            <span class="c1"># Unpacking arguments</span>
</span><span id="PumpWoodMicroService-2385"><a href="#PumpWoodMicroService-2385"><span class="linenos">2385</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2386"><a href="#PumpWoodMicroService-2386"><span class="linenos">2386</span></a>            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;filter_dict&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2387"><a href="#PumpWoodMicroService-2387"><span class="linenos">2387</span></a>            <span class="n">exclude_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;exclude_dict&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2388"><a href="#PumpWoodMicroService-2388"><span class="linenos">2388</span></a>            <span class="n">fields</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2389"><a href="#PumpWoodMicroService-2389"><span class="linenos">2389</span></a>            <span class="n">show_deleted</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2390"><a href="#PumpWoodMicroService-2390"><span class="linenos">2390</span></a>            <span class="n">auth_header</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;auth_header&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2391"><a href="#PumpWoodMicroService-2391"><span class="linenos">2391</span></a>            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2392"><a href="#PumpWoodMicroService-2392"><span class="linenos">2392</span></a>
</span><span id="PumpWoodMicroService-2393"><a href="#PumpWoodMicroService-2393"><span class="linenos">2393</span></a>            <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2394"><a href="#PumpWoodMicroService-2394"><span class="linenos">2394</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2395"><a href="#PumpWoodMicroService-2395"><span class="linenos">2395</span></a>            <span class="n">max_pk</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PumpWoodMicroService-2396"><a href="#PumpWoodMicroService-2396"><span class="linenos">2396</span></a>
</span><span id="PumpWoodMicroService-2397"><a href="#PumpWoodMicroService-2397"><span class="linenos">2397</span></a>            <span class="c1"># Fetch data until an empty result is returned</span>
</span><span id="PumpWoodMicroService-2398"><a href="#PumpWoodMicroService-2398"><span class="linenos">2398</span></a>            <span class="n">list_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-2399"><a href="#PumpWoodMicroService-2399"><span class="linenos">2399</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2400"><a href="#PumpWoodMicroService-2400"><span class="linenos">2400</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2401"><a href="#PumpWoodMicroService-2401"><span class="linenos">2401</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2402"><a href="#PumpWoodMicroService-2402"><span class="linenos">2402</span></a>                <span class="n">temp_filter_dict</span><span class="p">[</span><span class="s2">&quot;id__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_pk</span>
</span><span id="PumpWoodMicroService-2403"><a href="#PumpWoodMicroService-2403"><span class="linenos">2403</span></a>                <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-2404"><a href="#PumpWoodMicroService-2404"><span class="linenos">2404</span></a>                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2405"><a href="#PumpWoodMicroService-2405"><span class="linenos">2405</span></a>                    <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2406"><a href="#PumpWoodMicroService-2406"><span class="linenos">2406</span></a>                    <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2407"><a href="#PumpWoodMicroService-2407"><span class="linenos">2407</span></a>                    <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2408"><a href="#PumpWoodMicroService-2408"><span class="linenos">2408</span></a>                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2409"><a href="#PumpWoodMicroService-2409"><span class="linenos">2409</span></a>                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2410"><a href="#PumpWoodMicroService-2410"><span class="linenos">2410</span></a>                    <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="PumpWoodMicroService-2411"><a href="#PumpWoodMicroService-2411"><span class="linenos">2411</span></a>                <span class="n">temp_dateframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2412"><a href="#PumpWoodMicroService-2412"><span class="linenos">2412</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2413"><a href="#PumpWoodMicroService-2413"><span class="linenos">2413</span></a>
</span><span id="PumpWoodMicroService-2414"><a href="#PumpWoodMicroService-2414"><span class="linenos">2414</span></a>                <span class="c1"># Break if results are less than chunk size, so no more results</span>
</span><span id="PumpWoodMicroService-2415"><a href="#PumpWoodMicroService-2415"><span class="linenos">2415</span></a>                <span class="c1"># are avaiable</span>
</span><span id="PumpWoodMicroService-2416"><a href="#PumpWoodMicroService-2416"><span class="linenos">2416</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chunk_size</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2417"><a href="#PumpWoodMicroService-2417"><span class="linenos">2417</span></a>                    <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2418"><a href="#PumpWoodMicroService-2418"><span class="linenos">2418</span></a>                    <span class="k">break</span>
</span><span id="PumpWoodMicroService-2419"><a href="#PumpWoodMicroService-2419"><span class="linenos">2419</span></a>
</span><span id="PumpWoodMicroService-2420"><a href="#PumpWoodMicroService-2420"><span class="linenos">2420</span></a>                <span class="n">max_pk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2421"><a href="#PumpWoodMicroService-2421"><span class="linenos">2421</span></a>                <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2422"><a href="#PumpWoodMicroService-2422"><span class="linenos">2422</span></a>
</span><span id="PumpWoodMicroService-2423"><a href="#PumpWoodMicroService-2423"><span class="linenos">2423</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2424"><a href="#PumpWoodMicroService-2424"><span class="linenos">2424</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2425"><a href="#PumpWoodMicroService-2425"><span class="linenos">2425</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2426"><a href="#PumpWoodMicroService-2426"><span class="linenos">2426</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2427"><a href="#PumpWoodMicroService-2427"><span class="linenos">2427</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2428"><a href="#PumpWoodMicroService-2428"><span class="linenos">2428</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at flat_list_by_chunks:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2429"><a href="#PumpWoodMicroService-2429"><span class="linenos">2429</span></a>
</span><span id="PumpWoodMicroService-2430"><a href="#PumpWoodMicroService-2430"><span class="linenos">2430</span></a>    <span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-2431"><a href="#PumpWoodMicroService-2431"><span class="linenos">2431</span></a>                            <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2432"><a href="#PumpWoodMicroService-2432"><span class="linenos">2432</span></a>                            <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2433"><a href="#PumpWoodMicroService-2433"><span class="linenos">2433</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2434"><a href="#PumpWoodMicroService-2434"><span class="linenos">2434</span></a>                            <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2435"><a href="#PumpWoodMicroService-2435"><span class="linenos">2435</span></a>                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2436"><a href="#PumpWoodMicroService-2436"><span class="linenos">2436</span></a>                            <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2437"><a href="#PumpWoodMicroService-2437"><span class="linenos">2437</span></a>                            <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2438"><a href="#PumpWoodMicroService-2438"><span class="linenos">2438</span></a>                            <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2439"><a href="#PumpWoodMicroService-2439"><span class="linenos">2439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Incrementally fetch data from pivot end-point.</span>
</span><span id="PumpWoodMicroService-2440"><a href="#PumpWoodMicroService-2440"><span class="linenos">2440</span></a>
</span><span id="PumpWoodMicroService-2441"><a href="#PumpWoodMicroService-2441"><span class="linenos">2441</span></a><span class="sd">        Fetch data from pivot end-point paginating by id of chunk_size lenght.</span>
</span><span id="PumpWoodMicroService-2442"><a href="#PumpWoodMicroService-2442"><span class="linenos">2442</span></a>
</span><span id="PumpWoodMicroService-2443"><a href="#PumpWoodMicroService-2443"><span class="linenos">2443</span></a><span class="sd">        If table is partitioned it will split the query acording to partition</span>
</span><span id="PumpWoodMicroService-2444"><a href="#PumpWoodMicroService-2444"><span class="linenos">2444</span></a><span class="sd">        to facilitate query at the database.</span>
</span><span id="PumpWoodMicroService-2445"><a href="#PumpWoodMicroService-2445"><span class="linenos">2445</span></a>
</span><span id="PumpWoodMicroService-2446"><a href="#PumpWoodMicroService-2446"><span class="linenos">2446</span></a><span class="sd">        If start_date and end_date are set, also breaks the query by month</span>
</span><span id="PumpWoodMicroService-2447"><a href="#PumpWoodMicroService-2447"><span class="linenos">2447</span></a><span class="sd">        retrieving each month data in parallel.</span>
</span><span id="PumpWoodMicroService-2448"><a href="#PumpWoodMicroService-2448"><span class="linenos">2448</span></a>
</span><span id="PumpWoodMicroService-2449"><a href="#PumpWoodMicroService-2449"><span class="linenos">2449</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2450"><a href="#PumpWoodMicroService-2450"><span class="linenos">2450</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService-2451"><a href="#PumpWoodMicroService-2451"><span class="linenos">2451</span></a><span class="sd">                Model class to be pivoted.</span>
</span><span id="PumpWoodMicroService-2452"><a href="#PumpWoodMicroService-2452"><span class="linenos">2452</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService-2453"><a href="#PumpWoodMicroService-2453"><span class="linenos">2453</span></a><span class="sd">                Dictionary to to be used in objects.filter argument</span>
</span><span id="PumpWoodMicroService-2454"><a href="#PumpWoodMicroService-2454"><span class="linenos">2454</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="PumpWoodMicroService-2455"><a href="#PumpWoodMicroService-2455"><span class="linenos">2455</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService-2456"><a href="#PumpWoodMicroService-2456"><span class="linenos">2456</span></a><span class="sd">                Dictionary to to be used in objects.exclude argument</span>
</span><span id="PumpWoodMicroService-2457"><a href="#PumpWoodMicroService-2457"><span class="linenos">2457</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="PumpWoodMicroService-2458"><a href="#PumpWoodMicroService-2458"><span class="linenos">2458</span></a><span class="sd">            fields (List[str] | None):</span>
</span><span id="PumpWoodMicroService-2459"><a href="#PumpWoodMicroService-2459"><span class="linenos">2459</span></a><span class="sd">                List of the variables to be returned,</span>
</span><span id="PumpWoodMicroService-2460"><a href="#PumpWoodMicroService-2460"><span class="linenos">2460</span></a><span class="sd">                if None, the default variables will be returned.</span>
</span><span id="PumpWoodMicroService-2461"><a href="#PumpWoodMicroService-2461"><span class="linenos">2461</span></a><span class="sd">                If fields is set, dataframe will return that columns</span>
</span><span id="PumpWoodMicroService-2462"><a href="#PumpWoodMicroService-2462"><span class="linenos">2462</span></a><span class="sd">                even if data is empty.</span>
</span><span id="PumpWoodMicroService-2463"><a href="#PumpWoodMicroService-2463"><span class="linenos">2463</span></a><span class="sd">            start_date (datetime | str):</span>
</span><span id="PumpWoodMicroService-2464"><a href="#PumpWoodMicroService-2464"><span class="linenos">2464</span></a><span class="sd">                Set a begin date for the query. If begin and end date are</span>
</span><span id="PumpWoodMicroService-2465"><a href="#PumpWoodMicroService-2465"><span class="linenos">2465</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="PumpWoodMicroService-2466"><a href="#PumpWoodMicroService-2466"><span class="linenos">2466</span></a><span class="sd">                requested in parallel.</span>
</span><span id="PumpWoodMicroService-2467"><a href="#PumpWoodMicroService-2467"><span class="linenos">2467</span></a><span class="sd">            end_date (datetime | str):</span>
</span><span id="PumpWoodMicroService-2468"><a href="#PumpWoodMicroService-2468"><span class="linenos">2468</span></a><span class="sd">                Set a end date for the query. If begin and end date are</span>
</span><span id="PumpWoodMicroService-2469"><a href="#PumpWoodMicroService-2469"><span class="linenos">2469</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="PumpWoodMicroService-2470"><a href="#PumpWoodMicroService-2470"><span class="linenos">2470</span></a><span class="sd">                requested in parallel.</span>
</span><span id="PumpWoodMicroService-2471"><a href="#PumpWoodMicroService-2471"><span class="linenos">2471</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="PumpWoodMicroService-2472"><a href="#PumpWoodMicroService-2472"><span class="linenos">2472</span></a><span class="sd">                If deleted data should be returned.</span>
</span><span id="PumpWoodMicroService-2473"><a href="#PumpWoodMicroService-2473"><span class="linenos">2473</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService-2474"><a href="#PumpWoodMicroService-2474"><span class="linenos">2474</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2475"><a href="#PumpWoodMicroService-2475"><span class="linenos">2475</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2476"><a href="#PumpWoodMicroService-2476"><span class="linenos">2476</span></a><span class="sd">            chunk_size (int):</span>
</span><span id="PumpWoodMicroService-2477"><a href="#PumpWoodMicroService-2477"><span class="linenos">2477</span></a><span class="sd">                Limit of data to fetch per call.</span>
</span><span id="PumpWoodMicroService-2478"><a href="#PumpWoodMicroService-2478"><span class="linenos">2478</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="PumpWoodMicroService-2479"><a href="#PumpWoodMicroService-2479"><span class="linenos">2479</span></a><span class="sd">                Number of parallel process to perform.</span>
</span><span id="PumpWoodMicroService-2480"><a href="#PumpWoodMicroService-2480"><span class="linenos">2480</span></a><span class="sd">            create_composite_pk (bool):</span>
</span><span id="PumpWoodMicroService-2481"><a href="#PumpWoodMicroService-2481"><span class="linenos">2481</span></a><span class="sd">                If true and table has a composite pk, it will create pk</span>
</span><span id="PumpWoodMicroService-2482"><a href="#PumpWoodMicroService-2482"><span class="linenos">2482</span></a><span class="sd">                value based on the hash on the json serialized dictionary</span>
</span><span id="PumpWoodMicroService-2483"><a href="#PumpWoodMicroService-2483"><span class="linenos">2483</span></a><span class="sd">                of the components of the primary key.</span>
</span><span id="PumpWoodMicroService-2484"><a href="#PumpWoodMicroService-2484"><span class="linenos">2484</span></a>
</span><span id="PumpWoodMicroService-2485"><a href="#PumpWoodMicroService-2485"><span class="linenos">2485</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2486"><a href="#PumpWoodMicroService-2486"><span class="linenos">2486</span></a><span class="sd">            Returns a dataframe with all information fetched.</span>
</span><span id="PumpWoodMicroService-2487"><a href="#PumpWoodMicroService-2487"><span class="linenos">2487</span></a>
</span><span id="PumpWoodMicroService-2488"><a href="#PumpWoodMicroService-2488"><span class="linenos">2488</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2489"><a href="#PumpWoodMicroService-2489"><span class="linenos">2489</span></a><span class="sd">            No particular raise.</span>
</span><span id="PumpWoodMicroService-2490"><a href="#PumpWoodMicroService-2490"><span class="linenos">2490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2491"><a href="#PumpWoodMicroService-2491"><span class="linenos">2491</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2492"><a href="#PumpWoodMicroService-2492"><span class="linenos">2492</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2493"><a href="#PumpWoodMicroService-2493"><span class="linenos">2493</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2494"><a href="#PumpWoodMicroService-2494"><span class="linenos">2494</span></a>
</span><span id="PumpWoodMicroService-2495"><a href="#PumpWoodMicroService-2495"><span class="linenos">2495</span></a>        <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2496"><a href="#PumpWoodMicroService-2496"><span class="linenos">2496</span></a>        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2497"><a href="#PumpWoodMicroService-2497"><span class="linenos">2497</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2498"><a href="#PumpWoodMicroService-2498"><span class="linenos">2498</span></a>        <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2499"><a href="#PumpWoodMicroService-2499"><span class="linenos">2499</span></a>        <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="PumpWoodMicroService-2500"><a href="#PumpWoodMicroService-2500"><span class="linenos">2500</span></a>
</span><span id="PumpWoodMicroService-2501"><a href="#PumpWoodMicroService-2501"><span class="linenos">2501</span></a>        <span class="c1"># Create a list of month and include start and end dates if not at</span>
</span><span id="PumpWoodMicroService-2502"><a href="#PumpWoodMicroService-2502"><span class="linenos">2502</span></a>        <span class="c1"># the beginning of a month</span>
</span><span id="PumpWoodMicroService-2503"><a href="#PumpWoodMicroService-2503"><span class="linenos">2503</span></a>        <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-2504"><a href="#PumpWoodMicroService-2504"><span class="linenos">2504</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2505"><a href="#PumpWoodMicroService-2505"><span class="linenos">2505</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2506"><a href="#PumpWoodMicroService-2506"><span class="linenos">2506</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2507"><a href="#PumpWoodMicroService-2507"><span class="linenos">2507</span></a>            <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2508"><a href="#PumpWoodMicroService-2508"><span class="linenos">2508</span></a>                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2509"><a href="#PumpWoodMicroService-2509"><span class="linenos">2509</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2510"><a href="#PumpWoodMicroService-2510"><span class="linenos">2510</span></a>                <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2511"><a href="#PumpWoodMicroService-2511"><span class="linenos">2511</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2512"><a href="#PumpWoodMicroService-2512"><span class="linenos">2512</span></a>
</span><span id="PumpWoodMicroService-2513"><a href="#PumpWoodMicroService-2513"><span class="linenos">2513</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2514"><a href="#PumpWoodMicroService-2514"><span class="linenos">2514</span></a>            <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2515"><a href="#PumpWoodMicroService-2515"><span class="linenos">2515</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2516"><a href="#PumpWoodMicroService-2516"><span class="linenos">2516</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2517"><a href="#PumpWoodMicroService-2517"><span class="linenos">2517</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2518"><a href="#PumpWoodMicroService-2518"><span class="linenos">2518</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2519"><a href="#PumpWoodMicroService-2519"><span class="linenos">2519</span></a>                <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
</span><span id="PumpWoodMicroService-2520"><a href="#PumpWoodMicroService-2520"><span class="linenos">2520</span></a>                <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService-2521"><a href="#PumpWoodMicroService-2521"><span class="linenos">2521</span></a>                <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService-2522"><a href="#PumpWoodMicroService-2522"><span class="linenos">2522</span></a>                <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2523"><a href="#PumpWoodMicroService-2523"><span class="linenos">2523</span></a>                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2524"><a href="#PumpWoodMicroService-2524"><span class="linenos">2524</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2525"><a href="#PumpWoodMicroService-2525"><span class="linenos">2525</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-2526"><a href="#PumpWoodMicroService-2526"><span class="linenos">2526</span></a>                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2527"><a href="#PumpWoodMicroService-2527"><span class="linenos">2527</span></a>                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2528"><a href="#PumpWoodMicroService-2528"><span class="linenos">2528</span></a>
</span><span id="PumpWoodMicroService-2529"><a href="#PumpWoodMicroService-2529"><span class="linenos">2529</span></a>        <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2530"><a href="#PumpWoodMicroService-2530"><span class="linenos">2530</span></a>
</span><span id="PumpWoodMicroService-2531"><a href="#PumpWoodMicroService-2531"><span class="linenos">2531</span></a>        <span class="c1">##########################################################</span>
</span><span id="PumpWoodMicroService-2532"><a href="#PumpWoodMicroService-2532"><span class="linenos">2532</span></a>        <span class="c1"># If table have more than one partition, run in parallel #</span>
</span><span id="PumpWoodMicroService-2533"><a href="#PumpWoodMicroService-2533"><span class="linenos">2533</span></a>        <span class="c1"># the {partition}__in elements along with dates          #</span>
</span><span id="PumpWoodMicroService-2534"><a href="#PumpWoodMicroService-2534"><span class="linenos">2534</span></a>        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2535"><a href="#PumpWoodMicroService-2535"><span class="linenos">2535</span></a>            <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2536"><a href="#PumpWoodMicroService-2536"><span class="linenos">2536</span></a>            <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="PumpWoodMicroService-2537"><a href="#PumpWoodMicroService-2537"><span class="linenos">2537</span></a>            <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-2538"><a href="#PumpWoodMicroService-2538"><span class="linenos">2538</span></a>            <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PumpWoodMicroService-2539"><a href="#PumpWoodMicroService-2539"><span class="linenos">2539</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2540"><a href="#PumpWoodMicroService-2540"><span class="linenos">2540</span></a>                <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2541"><a href="#PumpWoodMicroService-2541"><span class="linenos">2541</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2542"><a href="#PumpWoodMicroService-2542"><span class="linenos">2542</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2543"><a href="#PumpWoodMicroService-2543"><span class="linenos">2543</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2544"><a href="#PumpWoodMicroService-2544"><span class="linenos">2544</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService-2545"><a href="#PumpWoodMicroService-2545"><span class="linenos">2545</span></a>                <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2546"><a href="#PumpWoodMicroService-2546"><span class="linenos">2546</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
</span><span id="PumpWoodMicroService-2547"><a href="#PumpWoodMicroService-2547"><span class="linenos">2547</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2548"><a href="#PumpWoodMicroService-2548"><span class="linenos">2548</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2549"><a href="#PumpWoodMicroService-2549"><span class="linenos">2549</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService-2550"><a href="#PumpWoodMicroService-2550"><span class="linenos">2550</span></a>
</span><span id="PumpWoodMicroService-2551"><a href="#PumpWoodMicroService-2551"><span class="linenos">2551</span></a>            <span class="c1"># Validating query for partitioned tables</span>
</span><span id="PumpWoodMicroService-2552"><a href="#PumpWoodMicroService-2552"><span class="linenos">2552</span></a>            <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2553"><a href="#PumpWoodMicroService-2553"><span class="linenos">2553</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2554"><a href="#PumpWoodMicroService-2554"><span class="linenos">2554</span></a>                    <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
</span><span id="PumpWoodMicroService-2555"><a href="#PumpWoodMicroService-2555"><span class="linenos">2555</span></a>                    <span class="s2">&quot;queries without at least first level partition will &quot;</span>
</span><span id="PumpWoodMicroService-2556"><a href="#PumpWoodMicroService-2556"><span class="linenos">2556</span></a>                    <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
</span><span id="PumpWoodMicroService-2557"><a href="#PumpWoodMicroService-2557"><span class="linenos">2557</span></a>                    <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
</span><span id="PumpWoodMicroService-2558"><a href="#PumpWoodMicroService-2558"><span class="linenos">2558</span></a>                    <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService-2559"><a href="#PumpWoodMicroService-2559"><span class="linenos">2559</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2560"><a href="#PumpWoodMicroService-2560"><span class="linenos">2560</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2561"><a href="#PumpWoodMicroService-2561"><span class="linenos">2561</span></a>
</span><span id="PumpWoodMicroService-2562"><a href="#PumpWoodMicroService-2562"><span class="linenos">2562</span></a>            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2563"><a href="#PumpWoodMicroService-2563"><span class="linenos">2563</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2564"><a href="#PumpWoodMicroService-2564"><span class="linenos">2564</span></a>                    <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
</span><span id="PumpWoodMicroService-2565"><a href="#PumpWoodMicroService-2565"><span class="linenos">2565</span></a>                    <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2566"><a href="#PumpWoodMicroService-2566"><span class="linenos">2566</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2567"><a href="#PumpWoodMicroService-2567"><span class="linenos">2567</span></a>
</span><span id="PumpWoodMicroService-2568"><a href="#PumpWoodMicroService-2568"><span class="linenos">2568</span></a>            <span class="c1"># Parallelizing query using partition columns</span>
</span><span id="PumpWoodMicroService-2569"><a href="#PumpWoodMicroService-2569"><span class="linenos">2569</span></a>            <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-2570"><a href="#PumpWoodMicroService-2570"><span class="linenos">2570</span></a>            <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2571"><a href="#PumpWoodMicroService-2571"><span class="linenos">2571</span></a>                <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2572"><a href="#PumpWoodMicroService-2572"><span class="linenos">2572</span></a>                <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
</span><span id="PumpWoodMicroService-2573"><a href="#PumpWoodMicroService-2573"><span class="linenos">2573</span></a>                <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2574"><a href="#PumpWoodMicroService-2574"><span class="linenos">2574</span></a>                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2575"><a href="#PumpWoodMicroService-2575"><span class="linenos">2575</span></a>                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2576"><a href="#PumpWoodMicroService-2576"><span class="linenos">2576</span></a>                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2577"><a href="#PumpWoodMicroService-2577"><span class="linenos">2577</span></a>                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2578"><a href="#PumpWoodMicroService-2578"><span class="linenos">2578</span></a>                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2579"><a href="#PumpWoodMicroService-2579"><span class="linenos">2579</span></a>                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2580"><a href="#PumpWoodMicroService-2580"><span class="linenos">2580</span></a>                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2581"><a href="#PumpWoodMicroService-2581"><span class="linenos">2581</span></a>                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2582"><a href="#PumpWoodMicroService-2582"><span class="linenos">2582</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2583"><a href="#PumpWoodMicroService-2583"><span class="linenos">2583</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService-2584"><a href="#PumpWoodMicroService-2584"><span class="linenos">2584</span></a>                        <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2585"><a href="#PumpWoodMicroService-2585"><span class="linenos">2585</span></a>                            <span class="n">request_filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2586"><a href="#PumpWoodMicroService-2586"><span class="linenos">2586</span></a>                        <span class="c1"># If is not the last interval, query using open</span>
</span><span id="PumpWoodMicroService-2587"><a href="#PumpWoodMicroService-2587"><span class="linenos">2587</span></a>                        <span class="c1"># right interval so subsequence queries does</span>
</span><span id="PumpWoodMicroService-2588"><a href="#PumpWoodMicroService-2588"><span class="linenos">2588</span></a>                        <span class="c1"># not overlap</span>
</span><span id="PumpWoodMicroService-2589"><a href="#PumpWoodMicroService-2589"><span class="linenos">2589</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2590"><a href="#PumpWoodMicroService-2590"><span class="linenos">2590</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2591"><a href="#PumpWoodMicroService-2591"><span class="linenos">2591</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2592"><a href="#PumpWoodMicroService-2592"><span class="linenos">2592</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2593"><a href="#PumpWoodMicroService-2593"><span class="linenos">2593</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2594"><a href="#PumpWoodMicroService-2594"><span class="linenos">2594</span></a>
</span><span id="PumpWoodMicroService-2595"><a href="#PumpWoodMicroService-2595"><span class="linenos">2595</span></a>                        <span class="c1"># At the last interval use closed right interval so</span>
</span><span id="PumpWoodMicroService-2596"><a href="#PumpWoodMicroService-2596"><span class="linenos">2596</span></a>                        <span class="c1"># last element is also included in the interval</span>
</span><span id="PumpWoodMicroService-2597"><a href="#PumpWoodMicroService-2597"><span class="linenos">2597</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2598"><a href="#PumpWoodMicroService-2598"><span class="linenos">2598</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2599"><a href="#PumpWoodMicroService-2599"><span class="linenos">2599</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2600"><a href="#PumpWoodMicroService-2600"><span class="linenos">2600</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService-2601"><a href="#PumpWoodMicroService-2601"><span class="linenos">2601</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2602"><a href="#PumpWoodMicroService-2602"><span class="linenos">2602</span></a>
</span><span id="PumpWoodMicroService-2603"><a href="#PumpWoodMicroService-2603"><span class="linenos">2603</span></a>                        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2604"><a href="#PumpWoodMicroService-2604"><span class="linenos">2604</span></a>                            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2605"><a href="#PumpWoodMicroService-2605"><span class="linenos">2605</span></a>                            <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2606"><a href="#PumpWoodMicroService-2606"><span class="linenos">2606</span></a>                            <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2607"><a href="#PumpWoodMicroService-2607"><span class="linenos">2607</span></a>                            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2608"><a href="#PumpWoodMicroService-2608"><span class="linenos">2608</span></a>                            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2609"><a href="#PumpWoodMicroService-2609"><span class="linenos">2609</span></a>                            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2610"><a href="#PumpWoodMicroService-2610"><span class="linenos">2610</span></a>                            <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2611"><a href="#PumpWoodMicroService-2611"><span class="linenos">2611</span></a>
</span><span id="PumpWoodMicroService-2612"><a href="#PumpWoodMicroService-2612"><span class="linenos">2612</span></a>            <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
</span><span id="PumpWoodMicroService-2613"><a href="#PumpWoodMicroService-2613"><span class="linenos">2613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2614"><a href="#PumpWoodMicroService-2614"><span class="linenos">2614</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2615"><a href="#PumpWoodMicroService-2615"><span class="linenos">2615</span></a>                <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2616"><a href="#PumpWoodMicroService-2616"><span class="linenos">2616</span></a>                    <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2617"><a href="#PumpWoodMicroService-2617"><span class="linenos">2617</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2618"><a href="#PumpWoodMicroService-2618"><span class="linenos">2618</span></a>                        <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2619"><a href="#PumpWoodMicroService-2619"><span class="linenos">2619</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2620"><a href="#PumpWoodMicroService-2620"><span class="linenos">2620</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2621"><a href="#PumpWoodMicroService-2621"><span class="linenos">2621</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2622"><a href="#PumpWoodMicroService-2622"><span class="linenos">2622</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2623"><a href="#PumpWoodMicroService-2623"><span class="linenos">2623</span></a>
</span><span id="PumpWoodMicroService-2624"><a href="#PumpWoodMicroService-2624"><span class="linenos">2624</span></a>        <span class="c1">############################################</span>
</span><span id="PumpWoodMicroService-2625"><a href="#PumpWoodMicroService-2625"><span class="linenos">2625</span></a>        <span class="c1"># If table have partition, run in parallel #</span>
</span><span id="PumpWoodMicroService-2626"><a href="#PumpWoodMicroService-2626"><span class="linenos">2626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2627"><a href="#PumpWoodMicroService-2627"><span class="linenos">2627</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2628"><a href="#PumpWoodMicroService-2628"><span class="linenos">2628</span></a>                <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2629"><a href="#PumpWoodMicroService-2629"><span class="linenos">2629</span></a>                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2630"><a href="#PumpWoodMicroService-2630"><span class="linenos">2630</span></a>                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2631"><a href="#PumpWoodMicroService-2631"><span class="linenos">2631</span></a>                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2632"><a href="#PumpWoodMicroService-2632"><span class="linenos">2632</span></a>                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2633"><a href="#PumpWoodMicroService-2633"><span class="linenos">2633</span></a>                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2634"><a href="#PumpWoodMicroService-2634"><span class="linenos">2634</span></a>                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2635"><a href="#PumpWoodMicroService-2635"><span class="linenos">2635</span></a>                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2636"><a href="#PumpWoodMicroService-2636"><span class="linenos">2636</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
</span><span id="PumpWoodMicroService-2637"><a href="#PumpWoodMicroService-2637"><span class="linenos">2637</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2638"><a href="#PumpWoodMicroService-2638"><span class="linenos">2638</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2639"><a href="#PumpWoodMicroService-2639"><span class="linenos">2639</span></a>
</span><span id="PumpWoodMicroService-2640"><a href="#PumpWoodMicroService-2640"><span class="linenos">2640</span></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2641"><a href="#PumpWoodMicroService-2641"><span class="linenos">2641</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2642"><a href="#PumpWoodMicroService-2642"><span class="linenos">2642</span></a>            <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2643"><a href="#PumpWoodMicroService-2643"><span class="linenos">2643</span></a>                <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2644"><a href="#PumpWoodMicroService-2644"><span class="linenos">2644</span></a>                <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2645"><a href="#PumpWoodMicroService-2645"><span class="linenos">2645</span></a>            <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2646"><a href="#PumpWoodMicroService-2646"><span class="linenos">2646</span></a>                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService-2647"><a href="#PumpWoodMicroService-2647"><span class="linenos">2647</span></a>
</span><span id="PumpWoodMicroService-2648"><a href="#PumpWoodMicroService-2648"><span class="linenos">2648</span></a>        <span class="c1"># Adjust columns to return the columns set at fields</span>
</span><span id="PumpWoodMicroService-2649"><a href="#PumpWoodMicroService-2649"><span class="linenos">2649</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2650"><a href="#PumpWoodMicroService-2650"><span class="linenos">2650</span></a>            <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2651"><a href="#PumpWoodMicroService-2651"><span class="linenos">2651</span></a>        <span class="k">return</span> <span class="n">resp_df</span>
</span><span id="PumpWoodMicroService-2652"><a href="#PumpWoodMicroService-2652"><span class="linenos">2652</span></a>
</span><span id="PumpWoodMicroService-2653"><a href="#PumpWoodMicroService-2653"><span class="linenos">2653</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-2654"><a href="#PumpWoodMicroService-2654"><span class="linenos">2654</span></a>    <span class="k">def</span> <span class="nf">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2655"><a href="#PumpWoodMicroService-2655"><span class="linenos">2655</span></a>        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/bulk-save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
</span><span id="PumpWoodMicroService-2656"><a href="#PumpWoodMicroService-2656"><span class="linenos">2656</span></a>
</span><span id="PumpWoodMicroService-2657"><a href="#PumpWoodMicroService-2657"><span class="linenos">2657</span></a>    <span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2658"><a href="#PumpWoodMicroService-2658"><span class="linenos">2658</span></a>                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2659"><a href="#PumpWoodMicroService-2659"><span class="linenos">2659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a list of objects with one request.</span>
</span><span id="PumpWoodMicroService-2660"><a href="#PumpWoodMicroService-2660"><span class="linenos">2660</span></a>
</span><span id="PumpWoodMicroService-2661"><a href="#PumpWoodMicroService-2661"><span class="linenos">2661</span></a><span class="sd">        It is used with a unique call save many objects at the same time. It</span>
</span><span id="PumpWoodMicroService-2662"><a href="#PumpWoodMicroService-2662"><span class="linenos">2662</span></a><span class="sd">        is necessary that the end-point is able to receive bulk save requests</span>
</span><span id="PumpWoodMicroService-2663"><a href="#PumpWoodMicroService-2663"><span class="linenos">2663</span></a><span class="sd">        and all objects been of the same model class.</span>
</span><span id="PumpWoodMicroService-2664"><a href="#PumpWoodMicroService-2664"><span class="linenos">2664</span></a>
</span><span id="PumpWoodMicroService-2665"><a href="#PumpWoodMicroService-2665"><span class="linenos">2665</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2666"><a href="#PumpWoodMicroService-2666"><span class="linenos">2666</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2667"><a href="#PumpWoodMicroService-2667"><span class="linenos">2667</span></a><span class="sd">                Data model class.</span>
</span><span id="PumpWoodMicroService-2668"><a href="#PumpWoodMicroService-2668"><span class="linenos">2668</span></a><span class="sd">            data_to_save:</span>
</span><span id="PumpWoodMicroService-2669"><a href="#PumpWoodMicroService-2669"><span class="linenos">2669</span></a><span class="sd">                A list of objects to be saved.</span>
</span><span id="PumpWoodMicroService-2670"><a href="#PumpWoodMicroService-2670"><span class="linenos">2670</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2671"><a href="#PumpWoodMicroService-2671"><span class="linenos">2671</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2672"><a href="#PumpWoodMicroService-2672"><span class="linenos">2672</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2673"><a href="#PumpWoodMicroService-2673"><span class="linenos">2673</span></a>
</span><span id="PumpWoodMicroService-2674"><a href="#PumpWoodMicroService-2674"><span class="linenos">2674</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2675"><a href="#PumpWoodMicroService-2675"><span class="linenos">2675</span></a><span class="sd">            A dictinary with `saved_count` as key indicating the number of</span>
</span><span id="PumpWoodMicroService-2676"><a href="#PumpWoodMicroService-2676"><span class="linenos">2676</span></a><span class="sd">            objects that were saved in database.</span>
</span><span id="PumpWoodMicroService-2677"><a href="#PumpWoodMicroService-2677"><span class="linenos">2677</span></a>
</span><span id="PumpWoodMicroService-2678"><a href="#PumpWoodMicroService-2678"><span class="linenos">2678</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2679"><a href="#PumpWoodMicroService-2679"><span class="linenos">2679</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2680"><a href="#PumpWoodMicroService-2680"><span class="linenos">2680</span></a><span class="sd">                &#39;Expected columns and data columns do not match: Expected</span>
</span><span id="PumpWoodMicroService-2681"><a href="#PumpWoodMicroService-2681"><span class="linenos">2681</span></a><span class="sd">                columns: {expected} Data columns: {data_cols}&#39;. Indicates</span>
</span><span id="PumpWoodMicroService-2682"><a href="#PumpWoodMicroService-2682"><span class="linenos">2682</span></a><span class="sd">                that the expected fields of the object were not met at the</span>
</span><span id="PumpWoodMicroService-2683"><a href="#PumpWoodMicroService-2683"><span class="linenos">2683</span></a><span class="sd">                objects passed to save.</span>
</span><span id="PumpWoodMicroService-2684"><a href="#PumpWoodMicroService-2684"><span class="linenos">2684</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2685"><a href="#PumpWoodMicroService-2685"><span class="linenos">2685</span></a><span class="sd">                Other sqlalchemy and psycopg2 errors not associated with</span>
</span><span id="PumpWoodMicroService-2686"><a href="#PumpWoodMicroService-2686"><span class="linenos">2686</span></a><span class="sd">                IntegrityError.</span>
</span><span id="PumpWoodMicroService-2687"><a href="#PumpWoodMicroService-2687"><span class="linenos">2687</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2688"><a href="#PumpWoodMicroService-2688"><span class="linenos">2688</span></a><span class="sd">                &#39;Bulk save not avaiable.&#39;. Indicates that Bulk save end-point</span>
</span><span id="PumpWoodMicroService-2689"><a href="#PumpWoodMicroService-2689"><span class="linenos">2689</span></a><span class="sd">                was not configured for this model_class.</span>
</span><span id="PumpWoodMicroService-2690"><a href="#PumpWoodMicroService-2690"><span class="linenos">2690</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="PumpWoodMicroService-2691"><a href="#PumpWoodMicroService-2691"><span class="linenos">2691</span></a><span class="sd">                Raise integrity errors from sqlalchemy and psycopg2. Usually</span>
</span><span id="PumpWoodMicroService-2692"><a href="#PumpWoodMicroService-2692"><span class="linenos">2692</span></a><span class="sd">                associated with uniqueness of some column.</span>
</span><span id="PumpWoodMicroService-2693"><a href="#PumpWoodMicroService-2693"><span class="linenos">2693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2694"><a href="#PumpWoodMicroService-2694"><span class="linenos">2694</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2695"><a href="#PumpWoodMicroService-2695"><span class="linenos">2695</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2696"><a href="#PumpWoodMicroService-2696"><span class="linenos">2696</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2697"><a href="#PumpWoodMicroService-2697"><span class="linenos">2697</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2698"><a href="#PumpWoodMicroService-2698"><span class="linenos">2698</span></a>
</span><span id="PumpWoodMicroService-2699"><a href="#PumpWoodMicroService-2699"><span class="linenos">2699</span></a>    <span class="c1">########################</span>
</span><span id="PumpWoodMicroService-2700"><a href="#PumpWoodMicroService-2700"><span class="linenos">2700</span></a>    <span class="c1"># Parallel aux functions</span>
</span><span id="PumpWoodMicroService-2701"><a href="#PumpWoodMicroService-2701"><span class="linenos">2701</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService-2702"><a href="#PumpWoodMicroService-2702"><span class="linenos">2702</span></a>    <span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2703"><a href="#PumpWoodMicroService-2703"><span class="linenos">2703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Concat all parallel return to one list.</span>
</span><span id="PumpWoodMicroService-2704"><a href="#PumpWoodMicroService-2704"><span class="linenos">2704</span></a>
</span><span id="PumpWoodMicroService-2705"><a href="#PumpWoodMicroService-2705"><span class="linenos">2705</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2706"><a href="#PumpWoodMicroService-2706"><span class="linenos">2706</span></a><span class="sd">            parallel_result:</span>
</span><span id="PumpWoodMicroService-2707"><a href="#PumpWoodMicroService-2707"><span class="linenos">2707</span></a><span class="sd">                A list of lists to be flated (concatenate</span>
</span><span id="PumpWoodMicroService-2708"><a href="#PumpWoodMicroService-2708"><span class="linenos">2708</span></a><span class="sd">                all lists into one).</span>
</span><span id="PumpWoodMicroService-2709"><a href="#PumpWoodMicroService-2709"><span class="linenos">2709</span></a>
</span><span id="PumpWoodMicroService-2710"><a href="#PumpWoodMicroService-2710"><span class="linenos">2710</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2711"><a href="#PumpWoodMicroService-2711"><span class="linenos">2711</span></a><span class="sd">            A list with all sub list itens.</span>
</span><span id="PumpWoodMicroService-2712"><a href="#PumpWoodMicroService-2712"><span class="linenos">2712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2713"><a href="#PumpWoodMicroService-2713"><span class="linenos">2713</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-2714"><a href="#PumpWoodMicroService-2714"><span class="linenos">2714</span></a>            <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
</span><span id="PumpWoodMicroService-2715"><a href="#PumpWoodMicroService-2715"><span class="linenos">2715</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-2716"><a href="#PumpWoodMicroService-2716"><span class="linenos">2716</span></a>
</span><span id="PumpWoodMicroService-2717"><a href="#PumpWoodMicroService-2717"><span class="linenos">2717</span></a>    <span class="k">def</span> <span class="nf">_request_get_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2718"><a href="#PumpWoodMicroService-2718"><span class="linenos">2718</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2719"><a href="#PumpWoodMicroService-2719"><span class="linenos">2719</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2720"><a href="#PumpWoodMicroService-2720"><span class="linenos">2720</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2721"><a href="#PumpWoodMicroService-2721"><span class="linenos">2721</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2722"><a href="#PumpWoodMicroService-2722"><span class="linenos">2722</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-2723"><a href="#PumpWoodMicroService-2723"><span class="linenos">2723</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2724"><a href="#PumpWoodMicroService-2724"><span class="linenos">2724</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error on parallel get: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2725"><a href="#PumpWoodMicroService-2725"><span class="linenos">2725</span></a>
</span><span id="PumpWoodMicroService-2726"><a href="#PumpWoodMicroService-2726"><span class="linenos">2726</span></a>    <span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2727"><a href="#PumpWoodMicroService-2727"><span class="linenos">2727</span></a>                             <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2728"><a href="#PumpWoodMicroService-2728"><span class="linenos">2728</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-2729"><a href="#PumpWoodMicroService-2729"><span class="linenos">2729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel get requests.</span>
</span><span id="PumpWoodMicroService-2730"><a href="#PumpWoodMicroService-2730"><span class="linenos">2730</span></a>
</span><span id="PumpWoodMicroService-2731"><a href="#PumpWoodMicroService-2731"><span class="linenos">2731</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2732"><a href="#PumpWoodMicroService-2732"><span class="linenos">2732</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService-2733"><a href="#PumpWoodMicroService-2733"><span class="linenos">2733</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService-2734"><a href="#PumpWoodMicroService-2734"><span class="linenos">2734</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-2735"><a href="#PumpWoodMicroService-2735"><span class="linenos">2735</span></a><span class="sd">                A list of dictionary or a dictionary that will be replicated</span>
</span><span id="PumpWoodMicroService-2736"><a href="#PumpWoodMicroService-2736"><span class="linenos">2736</span></a><span class="sd">                len(urls_list) and passed to parallel request as url</span>
</span><span id="PumpWoodMicroService-2737"><a href="#PumpWoodMicroService-2737"><span class="linenos">2737</span></a><span class="sd">                parameter. If not set, empty dictionary will be passed to all</span>
</span><span id="PumpWoodMicroService-2738"><a href="#PumpWoodMicroService-2738"><span class="linenos">2738</span></a><span class="sd">                request as default.</span>
</span><span id="PumpWoodMicroService-2739"><a href="#PumpWoodMicroService-2739"><span class="linenos">2739</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-2740"><a href="#PumpWoodMicroService-2740"><span class="linenos">2740</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-2741"><a href="#PumpWoodMicroService-2741"><span class="linenos">2741</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-2742"><a href="#PumpWoodMicroService-2742"><span class="linenos">2742</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-2743"><a href="#PumpWoodMicroService-2743"><span class="linenos">2743</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2744"><a href="#PumpWoodMicroService-2744"><span class="linenos">2744</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2745"><a href="#PumpWoodMicroService-2745"><span class="linenos">2745</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2746"><a href="#PumpWoodMicroService-2746"><span class="linenos">2746</span></a>
</span><span id="PumpWoodMicroService-2747"><a href="#PumpWoodMicroService-2747"><span class="linenos">2747</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2748"><a href="#PumpWoodMicroService-2748"><span class="linenos">2748</span></a><span class="sd">            Return a list with all get request reponses. The results are</span>
</span><span id="PumpWoodMicroService-2749"><a href="#PumpWoodMicroService-2749"><span class="linenos">2749</span></a><span class="sd">            on the same order of argument list.</span>
</span><span id="PumpWoodMicroService-2750"><a href="#PumpWoodMicroService-2750"><span class="linenos">2750</span></a>
</span><span id="PumpWoodMicroService-2751"><a href="#PumpWoodMicroService-2751"><span class="linenos">2751</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2752"><a href="#PumpWoodMicroService-2752"><span class="linenos">2752</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-2753"><a href="#PumpWoodMicroService-2753"><span class="linenos">2753</span></a><span class="sd">                &#39;lenght of urls_list[{}] is different of parameters[{}]&#39;.</span>
</span><span id="PumpWoodMicroService-2754"><a href="#PumpWoodMicroService-2754"><span class="linenos">2754</span></a><span class="sd">                Indicates that the function arguments `urls_list` and</span>
</span><span id="PumpWoodMicroService-2755"><a href="#PumpWoodMicroService-2755"><span class="linenos">2755</span></a><span class="sd">                `parameters` (when passed as a list of dictionaries)</span>
</span><span id="PumpWoodMicroService-2756"><a href="#PumpWoodMicroService-2756"><span class="linenos">2756</span></a><span class="sd">                does not have de same lenght.</span>
</span><span id="PumpWoodMicroService-2757"><a href="#PumpWoodMicroService-2757"><span class="linenos">2757</span></a><span class="sd">            PumpWoodNotImplementedError:</span>
</span><span id="PumpWoodMicroService-2758"><a href="#PumpWoodMicroService-2758"><span class="linenos">2758</span></a><span class="sd">                &#39;paraemters type[{}] is not implemented&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService-2759"><a href="#PumpWoodMicroService-2759"><span class="linenos">2759</span></a><span class="sd">                `parameters` passed as function argument is not a list of dict</span>
</span><span id="PumpWoodMicroService-2760"><a href="#PumpWoodMicroService-2760"><span class="linenos">2760</span></a><span class="sd">                or a dictinary, so not implemented.</span>
</span><span id="PumpWoodMicroService-2761"><a href="#PumpWoodMicroService-2761"><span class="linenos">2761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2762"><a href="#PumpWoodMicroService-2762"><span class="linenos">2762</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2763"><a href="#PumpWoodMicroService-2763"><span class="linenos">2763</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2764"><a href="#PumpWoodMicroService-2764"><span class="linenos">2764</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2765"><a href="#PumpWoodMicroService-2765"><span class="linenos">2765</span></a>
</span><span id="PumpWoodMicroService-2766"><a href="#PumpWoodMicroService-2766"><span class="linenos">2766</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService-2767"><a href="#PumpWoodMicroService-2767"><span class="linenos">2767</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService-2768"><a href="#PumpWoodMicroService-2768"><span class="linenos">2768</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2769"><a href="#PumpWoodMicroService-2769"><span class="linenos">2769</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-2770"><a href="#PumpWoodMicroService-2770"><span class="linenos">2770</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2771"><a href="#PumpWoodMicroService-2771"><span class="linenos">2771</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2772"><a href="#PumpWoodMicroService-2772"><span class="linenos">2772</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2773"><a href="#PumpWoodMicroService-2773"><span class="linenos">2773</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2774"><a href="#PumpWoodMicroService-2774"><span class="linenos">2774</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2775"><a href="#PumpWoodMicroService-2775"><span class="linenos">2775</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2776"><a href="#PumpWoodMicroService-2776"><span class="linenos">2776</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService-2777"><a href="#PumpWoodMicroService-2777"><span class="linenos">2777</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2778"><a href="#PumpWoodMicroService-2778"><span class="linenos">2778</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2779"><a href="#PumpWoodMicroService-2779"><span class="linenos">2779</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-2780"><a href="#PumpWoodMicroService-2780"><span class="linenos">2780</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2781"><a href="#PumpWoodMicroService-2781"><span class="linenos">2781</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2782"><a href="#PumpWoodMicroService-2782"><span class="linenos">2782</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2783"><a href="#PumpWoodMicroService-2783"><span class="linenos">2783</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2784"><a href="#PumpWoodMicroService-2784"><span class="linenos">2784</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2785"><a href="#PumpWoodMicroService-2785"><span class="linenos">2785</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-2786"><a href="#PumpWoodMicroService-2786"><span class="linenos">2786</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2787"><a href="#PumpWoodMicroService-2787"><span class="linenos">2787</span></a>
</span><span id="PumpWoodMicroService-2788"><a href="#PumpWoodMicroService-2788"><span class="linenos">2788</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="PumpWoodMicroService-2789"><a href="#PumpWoodMicroService-2789"><span class="linenos">2789</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-2790"><a href="#PumpWoodMicroService-2790"><span class="linenos">2790</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService-2791"><a href="#PumpWoodMicroService-2791"><span class="linenos">2791</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2792"><a href="#PumpWoodMicroService-2792"><span class="linenos">2792</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2793"><a href="#PumpWoodMicroService-2793"><span class="linenos">2793</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="PumpWoodMicroService-2794"><a href="#PumpWoodMicroService-2794"><span class="linenos">2794</span></a>
</span><span id="PumpWoodMicroService-2795"><a href="#PumpWoodMicroService-2795"><span class="linenos">2795</span></a>        <span class="c1"># Run requests in parallel</span>
</span><span id="PumpWoodMicroService-2796"><a href="#PumpWoodMicroService-2796"><span class="linenos">2796</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2797"><a href="#PumpWoodMicroService-2797"><span class="linenos">2797</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2798"><a href="#PumpWoodMicroService-2798"><span class="linenos">2798</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2799"><a href="#PumpWoodMicroService-2799"><span class="linenos">2799</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-2800"><a href="#PumpWoodMicroService-2800"><span class="linenos">2800</span></a>
</span><span id="PumpWoodMicroService-2801"><a href="#PumpWoodMicroService-2801"><span class="linenos">2801</span></a>    <span class="k">def</span> <span class="nf">_request_post_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2802"><a href="#PumpWoodMicroService-2802"><span class="linenos">2802</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2803"><a href="#PumpWoodMicroService-2803"><span class="linenos">2803</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2804"><a href="#PumpWoodMicroService-2804"><span class="linenos">2804</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2805"><a href="#PumpWoodMicroService-2805"><span class="linenos">2805</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2806"><a href="#PumpWoodMicroService-2806"><span class="linenos">2806</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="PumpWoodMicroService-2807"><a href="#PumpWoodMicroService-2807"><span class="linenos">2807</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2808"><a href="#PumpWoodMicroService-2808"><span class="linenos">2808</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel post: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2809"><a href="#PumpWoodMicroService-2809"><span class="linenos">2809</span></a>
</span><span id="PumpWoodMicroService-2810"><a href="#PumpWoodMicroService-2810"><span class="linenos">2810</span></a>    <span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2811"><a href="#PumpWoodMicroService-2811"><span class="linenos">2811</span></a>                              <span class="n">data_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2812"><a href="#PumpWoodMicroService-2812"><span class="linenos">2812</span></a>                              <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2813"><a href="#PumpWoodMicroService-2813"><span class="linenos">2813</span></a>                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2814"><a href="#PumpWoodMicroService-2814"><span class="linenos">2814</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-2815"><a href="#PumpWoodMicroService-2815"><span class="linenos">2815</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel post request.</span>
</span><span id="PumpWoodMicroService-2816"><a href="#PumpWoodMicroService-2816"><span class="linenos">2816</span></a>
</span><span id="PumpWoodMicroService-2817"><a href="#PumpWoodMicroService-2817"><span class="linenos">2817</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2818"><a href="#PumpWoodMicroService-2818"><span class="linenos">2818</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService-2819"><a href="#PumpWoodMicroService-2819"><span class="linenos">2819</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService-2820"><a href="#PumpWoodMicroService-2820"><span class="linenos">2820</span></a><span class="sd">            data_list:</span>
</span><span id="PumpWoodMicroService-2821"><a href="#PumpWoodMicroService-2821"><span class="linenos">2821</span></a><span class="sd">                List of data to be used as post payloads.</span>
</span><span id="PumpWoodMicroService-2822"><a href="#PumpWoodMicroService-2822"><span class="linenos">2822</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-2823"><a href="#PumpWoodMicroService-2823"><span class="linenos">2823</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="PumpWoodMicroService-2824"><a href="#PumpWoodMicroService-2824"><span class="linenos">2824</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-2825"><a href="#PumpWoodMicroService-2825"><span class="linenos">2825</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-2826"><a href="#PumpWoodMicroService-2826"><span class="linenos">2826</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-2827"><a href="#PumpWoodMicroService-2827"><span class="linenos">2827</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-2828"><a href="#PumpWoodMicroService-2828"><span class="linenos">2828</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2829"><a href="#PumpWoodMicroService-2829"><span class="linenos">2829</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2830"><a href="#PumpWoodMicroService-2830"><span class="linenos">2830</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2831"><a href="#PumpWoodMicroService-2831"><span class="linenos">2831</span></a>
</span><span id="PumpWoodMicroService-2832"><a href="#PumpWoodMicroService-2832"><span class="linenos">2832</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2833"><a href="#PumpWoodMicroService-2833"><span class="linenos">2833</span></a><span class="sd">            List of the post request reponses.</span>
</span><span id="PumpWoodMicroService-2834"><a href="#PumpWoodMicroService-2834"><span class="linenos">2834</span></a>
</span><span id="PumpWoodMicroService-2835"><a href="#PumpWoodMicroService-2835"><span class="linenos">2835</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2836"><a href="#PumpWoodMicroService-2836"><span class="linenos">2836</span></a><span class="sd">            No particular raises</span>
</span><span id="PumpWoodMicroService-2837"><a href="#PumpWoodMicroService-2837"><span class="linenos">2837</span></a>
</span><span id="PumpWoodMicroService-2838"><a href="#PumpWoodMicroService-2838"><span class="linenos">2838</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-2839"><a href="#PumpWoodMicroService-2839"><span class="linenos">2839</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService-2840"><a href="#PumpWoodMicroService-2840"><span class="linenos">2840</span></a>
</span><span id="PumpWoodMicroService-2841"><a href="#PumpWoodMicroService-2841"><span class="linenos">2841</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2842"><a href="#PumpWoodMicroService-2842"><span class="linenos">2842</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2843"><a href="#PumpWoodMicroService-2843"><span class="linenos">2843</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2844"><a href="#PumpWoodMicroService-2844"><span class="linenos">2844</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2845"><a href="#PumpWoodMicroService-2845"><span class="linenos">2845</span></a>
</span><span id="PumpWoodMicroService-2846"><a href="#PumpWoodMicroService-2846"><span class="linenos">2846</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService-2847"><a href="#PumpWoodMicroService-2847"><span class="linenos">2847</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService-2848"><a href="#PumpWoodMicroService-2848"><span class="linenos">2848</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2849"><a href="#PumpWoodMicroService-2849"><span class="linenos">2849</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-2850"><a href="#PumpWoodMicroService-2850"><span class="linenos">2850</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2851"><a href="#PumpWoodMicroService-2851"><span class="linenos">2851</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2852"><a href="#PumpWoodMicroService-2852"><span class="linenos">2852</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2853"><a href="#PumpWoodMicroService-2853"><span class="linenos">2853</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2854"><a href="#PumpWoodMicroService-2854"><span class="linenos">2854</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2855"><a href="#PumpWoodMicroService-2855"><span class="linenos">2855</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2856"><a href="#PumpWoodMicroService-2856"><span class="linenos">2856</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService-2857"><a href="#PumpWoodMicroService-2857"><span class="linenos">2857</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2858"><a href="#PumpWoodMicroService-2858"><span class="linenos">2858</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2859"><a href="#PumpWoodMicroService-2859"><span class="linenos">2859</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-2860"><a href="#PumpWoodMicroService-2860"><span class="linenos">2860</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2861"><a href="#PumpWoodMicroService-2861"><span class="linenos">2861</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2862"><a href="#PumpWoodMicroService-2862"><span class="linenos">2862</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2863"><a href="#PumpWoodMicroService-2863"><span class="linenos">2863</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2864"><a href="#PumpWoodMicroService-2864"><span class="linenos">2864</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2865"><a href="#PumpWoodMicroService-2865"><span class="linenos">2865</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-2866"><a href="#PumpWoodMicroService-2866"><span class="linenos">2866</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2867"><a href="#PumpWoodMicroService-2867"><span class="linenos">2867</span></a>
</span><span id="PumpWoodMicroService-2868"><a href="#PumpWoodMicroService-2868"><span class="linenos">2868</span></a>        <span class="c1"># Validate if length of URL is the same of data_list</span>
</span><span id="PumpWoodMicroService-2869"><a href="#PumpWoodMicroService-2869"><span class="linenos">2869</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2870"><a href="#PumpWoodMicroService-2870"><span class="linenos">2870</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2871"><a href="#PumpWoodMicroService-2871"><span class="linenos">2871</span></a>                <span class="s1">&#39;len(urls_list)[</span><span class="si">{}</span><span class="s1">] must be equal &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-2872"><a href="#PumpWoodMicroService-2872"><span class="linenos">2872</span></a>                <span class="s1">&#39;to len(data_list)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2873"><a href="#PumpWoodMicroService-2873"><span class="linenos">2873</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2874"><a href="#PumpWoodMicroService-2874"><span class="linenos">2874</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2875"><a href="#PumpWoodMicroService-2875"><span class="linenos">2875</span></a>
</span><span id="PumpWoodMicroService-2876"><a href="#PumpWoodMicroService-2876"><span class="linenos">2876</span></a>        <span class="c1"># Create the arguments for parallel requests</span>
</span><span id="PumpWoodMicroService-2877"><a href="#PumpWoodMicroService-2877"><span class="linenos">2877</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-2878"><a href="#PumpWoodMicroService-2878"><span class="linenos">2878</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService-2879"><a href="#PumpWoodMicroService-2879"><span class="linenos">2879</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2880"><a href="#PumpWoodMicroService-2880"><span class="linenos">2880</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2881"><a href="#PumpWoodMicroService-2881"><span class="linenos">2881</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2882"><a href="#PumpWoodMicroService-2882"><span class="linenos">2882</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2883"><a href="#PumpWoodMicroService-2883"><span class="linenos">2883</span></a>                <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-2884"><a href="#PumpWoodMicroService-2884"><span class="linenos">2884</span></a>
</span><span id="PumpWoodMicroService-2885"><a href="#PumpWoodMicroService-2885"><span class="linenos">2885</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2886"><a href="#PumpWoodMicroService-2886"><span class="linenos">2886</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2887"><a href="#PumpWoodMicroService-2887"><span class="linenos">2887</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2888"><a href="#PumpWoodMicroService-2888"><span class="linenos">2888</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-2889"><a href="#PumpWoodMicroService-2889"><span class="linenos">2889</span></a>
</span><span id="PumpWoodMicroService-2890"><a href="#PumpWoodMicroService-2890"><span class="linenos">2890</span></a>    <span class="k">def</span> <span class="nf">_request_delete_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2891"><a href="#PumpWoodMicroService-2891"><span class="linenos">2891</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2892"><a href="#PumpWoodMicroService-2892"><span class="linenos">2892</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2893"><a href="#PumpWoodMicroService-2893"><span class="linenos">2893</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2894"><a href="#PumpWoodMicroService-2894"><span class="linenos">2894</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-2895"><a href="#PumpWoodMicroService-2895"><span class="linenos">2895</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="PumpWoodMicroService-2896"><a href="#PumpWoodMicroService-2896"><span class="linenos">2896</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2897"><a href="#PumpWoodMicroService-2897"><span class="linenos">2897</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel delete: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2898"><a href="#PumpWoodMicroService-2898"><span class="linenos">2898</span></a>
</span><span id="PumpWoodMicroService-2899"><a href="#PumpWoodMicroService-2899"><span class="linenos">2899</span></a>    <span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-2900"><a href="#PumpWoodMicroService-2900"><span class="linenos">2900</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2901"><a href="#PumpWoodMicroService-2901"><span class="linenos">2901</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2902"><a href="#PumpWoodMicroService-2902"><span class="linenos">2902</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2903"><a href="#PumpWoodMicroService-2903"><span class="linenos">2903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete request.</span>
</span><span id="PumpWoodMicroService-2904"><a href="#PumpWoodMicroService-2904"><span class="linenos">2904</span></a>
</span><span id="PumpWoodMicroService-2905"><a href="#PumpWoodMicroService-2905"><span class="linenos">2905</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2906"><a href="#PumpWoodMicroService-2906"><span class="linenos">2906</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService-2907"><a href="#PumpWoodMicroService-2907"><span class="linenos">2907</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService-2908"><a href="#PumpWoodMicroService-2908"><span class="linenos">2908</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-2909"><a href="#PumpWoodMicroService-2909"><span class="linenos">2909</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="PumpWoodMicroService-2910"><a href="#PumpWoodMicroService-2910"><span class="linenos">2910</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-2911"><a href="#PumpWoodMicroService-2911"><span class="linenos">2911</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-2912"><a href="#PumpWoodMicroService-2912"><span class="linenos">2912</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-2913"><a href="#PumpWoodMicroService-2913"><span class="linenos">2913</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-2914"><a href="#PumpWoodMicroService-2914"><span class="linenos">2914</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-2915"><a href="#PumpWoodMicroService-2915"><span class="linenos">2915</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-2916"><a href="#PumpWoodMicroService-2916"><span class="linenos">2916</span></a>
</span><span id="PumpWoodMicroService-2917"><a href="#PumpWoodMicroService-2917"><span class="linenos">2917</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-2918"><a href="#PumpWoodMicroService-2918"><span class="linenos">2918</span></a><span class="sd">            list: List of the get request reponses.</span>
</span><span id="PumpWoodMicroService-2919"><a href="#PumpWoodMicroService-2919"><span class="linenos">2919</span></a>
</span><span id="PumpWoodMicroService-2920"><a href="#PumpWoodMicroService-2920"><span class="linenos">2920</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-2921"><a href="#PumpWoodMicroService-2921"><span class="linenos">2921</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-2922"><a href="#PumpWoodMicroService-2922"><span class="linenos">2922</span></a>
</span><span id="PumpWoodMicroService-2923"><a href="#PumpWoodMicroService-2923"><span class="linenos">2923</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-2924"><a href="#PumpWoodMicroService-2924"><span class="linenos">2924</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService-2925"><a href="#PumpWoodMicroService-2925"><span class="linenos">2925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-2926"><a href="#PumpWoodMicroService-2926"><span class="linenos">2926</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2927"><a href="#PumpWoodMicroService-2927"><span class="linenos">2927</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2928"><a href="#PumpWoodMicroService-2928"><span class="linenos">2928</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2929"><a href="#PumpWoodMicroService-2929"><span class="linenos">2929</span></a>
</span><span id="PumpWoodMicroService-2930"><a href="#PumpWoodMicroService-2930"><span class="linenos">2930</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService-2931"><a href="#PumpWoodMicroService-2931"><span class="linenos">2931</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService-2932"><a href="#PumpWoodMicroService-2932"><span class="linenos">2932</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2933"><a href="#PumpWoodMicroService-2933"><span class="linenos">2933</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-2934"><a href="#PumpWoodMicroService-2934"><span class="linenos">2934</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2935"><a href="#PumpWoodMicroService-2935"><span class="linenos">2935</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2936"><a href="#PumpWoodMicroService-2936"><span class="linenos">2936</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2937"><a href="#PumpWoodMicroService-2937"><span class="linenos">2937</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService-2938"><a href="#PumpWoodMicroService-2938"><span class="linenos">2938</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2939"><a href="#PumpWoodMicroService-2939"><span class="linenos">2939</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2940"><a href="#PumpWoodMicroService-2940"><span class="linenos">2940</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService-2941"><a href="#PumpWoodMicroService-2941"><span class="linenos">2941</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2942"><a href="#PumpWoodMicroService-2942"><span class="linenos">2942</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-2943"><a href="#PumpWoodMicroService-2943"><span class="linenos">2943</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-2944"><a href="#PumpWoodMicroService-2944"><span class="linenos">2944</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2945"><a href="#PumpWoodMicroService-2945"><span class="linenos">2945</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-2946"><a href="#PumpWoodMicroService-2946"><span class="linenos">2946</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2947"><a href="#PumpWoodMicroService-2947"><span class="linenos">2947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2948"><a href="#PumpWoodMicroService-2948"><span class="linenos">2948</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-2949"><a href="#PumpWoodMicroService-2949"><span class="linenos">2949</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-2950"><a href="#PumpWoodMicroService-2950"><span class="linenos">2950</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2951"><a href="#PumpWoodMicroService-2951"><span class="linenos">2951</span></a>
</span><span id="PumpWoodMicroService-2952"><a href="#PumpWoodMicroService-2952"><span class="linenos">2952</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="PumpWoodMicroService-2953"><a href="#PumpWoodMicroService-2953"><span class="linenos">2953</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-2954"><a href="#PumpWoodMicroService-2954"><span class="linenos">2954</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService-2955"><a href="#PumpWoodMicroService-2955"><span class="linenos">2955</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-2956"><a href="#PumpWoodMicroService-2956"><span class="linenos">2956</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2957"><a href="#PumpWoodMicroService-2957"><span class="linenos">2957</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="PumpWoodMicroService-2958"><a href="#PumpWoodMicroService-2958"><span class="linenos">2958</span></a>
</span><span id="PumpWoodMicroService-2959"><a href="#PumpWoodMicroService-2959"><span class="linenos">2959</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-2960"><a href="#PumpWoodMicroService-2960"><span class="linenos">2960</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2961"><a href="#PumpWoodMicroService-2961"><span class="linenos">2961</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-2962"><a href="#PumpWoodMicroService-2962"><span class="linenos">2962</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-2963"><a href="#PumpWoodMicroService-2963"><span class="linenos">2963</span></a>
</span><span id="PumpWoodMicroService-2964"><a href="#PumpWoodMicroService-2964"><span class="linenos">2964</span></a>    <span class="c1">######################</span>
</span><span id="PumpWoodMicroService-2965"><a href="#PumpWoodMicroService-2965"><span class="linenos">2965</span></a>    <span class="c1"># Parallel functions #</span>
</span><span id="PumpWoodMicroService-2966"><a href="#PumpWoodMicroService-2966"><span class="linenos">2966</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-2967"><a href="#PumpWoodMicroService-2967"><span class="linenos">2967</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2968"><a href="#PumpWoodMicroService-2968"><span class="linenos">2968</span></a>                          <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2969"><a href="#PumpWoodMicroService-2969"><span class="linenos">2969</span></a>                          <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2970"><a href="#PumpWoodMicroService-2970"><span class="linenos">2970</span></a>                          <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-2971"><a href="#PumpWoodMicroService-2971"><span class="linenos">2971</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-2972"><a href="#PumpWoodMicroService-2972"><span class="linenos">2972</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel retrieve request.</span>
</span><span id="PumpWoodMicroService-2973"><a href="#PumpWoodMicroService-2973"><span class="linenos">2973</span></a>
</span><span id="PumpWoodMicroService-2974"><a href="#PumpWoodMicroService-2974"><span class="linenos">2974</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-2975"><a href="#PumpWoodMicroService-2975"><span class="linenos">2975</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-2976"><a href="#PumpWoodMicroService-2976"><span class="linenos">2976</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService-2977"><a href="#PumpWoodMicroService-2977"><span class="linenos">2977</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService-2978"><a href="#PumpWoodMicroService-2978"><span class="linenos">2978</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="PumpWoodMicroService-2979"><a href="#PumpWoodMicroService-2979"><span class="linenos">2979</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService-2980"><a href="#PumpWoodMicroService-2980"><span class="linenos">2980</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-2981"><a href="#PumpWoodMicroService-2981"><span class="linenos">2981</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService-2982"><a href="#PumpWoodMicroService-2982"><span class="linenos">2982</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-2983"><a href="#PumpWoodMicroService-2983"><span class="linenos">2983</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-2984"><a href="#PumpWoodMicroService-2984"><span class="linenos">2984</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService-2985"><a href="#PumpWoodMicroService-2985"><span class="linenos">2985</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-2986"><a href="#PumpWoodMicroService-2986"><span class="linenos">2986</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-2987"><a href="#PumpWoodMicroService-2987"><span class="linenos">2987</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-2988"><a href="#PumpWoodMicroService-2988"><span class="linenos">2988</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-2989"><a href="#PumpWoodMicroService-2989"><span class="linenos">2989</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService-2990"><a href="#PumpWoodMicroService-2990"><span class="linenos">2990</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService-2991"><a href="#PumpWoodMicroService-2991"><span class="linenos">2991</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService-2992"><a href="#PumpWoodMicroService-2992"><span class="linenos">2992</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService-2993"><a href="#PumpWoodMicroService-2993"><span class="linenos">2993</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService-2994"><a href="#PumpWoodMicroService-2994"><span class="linenos">2994</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService-2995"><a href="#PumpWoodMicroService-2995"><span class="linenos">2995</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService-2996"><a href="#PumpWoodMicroService-2996"><span class="linenos">2996</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-2997"><a href="#PumpWoodMicroService-2997"><span class="linenos">2997</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-2998"><a href="#PumpWoodMicroService-2998"><span class="linenos">2998</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-2999"><a href="#PumpWoodMicroService-2999"><span class="linenos">2999</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3000"><a href="#PumpWoodMicroService-3000"><span class="linenos">3000</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3001"><a href="#PumpWoodMicroService-3001"><span class="linenos">3001</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3002"><a href="#PumpWoodMicroService-3002"><span class="linenos">3002</span></a>
</span><span id="PumpWoodMicroService-3003"><a href="#PumpWoodMicroService-3003"><span class="linenos">3003</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3004"><a href="#PumpWoodMicroService-3004"><span class="linenos">3004</span></a><span class="sd">            List of the retrieve request data.</span>
</span><span id="PumpWoodMicroService-3005"><a href="#PumpWoodMicroService-3005"><span class="linenos">3005</span></a>
</span><span id="PumpWoodMicroService-3006"><a href="#PumpWoodMicroService-3006"><span class="linenos">3006</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3007"><a href="#PumpWoodMicroService-3007"><span class="linenos">3007</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3008"><a href="#PumpWoodMicroService-3008"><span class="linenos">3008</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_pk)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService-3009"><a href="#PumpWoodMicroService-3009"><span class="linenos">3009</span></a><span class="sd">                the lenght of the arguments model_class and list_pk are</span>
</span><span id="PumpWoodMicroService-3010"><a href="#PumpWoodMicroService-3010"><span class="linenos">3010</span></a><span class="sd">                incompatible.</span>
</span><span id="PumpWoodMicroService-3011"><a href="#PumpWoodMicroService-3011"><span class="linenos">3011</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3012"><a href="#PumpWoodMicroService-3012"><span class="linenos">3012</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3013"><a href="#PumpWoodMicroService-3013"><span class="linenos">3013</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3014"><a href="#PumpWoodMicroService-3014"><span class="linenos">3014</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3015"><a href="#PumpWoodMicroService-3015"><span class="linenos">3015</span></a>
</span><span id="PumpWoodMicroService-3016"><a href="#PumpWoodMicroService-3016"><span class="linenos">3016</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3017"><a href="#PumpWoodMicroService-3017"><span class="linenos">3017</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3018"><a href="#PumpWoodMicroService-3018"><span class="linenos">3018</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3019"><a href="#PumpWoodMicroService-3019"><span class="linenos">3019</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3020"><a href="#PumpWoodMicroService-3020"><span class="linenos">3020</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-3021"><a href="#PumpWoodMicroService-3021"><span class="linenos">3021</span></a>                    <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_pk)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3022"><a href="#PumpWoodMicroService-3022"><span class="linenos">3022</span></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3023"><a href="#PumpWoodMicroService-3023"><span class="linenos">3023</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3024"><a href="#PumpWoodMicroService-3024"><span class="linenos">3024</span></a>
</span><span id="PumpWoodMicroService-3025"><a href="#PumpWoodMicroService-3025"><span class="linenos">3025</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3026"><a href="#PumpWoodMicroService-3026"><span class="linenos">3026</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3027"><a href="#PumpWoodMicroService-3027"><span class="linenos">3027</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3028"><a href="#PumpWoodMicroService-3028"><span class="linenos">3028</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService-3029"><a href="#PumpWoodMicroService-3029"><span class="linenos">3029</span></a>
</span><span id="PumpWoodMicroService-3030"><a href="#PumpWoodMicroService-3030"><span class="linenos">3030</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3031"><a href="#PumpWoodMicroService-3031"><span class="linenos">3031</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3032"><a href="#PumpWoodMicroService-3032"><span class="linenos">3032</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService-3033"><a href="#PumpWoodMicroService-3033"><span class="linenos">3033</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3034"><a href="#PumpWoodMicroService-3034"><span class="linenos">3034</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3035"><a href="#PumpWoodMicroService-3035"><span class="linenos">3035</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="PumpWoodMicroService-3036"><a href="#PumpWoodMicroService-3036"><span class="linenos">3036</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3037"><a href="#PumpWoodMicroService-3037"><span class="linenos">3037</span></a>
</span><span id="PumpWoodMicroService-3038"><a href="#PumpWoodMicroService-3038"><span class="linenos">3038</span></a>    <span class="k">def</span> <span class="nf">_request_retrieve_file_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3039"><a href="#PumpWoodMicroService-3039"><span class="linenos">3039</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3040"><a href="#PumpWoodMicroService-3040"><span class="linenos">3040</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-3041"><a href="#PumpWoodMicroService-3041"><span class="linenos">3041</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3042"><a href="#PumpWoodMicroService-3042"><span class="linenos">3042</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3043"><a href="#PumpWoodMicroService-3043"><span class="linenos">3043</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3044"><a href="#PumpWoodMicroService-3044"><span class="linenos">3044</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel retrieve_file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3045"><a href="#PumpWoodMicroService-3045"><span class="linenos">3045</span></a>
</span><span id="PumpWoodMicroService-3046"><a href="#PumpWoodMicroService-3046"><span class="linenos">3046</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3047"><a href="#PumpWoodMicroService-3047"><span class="linenos">3047</span></a>                               <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3048"><a href="#PumpWoodMicroService-3048"><span class="linenos">3048</span></a>                               <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3049"><a href="#PumpWoodMicroService-3049"><span class="linenos">3049</span></a>                               <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3050"><a href="#PumpWoodMicroService-3050"><span class="linenos">3050</span></a>                               <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3051"><a href="#PumpWoodMicroService-3051"><span class="linenos">3051</span></a>                               <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3052"><a href="#PumpWoodMicroService-3052"><span class="linenos">3052</span></a>                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3053"><a href="#PumpWoodMicroService-3053"><span class="linenos">3053</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] retrieve request.</span>
</span><span id="PumpWoodMicroService-3054"><a href="#PumpWoodMicroService-3054"><span class="linenos">3054</span></a>
</span><span id="PumpWoodMicroService-3055"><a href="#PumpWoodMicroService-3055"><span class="linenos">3055</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3056"><a href="#PumpWoodMicroService-3056"><span class="linenos">3056</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3057"><a href="#PumpWoodMicroService-3057"><span class="linenos">3057</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService-3058"><a href="#PumpWoodMicroService-3058"><span class="linenos">3058</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService-3059"><a href="#PumpWoodMicroService-3059"><span class="linenos">3059</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="PumpWoodMicroService-3060"><a href="#PumpWoodMicroService-3060"><span class="linenos">3060</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService-3061"><a href="#PumpWoodMicroService-3061"><span class="linenos">3061</span></a><span class="sd">                Indicates the file field to download from.</span>
</span><span id="PumpWoodMicroService-3062"><a href="#PumpWoodMicroService-3062"><span class="linenos">3062</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3063"><a href="#PumpWoodMicroService-3063"><span class="linenos">3063</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3064"><a href="#PumpWoodMicroService-3064"><span class="linenos">3064</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3065"><a href="#PumpWoodMicroService-3065"><span class="linenos">3065</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3066"><a href="#PumpWoodMicroService-3066"><span class="linenos">3066</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService-3067"><a href="#PumpWoodMicroService-3067"><span class="linenos">3067</span></a><span class="sd">                Path to be used to save files.</span>
</span><span id="PumpWoodMicroService-3068"><a href="#PumpWoodMicroService-3068"><span class="linenos">3068</span></a><span class="sd">            save_file:</span>
</span><span id="PumpWoodMicroService-3069"><a href="#PumpWoodMicroService-3069"><span class="linenos">3069</span></a><span class="sd">                True save file locally, False return file content as bites.</span>
</span><span id="PumpWoodMicroService-3070"><a href="#PumpWoodMicroService-3070"><span class="linenos">3070</span></a><span class="sd">            list_file_name:</span>
</span><span id="PumpWoodMicroService-3071"><a href="#PumpWoodMicroService-3071"><span class="linenos">3071</span></a><span class="sd">                Set a file name for each file download.</span>
</span><span id="PumpWoodMicroService-3072"><a href="#PumpWoodMicroService-3072"><span class="linenos">3072</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService-3073"><a href="#PumpWoodMicroService-3073"><span class="linenos">3073</span></a><span class="sd">                Set how treat when a file will be saved</span>
</span><span id="PumpWoodMicroService-3074"><a href="#PumpWoodMicroService-3074"><span class="linenos">3074</span></a><span class="sd">                and there is another at same path. &quot;fail&quot; will raise an error;</span>
</span><span id="PumpWoodMicroService-3075"><a href="#PumpWoodMicroService-3075"><span class="linenos">3075</span></a><span class="sd">                &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
</span><span id="PumpWoodMicroService-3076"><a href="#PumpWoodMicroService-3076"><span class="linenos">3076</span></a><span class="sd">                when list_file_name is set, check before downloaded it file</span>
</span><span id="PumpWoodMicroService-3077"><a href="#PumpWoodMicroService-3077"><span class="linenos">3077</span></a><span class="sd">                already exists, if so skip the download.</span>
</span><span id="PumpWoodMicroService-3078"><a href="#PumpWoodMicroService-3078"><span class="linenos">3078</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3079"><a href="#PumpWoodMicroService-3079"><span class="linenos">3079</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3080"><a href="#PumpWoodMicroService-3080"><span class="linenos">3080</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3081"><a href="#PumpWoodMicroService-3081"><span class="linenos">3081</span></a>
</span><span id="PumpWoodMicroService-3082"><a href="#PumpWoodMicroService-3082"><span class="linenos">3082</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3083"><a href="#PumpWoodMicroService-3083"><span class="linenos">3083</span></a><span class="sd">            List of the retrieve file request data.</span>
</span><span id="PumpWoodMicroService-3084"><a href="#PumpWoodMicroService-3084"><span class="linenos">3084</span></a>
</span><span id="PumpWoodMicroService-3085"><a href="#PumpWoodMicroService-3085"><span class="linenos">3085</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3086"><a href="#PumpWoodMicroService-3086"><span class="linenos">3086</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3087"><a href="#PumpWoodMicroService-3087"><span class="linenos">3087</span></a><span class="sd">                &#39;Lenght of list_file_name and list_pk are not equal:</span>
</span><span id="PumpWoodMicroService-3088"><a href="#PumpWoodMicroService-3088"><span class="linenos">3088</span></a><span class="sd">                len(list_file_name)={list_file_name}; len(list_pk)={list_pk}&#39;.</span>
</span><span id="PumpWoodMicroService-3089"><a href="#PumpWoodMicroService-3089"><span class="linenos">3089</span></a><span class="sd">                Indicates that len(list_file_name) and len(list_pk) function</span>
</span><span id="PumpWoodMicroService-3090"><a href="#PumpWoodMicroService-3090"><span class="linenos">3090</span></a><span class="sd">                arguments are not equal.</span>
</span><span id="PumpWoodMicroService-3091"><a href="#PumpWoodMicroService-3091"><span class="linenos">3091</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3092"><a href="#PumpWoodMicroService-3092"><span class="linenos">3092</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3093"><a href="#PumpWoodMicroService-3093"><span class="linenos">3093</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3094"><a href="#PumpWoodMicroService-3094"><span class="linenos">3094</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3095"><a href="#PumpWoodMicroService-3095"><span class="linenos">3095</span></a>
</span><span id="PumpWoodMicroService-3096"><a href="#PumpWoodMicroService-3096"><span class="linenos">3096</span></a>        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3097"><a href="#PumpWoodMicroService-3097"><span class="linenos">3097</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3098"><a href="#PumpWoodMicroService-3098"><span class="linenos">3098</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
</span><span id="PumpWoodMicroService-3099"><a href="#PumpWoodMicroService-3099"><span class="linenos">3099</span></a>                    <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-3100"><a href="#PumpWoodMicroService-3100"><span class="linenos">3100</span></a>                    <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService-3101"><a href="#PumpWoodMicroService-3101"><span class="linenos">3101</span></a>                    <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3102"><a href="#PumpWoodMicroService-3102"><span class="linenos">3102</span></a>                        <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
</span><span id="PumpWoodMicroService-3103"><a href="#PumpWoodMicroService-3103"><span class="linenos">3103</span></a>                        <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService-3104"><a href="#PumpWoodMicroService-3104"><span class="linenos">3104</span></a>
</span><span id="PumpWoodMicroService-3105"><a href="#PumpWoodMicroService-3105"><span class="linenos">3105</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService-3106"><a href="#PumpWoodMicroService-3106"><span class="linenos">3106</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService-3107"><a href="#PumpWoodMicroService-3107"><span class="linenos">3107</span></a>            <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3108"><a href="#PumpWoodMicroService-3108"><span class="linenos">3108</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-3109"><a href="#PumpWoodMicroService-3109"><span class="linenos">3109</span></a>            <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3110"><a href="#PumpWoodMicroService-3110"><span class="linenos">3110</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3111"><a href="#PumpWoodMicroService-3111"><span class="linenos">3111</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService-3112"><a href="#PumpWoodMicroService-3112"><span class="linenos">3112</span></a>                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3113"><a href="#PumpWoodMicroService-3113"><span class="linenos">3113</span></a>                <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3114"><a href="#PumpWoodMicroService-3114"><span class="linenos">3114</span></a>                <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3115"><a href="#PumpWoodMicroService-3115"><span class="linenos">3115</span></a>                <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>
</span><span id="PumpWoodMicroService-3116"><a href="#PumpWoodMicroService-3116"><span class="linenos">3116</span></a>
</span><span id="PumpWoodMicroService-3117"><a href="#PumpWoodMicroService-3117"><span class="linenos">3117</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3118"><a href="#PumpWoodMicroService-3118"><span class="linenos">3118</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3119"><a href="#PumpWoodMicroService-3119"><span class="linenos">3119</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3120"><a href="#PumpWoodMicroService-3120"><span class="linenos">3120</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3121"><a href="#PumpWoodMicroService-3121"><span class="linenos">3121</span></a>                    <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3122"><a href="#PumpWoodMicroService-3122"><span class="linenos">3122</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3123"><a href="#PumpWoodMicroService-3123"><span class="linenos">3123</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3124"><a href="#PumpWoodMicroService-3124"><span class="linenos">3124</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3125"><a href="#PumpWoodMicroService-3125"><span class="linenos">3125</span></a>
</span><span id="PumpWoodMicroService-3126"><a href="#PumpWoodMicroService-3126"><span class="linenos">3126</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService-3127"><a href="#PumpWoodMicroService-3127"><span class="linenos">3127</span></a>
</span><span id="PumpWoodMicroService-3128"><a href="#PumpWoodMicroService-3128"><span class="linenos">3128</span></a>    <span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3129"><a href="#PumpWoodMicroService-3129"><span class="linenos">3129</span></a>                      <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3130"><a href="#PumpWoodMicroService-3130"><span class="linenos">3130</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3131"><a href="#PumpWoodMicroService-3131"><span class="linenos">3131</span></a>                      <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3132"><a href="#PumpWoodMicroService-3132"><span class="linenos">3132</span></a>                      <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-3133"><a href="#PumpWoodMicroService-3133"><span class="linenos">3133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list request.</span>
</span><span id="PumpWoodMicroService-3134"><a href="#PumpWoodMicroService-3134"><span class="linenos">3134</span></a>
</span><span id="PumpWoodMicroService-3135"><a href="#PumpWoodMicroService-3135"><span class="linenos">3135</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3136"><a href="#PumpWoodMicroService-3136"><span class="linenos">3136</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService-3137"><a href="#PumpWoodMicroService-3137"><span class="linenos">3137</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService-3138"><a href="#PumpWoodMicroService-3138"><span class="linenos">3138</span></a><span class="sd">            list_args (List[dict]):</span>
</span><span id="PumpWoodMicroService-3139"><a href="#PumpWoodMicroService-3139"><span class="linenos">3139</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="PumpWoodMicroService-3140"><a href="#PumpWoodMicroService-3140"><span class="linenos">3140</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="PumpWoodMicroService-3141"><a href="#PumpWoodMicroService-3141"><span class="linenos">3141</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="PumpWoodMicroService-3142"><a href="#PumpWoodMicroService-3142"><span class="linenos">3142</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3143"><a href="#PumpWoodMicroService-3143"><span class="linenos">3143</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3144"><a href="#PumpWoodMicroService-3144"><span class="linenos">3144</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3145"><a href="#PumpWoodMicroService-3145"><span class="linenos">3145</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService-3146"><a href="#PumpWoodMicroService-3146"><span class="linenos">3146</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3147"><a href="#PumpWoodMicroService-3147"><span class="linenos">3147</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3148"><a href="#PumpWoodMicroService-3148"><span class="linenos">3148</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="PumpWoodMicroService-3149"><a href="#PumpWoodMicroService-3149"><span class="linenos">3149</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService-3150"><a href="#PumpWoodMicroService-3150"><span class="linenos">3150</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="PumpWoodMicroService-3151"><a href="#PumpWoodMicroService-3151"><span class="linenos">3151</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService-3152"><a href="#PumpWoodMicroService-3152"><span class="linenos">3152</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService-3153"><a href="#PumpWoodMicroService-3153"><span class="linenos">3153</span></a><span class="sd">            limit (int):</span>
</span><span id="PumpWoodMicroService-3154"><a href="#PumpWoodMicroService-3154"><span class="linenos">3154</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService-3155"><a href="#PumpWoodMicroService-3155"><span class="linenos">3155</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService-3156"><a href="#PumpWoodMicroService-3156"><span class="linenos">3156</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="PumpWoodMicroService-3157"><a href="#PumpWoodMicroService-3157"><span class="linenos">3157</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService-3158"><a href="#PumpWoodMicroService-3158"><span class="linenos">3158</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService-3159"><a href="#PumpWoodMicroService-3159"><span class="linenos">3159</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService-3160"><a href="#PumpWoodMicroService-3160"><span class="linenos">3160</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService-3161"><a href="#PumpWoodMicroService-3161"><span class="linenos">3161</span></a>
</span><span id="PumpWoodMicroService-3162"><a href="#PumpWoodMicroService-3162"><span class="linenos">3162</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3163"><a href="#PumpWoodMicroService-3163"><span class="linenos">3163</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="PumpWoodMicroService-3164"><a href="#PumpWoodMicroService-3164"><span class="linenos">3164</span></a>
</span><span id="PumpWoodMicroService-3165"><a href="#PumpWoodMicroService-3165"><span class="linenos">3165</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3166"><a href="#PumpWoodMicroService-3166"><span class="linenos">3166</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3167"><a href="#PumpWoodMicroService-3167"><span class="linenos">3167</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService-3168"><a href="#PumpWoodMicroService-3168"><span class="linenos">3168</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="PumpWoodMicroService-3169"><a href="#PumpWoodMicroService-3169"><span class="linenos">3169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3170"><a href="#PumpWoodMicroService-3170"><span class="linenos">3170</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3171"><a href="#PumpWoodMicroService-3171"><span class="linenos">3171</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3172"><a href="#PumpWoodMicroService-3172"><span class="linenos">3172</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3173"><a href="#PumpWoodMicroService-3173"><span class="linenos">3173</span></a>
</span><span id="PumpWoodMicroService-3174"><a href="#PumpWoodMicroService-3174"><span class="linenos">3174</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-3175"><a href="#PumpWoodMicroService-3175"><span class="linenos">3175</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3176"><a href="#PumpWoodMicroService-3176"><span class="linenos">3176</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3177"><a href="#PumpWoodMicroService-3177"><span class="linenos">3177</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3178"><a href="#PumpWoodMicroService-3178"><span class="linenos">3178</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3179"><a href="#PumpWoodMicroService-3179"><span class="linenos">3179</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3180"><a href="#PumpWoodMicroService-3180"><span class="linenos">3180</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3181"><a href="#PumpWoodMicroService-3181"><span class="linenos">3181</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3182"><a href="#PumpWoodMicroService-3182"><span class="linenos">3182</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3183"><a href="#PumpWoodMicroService-3183"><span class="linenos">3183</span></a>
</span><span id="PumpWoodMicroService-3184"><a href="#PumpWoodMicroService-3184"><span class="linenos">3184</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3185"><a href="#PumpWoodMicroService-3185"><span class="linenos">3185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3186"><a href="#PumpWoodMicroService-3186"><span class="linenos">3186</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3187"><a href="#PumpWoodMicroService-3187"><span class="linenos">3187</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3188"><a href="#PumpWoodMicroService-3188"><span class="linenos">3188</span></a>
</span><span id="PumpWoodMicroService-3189"><a href="#PumpWoodMicroService-3189"><span class="linenos">3189</span></a>    <span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3190"><a href="#PumpWoodMicroService-3190"><span class="linenos">3190</span></a>                                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-3191"><a href="#PumpWoodMicroService-3191"><span class="linenos">3191</span></a>                                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3192"><a href="#PumpWoodMicroService-3192"><span class="linenos">3192</span></a>                                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3193"><a href="#PumpWoodMicroService-3193"><span class="linenos">3193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_without_pag request.</span>
</span><span id="PumpWoodMicroService-3194"><a href="#PumpWoodMicroService-3194"><span class="linenos">3194</span></a>
</span><span id="PumpWoodMicroService-3195"><a href="#PumpWoodMicroService-3195"><span class="linenos">3195</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3196"><a href="#PumpWoodMicroService-3196"><span class="linenos">3196</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3197"><a href="#PumpWoodMicroService-3197"><span class="linenos">3197</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService-3198"><a href="#PumpWoodMicroService-3198"><span class="linenos">3198</span></a><span class="sd">            list_args:</span>
</span><span id="PumpWoodMicroService-3199"><a href="#PumpWoodMicroService-3199"><span class="linenos">3199</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="PumpWoodMicroService-3200"><a href="#PumpWoodMicroService-3200"><span class="linenos">3200</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="PumpWoodMicroService-3201"><a href="#PumpWoodMicroService-3201"><span class="linenos">3201</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="PumpWoodMicroService-3202"><a href="#PumpWoodMicroService-3202"><span class="linenos">3202</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="PumpWoodMicroService-3203"><a href="#PumpWoodMicroService-3203"><span class="linenos">3203</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3204"><a href="#PumpWoodMicroService-3204"><span class="linenos">3204</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3205"><a href="#PumpWoodMicroService-3205"><span class="linenos">3205</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3206"><a href="#PumpWoodMicroService-3206"><span class="linenos">3206</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3207"><a href="#PumpWoodMicroService-3207"><span class="linenos">3207</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3208"><a href="#PumpWoodMicroService-3208"><span class="linenos">3208</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3209"><a href="#PumpWoodMicroService-3209"><span class="linenos">3209</span></a>
</span><span id="PumpWoodMicroService-3210"><a href="#PumpWoodMicroService-3210"><span class="linenos">3210</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3211"><a href="#PumpWoodMicroService-3211"><span class="linenos">3211</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="PumpWoodMicroService-3212"><a href="#PumpWoodMicroService-3212"><span class="linenos">3212</span></a>
</span><span id="PumpWoodMicroService-3213"><a href="#PumpWoodMicroService-3213"><span class="linenos">3213</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3214"><a href="#PumpWoodMicroService-3214"><span class="linenos">3214</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3215"><a href="#PumpWoodMicroService-3215"><span class="linenos">3215</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService-3216"><a href="#PumpWoodMicroService-3216"><span class="linenos">3216</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="PumpWoodMicroService-3217"><a href="#PumpWoodMicroService-3217"><span class="linenos">3217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3218"><a href="#PumpWoodMicroService-3218"><span class="linenos">3218</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3219"><a href="#PumpWoodMicroService-3219"><span class="linenos">3219</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3220"><a href="#PumpWoodMicroService-3220"><span class="linenos">3220</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3221"><a href="#PumpWoodMicroService-3221"><span class="linenos">3221</span></a>
</span><span id="PumpWoodMicroService-3222"><a href="#PumpWoodMicroService-3222"><span class="linenos">3222</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-3223"><a href="#PumpWoodMicroService-3223"><span class="linenos">3223</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3224"><a href="#PumpWoodMicroService-3224"><span class="linenos">3224</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService-3225"><a href="#PumpWoodMicroService-3225"><span class="linenos">3225</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3226"><a href="#PumpWoodMicroService-3226"><span class="linenos">3226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3227"><a href="#PumpWoodMicroService-3227"><span class="linenos">3227</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3228"><a href="#PumpWoodMicroService-3228"><span class="linenos">3228</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3229"><a href="#PumpWoodMicroService-3229"><span class="linenos">3229</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3230"><a href="#PumpWoodMicroService-3230"><span class="linenos">3230</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3231"><a href="#PumpWoodMicroService-3231"><span class="linenos">3231</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3232"><a href="#PumpWoodMicroService-3232"><span class="linenos">3232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3233"><a href="#PumpWoodMicroService-3233"><span class="linenos">3233</span></a>
</span><span id="PumpWoodMicroService-3234"><a href="#PumpWoodMicroService-3234"><span class="linenos">3234</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3235"><a href="#PumpWoodMicroService-3235"><span class="linenos">3235</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3236"><a href="#PumpWoodMicroService-3236"><span class="linenos">3236</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3237"><a href="#PumpWoodMicroService-3237"><span class="linenos">3237</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3238"><a href="#PumpWoodMicroService-3238"><span class="linenos">3238</span></a>
</span><span id="PumpWoodMicroService-3239"><a href="#PumpWoodMicroService-3239"><span class="linenos">3239</span></a>    <span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3240"><a href="#PumpWoodMicroService-3240"><span class="linenos">3240</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3241"><a href="#PumpWoodMicroService-3241"><span class="linenos">3241</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3242"><a href="#PumpWoodMicroService-3242"><span class="linenos">3242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_one request.</span>
</span><span id="PumpWoodMicroService-3243"><a href="#PumpWoodMicroService-3243"><span class="linenos">3243</span></a>
</span><span id="PumpWoodMicroService-3244"><a href="#PumpWoodMicroService-3244"><span class="linenos">3244</span></a><span class="sd">        DEPRECTED user retrieve call with default_fields=True.</span>
</span><span id="PumpWoodMicroService-3245"><a href="#PumpWoodMicroService-3245"><span class="linenos">3245</span></a>
</span><span id="PumpWoodMicroService-3246"><a href="#PumpWoodMicroService-3246"><span class="linenos">3246</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3247"><a href="#PumpWoodMicroService-3247"><span class="linenos">3247</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3248"><a href="#PumpWoodMicroService-3248"><span class="linenos">3248</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="PumpWoodMicroService-3249"><a href="#PumpWoodMicroService-3249"><span class="linenos">3249</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService-3250"><a href="#PumpWoodMicroService-3250"><span class="linenos">3250</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="PumpWoodMicroService-3251"><a href="#PumpWoodMicroService-3251"><span class="linenos">3251</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3252"><a href="#PumpWoodMicroService-3252"><span class="linenos">3252</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3253"><a href="#PumpWoodMicroService-3253"><span class="linenos">3253</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3254"><a href="#PumpWoodMicroService-3254"><span class="linenos">3254</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3255"><a href="#PumpWoodMicroService-3255"><span class="linenos">3255</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3256"><a href="#PumpWoodMicroService-3256"><span class="linenos">3256</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3257"><a href="#PumpWoodMicroService-3257"><span class="linenos">3257</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3258"><a href="#PumpWoodMicroService-3258"><span class="linenos">3258</span></a>
</span><span id="PumpWoodMicroService-3259"><a href="#PumpWoodMicroService-3259"><span class="linenos">3259</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3260"><a href="#PumpWoodMicroService-3260"><span class="linenos">3260</span></a><span class="sd">            List of the list_one request data.</span>
</span><span id="PumpWoodMicroService-3261"><a href="#PumpWoodMicroService-3261"><span class="linenos">3261</span></a>
</span><span id="PumpWoodMicroService-3262"><a href="#PumpWoodMicroService-3262"><span class="linenos">3262</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3263"><a href="#PumpWoodMicroService-3263"><span class="linenos">3263</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3264"><a href="#PumpWoodMicroService-3264"><span class="linenos">3264</span></a><span class="sd">                &#39;len(model_class) != len(list_pk)&#39;. Indicates that lenght</span>
</span><span id="PumpWoodMicroService-3265"><a href="#PumpWoodMicroService-3265"><span class="linenos">3265</span></a><span class="sd">                of model_class and list_pk arguments are not equal.</span>
</span><span id="PumpWoodMicroService-3266"><a href="#PumpWoodMicroService-3266"><span class="linenos">3266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3267"><a href="#PumpWoodMicroService-3267"><span class="linenos">3267</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3268"><a href="#PumpWoodMicroService-3268"><span class="linenos">3268</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3269"><a href="#PumpWoodMicroService-3269"><span class="linenos">3269</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3270"><a href="#PumpWoodMicroService-3270"><span class="linenos">3270</span></a>
</span><span id="PumpWoodMicroService-3271"><a href="#PumpWoodMicroService-3271"><span class="linenos">3271</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3272"><a href="#PumpWoodMicroService-3272"><span class="linenos">3272</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3273"><a href="#PumpWoodMicroService-3273"><span class="linenos">3273</span></a>
</span><span id="PumpWoodMicroService-3274"><a href="#PumpWoodMicroService-3274"><span class="linenos">3274</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3275"><a href="#PumpWoodMicroService-3275"><span class="linenos">3275</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3276"><a href="#PumpWoodMicroService-3276"><span class="linenos">3276</span></a>
</span><span id="PumpWoodMicroService-3277"><a href="#PumpWoodMicroService-3277"><span class="linenos">3277</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3278"><a href="#PumpWoodMicroService-3278"><span class="linenos">3278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-3279"><a href="#PumpWoodMicroService-3279"><span class="linenos">3279</span></a>                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3280"><a href="#PumpWoodMicroService-3280"><span class="linenos">3280</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService-3281"><a href="#PumpWoodMicroService-3281"><span class="linenos">3281</span></a>
</span><span id="PumpWoodMicroService-3282"><a href="#PumpWoodMicroService-3282"><span class="linenos">3282</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3283"><a href="#PumpWoodMicroService-3283"><span class="linenos">3283</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3284"><a href="#PumpWoodMicroService-3284"><span class="linenos">3284</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3285"><a href="#PumpWoodMicroService-3285"><span class="linenos">3285</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3286"><a href="#PumpWoodMicroService-3286"><span class="linenos">3286</span></a>
</span><span id="PumpWoodMicroService-3287"><a href="#PumpWoodMicroService-3287"><span class="linenos">3287</span></a>    <span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-3288"><a href="#PumpWoodMicroService-3288"><span class="linenos">3288</span></a>                      <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3289"><a href="#PumpWoodMicroService-3289"><span class="linenos">3289</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-3290"><a href="#PumpWoodMicroService-3290"><span class="linenos">3290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel save requests.</span>
</span><span id="PumpWoodMicroService-3291"><a href="#PumpWoodMicroService-3291"><span class="linenos">3291</span></a>
</span><span id="PumpWoodMicroService-3292"><a href="#PumpWoodMicroService-3292"><span class="linenos">3292</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3293"><a href="#PumpWoodMicroService-3293"><span class="linenos">3293</span></a><span class="sd">            list_obj_dict:</span>
</span><span id="PumpWoodMicroService-3294"><a href="#PumpWoodMicroService-3294"><span class="linenos">3294</span></a><span class="sd">                List of dictionaries containing PumpWood objects</span>
</span><span id="PumpWoodMicroService-3295"><a href="#PumpWoodMicroService-3295"><span class="linenos">3295</span></a><span class="sd">                (must have at least &#39;model_class&#39; key).</span>
</span><span id="PumpWoodMicroService-3296"><a href="#PumpWoodMicroService-3296"><span class="linenos">3296</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3297"><a href="#PumpWoodMicroService-3297"><span class="linenos">3297</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3298"><a href="#PumpWoodMicroService-3298"><span class="linenos">3298</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3299"><a href="#PumpWoodMicroService-3299"><span class="linenos">3299</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3300"><a href="#PumpWoodMicroService-3300"><span class="linenos">3300</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3301"><a href="#PumpWoodMicroService-3301"><span class="linenos">3301</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3302"><a href="#PumpWoodMicroService-3302"><span class="linenos">3302</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3303"><a href="#PumpWoodMicroService-3303"><span class="linenos">3303</span></a>
</span><span id="PumpWoodMicroService-3304"><a href="#PumpWoodMicroService-3304"><span class="linenos">3304</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3305"><a href="#PumpWoodMicroService-3305"><span class="linenos">3305</span></a><span class="sd">            List of the save request data.</span>
</span><span id="PumpWoodMicroService-3306"><a href="#PumpWoodMicroService-3306"><span class="linenos">3306</span></a>
</span><span id="PumpWoodMicroService-3307"><a href="#PumpWoodMicroService-3307"><span class="linenos">3307</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3308"><a href="#PumpWoodMicroService-3308"><span class="linenos">3308</span></a><span class="sd">            No particular raises</span>
</span><span id="PumpWoodMicroService-3309"><a href="#PumpWoodMicroService-3309"><span class="linenos">3309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3310"><a href="#PumpWoodMicroService-3310"><span class="linenos">3310</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3311"><a href="#PumpWoodMicroService-3311"><span class="linenos">3311</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3312"><a href="#PumpWoodMicroService-3312"><span class="linenos">3312</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3313"><a href="#PumpWoodMicroService-3313"><span class="linenos">3313</span></a>
</span><span id="PumpWoodMicroService-3314"><a href="#PumpWoodMicroService-3314"><span class="linenos">3314</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3315"><a href="#PumpWoodMicroService-3315"><span class="linenos">3315</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3316"><a href="#PumpWoodMicroService-3316"><span class="linenos">3316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3317"><a href="#PumpWoodMicroService-3317"><span class="linenos">3317</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3318"><a href="#PumpWoodMicroService-3318"><span class="linenos">3318</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3319"><a href="#PumpWoodMicroService-3319"><span class="linenos">3319</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3320"><a href="#PumpWoodMicroService-3320"><span class="linenos">3320</span></a>
</span><span id="PumpWoodMicroService-3321"><a href="#PumpWoodMicroService-3321"><span class="linenos">3321</span></a>    <span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3322"><a href="#PumpWoodMicroService-3322"><span class="linenos">3322</span></a>                        <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3323"><a href="#PumpWoodMicroService-3323"><span class="linenos">3323</span></a>                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3324"><a href="#PumpWoodMicroService-3324"><span class="linenos">3324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] delete requests.</span>
</span><span id="PumpWoodMicroService-3325"><a href="#PumpWoodMicroService-3325"><span class="linenos">3325</span></a>
</span><span id="PumpWoodMicroService-3326"><a href="#PumpWoodMicroService-3326"><span class="linenos">3326</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3327"><a href="#PumpWoodMicroService-3327"><span class="linenos">3327</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3328"><a href="#PumpWoodMicroService-3328"><span class="linenos">3328</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="PumpWoodMicroService-3329"><a href="#PumpWoodMicroService-3329"><span class="linenos">3329</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService-3330"><a href="#PumpWoodMicroService-3330"><span class="linenos">3330</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="PumpWoodMicroService-3331"><a href="#PumpWoodMicroService-3331"><span class="linenos">3331</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3332"><a href="#PumpWoodMicroService-3332"><span class="linenos">3332</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3333"><a href="#PumpWoodMicroService-3333"><span class="linenos">3333</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3334"><a href="#PumpWoodMicroService-3334"><span class="linenos">3334</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3335"><a href="#PumpWoodMicroService-3335"><span class="linenos">3335</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3336"><a href="#PumpWoodMicroService-3336"><span class="linenos">3336</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3337"><a href="#PumpWoodMicroService-3337"><span class="linenos">3337</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3338"><a href="#PumpWoodMicroService-3338"><span class="linenos">3338</span></a>
</span><span id="PumpWoodMicroService-3339"><a href="#PumpWoodMicroService-3339"><span class="linenos">3339</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3340"><a href="#PumpWoodMicroService-3340"><span class="linenos">3340</span></a><span class="sd">            List of the delete request data.</span>
</span><span id="PumpWoodMicroService-3341"><a href="#PumpWoodMicroService-3341"><span class="linenos">3341</span></a>
</span><span id="PumpWoodMicroService-3342"><a href="#PumpWoodMicroService-3342"><span class="linenos">3342</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3343"><a href="#PumpWoodMicroService-3343"><span class="linenos">3343</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3344"><a href="#PumpWoodMicroService-3344"><span class="linenos">3344</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="PumpWoodMicroService-3345"><a href="#PumpWoodMicroService-3345"><span class="linenos">3345</span></a><span class="sd">                that length of model_class and list_args arguments are not</span>
</span><span id="PumpWoodMicroService-3346"><a href="#PumpWoodMicroService-3346"><span class="linenos">3346</span></a><span class="sd">                equal.</span>
</span><span id="PumpWoodMicroService-3347"><a href="#PumpWoodMicroService-3347"><span class="linenos">3347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3348"><a href="#PumpWoodMicroService-3348"><span class="linenos">3348</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3349"><a href="#PumpWoodMicroService-3349"><span class="linenos">3349</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3350"><a href="#PumpWoodMicroService-3350"><span class="linenos">3350</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3351"><a href="#PumpWoodMicroService-3351"><span class="linenos">3351</span></a>
</span><span id="PumpWoodMicroService-3352"><a href="#PumpWoodMicroService-3352"><span class="linenos">3352</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3353"><a href="#PumpWoodMicroService-3353"><span class="linenos">3353</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3354"><a href="#PumpWoodMicroService-3354"><span class="linenos">3354</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3355"><a href="#PumpWoodMicroService-3355"><span class="linenos">3355</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3356"><a href="#PumpWoodMicroService-3356"><span class="linenos">3356</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3357"><a href="#PumpWoodMicroService-3357"><span class="linenos">3357</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3358"><a href="#PumpWoodMicroService-3358"><span class="linenos">3358</span></a>
</span><span id="PumpWoodMicroService-3359"><a href="#PumpWoodMicroService-3359"><span class="linenos">3359</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3360"><a href="#PumpWoodMicroService-3360"><span class="linenos">3360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-3361"><a href="#PumpWoodMicroService-3361"><span class="linenos">3361</span></a>                                           <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3362"><a href="#PumpWoodMicroService-3362"><span class="linenos">3362</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService-3363"><a href="#PumpWoodMicroService-3363"><span class="linenos">3363</span></a>
</span><span id="PumpWoodMicroService-3364"><a href="#PumpWoodMicroService-3364"><span class="linenos">3364</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3365"><a href="#PumpWoodMicroService-3365"><span class="linenos">3365</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3366"><a href="#PumpWoodMicroService-3366"><span class="linenos">3366</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3367"><a href="#PumpWoodMicroService-3367"><span class="linenos">3367</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3368"><a href="#PumpWoodMicroService-3368"><span class="linenos">3368</span></a>
</span><span id="PumpWoodMicroService-3369"><a href="#PumpWoodMicroService-3369"><span class="linenos">3369</span></a>    <span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3370"><a href="#PumpWoodMicroService-3370"><span class="linenos">3370</span></a>                             <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3371"><a href="#PumpWoodMicroService-3371"><span class="linenos">3371</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-3372"><a href="#PumpWoodMicroService-3372"><span class="linenos">3372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete_many request.</span>
</span><span id="PumpWoodMicroService-3373"><a href="#PumpWoodMicroService-3373"><span class="linenos">3373</span></a>
</span><span id="PumpWoodMicroService-3374"><a href="#PumpWoodMicroService-3374"><span class="linenos">3374</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3375"><a href="#PumpWoodMicroService-3375"><span class="linenos">3375</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService-3376"><a href="#PumpWoodMicroService-3376"><span class="linenos">3376</span></a><span class="sd">                Model Class to delete many.</span>
</span><span id="PumpWoodMicroService-3377"><a href="#PumpWoodMicroService-3377"><span class="linenos">3377</span></a><span class="sd">            list_args (list):</span>
</span><span id="PumpWoodMicroService-3378"><a href="#PumpWoodMicroService-3378"><span class="linenos">3378</span></a><span class="sd">                A list of list request args (filter_dict, exclude_dict).</span>
</span><span id="PumpWoodMicroService-3379"><a href="#PumpWoodMicroService-3379"><span class="linenos">3379</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3380"><a href="#PumpWoodMicroService-3380"><span class="linenos">3380</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3381"><a href="#PumpWoodMicroService-3381"><span class="linenos">3381</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3382"><a href="#PumpWoodMicroService-3382"><span class="linenos">3382</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3383"><a href="#PumpWoodMicroService-3383"><span class="linenos">3383</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3384"><a href="#PumpWoodMicroService-3384"><span class="linenos">3384</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3385"><a href="#PumpWoodMicroService-3385"><span class="linenos">3385</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3386"><a href="#PumpWoodMicroService-3386"><span class="linenos">3386</span></a>
</span><span id="PumpWoodMicroService-3387"><a href="#PumpWoodMicroService-3387"><span class="linenos">3387</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3388"><a href="#PumpWoodMicroService-3388"><span class="linenos">3388</span></a><span class="sd">            List of the delete many request reponses.</span>
</span><span id="PumpWoodMicroService-3389"><a href="#PumpWoodMicroService-3389"><span class="linenos">3389</span></a>
</span><span id="PumpWoodMicroService-3390"><a href="#PumpWoodMicroService-3390"><span class="linenos">3390</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3391"><a href="#PumpWoodMicroService-3391"><span class="linenos">3391</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3392"><a href="#PumpWoodMicroService-3392"><span class="linenos">3392</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="PumpWoodMicroService-3393"><a href="#PumpWoodMicroService-3393"><span class="linenos">3393</span></a><span class="sd">                that length of model_class and list_args arguments</span>
</span><span id="PumpWoodMicroService-3394"><a href="#PumpWoodMicroService-3394"><span class="linenos">3394</span></a><span class="sd">                are not equal.</span>
</span><span id="PumpWoodMicroService-3395"><a href="#PumpWoodMicroService-3395"><span class="linenos">3395</span></a>
</span><span id="PumpWoodMicroService-3396"><a href="#PumpWoodMicroService-3396"><span class="linenos">3396</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-3397"><a href="#PumpWoodMicroService-3397"><span class="linenos">3397</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService-3398"><a href="#PumpWoodMicroService-3398"><span class="linenos">3398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3399"><a href="#PumpWoodMicroService-3399"><span class="linenos">3399</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3400"><a href="#PumpWoodMicroService-3400"><span class="linenos">3400</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3401"><a href="#PumpWoodMicroService-3401"><span class="linenos">3401</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3402"><a href="#PumpWoodMicroService-3402"><span class="linenos">3402</span></a>
</span><span id="PumpWoodMicroService-3403"><a href="#PumpWoodMicroService-3403"><span class="linenos">3403</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-3404"><a href="#PumpWoodMicroService-3404"><span class="linenos">3404</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3405"><a href="#PumpWoodMicroService-3405"><span class="linenos">3405</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService-3406"><a href="#PumpWoodMicroService-3406"><span class="linenos">3406</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3407"><a href="#PumpWoodMicroService-3407"><span class="linenos">3407</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3408"><a href="#PumpWoodMicroService-3408"><span class="linenos">3408</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3409"><a href="#PumpWoodMicroService-3409"><span class="linenos">3409</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3410"><a href="#PumpWoodMicroService-3410"><span class="linenos">3410</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3411"><a href="#PumpWoodMicroService-3411"><span class="linenos">3411</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3412"><a href="#PumpWoodMicroService-3412"><span class="linenos">3412</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3413"><a href="#PumpWoodMicroService-3413"><span class="linenos">3413</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService-3414"><a href="#PumpWoodMicroService-3414"><span class="linenos">3414</span></a>
</span><span id="PumpWoodMicroService-3415"><a href="#PumpWoodMicroService-3415"><span class="linenos">3415</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3416"><a href="#PumpWoodMicroService-3416"><span class="linenos">3416</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3417"><a href="#PumpWoodMicroService-3417"><span class="linenos">3417</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3418"><a href="#PumpWoodMicroService-3418"><span class="linenos">3418</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3419"><a href="#PumpWoodMicroService-3419"><span class="linenos">3419</span></a>
</span><span id="PumpWoodMicroService-3420"><a href="#PumpWoodMicroService-3420"><span class="linenos">3420</span></a>    <span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3421"><a href="#PumpWoodMicroService-3421"><span class="linenos">3421</span></a>                                <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3422"><a href="#PumpWoodMicroService-3422"><span class="linenos">3422</span></a>                                <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3423"><a href="#PumpWoodMicroService-3423"><span class="linenos">3423</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService-3424"><a href="#PumpWoodMicroService-3424"><span class="linenos">3424</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3425"><a href="#PumpWoodMicroService-3425"><span class="linenos">3425</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-3426"><a href="#PumpWoodMicroService-3426"><span class="linenos">3426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel execute_action requests.</span>
</span><span id="PumpWoodMicroService-3427"><a href="#PumpWoodMicroService-3427"><span class="linenos">3427</span></a>
</span><span id="PumpWoodMicroService-3428"><a href="#PumpWoodMicroService-3428"><span class="linenos">3428</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3429"><a href="#PumpWoodMicroService-3429"><span class="linenos">3429</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3430"><a href="#PumpWoodMicroService-3430"><span class="linenos">3430</span></a><span class="sd">                Model Class to perform action over,</span>
</span><span id="PumpWoodMicroService-3431"><a href="#PumpWoodMicroService-3431"><span class="linenos">3431</span></a><span class="sd">                or a list of model class o make diferent actions.</span>
</span><span id="PumpWoodMicroService-3432"><a href="#PumpWoodMicroService-3432"><span class="linenos">3432</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService-3433"><a href="#PumpWoodMicroService-3433"><span class="linenos">3433</span></a><span class="sd">                A list of the pks to perform action or a</span>
</span><span id="PumpWoodMicroService-3434"><a href="#PumpWoodMicroService-3434"><span class="linenos">3434</span></a><span class="sd">                single pk to perform action with different paraemters.</span>
</span><span id="PumpWoodMicroService-3435"><a href="#PumpWoodMicroService-3435"><span class="linenos">3435</span></a><span class="sd">            action:</span>
</span><span id="PumpWoodMicroService-3436"><a href="#PumpWoodMicroService-3436"><span class="linenos">3436</span></a><span class="sd">                A list of actions to perform or a single</span>
</span><span id="PumpWoodMicroService-3437"><a href="#PumpWoodMicroService-3437"><span class="linenos">3437</span></a><span class="sd">                action to perform over all pks and parameters.</span>
</span><span id="PumpWoodMicroService-3438"><a href="#PumpWoodMicroService-3438"><span class="linenos">3438</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService-3439"><a href="#PumpWoodMicroService-3439"><span class="linenos">3439</span></a><span class="sd">                Parameters used to perform actions</span>
</span><span id="PumpWoodMicroService-3440"><a href="#PumpWoodMicroService-3440"><span class="linenos">3440</span></a><span class="sd">                or a single dict to be used in all actions.</span>
</span><span id="PumpWoodMicroService-3441"><a href="#PumpWoodMicroService-3441"><span class="linenos">3441</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3442"><a href="#PumpWoodMicroService-3442"><span class="linenos">3442</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3443"><a href="#PumpWoodMicroService-3443"><span class="linenos">3443</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3444"><a href="#PumpWoodMicroService-3444"><span class="linenos">3444</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3445"><a href="#PumpWoodMicroService-3445"><span class="linenos">3445</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3446"><a href="#PumpWoodMicroService-3446"><span class="linenos">3446</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3447"><a href="#PumpWoodMicroService-3447"><span class="linenos">3447</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3448"><a href="#PumpWoodMicroService-3448"><span class="linenos">3448</span></a>
</span><span id="PumpWoodMicroService-3449"><a href="#PumpWoodMicroService-3449"><span class="linenos">3449</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3450"><a href="#PumpWoodMicroService-3450"><span class="linenos">3450</span></a><span class="sd">            List of the execute_action request data.</span>
</span><span id="PumpWoodMicroService-3451"><a href="#PumpWoodMicroService-3451"><span class="linenos">3451</span></a>
</span><span id="PumpWoodMicroService-3452"><a href="#PumpWoodMicroService-3452"><span class="linenos">3452</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3453"><a href="#PumpWoodMicroService-3453"><span class="linenos">3453</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService-3454"><a href="#PumpWoodMicroService-3454"><span class="linenos">3454</span></a><span class="sd">                &#39;parallel_length != len([argument])&#39;. Indicates that function</span>
</span><span id="PumpWoodMicroService-3455"><a href="#PumpWoodMicroService-3455"><span class="linenos">3455</span></a><span class="sd">                arguments does not have all the same lenght.</span>
</span><span id="PumpWoodMicroService-3456"><a href="#PumpWoodMicroService-3456"><span class="linenos">3456</span></a>
</span><span id="PumpWoodMicroService-3457"><a href="#PumpWoodMicroService-3457"><span class="linenos">3457</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-3458"><a href="#PumpWoodMicroService-3458"><span class="linenos">3458</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService-3459"><a href="#PumpWoodMicroService-3459"><span class="linenos">3459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3460"><a href="#PumpWoodMicroService-3460"><span class="linenos">3460</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3461"><a href="#PumpWoodMicroService-3461"><span class="linenos">3461</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3462"><a href="#PumpWoodMicroService-3462"><span class="linenos">3462</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3463"><a href="#PumpWoodMicroService-3463"><span class="linenos">3463</span></a>
</span><span id="PumpWoodMicroService-3464"><a href="#PumpWoodMicroService-3464"><span class="linenos">3464</span></a>        <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService-3465"><a href="#PumpWoodMicroService-3465"><span class="linenos">3465</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3466"><a href="#PumpWoodMicroService-3466"><span class="linenos">3466</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3467"><a href="#PumpWoodMicroService-3467"><span class="linenos">3467</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3468"><a href="#PumpWoodMicroService-3468"><span class="linenos">3468</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3469"><a href="#PumpWoodMicroService-3469"><span class="linenos">3469</span></a>                        <span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3470"><a href="#PumpWoodMicroService-3470"><span class="linenos">3470</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3471"><a href="#PumpWoodMicroService-3471"><span class="linenos">3471</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3472"><a href="#PumpWoodMicroService-3472"><span class="linenos">3472</span></a>
</span><span id="PumpWoodMicroService-3473"><a href="#PumpWoodMicroService-3473"><span class="linenos">3473</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3474"><a href="#PumpWoodMicroService-3474"><span class="linenos">3474</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3475"><a href="#PumpWoodMicroService-3475"><span class="linenos">3475</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3476"><a href="#PumpWoodMicroService-3476"><span class="linenos">3476</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3477"><a href="#PumpWoodMicroService-3477"><span class="linenos">3477</span></a>                        <span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3478"><a href="#PumpWoodMicroService-3478"><span class="linenos">3478</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3479"><a href="#PumpWoodMicroService-3479"><span class="linenos">3479</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3480"><a href="#PumpWoodMicroService-3480"><span class="linenos">3480</span></a>
</span><span id="PumpWoodMicroService-3481"><a href="#PumpWoodMicroService-3481"><span class="linenos">3481</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3482"><a href="#PumpWoodMicroService-3482"><span class="linenos">3482</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3483"><a href="#PumpWoodMicroService-3483"><span class="linenos">3483</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3484"><a href="#PumpWoodMicroService-3484"><span class="linenos">3484</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3485"><a href="#PumpWoodMicroService-3485"><span class="linenos">3485</span></a>                        <span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3486"><a href="#PumpWoodMicroService-3486"><span class="linenos">3486</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3487"><a href="#PumpWoodMicroService-3487"><span class="linenos">3487</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3488"><a href="#PumpWoodMicroService-3488"><span class="linenos">3488</span></a>
</span><span id="PumpWoodMicroService-3489"><a href="#PumpWoodMicroService-3489"><span class="linenos">3489</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3490"><a href="#PumpWoodMicroService-3490"><span class="linenos">3490</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3491"><a href="#PumpWoodMicroService-3491"><span class="linenos">3491</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3492"><a href="#PumpWoodMicroService-3492"><span class="linenos">3492</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3493"><a href="#PumpWoodMicroService-3493"><span class="linenos">3493</span></a>                        <span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3494"><a href="#PumpWoodMicroService-3494"><span class="linenos">3494</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3495"><a href="#PumpWoodMicroService-3495"><span class="linenos">3495</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3496"><a href="#PumpWoodMicroService-3496"><span class="linenos">3496</span></a>
</span><span id="PumpWoodMicroService-3497"><a href="#PumpWoodMicroService-3497"><span class="linenos">3497</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-3498"><a href="#PumpWoodMicroService-3498"><span class="linenos">3498</span></a>            <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService-3499"><a href="#PumpWoodMicroService-3499"><span class="linenos">3499</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3500"><a href="#PumpWoodMicroService-3500"><span class="linenos">3500</span></a>        <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-3501"><a href="#PumpWoodMicroService-3501"><span class="linenos">3501</span></a>            <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService-3502"><a href="#PumpWoodMicroService-3502"><span class="linenos">3502</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3503"><a href="#PumpWoodMicroService-3503"><span class="linenos">3503</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-3504"><a href="#PumpWoodMicroService-3504"><span class="linenos">3504</span></a>            <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService-3505"><a href="#PumpWoodMicroService-3505"><span class="linenos">3505</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3506"><a href="#PumpWoodMicroService-3506"><span class="linenos">3506</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService-3507"><a href="#PumpWoodMicroService-3507"><span class="linenos">3507</span></a>            <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService-3508"><a href="#PumpWoodMicroService-3508"><span class="linenos">3508</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3509"><a href="#PumpWoodMicroService-3509"><span class="linenos">3509</span></a>
</span><span id="PumpWoodMicroService-3510"><a href="#PumpWoodMicroService-3510"><span class="linenos">3510</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService-3511"><a href="#PumpWoodMicroService-3511"><span class="linenos">3511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3512"><a href="#PumpWoodMicroService-3512"><span class="linenos">3512</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3513"><a href="#PumpWoodMicroService-3513"><span class="linenos">3513</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService-3514"><a href="#PumpWoodMicroService-3514"><span class="linenos">3514</span></a>
</span><span id="PumpWoodMicroService-3515"><a href="#PumpWoodMicroService-3515"><span class="linenos">3515</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3516"><a href="#PumpWoodMicroService-3516"><span class="linenos">3516</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3517"><a href="#PumpWoodMicroService-3517"><span class="linenos">3517</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3518"><a href="#PumpWoodMicroService-3518"><span class="linenos">3518</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3519"><a href="#PumpWoodMicroService-3519"><span class="linenos">3519</span></a>
</span><span id="PumpWoodMicroService-3520"><a href="#PumpWoodMicroService-3520"><span class="linenos">3520</span></a>    <span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3521"><a href="#PumpWoodMicroService-3521"><span class="linenos">3521</span></a>                           <span class="n">data_to_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService-3522"><a href="#PumpWoodMicroService-3522"><span class="linenos">3522</span></a>                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3523"><a href="#PumpWoodMicroService-3523"><span class="linenos">3523</span></a>                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3524"><a href="#PumpWoodMicroService-3524"><span class="linenos">3524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Break data_to_save in many parallel bulk_save requests.</span>
</span><span id="PumpWoodMicroService-3525"><a href="#PumpWoodMicroService-3525"><span class="linenos">3525</span></a>
</span><span id="PumpWoodMicroService-3526"><a href="#PumpWoodMicroService-3526"><span class="linenos">3526</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3527"><a href="#PumpWoodMicroService-3527"><span class="linenos">3527</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3528"><a href="#PumpWoodMicroService-3528"><span class="linenos">3528</span></a><span class="sd">                Model class of the data that will be saved.</span>
</span><span id="PumpWoodMicroService-3529"><a href="#PumpWoodMicroService-3529"><span class="linenos">3529</span></a><span class="sd">            data_to_save:</span>
</span><span id="PumpWoodMicroService-3530"><a href="#PumpWoodMicroService-3530"><span class="linenos">3530</span></a><span class="sd">                Data that will be saved</span>
</span><span id="PumpWoodMicroService-3531"><a href="#PumpWoodMicroService-3531"><span class="linenos">3531</span></a><span class="sd">            chunksize:</span>
</span><span id="PumpWoodMicroService-3532"><a href="#PumpWoodMicroService-3532"><span class="linenos">3532</span></a><span class="sd">                Length of each parallel bulk save chunk.</span>
</span><span id="PumpWoodMicroService-3533"><a href="#PumpWoodMicroService-3533"><span class="linenos">3533</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3534"><a href="#PumpWoodMicroService-3534"><span class="linenos">3534</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3535"><a href="#PumpWoodMicroService-3535"><span class="linenos">3535</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3536"><a href="#PumpWoodMicroService-3536"><span class="linenos">3536</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3537"><a href="#PumpWoodMicroService-3537"><span class="linenos">3537</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3538"><a href="#PumpWoodMicroService-3538"><span class="linenos">3538</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3539"><a href="#PumpWoodMicroService-3539"><span class="linenos">3539</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3540"><a href="#PumpWoodMicroService-3540"><span class="linenos">3540</span></a>
</span><span id="PumpWoodMicroService-3541"><a href="#PumpWoodMicroService-3541"><span class="linenos">3541</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3542"><a href="#PumpWoodMicroService-3542"><span class="linenos">3542</span></a><span class="sd">            List of the responses of bulk_save.</span>
</span><span id="PumpWoodMicroService-3543"><a href="#PumpWoodMicroService-3543"><span class="linenos">3543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3544"><a href="#PumpWoodMicroService-3544"><span class="linenos">3544</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3545"><a href="#PumpWoodMicroService-3545"><span class="linenos">3545</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3546"><a href="#PumpWoodMicroService-3546"><span class="linenos">3546</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3547"><a href="#PumpWoodMicroService-3547"><span class="linenos">3547</span></a>
</span><span id="PumpWoodMicroService-3548"><a href="#PumpWoodMicroService-3548"><span class="linenos">3548</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3549"><a href="#PumpWoodMicroService-3549"><span class="linenos">3549</span></a>            <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3550"><a href="#PumpWoodMicroService-3550"><span class="linenos">3550</span></a>
</span><span id="PumpWoodMicroService-3551"><a href="#PumpWoodMicroService-3551"><span class="linenos">3551</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3552"><a href="#PumpWoodMicroService-3552"><span class="linenos">3552</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3553"><a href="#PumpWoodMicroService-3553"><span class="linenos">3553</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3554"><a href="#PumpWoodMicroService-3554"><span class="linenos">3554</span></a>
</span><span id="PumpWoodMicroService-3555"><a href="#PumpWoodMicroService-3555"><span class="linenos">3555</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3556"><a href="#PumpWoodMicroService-3556"><span class="linenos">3556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3557"><a href="#PumpWoodMicroService-3557"><span class="linenos">3557</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3558"><a href="#PumpWoodMicroService-3558"><span class="linenos">3558</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3559"><a href="#PumpWoodMicroService-3559"><span class="linenos">3559</span></a>
</span><span id="PumpWoodMicroService-3560"><a href="#PumpWoodMicroService-3560"><span class="linenos">3560</span></a>    <span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService-3561"><a href="#PumpWoodMicroService-3561"><span class="linenos">3561</span></a>                       <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3562"><a href="#PumpWoodMicroService-3562"><span class="linenos">3562</span></a>                       <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3563"><a href="#PumpWoodMicroService-3563"><span class="linenos">3563</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService-3564"><a href="#PumpWoodMicroService-3564"><span class="linenos">3564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel pivot request.</span>
</span><span id="PumpWoodMicroService-3565"><a href="#PumpWoodMicroService-3565"><span class="linenos">3565</span></a>
</span><span id="PumpWoodMicroService-3566"><a href="#PumpWoodMicroService-3566"><span class="linenos">3566</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService-3567"><a href="#PumpWoodMicroService-3567"><span class="linenos">3567</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService-3568"><a href="#PumpWoodMicroService-3568"><span class="linenos">3568</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService-3569"><a href="#PumpWoodMicroService-3569"><span class="linenos">3569</span></a><span class="sd">            list_args:</span>
</span><span id="PumpWoodMicroService-3570"><a href="#PumpWoodMicroService-3570"><span class="linenos">3570</span></a><span class="sd">                A list of list request args (filter_dict,exclude_dict,</span>
</span><span id="PumpWoodMicroService-3571"><a href="#PumpWoodMicroService-3571"><span class="linenos">3571</span></a><span class="sd">                order_by).</span>
</span><span id="PumpWoodMicroService-3572"><a href="#PumpWoodMicroService-3572"><span class="linenos">3572</span></a><span class="sd">            columns:</span>
</span><span id="PumpWoodMicroService-3573"><a href="#PumpWoodMicroService-3573"><span class="linenos">3573</span></a><span class="sd">                List of columns at the pivoted table.</span>
</span><span id="PumpWoodMicroService-3574"><a href="#PumpWoodMicroService-3574"><span class="linenos">3574</span></a><span class="sd">            format:</span>
</span><span id="PumpWoodMicroService-3575"><a href="#PumpWoodMicroService-3575"><span class="linenos">3575</span></a><span class="sd">                Format of returned table. See pandas.DataFrame</span>
</span><span id="PumpWoodMicroService-3576"><a href="#PumpWoodMicroService-3576"><span class="linenos">3576</span></a><span class="sd">                to_dict args.</span>
</span><span id="PumpWoodMicroService-3577"><a href="#PumpWoodMicroService-3577"><span class="linenos">3577</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService-3578"><a href="#PumpWoodMicroService-3578"><span class="linenos">3578</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService-3579"><a href="#PumpWoodMicroService-3579"><span class="linenos">3579</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService-3580"><a href="#PumpWoodMicroService-3580"><span class="linenos">3580</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService-3581"><a href="#PumpWoodMicroService-3581"><span class="linenos">3581</span></a><span class="sd">            variables:</span>
</span><span id="PumpWoodMicroService-3582"><a href="#PumpWoodMicroService-3582"><span class="linenos">3582</span></a><span class="sd">                Restrict the fields that will be returned at the query.</span>
</span><span id="PumpWoodMicroService-3583"><a href="#PumpWoodMicroService-3583"><span class="linenos">3583</span></a><span class="sd">            show_deleted:</span>
</span><span id="PumpWoodMicroService-3584"><a href="#PumpWoodMicroService-3584"><span class="linenos">3584</span></a><span class="sd">                If results should include data with deleted=True. This will</span>
</span><span id="PumpWoodMicroService-3585"><a href="#PumpWoodMicroService-3585"><span class="linenos">3585</span></a><span class="sd">                be ignored if model class does not have deleted field.</span>
</span><span id="PumpWoodMicroService-3586"><a href="#PumpWoodMicroService-3586"><span class="linenos">3586</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService-3587"><a href="#PumpWoodMicroService-3587"><span class="linenos">3587</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService-3588"><a href="#PumpWoodMicroService-3588"><span class="linenos">3588</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService-3589"><a href="#PumpWoodMicroService-3589"><span class="linenos">3589</span></a>
</span><span id="PumpWoodMicroService-3590"><a href="#PumpWoodMicroService-3590"><span class="linenos">3590</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService-3591"><a href="#PumpWoodMicroService-3591"><span class="linenos">3591</span></a><span class="sd">            List of the pivot request reponses.</span>
</span><span id="PumpWoodMicroService-3592"><a href="#PumpWoodMicroService-3592"><span class="linenos">3592</span></a>
</span><span id="PumpWoodMicroService-3593"><a href="#PumpWoodMicroService-3593"><span class="linenos">3593</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService-3594"><a href="#PumpWoodMicroService-3594"><span class="linenos">3594</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService-3595"><a href="#PumpWoodMicroService-3595"><span class="linenos">3595</span></a>
</span><span id="PumpWoodMicroService-3596"><a href="#PumpWoodMicroService-3596"><span class="linenos">3596</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService-3597"><a href="#PumpWoodMicroService-3597"><span class="linenos">3597</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService-3598"><a href="#PumpWoodMicroService-3598"><span class="linenos">3598</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3599"><a href="#PumpWoodMicroService-3599"><span class="linenos">3599</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3600"><a href="#PumpWoodMicroService-3600"><span class="linenos">3600</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3601"><a href="#PumpWoodMicroService-3601"><span class="linenos">3601</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3602"><a href="#PumpWoodMicroService-3602"><span class="linenos">3602</span></a>
</span><span id="PumpWoodMicroService-3603"><a href="#PumpWoodMicroService-3603"><span class="linenos">3603</span></a>        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService-3604"><a href="#PumpWoodMicroService-3604"><span class="linenos">3604</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3605"><a href="#PumpWoodMicroService-3605"><span class="linenos">3605</span></a>        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3606"><a href="#PumpWoodMicroService-3606"><span class="linenos">3606</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
</span><span id="PumpWoodMicroService-3607"><a href="#PumpWoodMicroService-3607"><span class="linenos">3607</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
</span><span id="PumpWoodMicroService-3608"><a href="#PumpWoodMicroService-3608"><span class="linenos">3608</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
</span><span id="PumpWoodMicroService-3609"><a href="#PumpWoodMicroService-3609"><span class="linenos">3609</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>
</span><span id="PumpWoodMicroService-3610"><a href="#PumpWoodMicroService-3610"><span class="linenos">3610</span></a>
</span><span id="PumpWoodMicroService-3611"><a href="#PumpWoodMicroService-3611"><span class="linenos">3611</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3612"><a href="#PumpWoodMicroService-3612"><span class="linenos">3612</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3613"><a href="#PumpWoodMicroService-3613"><span class="linenos">3613</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3614"><a href="#PumpWoodMicroService-3614"><span class="linenos">3614</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3615"><a href="#PumpWoodMicroService-3615"><span class="linenos">3615</span></a>
</span><span id="PumpWoodMicroService-3616"><a href="#PumpWoodMicroService-3616"><span class="linenos">3616</span></a>    <span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3617"><a href="#PumpWoodMicroService-3617"><span class="linenos">3617</span></a>                         <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService-3618"><a href="#PumpWoodMicroService-3618"><span class="linenos">3618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix. In development...&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService-3619"><a href="#PumpWoodMicroService-3619"><span class="linenos">3619</span></a>        <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3620"><a href="#PumpWoodMicroService-3620"><span class="linenos">3620</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3621"><a href="#PumpWoodMicroService-3621"><span class="linenos">3621</span></a>            <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3622"><a href="#PumpWoodMicroService-3622"><span class="linenos">3622</span></a>            <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3623"><a href="#PumpWoodMicroService-3623"><span class="linenos">3623</span></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
</span><span id="PumpWoodMicroService-3624"><a href="#PumpWoodMicroService-3624"><span class="linenos">3624</span></a>            <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-3625"><a href="#PumpWoodMicroService-3625"><span class="linenos">3625</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="PumpWoodMicroService-3626"><a href="#PumpWoodMicroService-3626"><span class="linenos">3626</span></a>        <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3627"><a href="#PumpWoodMicroService-3627"><span class="linenos">3627</span></a>        <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService-3628"><a href="#PumpWoodMicroService-3628"><span class="linenos">3628</span></a>
</span><span id="PumpWoodMicroService-3629"><a href="#PumpWoodMicroService-3629"><span class="linenos">3629</span></a>        <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3630"><a href="#PumpWoodMicroService-3630"><span class="linenos">3630</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3631"><a href="#PumpWoodMicroService-3631"><span class="linenos">3631</span></a>            <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3632"><a href="#PumpWoodMicroService-3632"><span class="linenos">3632</span></a>            <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService-3633"><a href="#PumpWoodMicroService-3633"><span class="linenos">3633</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="PumpWoodMicroService-3634"><a href="#PumpWoodMicroService-3634"><span class="linenos">3634</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService-3635"><a href="#PumpWoodMicroService-3635"><span class="linenos">3635</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService-3636"><a href="#PumpWoodMicroService-3636"><span class="linenos">3636</span></a>                <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
</span><span id="PumpWoodMicroService-3637"><a href="#PumpWoodMicroService-3637"><span class="linenos">3637</span></a>                <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Class to define an inter-pumpwood MicroService.</p>

<p>Create an object ot help communication with Pumpwood based backends. It
manage login and token refresh if necessary.</p>

<p>It also implements parallel functions that split requests in parallel
process to reduce processing time.</p>
</div>


                            <div id="PumpWoodMicroService.__init__" class="classattr">
                                        <input id="PumpWoodMicroService.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PumpWoodMicroService</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="PumpWoodMicroService.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.__init__-98"><a href="#PumpWoodMicroService.__init__-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.__init__-99"><a href="#PumpWoodMicroService.__init__-99"><span class="linenos"> 99</span></a>                 <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.__init__-100"><a href="#PumpWoodMicroService.__init__-100"><span class="linenos">100</span></a>                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.__init__-101"><a href="#PumpWoodMicroService.__init__-101"><span class="linenos">101</span></a>                 <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="PumpWoodMicroService.__init__-102"><a href="#PumpWoodMicroService.__init__-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new PumpWoodMicroService object.</span>
</span><span id="PumpWoodMicroService.__init__-103"><a href="#PumpWoodMicroService.__init__-103"><span class="linenos">103</span></a>
</span><span id="PumpWoodMicroService.__init__-104"><a href="#PumpWoodMicroService.__init__-104"><span class="linenos">104</span></a><span class="sd">        Creates a new microservice object. If just name is passed, object must</span>
</span><span id="PumpWoodMicroService.__init__-105"><a href="#PumpWoodMicroService.__init__-105"><span class="linenos">105</span></a><span class="sd">        be initiate after with init() method.</span>
</span><span id="PumpWoodMicroService.__init__-106"><a href="#PumpWoodMicroService.__init__-106"><span class="linenos">106</span></a>
</span><span id="PumpWoodMicroService.__init__-107"><a href="#PumpWoodMicroService.__init__-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.__init__-108"><a href="#PumpWoodMicroService.__init__-108"><span class="linenos">108</span></a><span class="sd">            name:</span>
</span><span id="PumpWoodMicroService.__init__-109"><a href="#PumpWoodMicroService.__init__-109"><span class="linenos">109</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="PumpWoodMicroService.__init__-110"><a href="#PumpWoodMicroService.__init__-110"><span class="linenos">110</span></a><span class="sd">                are raised.</span>
</span><span id="PumpWoodMicroService.__init__-111"><a href="#PumpWoodMicroService.__init__-111"><span class="linenos">111</span></a><span class="sd">            server_url:</span>
</span><span id="PumpWoodMicroService.__init__-112"><a href="#PumpWoodMicroService.__init__-112"><span class="linenos">112</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="PumpWoodMicroService.__init__-113"><a href="#PumpWoodMicroService.__init__-113"><span class="linenos">113</span></a><span class="sd">            username:</span>
</span><span id="PumpWoodMicroService.__init__-114"><a href="#PumpWoodMicroService.__init__-114"><span class="linenos">114</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="PumpWoodMicroService.__init__-115"><a href="#PumpWoodMicroService.__init__-115"><span class="linenos">115</span></a><span class="sd">            password:</span>
</span><span id="PumpWoodMicroService.__init__-116"><a href="#PumpWoodMicroService.__init__-116"><span class="linenos">116</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="PumpWoodMicroService.__init__-117"><a href="#PumpWoodMicroService.__init__-117"><span class="linenos">117</span></a><span class="sd">                with the request.</span>
</span><span id="PumpWoodMicroService.__init__-118"><a href="#PumpWoodMicroService.__init__-118"><span class="linenos">118</span></a><span class="sd">            verify_ssl:</span>
</span><span id="PumpWoodMicroService.__init__-119"><a href="#PumpWoodMicroService.__init__-119"><span class="linenos">119</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="PumpWoodMicroService.__init__-120"><a href="#PumpWoodMicroService.__init__-120"><span class="linenos">120</span></a><span class="sd">            debug:</span>
</span><span id="PumpWoodMicroService.__init__-121"><a href="#PumpWoodMicroService.__init__-121"><span class="linenos">121</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="PumpWoodMicroService.__init__-122"><a href="#PumpWoodMicroService.__init__-122"><span class="linenos">122</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="PumpWoodMicroService.__init__-123"><a href="#PumpWoodMicroService.__init__-123"><span class="linenos">123</span></a><span class="sd">            default_timeout:</span>
</span><span id="PumpWoodMicroService.__init__-124"><a href="#PumpWoodMicroService.__init__-124"><span class="linenos">124</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="PumpWoodMicroService.__init__-125"><a href="#PumpWoodMicroService.__init__-125"><span class="linenos">125</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService.__init__-126"><a href="#PumpWoodMicroService.__init__-126"><span class="linenos">126</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="PumpWoodMicroService.__init__-127"><a href="#PumpWoodMicroService.__init__-127"><span class="linenos">127</span></a>
</span><span id="PumpWoodMicroService.__init__-128"><a href="#PumpWoodMicroService.__init__-128"><span class="linenos">128</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.__init__-129"><a href="#PumpWoodMicroService.__init__-129"><span class="linenos">129</span></a><span class="sd">            PumpWoodMicroService: New PumpWoodMicroService object</span>
</span><span id="PumpWoodMicroService.__init__-130"><a href="#PumpWoodMicroService.__init__-130"><span class="linenos">130</span></a>
</span><span id="PumpWoodMicroService.__init__-131"><a href="#PumpWoodMicroService.__init__-131"><span class="linenos">131</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.__init__-132"><a href="#PumpWoodMicroService.__init__-132"><span class="linenos">132</span></a><span class="sd">            No particular Raises.</span>
</span><span id="PumpWoodMicroService.__init__-133"><a href="#PumpWoodMicroService.__init__-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.__init__-134"><a href="#PumpWoodMicroService.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="PumpWoodMicroService.__init__-135"><a href="#PumpWoodMicroService.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.__init__-136"><a href="#PumpWoodMicroService.__init__-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.__init__-137"><a href="#PumpWoodMicroService.__init__-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="PumpWoodMicroService.__init__-138"><a href="#PumpWoodMicroService.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="PumpWoodMicroService.__init__-139"><a href="#PumpWoodMicroService.__init__-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.__init__-140"><a href="#PumpWoodMicroService.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="PumpWoodMicroService.__init__-141"><a href="#PumpWoodMicroService.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.__init__-142"><a href="#PumpWoodMicroService.__init__-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.__init__-143"><a href="#PumpWoodMicroService.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.__init__-144"><a href="#PumpWoodMicroService.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="PumpWoodMicroService.__init__-145"><a href="#PumpWoodMicroService.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService.__init__-146"><a href="#PumpWoodMicroService.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span></pre></div>


            <div class="docstring"><p>Create new PumpWoodMicroService object.</p>

<p>Creates a new microservice object. If just name is passed, object must
be initiate after with init() method.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name:</strong>  Name of the microservice, helps when exceptions
are raised.</li>
<li><strong>server_url:</strong>  URL of the server that will be connected.</li>
<li><strong>username:</strong>  Username that will be logged on.</li>
<li><strong>password:</strong>  Variable to be converted to JSON and posted along
with the request.</li>
<li><strong>verify_ssl:</strong>  Set if microservice will verify SSL certificate.</li>
<li><strong>debug:</strong>  If microservice will be used as debug mode. This will obrigate
auth token refresh for each call.</li>
<li><strong>default_timeout:</strong>  Default timeout for Pumpwood calls.</li>
<li><strong>**kwargs:</strong>  Other parameters used for compatibility between versions.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>PumpWoodMicroService: New PumpWoodMicroService object</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular Raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#PumpWoodMicroService.name"></a>
    
            <div class="docstring"><p>Name of the MicroService object, can be used for debug proposes.</p>
</div>


                            </div>
                            <div id="PumpWoodMicroService.server_url" class="classattr">
                                <div class="attr variable">
            <span class="name">server_url</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#PumpWoodMicroService.server_url"></a>
    
            <div class="docstring"><p>URL of the Pumpwood server.</p>
</div>


                            </div>
                            <div id="PumpWoodMicroService.verify_ssl" class="classattr">
                                <div class="attr variable">
            <span class="name">verify_ssl</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#PumpWoodMicroService.verify_ssl"></a>
    
            <div class="docstring"><p>If SSL certificates will be checked on HTTPs requests.</p>
</div>


                            </div>
                            <div id="PumpWoodMicroService.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#PumpWoodMicroService.debug"></a>
    
            <div class="docstring"><p>If microservice service is set as debug, if debug=TRUE all request will
refresh authorization token.</p>
</div>


                            </div>
                            <div id="PumpWoodMicroService.default_timeout" class="classattr">
                                <div class="attr variable">
            <span class="name">default_timeout</span>

        
    </div>
    <a class="headerlink" href="#PumpWoodMicroService.default_timeout"></a>
    
    

                            </div>
                            <div id="PumpWoodMicroService.init" class="classattr">
                                        <input id="PumpWoodMicroService.init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.init-148"><a href="#PumpWoodMicroService.init-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.init-149"><a href="#PumpWoodMicroService.init-149"><span class="linenos">149</span></a>             <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.init-150"><a href="#PumpWoodMicroService.init-150"><span class="linenos">150</span></a>             <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.init-151"><a href="#PumpWoodMicroService.init-151"><span class="linenos">151</span></a>             <span class="n">default_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
</span><span id="PumpWoodMicroService.init-152"><a href="#PumpWoodMicroService.init-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazzy initialization of the MicroService of object.</span>
</span><span id="PumpWoodMicroService.init-153"><a href="#PumpWoodMicroService.init-153"><span class="linenos">153</span></a>
</span><span id="PumpWoodMicroService.init-154"><a href="#PumpWoodMicroService.init-154"><span class="linenos">154</span></a><span class="sd">        This function might be usefull to use the object as a singleton at</span>
</span><span id="PumpWoodMicroService.init-155"><a href="#PumpWoodMicroService.init-155"><span class="linenos">155</span></a><span class="sd">        the backends. Using this function it is possible to instanciate an</span>
</span><span id="PumpWoodMicroService.init-156"><a href="#PumpWoodMicroService.init-156"><span class="linenos">156</span></a><span class="sd">        empty object and them set the attributes latter at the systems.</span>
</span><span id="PumpWoodMicroService.init-157"><a href="#PumpWoodMicroService.init-157"><span class="linenos">157</span></a>
</span><span id="PumpWoodMicroService.init-158"><a href="#PumpWoodMicroService.init-158"><span class="linenos">158</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.init-159"><a href="#PumpWoodMicroService.init-159"><span class="linenos">159</span></a><span class="sd">            name:</span>
</span><span id="PumpWoodMicroService.init-160"><a href="#PumpWoodMicroService.init-160"><span class="linenos">160</span></a><span class="sd">                Name of the microservice, helps when exceptions</span>
</span><span id="PumpWoodMicroService.init-161"><a href="#PumpWoodMicroService.init-161"><span class="linenos">161</span></a><span class="sd">                are raised.</span>
</span><span id="PumpWoodMicroService.init-162"><a href="#PumpWoodMicroService.init-162"><span class="linenos">162</span></a><span class="sd">            server_url:</span>
</span><span id="PumpWoodMicroService.init-163"><a href="#PumpWoodMicroService.init-163"><span class="linenos">163</span></a><span class="sd">                URL of the server that will be connected.</span>
</span><span id="PumpWoodMicroService.init-164"><a href="#PumpWoodMicroService.init-164"><span class="linenos">164</span></a><span class="sd">            username:</span>
</span><span id="PumpWoodMicroService.init-165"><a href="#PumpWoodMicroService.init-165"><span class="linenos">165</span></a><span class="sd">                Username that will be logged on.</span>
</span><span id="PumpWoodMicroService.init-166"><a href="#PumpWoodMicroService.init-166"><span class="linenos">166</span></a><span class="sd">            password:</span>
</span><span id="PumpWoodMicroService.init-167"><a href="#PumpWoodMicroService.init-167"><span class="linenos">167</span></a><span class="sd">                Variable to be converted to JSON and posted along</span>
</span><span id="PumpWoodMicroService.init-168"><a href="#PumpWoodMicroService.init-168"><span class="linenos">168</span></a><span class="sd">                with the request.</span>
</span><span id="PumpWoodMicroService.init-169"><a href="#PumpWoodMicroService.init-169"><span class="linenos">169</span></a><span class="sd">            verify_ssl:</span>
</span><span id="PumpWoodMicroService.init-170"><a href="#PumpWoodMicroService.init-170"><span class="linenos">170</span></a><span class="sd">                Set if microservice will verify SSL certificate.</span>
</span><span id="PumpWoodMicroService.init-171"><a href="#PumpWoodMicroService.init-171"><span class="linenos">171</span></a><span class="sd">            debug:</span>
</span><span id="PumpWoodMicroService.init-172"><a href="#PumpWoodMicroService.init-172"><span class="linenos">172</span></a><span class="sd">                If microservice will be used as debug mode. This will obrigate</span>
</span><span id="PumpWoodMicroService.init-173"><a href="#PumpWoodMicroService.init-173"><span class="linenos">173</span></a><span class="sd">                auth token refresh for each call.</span>
</span><span id="PumpWoodMicroService.init-174"><a href="#PumpWoodMicroService.init-174"><span class="linenos">174</span></a><span class="sd">            default_timeout:</span>
</span><span id="PumpWoodMicroService.init-175"><a href="#PumpWoodMicroService.init-175"><span class="linenos">175</span></a><span class="sd">                Default timeout for Pumpwood calls.</span>
</span><span id="PumpWoodMicroService.init-176"><a href="#PumpWoodMicroService.init-176"><span class="linenos">176</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService.init-177"><a href="#PumpWoodMicroService.init-177"><span class="linenos">177</span></a><span class="sd">                Other parameters used for compatibility between versions.</span>
</span><span id="PumpWoodMicroService.init-178"><a href="#PumpWoodMicroService.init-178"><span class="linenos">178</span></a>
</span><span id="PumpWoodMicroService.init-179"><a href="#PumpWoodMicroService.init-179"><span class="linenos">179</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.init-180"><a href="#PumpWoodMicroService.init-180"><span class="linenos">180</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService.init-181"><a href="#PumpWoodMicroService.init-181"><span class="linenos">181</span></a>
</span><span id="PumpWoodMicroService.init-182"><a href="#PumpWoodMicroService.init-182"><span class="linenos">182</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.init-183"><a href="#PumpWoodMicroService.init-183"><span class="linenos">183</span></a><span class="sd">            No particular Raises</span>
</span><span id="PumpWoodMicroService.init-184"><a href="#PumpWoodMicroService.init-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.init-185"><a href="#PumpWoodMicroService.init-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="PumpWoodMicroService.init-186"><a href="#PumpWoodMicroService.init-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.init-187"><a href="#PumpWoodMicroService.init-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="PumpWoodMicroService.init-188"><a href="#PumpWoodMicroService.init-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="PumpWoodMicroService.init-189"><a href="#PumpWoodMicroService.init-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.init-190"><a href="#PumpWoodMicroService.init-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
</span><span id="PumpWoodMicroService.init-191"><a href="#PumpWoodMicroService.init-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span> <span class="o">=</span> <span class="n">default_timeout</span>
</span><span id="PumpWoodMicroService.init-192"><a href="#PumpWoodMicroService.init-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span></pre></div>


            <div class="docstring"><p>Lazzy initialization of the MicroService of object.</p>

<p>This function might be usefull to use the object as a singleton at
the backends. Using this function it is possible to instanciate an
empty object and them set the attributes latter at the systems.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name:</strong>  Name of the microservice, helps when exceptions
are raised.</li>
<li><strong>server_url:</strong>  URL of the server that will be connected.</li>
<li><strong>username:</strong>  Username that will be logged on.</li>
<li><strong>password:</strong>  Variable to be converted to JSON and posted along
with the request.</li>
<li><strong>verify_ssl:</strong>  Set if microservice will verify SSL certificate.</li>
<li><strong>debug:</strong>  If microservice will be used as debug mode. This will obrigate
auth token refresh for each call.</li>
<li><strong>default_timeout:</strong>  Default timeout for Pumpwood calls.</li>
<li><strong>**kwargs:</strong>  Other parameters used for compatibility between versions.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>No return</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular Raises</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.angular_json" class="classattr">
                                        <input id="PumpWoodMicroService.angular_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">angular_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">request_result</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.angular_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.angular_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.angular_json-194"><a href="#PumpWoodMicroService.angular_json-194"><span class="linenos">194</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService.angular_json-195"><a href="#PumpWoodMicroService.angular_json-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.angular_json-196"><a href="#PumpWoodMicroService.angular_json-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert text to Json removing any XSSI at the beging of JSON.</span>
</span><span id="PumpWoodMicroService.angular_json-197"><a href="#PumpWoodMicroService.angular_json-197"><span class="linenos">197</span></a>
</span><span id="PumpWoodMicroService.angular_json-198"><a href="#PumpWoodMicroService.angular_json-198"><span class="linenos">198</span></a><span class="sd">        Some backends add `)]}&#39;,\n` at the beginning of the JSON data to</span>
</span><span id="PumpWoodMicroService.angular_json-199"><a href="#PumpWoodMicroService.angular_json-199"><span class="linenos">199</span></a><span class="sd">        prevent injection of functions. This function remove this characters</span>
</span><span id="PumpWoodMicroService.angular_json-200"><a href="#PumpWoodMicroService.angular_json-200"><span class="linenos">200</span></a><span class="sd">        if present.</span>
</span><span id="PumpWoodMicroService.angular_json-201"><a href="#PumpWoodMicroService.angular_json-201"><span class="linenos">201</span></a>
</span><span id="PumpWoodMicroService.angular_json-202"><a href="#PumpWoodMicroService.angular_json-202"><span class="linenos">202</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.angular_json-203"><a href="#PumpWoodMicroService.angular_json-203"><span class="linenos">203</span></a><span class="sd">            request_result:</span>
</span><span id="PumpWoodMicroService.angular_json-204"><a href="#PumpWoodMicroService.angular_json-204"><span class="linenos">204</span></a><span class="sd">                JSON Request to be converted</span>
</span><span id="PumpWoodMicroService.angular_json-205"><a href="#PumpWoodMicroService.angular_json-205"><span class="linenos">205</span></a>
</span><span id="PumpWoodMicroService.angular_json-206"><a href="#PumpWoodMicroService.angular_json-206"><span class="linenos">206</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.angular_json-207"><a href="#PumpWoodMicroService.angular_json-207"><span class="linenos">207</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService.angular_json-208"><a href="#PumpWoodMicroService.angular_json-208"><span class="linenos">208</span></a>
</span><span id="PumpWoodMicroService.angular_json-209"><a href="#PumpWoodMicroService.angular_json-209"><span class="linenos">209</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.angular_json-210"><a href="#PumpWoodMicroService.angular_json-210"><span class="linenos">210</span></a><span class="sd">            No particular Raises</span>
</span><span id="PumpWoodMicroService.angular_json-211"><a href="#PumpWoodMicroService.angular_json-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.angular_json-212"><a href="#PumpWoodMicroService.angular_json-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.angular_json-213"><a href="#PumpWoodMicroService.angular_json-213"><span class="linenos">213</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.angular_json-214"><a href="#PumpWoodMicroService.angular_json-214"><span class="linenos">214</span></a>
</span><span id="PumpWoodMicroService.angular_json-215"><a href="#PumpWoodMicroService.angular_json-215"><span class="linenos">215</span></a>        <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService.angular_json-216"><a href="#PumpWoodMicroService.angular_json-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.angular_json-217"><a href="#PumpWoodMicroService.angular_json-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.angular_json-218"><a href="#PumpWoodMicroService.angular_json-218"><span class="linenos">218</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
</span><span id="PumpWoodMicroService.angular_json-219"><a href="#PumpWoodMicroService.angular_json-219"><span class="linenos">219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.angular_json-220"><a href="#PumpWoodMicroService.angular_json-220"><span class="linenos">220</span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.angular_json-221"><a href="#PumpWoodMicroService.angular_json-221"><span class="linenos">221</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.angular_json-222"><a href="#PumpWoodMicroService.angular_json-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.angular_json-223"><a href="#PumpWoodMicroService.angular_json-223"><span class="linenos">223</span></a>                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Convert text to Json removing any XSSI at the beging of JSON.</p>

<p>Some backends add <code>)]}',\n</code> at the beginning of the JSON data to
prevent injection of functions. This function remove this characters
if present.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>request_result:</strong>  JSON Request to be converted</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>No return</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular Raises</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.time_to_expiry" class="classattr">
                                        <input id="PumpWoodMicroService.time_to_expiry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">time_to_expiry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timedeltas</span><span class="o">.</span><span class="n">Timedelta</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.time_to_expiry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.time_to_expiry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.time_to_expiry-225"><a href="#PumpWoodMicroService.time_to_expiry-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.time_to_expiry-226"><a href="#PumpWoodMicroService.time_to_expiry-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return time to token expiry.</span>
</span><span id="PumpWoodMicroService.time_to_expiry-227"><a href="#PumpWoodMicroService.time_to_expiry-227"><span class="linenos">227</span></a>
</span><span id="PumpWoodMicroService.time_to_expiry-228"><a href="#PumpWoodMicroService.time_to_expiry-228"><span class="linenos">228</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.time_to_expiry-229"><a href="#PumpWoodMicroService.time_to_expiry-229"><span class="linenos">229</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService.time_to_expiry-230"><a href="#PumpWoodMicroService.time_to_expiry-230"><span class="linenos">230</span></a>
</span><span id="PumpWoodMicroService.time_to_expiry-231"><a href="#PumpWoodMicroService.time_to_expiry-231"><span class="linenos">231</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.time_to_expiry-232"><a href="#PumpWoodMicroService.time_to_expiry-232"><span class="linenos">232</span></a><span class="sd">            Return time until token expiration.</span>
</span><span id="PumpWoodMicroService.time_to_expiry-233"><a href="#PumpWoodMicroService.time_to_expiry-233"><span class="linenos">233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.time_to_expiry-234"><a href="#PumpWoodMicroService.time_to_expiry-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.time_to_expiry-235"><a href="#PumpWoodMicroService.time_to_expiry-235"><span class="linenos">235</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.time_to_expiry-236"><a href="#PumpWoodMicroService.time_to_expiry-236"><span class="linenos">236</span></a>
</span><span id="PumpWoodMicroService.time_to_expiry-237"><a href="#PumpWoodMicroService.time_to_expiry-237"><span class="linenos">237</span></a>        <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.time_to_expiry-238"><a href="#PumpWoodMicroService.time_to_expiry-238"><span class="linenos">238</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.time_to_expiry-239"><a href="#PumpWoodMicroService.time_to_expiry-239"><span class="linenos">239</span></a>        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
</span><span id="PumpWoodMicroService.time_to_expiry-240"><a href="#PumpWoodMicroService.time_to_expiry-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">time_to_expiry</span>
</span></pre></div>


            <div class="docstring"><p>Return time to token expiry.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li>No Args.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return time until token expiration.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.is_credential_set" class="classattr">
                                        <input id="PumpWoodMicroService.is_credential_set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_credential_set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.is_credential_set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.is_credential_set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.is_credential_set-242"><a href="#PumpWoodMicroService.is_credential_set-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.is_credential_set-243"><a href="#PumpWoodMicroService.is_credential_set-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if username and password are set on object.</span>
</span><span id="PumpWoodMicroService.is_credential_set-244"><a href="#PumpWoodMicroService.is_credential_set-244"><span class="linenos">244</span></a>
</span><span id="PumpWoodMicroService.is_credential_set-245"><a href="#PumpWoodMicroService.is_credential_set-245"><span class="linenos">245</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.is_credential_set-246"><a href="#PumpWoodMicroService.is_credential_set-246"><span class="linenos">246</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService.is_credential_set-247"><a href="#PumpWoodMicroService.is_credential_set-247"><span class="linenos">247</span></a>
</span><span id="PumpWoodMicroService.is_credential_set-248"><a href="#PumpWoodMicroService.is_credential_set-248"><span class="linenos">248</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.is_credential_set-249"><a href="#PumpWoodMicroService.is_credential_set-249"><span class="linenos">249</span></a><span class="sd">            True if usename and password were set during object creation or</span>
</span><span id="PumpWoodMicroService.is_credential_set-250"><a href="#PumpWoodMicroService.is_credential_set-250"><span class="linenos">250</span></a><span class="sd">            later with init function.</span>
</span><span id="PumpWoodMicroService.is_credential_set-251"><a href="#PumpWoodMicroService.is_credential_set-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.is_credential_set-252"><a href="#PumpWoodMicroService.is_credential_set-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if username and password are set on object.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li>No Args.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>True if usename and password were set during object creation or
  later with init function.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.login" class="classattr">
                                        <input id="PumpWoodMicroService.login-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">login</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.login-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.login"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.login-254"><a href="#PumpWoodMicroService.login-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-255"><a href="#PumpWoodMicroService.login-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log microservice in using username and password provided.</span>
</span><span id="PumpWoodMicroService.login-256"><a href="#PumpWoodMicroService.login-256"><span class="linenos">256</span></a>
</span><span id="PumpWoodMicroService.login-257"><a href="#PumpWoodMicroService.login-257"><span class="linenos">257</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.login-258"><a href="#PumpWoodMicroService.login-258"><span class="linenos">258</span></a><span class="sd">            force_refresh (bool):</span>
</span><span id="PumpWoodMicroService.login-259"><a href="#PumpWoodMicroService.login-259"><span class="linenos">259</span></a><span class="sd">                Force token refresh despise still valid</span>
</span><span id="PumpWoodMicroService.login-260"><a href="#PumpWoodMicroService.login-260"><span class="linenos">260</span></a><span class="sd">                according to self.__token_expiry.</span>
</span><span id="PumpWoodMicroService.login-261"><a href="#PumpWoodMicroService.login-261"><span class="linenos">261</span></a>
</span><span id="PumpWoodMicroService.login-262"><a href="#PumpWoodMicroService.login-262"><span class="linenos">262</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.login-263"><a href="#PumpWoodMicroService.login-263"><span class="linenos">263</span></a><span class="sd">            No return</span>
</span><span id="PumpWoodMicroService.login-264"><a href="#PumpWoodMicroService.login-264"><span class="linenos">264</span></a>
</span><span id="PumpWoodMicroService.login-265"><a href="#PumpWoodMicroService.login-265"><span class="linenos">265</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.login-266"><a href="#PumpWoodMicroService.login-266"><span class="linenos">266</span></a><span class="sd">            Exception: If login response has status diferent from 200.</span>
</span><span id="PumpWoodMicroService.login-267"><a href="#PumpWoodMicroService.login-267"><span class="linenos">267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.login-268"><a href="#PumpWoodMicroService.login-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.login-269"><a href="#PumpWoodMicroService.login-269"><span class="linenos">269</span></a>            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.login-270"><a href="#PumpWoodMicroService.login-270"><span class="linenos">270</span></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-271"><a href="#PumpWoodMicroService.login-271"><span class="linenos">271</span></a>
</span><span id="PumpWoodMicroService.login-272"><a href="#PumpWoodMicroService.login-272"><span class="linenos">272</span></a>        <span class="c1"># Check if expiry time is 1h from now</span>
</span><span id="PumpWoodMicroService.login-273"><a href="#PumpWoodMicroService.login-273"><span class="linenos">273</span></a>        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService.login-274"><a href="#PumpWoodMicroService.login-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-275"><a href="#PumpWoodMicroService.login-275"><span class="linenos">275</span></a>            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.login-276"><a href="#PumpWoodMicroService.login-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-277"><a href="#PumpWoodMicroService.login-277"><span class="linenos">277</span></a>            <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.login-278"><a href="#PumpWoodMicroService.login-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.login-279"><a href="#PumpWoodMicroService.login-279"><span class="linenos">279</span></a>                <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.login-280"><a href="#PumpWoodMicroService.login-280"><span class="linenos">280</span></a>
</span><span id="PumpWoodMicroService.login-281"><a href="#PumpWoodMicroService.login-281"><span class="linenos">281</span></a>        <span class="c1"># When if debug always refresh token</span>
</span><span id="PumpWoodMicroService.login-282"><a href="#PumpWoodMicroService.login-282"><span class="linenos">282</span></a>        <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.login-283"><a href="#PumpWoodMicroService.login-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-284"><a href="#PumpWoodMicroService.login-284"><span class="linenos">284</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.login-285"><a href="#PumpWoodMicroService.login-285"><span class="linenos">285</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
</span><span id="PumpWoodMicroService.login-286"><a href="#PumpWoodMicroService.login-286"><span class="linenos">286</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-287"><a href="#PumpWoodMicroService.login-287"><span class="linenos">287</span></a>            <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="PumpWoodMicroService.login-288"><a href="#PumpWoodMicroService.login-288"><span class="linenos">288</span></a>
</span><span id="PumpWoodMicroService.login-289"><a href="#PumpWoodMicroService.login-289"><span class="linenos">289</span></a>        <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-290"><a href="#PumpWoodMicroService.login-290"><span class="linenos">290</span></a>            <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.login-291"><a href="#PumpWoodMicroService.login-291"><span class="linenos">291</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-292"><a href="#PumpWoodMicroService.login-292"><span class="linenos">292</span></a>            <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.login-293"><a href="#PumpWoodMicroService.login-293"><span class="linenos">293</span></a>                <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.login-294"><a href="#PumpWoodMicroService.login-294"><span class="linenos">294</span></a>                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.login-295"><a href="#PumpWoodMicroService.login-295"><span class="linenos">295</span></a>                    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.login-296"><a href="#PumpWoodMicroService.login-296"><span class="linenos">296</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-297"><a href="#PumpWoodMicroService.login-297"><span class="linenos">297</span></a>
</span><span id="PumpWoodMicroService.login-298"><a href="#PumpWoodMicroService.login-298"><span class="linenos">298</span></a>            <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService.login-299"><a href="#PumpWoodMicroService.login-299"><span class="linenos">299</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-300"><a href="#PumpWoodMicroService.login-300"><span class="linenos">300</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-301"><a href="#PumpWoodMicroService.login-301"><span class="linenos">301</span></a>                <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.login-302"><a href="#PumpWoodMicroService.login-302"><span class="linenos">302</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.login-303"><a href="#PumpWoodMicroService.login-303"><span class="linenos">303</span></a>                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.login-304"><a href="#PumpWoodMicroService.login-304"><span class="linenos">304</span></a>                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="PumpWoodMicroService.login-305"><a href="#PumpWoodMicroService.login-305"><span class="linenos">305</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-306"><a href="#PumpWoodMicroService.login-306"><span class="linenos">306</span></a>
</span><span id="PumpWoodMicroService.login-307"><a href="#PumpWoodMicroService.login-307"><span class="linenos">307</span></a>            <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.login-308"><a href="#PumpWoodMicroService.login-308"><span class="linenos">308</span></a>                <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.login-309"><a href="#PumpWoodMicroService.login-309"><span class="linenos">309</span></a>
</span><span id="PumpWoodMicroService.login-310"><a href="#PumpWoodMicroService.login-310"><span class="linenos">310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.login-311"><a href="#PumpWoodMicroService.login-311"><span class="linenos">311</span></a>                <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
</span><span id="PumpWoodMicroService.login-312"><a href="#PumpWoodMicroService.login-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.login-313"><a href="#PumpWoodMicroService.login-313"><span class="linenos">313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Log microservice in using username and password provided.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>force_refresh (bool):</strong>  Force token refresh despise still valid
according to self.__token_expiry.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>No return</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If login response has status diferent from 200.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.confirm_mfa_code" class="classattr">
                                        <input id="PumpWoodMicroService.confirm_mfa_code-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">confirm_mfa_code</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.confirm_mfa_code-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.confirm_mfa_code"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.confirm_mfa_code-315"><a href="#PumpWoodMicroService.confirm_mfa_code-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-316"><a href="#PumpWoodMicroService.confirm_mfa_code-316"><span class="linenos">316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ask user to confirm MFA code to login.</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-317"><a href="#PumpWoodMicroService.confirm_mfa_code-317"><span class="linenos">317</span></a>
</span><span id="PumpWoodMicroService.confirm_mfa_code-318"><a href="#PumpWoodMicroService.confirm_mfa_code-318"><span class="linenos">318</span></a><span class="sd">        Open an input interface at terminal for user to validate MFA token.</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-319"><a href="#PumpWoodMicroService.confirm_mfa_code-319"><span class="linenos">319</span></a>
</span><span id="PumpWoodMicroService.confirm_mfa_code-320"><a href="#PumpWoodMicroService.confirm_mfa_code-320"><span class="linenos">320</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-321"><a href="#PumpWoodMicroService.confirm_mfa_code-321"><span class="linenos">321</span></a><span class="sd">            mfa_login_data:</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-322"><a href="#PumpWoodMicroService.confirm_mfa_code-322"><span class="linenos">322</span></a><span class="sd">                Result from login request with &#39;mfa_token&#39;</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-323"><a href="#PumpWoodMicroService.confirm_mfa_code-323"><span class="linenos">323</span></a><span class="sd">                as key.</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-324"><a href="#PumpWoodMicroService.confirm_mfa_code-324"><span class="linenos">324</span></a>
</span><span id="PumpWoodMicroService.confirm_mfa_code-325"><a href="#PumpWoodMicroService.confirm_mfa_code-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-326"><a href="#PumpWoodMicroService.confirm_mfa_code-326"><span class="linenos">326</span></a><span class="sd">            Return login returned with MFA confimation.</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-327"><a href="#PumpWoodMicroService.confirm_mfa_code-327"><span class="linenos">327</span></a>
</span><span id="PumpWoodMicroService.confirm_mfa_code-328"><a href="#PumpWoodMicroService.confirm_mfa_code-328"><span class="linenos">328</span></a><span class="sd">        Raise:</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-329"><a href="#PumpWoodMicroService.confirm_mfa_code-329"><span class="linenos">329</span></a><span class="sd">            Raise error if reponse is not valid using error_handler.</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-330"><a href="#PumpWoodMicroService.confirm_mfa_code-330"><span class="linenos">330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-331"><a href="#PumpWoodMicroService.confirm_mfa_code-331"><span class="linenos">331</span></a>        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-332"><a href="#PumpWoodMicroService.confirm_mfa_code-332"><span class="linenos">332</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-333"><a href="#PumpWoodMicroService.confirm_mfa_code-333"><span class="linenos">333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-334"><a href="#PumpWoodMicroService.confirm_mfa_code-334"><span class="linenos">334</span></a>        <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-335"><a href="#PumpWoodMicroService.confirm_mfa_code-335"><span class="linenos">335</span></a>            <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-336"><a href="#PumpWoodMicroService.confirm_mfa_code-336"><span class="linenos">336</span></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-337"><a href="#PumpWoodMicroService.confirm_mfa_code-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-338"><a href="#PumpWoodMicroService.confirm_mfa_code-338"><span class="linenos">338</span></a>
</span><span id="PumpWoodMicroService.confirm_mfa_code-339"><a href="#PumpWoodMicroService.confirm_mfa_code-339"><span class="linenos">339</span></a>        <span class="c1"># Set _is_mfa_login true to indicate that login required MFA</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-340"><a href="#PumpWoodMicroService.confirm_mfa_code-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.confirm_mfa_code-341"><a href="#PumpWoodMicroService.confirm_mfa_code-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Ask user to confirm MFA code to login.</p>

<p>Open an input interface at terminal for user to validate MFA token.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>mfa_login_data:</strong>  Result from login request with 'mfa_token'
as key.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return login returned with MFA confimation.</p>
</blockquote>

<h6 id="raise">Raise:</h6>

<blockquote>
  <p>Raise error if reponse is not valid using error_handler.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.logout" class="classattr">
                                        <input id="PumpWoodMicroService.logout-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logout</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.logout-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.logout"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.logout-343"><a href="#PumpWoodMicroService.logout-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.logout-344"><a href="#PumpWoodMicroService.logout-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout token.</span>
</span><span id="PumpWoodMicroService.logout-345"><a href="#PumpWoodMicroService.logout-345"><span class="linenos">345</span></a>
</span><span id="PumpWoodMicroService.logout-346"><a href="#PumpWoodMicroService.logout-346"><span class="linenos">346</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.logout-347"><a href="#PumpWoodMicroService.logout-347"><span class="linenos">347</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.logout-348"><a href="#PumpWoodMicroService.logout-348"><span class="linenos">348</span></a><span class="sd">                Authentication header.</span>
</span><span id="PumpWoodMicroService.logout-349"><a href="#PumpWoodMicroService.logout-349"><span class="linenos">349</span></a>
</span><span id="PumpWoodMicroService.logout-350"><a href="#PumpWoodMicroService.logout-350"><span class="linenos">350</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.logout-351"><a href="#PumpWoodMicroService.logout-351"><span class="linenos">351</span></a><span class="sd">            True if logout was ok.</span>
</span><span id="PumpWoodMicroService.logout-352"><a href="#PumpWoodMicroService.logout-352"><span class="linenos">352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.logout-353"><a href="#PumpWoodMicroService.logout-353"><span class="linenos">353</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.logout-354"><a href="#PumpWoodMicroService.logout-354"><span class="linenos">354</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.logout-355"><a href="#PumpWoodMicroService.logout-355"><span class="linenos">355</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.logout-356"><a href="#PumpWoodMicroService.logout-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Logout token.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>auth_header:</strong>  Authentication header.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>True if logout was ok.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.logout_all" class="classattr">
                                        <input id="PumpWoodMicroService.logout_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logout_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.logout_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.logout_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.logout_all-358"><a href="#PumpWoodMicroService.logout_all-358"><span class="linenos">358</span></a>    <span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.logout_all-359"><a href="#PumpWoodMicroService.logout_all-359"><span class="linenos">359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout all tokens from user.</span>
</span><span id="PumpWoodMicroService.logout_all-360"><a href="#PumpWoodMicroService.logout_all-360"><span class="linenos">360</span></a>
</span><span id="PumpWoodMicroService.logout_all-361"><a href="#PumpWoodMicroService.logout_all-361"><span class="linenos">361</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.logout_all-362"><a href="#PumpWoodMicroService.logout_all-362"><span class="linenos">362</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService.logout_all-363"><a href="#PumpWoodMicroService.logout_all-363"><span class="linenos">363</span></a><span class="sd">                Authentication header.</span>
</span><span id="PumpWoodMicroService.logout_all-364"><a href="#PumpWoodMicroService.logout_all-364"><span class="linenos">364</span></a>
</span><span id="PumpWoodMicroService.logout_all-365"><a href="#PumpWoodMicroService.logout_all-365"><span class="linenos">365</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.logout_all-366"><a href="#PumpWoodMicroService.logout_all-366"><span class="linenos">366</span></a><span class="sd">            True if logout all was ok.</span>
</span><span id="PumpWoodMicroService.logout_all-367"><a href="#PumpWoodMicroService.logout_all-367"><span class="linenos">367</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.logout_all-368"><a href="#PumpWoodMicroService.logout_all-368"><span class="linenos">368</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.logout_all-369"><a href="#PumpWoodMicroService.logout_all-369"><span class="linenos">369</span></a>            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.logout_all-370"><a href="#PumpWoodMicroService.logout_all-370"><span class="linenos">370</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.logout_all-371"><a href="#PumpWoodMicroService.logout_all-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Logout all tokens from user.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>auth_header (dict):</strong>  Authentication header.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>True if logout all was ok.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.set_auth_header" class="classattr">
                                        <input id="PumpWoodMicroService.set_auth_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_auth_header</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">token_expiry</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.set_auth_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.set_auth_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.set_auth_header-373"><a href="#PumpWoodMicroService.set_auth_header-373"><span class="linenos">373</span></a>    <span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.set_auth_header-374"><a href="#PumpWoodMicroService.set_auth_header-374"><span class="linenos">374</span></a>                        <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.set_auth_header-375"><a href="#PumpWoodMicroService.set_auth_header-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set auth_header and token_expiry date.</span>
</span><span id="PumpWoodMicroService.set_auth_header-376"><a href="#PumpWoodMicroService.set_auth_header-376"><span class="linenos">376</span></a>
</span><span id="PumpWoodMicroService.set_auth_header-377"><a href="#PumpWoodMicroService.set_auth_header-377"><span class="linenos">377</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.set_auth_header-378"><a href="#PumpWoodMicroService.set_auth_header-378"><span class="linenos">378</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.set_auth_header-379"><a href="#PumpWoodMicroService.set_auth_header-379"><span class="linenos">379</span></a><span class="sd">                Authentication header to be set.</span>
</span><span id="PumpWoodMicroService.set_auth_header-380"><a href="#PumpWoodMicroService.set_auth_header-380"><span class="linenos">380</span></a><span class="sd">            token_expiry:</span>
</span><span id="PumpWoodMicroService.set_auth_header-381"><a href="#PumpWoodMicroService.set_auth_header-381"><span class="linenos">381</span></a><span class="sd">                Token expiry datetime to be set.</span>
</span><span id="PumpWoodMicroService.set_auth_header-382"><a href="#PumpWoodMicroService.set_auth_header-382"><span class="linenos">382</span></a>
</span><span id="PumpWoodMicroService.set_auth_header-383"><a href="#PumpWoodMicroService.set_auth_header-383"><span class="linenos">383</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.set_auth_header-384"><a href="#PumpWoodMicroService.set_auth_header-384"><span class="linenos">384</span></a><span class="sd">            No return.</span>
</span><span id="PumpWoodMicroService.set_auth_header-385"><a href="#PumpWoodMicroService.set_auth_header-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.set_auth_header-386"><a href="#PumpWoodMicroService.set_auth_header-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
</span><span id="PumpWoodMicroService.set_auth_header-387"><a href="#PumpWoodMicroService.set_auth_header-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set auth_header and token_expiry date.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>auth_header:</strong>  Authentication header to be set.</li>
<li><strong>token_expiry:</strong>  Token expiry datetime to be set.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>No return.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.get_auth_header" class="classattr">
                                        <input id="PumpWoodMicroService.get_auth_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_auth_header</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.get_auth_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.get_auth_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.get_auth_header-389"><a href="#PumpWoodMicroService.get_auth_header-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_auth_header-390"><a href="#PumpWoodMicroService.get_auth_header-390"><span class="linenos">390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve auth_header and token_expiry from object.</span>
</span><span id="PumpWoodMicroService.get_auth_header-391"><a href="#PumpWoodMicroService.get_auth_header-391"><span class="linenos">391</span></a>
</span><span id="PumpWoodMicroService.get_auth_header-392"><a href="#PumpWoodMicroService.get_auth_header-392"><span class="linenos">392</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.get_auth_header-393"><a href="#PumpWoodMicroService.get_auth_header-393"><span class="linenos">393</span></a><span class="sd">            No Args.</span>
</span><span id="PumpWoodMicroService.get_auth_header-394"><a href="#PumpWoodMicroService.get_auth_header-394"><span class="linenos">394</span></a>
</span><span id="PumpWoodMicroService.get_auth_header-395"><a href="#PumpWoodMicroService.get_auth_header-395"><span class="linenos">395</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.get_auth_header-396"><a href="#PumpWoodMicroService.get_auth_header-396"><span class="linenos">396</span></a><span class="sd">            Return authorization header and token_expiry datetime from object.</span>
</span><span id="PumpWoodMicroService.get_auth_header-397"><a href="#PumpWoodMicroService.get_auth_header-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.get_auth_header-398"><a href="#PumpWoodMicroService.get_auth_header-398"><span class="linenos">398</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.get_auth_header-399"><a href="#PumpWoodMicroService.get_auth_header-399"><span class="linenos">399</span></a>            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_auth_header-400"><a href="#PumpWoodMicroService.get_auth_header-400"><span class="linenos">400</span></a>            <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve auth_header and token_expiry from object.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li>No Args.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return authorization header and token_expiry datetime from object.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.error_handler" class="classattr">
                                        <input id="PumpWoodMicroService.error_handler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">error_handler</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">response</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.error_handler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.error_handler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.error_handler-450"><a href="#PumpWoodMicroService.error_handler-450"><span class="linenos">450</span></a>    <span class="nd">@classmethod</span>
</span><span id="PumpWoodMicroService.error_handler-451"><a href="#PumpWoodMicroService.error_handler-451"><span class="linenos">451</span></a>    <span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.error_handler-452"><a href="#PumpWoodMicroService.error_handler-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle request error.</span>
</span><span id="PumpWoodMicroService.error_handler-453"><a href="#PumpWoodMicroService.error_handler-453"><span class="linenos">453</span></a>
</span><span id="PumpWoodMicroService.error_handler-454"><a href="#PumpWoodMicroService.error_handler-454"><span class="linenos">454</span></a><span class="sd">        Check if is a Json and propagate the error with</span>
</span><span id="PumpWoodMicroService.error_handler-455"><a href="#PumpWoodMicroService.error_handler-455"><span class="linenos">455</span></a><span class="sd">        same type if possible. If not Json raises the content.</span>
</span><span id="PumpWoodMicroService.error_handler-456"><a href="#PumpWoodMicroService.error_handler-456"><span class="linenos">456</span></a>
</span><span id="PumpWoodMicroService.error_handler-457"><a href="#PumpWoodMicroService.error_handler-457"><span class="linenos">457</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.error_handler-458"><a href="#PumpWoodMicroService.error_handler-458"><span class="linenos">458</span></a><span class="sd">            response:</span>
</span><span id="PumpWoodMicroService.error_handler-459"><a href="#PumpWoodMicroService.error_handler-459"><span class="linenos">459</span></a><span class="sd">                response to be handled, it is a PumpWoodException</span>
</span><span id="PumpWoodMicroService.error_handler-460"><a href="#PumpWoodMicroService.error_handler-460"><span class="linenos">460</span></a><span class="sd">                return it will raise the same exception at microservice</span>
</span><span id="PumpWoodMicroService.error_handler-461"><a href="#PumpWoodMicroService.error_handler-461"><span class="linenos">461</span></a><span class="sd">                object.</span>
</span><span id="PumpWoodMicroService.error_handler-462"><a href="#PumpWoodMicroService.error_handler-462"><span class="linenos">462</span></a>
</span><span id="PumpWoodMicroService.error_handler-463"><a href="#PumpWoodMicroService.error_handler-463"><span class="linenos">463</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.error_handler-464"><a href="#PumpWoodMicroService.error_handler-464"><span class="linenos">464</span></a><span class="sd">            No return.</span>
</span><span id="PumpWoodMicroService.error_handler-465"><a href="#PumpWoodMicroService.error_handler-465"><span class="linenos">465</span></a>
</span><span id="PumpWoodMicroService.error_handler-466"><a href="#PumpWoodMicroService.error_handler-466"><span class="linenos">466</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.error_handler-467"><a href="#PumpWoodMicroService.error_handler-467"><span class="linenos">467</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService.error_handler-468"><a href="#PumpWoodMicroService.error_handler-468"><span class="linenos">468</span></a><span class="sd">                If content-type is not application/json.</span>
</span><span id="PumpWoodMicroService.error_handler-469"><a href="#PumpWoodMicroService.error_handler-469"><span class="linenos">469</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService.error_handler-470"><a href="#PumpWoodMicroService.error_handler-470"><span class="linenos">470</span></a><span class="sd">                If content-type is application/json, but type not</span>
</span><span id="PumpWoodMicroService.error_handler-471"><a href="#PumpWoodMicroService.error_handler-471"><span class="linenos">471</span></a><span class="sd">                present or not recognisable at `exceptions.exceptions_dict`.</span>
</span><span id="PumpWoodMicroService.error_handler-472"><a href="#PumpWoodMicroService.error_handler-472"><span class="linenos">472</span></a><span class="sd">            Other PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService.error_handler-473"><a href="#PumpWoodMicroService.error_handler-473"><span class="linenos">473</span></a><span class="sd">                If content-type is application/json if type is present and</span>
</span><span id="PumpWoodMicroService.error_handler-474"><a href="#PumpWoodMicroService.error_handler-474"><span class="linenos">474</span></a><span class="sd">                recognisable.</span>
</span><span id="PumpWoodMicroService.error_handler-475"><a href="#PumpWoodMicroService.error_handler-475"><span class="linenos">475</span></a>
</span><span id="PumpWoodMicroService.error_handler-476"><a href="#PumpWoodMicroService.error_handler-476"><span class="linenos">476</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.error_handler-477"><a href="#PumpWoodMicroService.error_handler-477"><span class="linenos">477</span></a><span class="sd">            No example</span>
</span><span id="PumpWoodMicroService.error_handler-478"><a href="#PumpWoodMicroService.error_handler-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.error_handler-479"><a href="#PumpWoodMicroService.error_handler-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.error_handler-480"><a href="#PumpWoodMicroService.error_handler-480"><span class="linenos">480</span></a>            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-481"><a href="#PumpWoodMicroService.error_handler-481"><span class="linenos">481</span></a>            <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.error_handler-482"><a href="#PumpWoodMicroService.error_handler-482"><span class="linenos">482</span></a>
</span><span id="PumpWoodMicroService.error_handler-483"><a href="#PumpWoodMicroService.error_handler-483"><span class="linenos">483</span></a>            <span class="c1"># Request information</span>
</span><span id="PumpWoodMicroService.error_handler-484"><a href="#PumpWoodMicroService.error_handler-484"><span class="linenos">484</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
</span><span id="PumpWoodMicroService.error_handler-485"><a href="#PumpWoodMicroService.error_handler-485"><span class="linenos">485</span></a>            <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
</span><span id="PumpWoodMicroService.error_handler-486"><a href="#PumpWoodMicroService.error_handler-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.error_handler-487"><a href="#PumpWoodMicroService.error_handler-487"><span class="linenos">487</span></a>                <span class="c1"># Raise the exception as first in exception deep.</span>
</span><span id="PumpWoodMicroService.error_handler-488"><a href="#PumpWoodMicroService.error_handler-488"><span class="linenos">488</span></a>                <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="PumpWoodMicroService.error_handler-489"><a href="#PumpWoodMicroService.error_handler-489"><span class="linenos">489</span></a>                    <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-490"><a href="#PumpWoodMicroService.error_handler-490"><span class="linenos">490</span></a>                    <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-491"><a href="#PumpWoodMicroService.error_handler-491"><span class="linenos">491</span></a>                    <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService.error_handler-492"><a href="#PumpWoodMicroService.error_handler-492"><span class="linenos">492</span></a>                    <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</span><span id="PumpWoodMicroService.error_handler-493"><a href="#PumpWoodMicroService.error_handler-493"><span class="linenos">493</span></a>                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.error_handler-494"><a href="#PumpWoodMicroService.error_handler-494"><span class="linenos">494</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.error_handler-495"><a href="#PumpWoodMicroService.error_handler-495"><span class="linenos">495</span></a>                        <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.error_handler-496"><a href="#PumpWoodMicroService.error_handler-496"><span class="linenos">496</span></a>
</span><span id="PumpWoodMicroService.error_handler-497"><a href="#PumpWoodMicroService.error_handler-497"><span class="linenos">497</span></a>            <span class="c1"># Build error stack</span>
</span><span id="PumpWoodMicroService.error_handler-498"><a href="#PumpWoodMicroService.error_handler-498"><span class="linenos">498</span></a>            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-499"><a href="#PumpWoodMicroService.error_handler-499"><span class="linenos">499</span></a>
</span><span id="PumpWoodMicroService.error_handler-500"><a href="#PumpWoodMicroService.error_handler-500"><span class="linenos">500</span></a>            <span class="c1"># Removing previous error stack</span>
</span><span id="PumpWoodMicroService.error_handler-501"><a href="#PumpWoodMicroService.error_handler-501"><span class="linenos">501</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="PumpWoodMicroService.error_handler-502"><a href="#PumpWoodMicroService.error_handler-502"><span class="linenos">502</span></a>            <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="PumpWoodMicroService.error_handler-503"><a href="#PumpWoodMicroService.error_handler-503"><span class="linenos">503</span></a>
</span><span id="PumpWoodMicroService.error_handler-504"><a href="#PumpWoodMicroService.error_handler-504"><span class="linenos">504</span></a>            <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-505"><a href="#PumpWoodMicroService.error_handler-505"><span class="linenos">505</span></a>            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.error_handler-506"><a href="#PumpWoodMicroService.error_handler-506"><span class="linenos">506</span></a>                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-507"><a href="#PumpWoodMicroService.error_handler-507"><span class="linenos">507</span></a>                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-508"><a href="#PumpWoodMicroService.error_handler-508"><span class="linenos">508</span></a>                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService.error_handler-509"><a href="#PumpWoodMicroService.error_handler-509"><span class="linenos">509</span></a>                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService.error_handler-510"><a href="#PumpWoodMicroService.error_handler-510"><span class="linenos">510</span></a>            <span class="p">}</span>
</span><span id="PumpWoodMicroService.error_handler-511"><a href="#PumpWoodMicroService.error_handler-511"><span class="linenos">511</span></a>            <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-512"><a href="#PumpWoodMicroService.error_handler-512"><span class="linenos">512</span></a>            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="PumpWoodMicroService.error_handler-513"><a href="#PumpWoodMicroService.error_handler-513"><span class="linenos">513</span></a>
</span><span id="PumpWoodMicroService.error_handler-514"><a href="#PumpWoodMicroService.error_handler-514"><span class="linenos">514</span></a>            <span class="c1">###################</span>
</span><span id="PumpWoodMicroService.error_handler-515"><a href="#PumpWoodMicroService.error_handler-515"><span class="linenos">515</span></a>            <span class="c1"># Propagate error #</span>
</span><span id="PumpWoodMicroService.error_handler-516"><a href="#PumpWoodMicroService.error_handler-516"><span class="linenos">516</span></a>            <span class="c1"># get exception using &#39;type&#39; key at response data and get the</span>
</span><span id="PumpWoodMicroService.error_handler-517"><a href="#PumpWoodMicroService.error_handler-517"><span class="linenos">517</span></a>            <span class="c1"># exception from exceptions_dict at exceptions</span>
</span><span id="PumpWoodMicroService.error_handler-518"><a href="#PumpWoodMicroService.error_handler-518"><span class="linenos">518</span></a>            <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-519"><a href="#PumpWoodMicroService.error_handler-519"><span class="linenos">519</span></a>            <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-520"><a href="#PumpWoodMicroService.error_handler-520"><span class="linenos">520</span></a>            <span class="n">TempPumpwoodException</span> <span class="o">=</span> <span class="n">exceptions_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exception_type</span><span class="p">)</span> <span class="c1"># NOQA</span>
</span><span id="PumpWoodMicroService.error_handler-521"><a href="#PumpWoodMicroService.error_handler-521"><span class="linenos">521</span></a>            <span class="k">if</span> <span class="n">TempPumpwoodException</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.error_handler-522"><a href="#PumpWoodMicroService.error_handler-522"><span class="linenos">522</span></a>                <span class="k">raise</span> <span class="n">TempPumpwoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.error_handler-523"><a href="#PumpWoodMicroService.error_handler-523"><span class="linenos">523</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-524"><a href="#PumpWoodMicroService.error_handler-524"><span class="linenos">524</span></a>                    <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-525"><a href="#PumpWoodMicroService.error_handler-525"><span class="linenos">525</span></a>                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-526"><a href="#PumpWoodMicroService.error_handler-526"><span class="linenos">526</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.error_handler-527"><a href="#PumpWoodMicroService.error_handler-527"><span class="linenos">527</span></a>                <span class="c1"># If token is invalid is at response, return a</span>
</span><span id="PumpWoodMicroService.error_handler-528"><a href="#PumpWoodMicroService.error_handler-528"><span class="linenos">528</span></a>                <span class="c1"># PumpWoodUnauthorized error</span>
</span><span id="PumpWoodMicroService.error_handler-529"><a href="#PumpWoodMicroService.error_handler-529"><span class="linenos">529</span></a>                <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.error_handler-530"><a href="#PumpWoodMicroService.error_handler-530"><span class="linenos">530</span></a>                <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
</span><span id="PumpWoodMicroService.error_handler-531"><a href="#PumpWoodMicroService.error_handler-531"><span class="linenos">531</span></a>                <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.error_handler-532"><a href="#PumpWoodMicroService.error_handler-532"><span class="linenos">532</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.error_handler-533"><a href="#PumpWoodMicroService.error_handler-533"><span class="linenos">533</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-534"><a href="#PumpWoodMicroService.error_handler-534"><span class="linenos">534</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.error_handler-535"><a href="#PumpWoodMicroService.error_handler-535"><span class="linenos">535</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.error_handler-536"><a href="#PumpWoodMicroService.error_handler-536"><span class="linenos">536</span></a>                    <span class="c1"># If the error is not mapped return a</span>
</span><span id="PumpWoodMicroService.error_handler-537"><a href="#PumpWoodMicroService.error_handler-537"><span class="linenos">537</span></a>                    <span class="c1"># PumpWoodOtherException limiting the message size to 1k</span>
</span><span id="PumpWoodMicroService.error_handler-538"><a href="#PumpWoodMicroService.error_handler-538"><span class="linenos">538</span></a>                    <span class="c1"># characters</span>
</span><span id="PumpWoodMicroService.error_handler-539"><a href="#PumpWoodMicroService.error_handler-539"><span class="linenos">539</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.error_handler-540"><a href="#PumpWoodMicroService.error_handler-540"><span class="linenos">540</span></a>                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.error_handler-541"><a href="#PumpWoodMicroService.error_handler-541"><span class="linenos">541</span></a>                        <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Handle request error.</p>

<p>Check if is a Json and propagate the error with
same type if possible. If not Json raises the content.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>response:</strong>  response to be handled, it is a PumpWoodException
return it will raise the same exception at microservice
object.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>No return.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodOtherException:</strong>  If content-type is not application/json.</li>
<li><strong>PumpWoodOtherException:</strong>  If content-type is application/json, but type not
present or not recognisable at <code>exceptions.exceptions_dict</code>.</li>
<li><strong>Other PumpWoodException sub-types:</strong>  If content-type is application/json if type is present and
recognisable.</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.is_invalid_token_response" class="classattr">
                                        <input id="PumpWoodMicroService.is_invalid_token_response-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">is_invalid_token_response</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.is_invalid_token_response-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.is_invalid_token_response"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.is_invalid_token_response-543"><a href="#PumpWoodMicroService.is_invalid_token_response-543"><span class="linenos">543</span></a>    <span class="nd">@classmethod</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-544"><a href="#PumpWoodMicroService.is_invalid_token_response-544"><span class="linenos">544</span></a>    <span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-545"><a href="#PumpWoodMicroService.is_invalid_token_response-545"><span class="linenos">545</span></a>                                  <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-546"><a href="#PumpWoodMicroService.is_invalid_token_response-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if reponse has invalid token error.</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-547"><a href="#PumpWoodMicroService.is_invalid_token_response-547"><span class="linenos">547</span></a>
</span><span id="PumpWoodMicroService.is_invalid_token_response-548"><a href="#PumpWoodMicroService.is_invalid_token_response-548"><span class="linenos">548</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-549"><a href="#PumpWoodMicroService.is_invalid_token_response-549"><span class="linenos">549</span></a><span class="sd">            response:</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-550"><a href="#PumpWoodMicroService.is_invalid_token_response-550"><span class="linenos">550</span></a><span class="sd">                Request reponse to check for invalid token.</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-551"><a href="#PumpWoodMicroService.is_invalid_token_response-551"><span class="linenos">551</span></a>
</span><span id="PumpWoodMicroService.is_invalid_token_response-552"><a href="#PumpWoodMicroService.is_invalid_token_response-552"><span class="linenos">552</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-553"><a href="#PumpWoodMicroService.is_invalid_token_response-553"><span class="linenos">553</span></a><span class="sd">            Return True if response has an invalid token status.</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-554"><a href="#PumpWoodMicroService.is_invalid_token_response-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-555"><a href="#PumpWoodMicroService.is_invalid_token_response-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-556"><a href="#PumpWoodMicroService.is_invalid_token_response-556"><span class="linenos">556</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.is_invalid_token_response-557"><a href="#PumpWoodMicroService.is_invalid_token_response-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if reponse has invalid token error.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>response:</strong>  Request reponse to check for invalid token.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return True if response has an invalid token status.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.request_post" class="classattr">
                                        <input id="PumpWoodMicroService.request_post-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">request_post</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.request_post-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.request_post"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.request_post-559"><a href="#PumpWoodMicroService.request_post-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-560"><a href="#PumpWoodMicroService.request_post-560"><span class="linenos">560</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-561"><a href="#PumpWoodMicroService.request_post-561"><span class="linenos">561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a POST a request to url with data as JSON payload.</span>
</span><span id="PumpWoodMicroService.request_post-562"><a href="#PumpWoodMicroService.request_post-562"><span class="linenos">562</span></a>
</span><span id="PumpWoodMicroService.request_post-563"><a href="#PumpWoodMicroService.request_post-563"><span class="linenos">563</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.request_post-564"><a href="#PumpWoodMicroService.request_post-564"><span class="linenos">564</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService.request_post-565"><a href="#PumpWoodMicroService.request_post-565"><span class="linenos">565</span></a><span class="sd">                URL to make the request.</span>
</span><span id="PumpWoodMicroService.request_post-566"><a href="#PumpWoodMicroService.request_post-566"><span class="linenos">566</span></a><span class="sd">            data:</span>
</span><span id="PumpWoodMicroService.request_post-567"><a href="#PumpWoodMicroService.request_post-567"><span class="linenos">567</span></a><span class="sd">                Data to be used as Json payload.</span>
</span><span id="PumpWoodMicroService.request_post-568"><a href="#PumpWoodMicroService.request_post-568"><span class="linenos">568</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService.request_post-569"><a href="#PumpWoodMicroService.request_post-569"><span class="linenos">569</span></a><span class="sd">                A dictonary with file data, files will be set on field</span>
</span><span id="PumpWoodMicroService.request_post-570"><a href="#PumpWoodMicroService.request_post-570"><span class="linenos">570</span></a><span class="sd">                corresponding.to dictonary key.</span>
</span><span id="PumpWoodMicroService.request_post-571"><a href="#PumpWoodMicroService.request_post-571"><span class="linenos">571</span></a><span class="sd">                `{&#39;file1&#39;: open(&#39;file1&#39;, &#39;rb&#39;), {&#39;file2&#39;: open(&#39;file2&#39;, &#39;rb&#39;)}`</span>
</span><span id="PumpWoodMicroService.request_post-572"><a href="#PumpWoodMicroService.request_post-572"><span class="linenos">572</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.request_post-573"><a href="#PumpWoodMicroService.request_post-573"><span class="linenos">573</span></a><span class="sd">                URL parameters.</span>
</span><span id="PumpWoodMicroService.request_post-574"><a href="#PumpWoodMicroService.request_post-574"><span class="linenos">574</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.request_post-575"><a href="#PumpWoodMicroService.request_post-575"><span class="linenos">575</span></a><span class="sd">                AuthHeader to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.request_post-576"><a href="#PumpWoodMicroService.request_post-576"><span class="linenos">576</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.request_post-577"><a href="#PumpWoodMicroService.request_post-577"><span class="linenos">577</span></a>
</span><span id="PumpWoodMicroService.request_post-578"><a href="#PumpWoodMicroService.request_post-578"><span class="linenos">578</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.request_post-579"><a href="#PumpWoodMicroService.request_post-579"><span class="linenos">579</span></a><span class="sd">            Return the post response data.</span>
</span><span id="PumpWoodMicroService.request_post-580"><a href="#PumpWoodMicroService.request_post-580"><span class="linenos">580</span></a>
</span><span id="PumpWoodMicroService.request_post-581"><a href="#PumpWoodMicroService.request_post-581"><span class="linenos">581</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.request_post-582"><a href="#PumpWoodMicroService.request_post-582"><span class="linenos">582</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService.request_post-583"><a href="#PumpWoodMicroService.request_post-583"><span class="linenos">583</span></a><span class="sd">                Response is passed to error_handler.</span>
</span><span id="PumpWoodMicroService.request_post-584"><a href="#PumpWoodMicroService.request_post-584"><span class="linenos">584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.request_post-585"><a href="#PumpWoodMicroService.request_post-585"><span class="linenos">585</span></a>        <span class="c1"># If parameters are not none convert them to JSON before</span>
</span><span id="PumpWoodMicroService.request_post-586"><a href="#PumpWoodMicroService.request_post-586"><span class="linenos">586</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on Javascript</span>
</span><span id="PumpWoodMicroService.request_post-587"><a href="#PumpWoodMicroService.request_post-587"><span class="linenos">587</span></a>        <span class="c1"># for exemple</span>
</span><span id="PumpWoodMicroService.request_post-588"><a href="#PumpWoodMicroService.request_post-588"><span class="linenos">588</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-589"><a href="#PumpWoodMicroService.request_post-589"><span class="linenos">589</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-590"><a href="#PumpWoodMicroService.request_post-590"><span class="linenos">590</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.request_post-591"><a href="#PumpWoodMicroService.request_post-591"><span class="linenos">591</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="PumpWoodMicroService.request_post-592"><a href="#PumpWoodMicroService.request_post-592"><span class="linenos">592</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-593"><a href="#PumpWoodMicroService.request_post-593"><span class="linenos">593</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.request_post-594"><a href="#PumpWoodMicroService.request_post-594"><span class="linenos">594</span></a>
</span><span id="PumpWoodMicroService.request_post-595"><a href="#PumpWoodMicroService.request_post-595"><span class="linenos">595</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.request_post-596"><a href="#PumpWoodMicroService.request_post-596"><span class="linenos">596</span></a>        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-597"><a href="#PumpWoodMicroService.request_post-597"><span class="linenos">597</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-598"><a href="#PumpWoodMicroService.request_post-598"><span class="linenos">598</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-599"><a href="#PumpWoodMicroService.request_post-599"><span class="linenos">599</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-600"><a href="#PumpWoodMicroService.request_post-600"><span class="linenos">600</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="PumpWoodMicroService.request_post-601"><a href="#PumpWoodMicroService.request_post-601"><span class="linenos">601</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-602"><a href="#PumpWoodMicroService.request_post-602"><span class="linenos">602</span></a>                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-603"><a href="#PumpWoodMicroService.request_post-603"><span class="linenos">603</span></a>
</span><span id="PumpWoodMicroService.request_post-604"><a href="#PumpWoodMicroService.request_post-604"><span class="linenos">604</span></a>            <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="PumpWoodMicroService.request_post-605"><a href="#PumpWoodMicroService.request_post-605"><span class="linenos">605</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-606"><a href="#PumpWoodMicroService.request_post-606"><span class="linenos">606</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService.request_post-607"><a href="#PumpWoodMicroService.request_post-607"><span class="linenos">607</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-608"><a href="#PumpWoodMicroService.request_post-608"><span class="linenos">608</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-609"><a href="#PumpWoodMicroService.request_post-609"><span class="linenos">609</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-610"><a href="#PumpWoodMicroService.request_post-610"><span class="linenos">610</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-611"><a href="#PumpWoodMicroService.request_post-611"><span class="linenos">611</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-612"><a href="#PumpWoodMicroService.request_post-612"><span class="linenos">612</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-613"><a href="#PumpWoodMicroService.request_post-613"><span class="linenos">613</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="PumpWoodMicroService.request_post-614"><a href="#PumpWoodMicroService.request_post-614"><span class="linenos">614</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-615"><a href="#PumpWoodMicroService.request_post-615"><span class="linenos">615</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-616"><a href="#PumpWoodMicroService.request_post-616"><span class="linenos">616</span></a>
</span><span id="PumpWoodMicroService.request_post-617"><a href="#PumpWoodMicroService.request_post-617"><span class="linenos">617</span></a>        <span class="c1"># Request with files are done using multipart serializing all fields</span>
</span><span id="PumpWoodMicroService.request_post-618"><a href="#PumpWoodMicroService.request_post-618"><span class="linenos">618</span></a>        <span class="c1"># as JSON</span>
</span><span id="PumpWoodMicroService.request_post-619"><a href="#PumpWoodMicroService.request_post-619"><span class="linenos">619</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-620"><a href="#PumpWoodMicroService.request_post-620"><span class="linenos">620</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-621"><a href="#PumpWoodMicroService.request_post-621"><span class="linenos">621</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-622"><a href="#PumpWoodMicroService.request_post-622"><span class="linenos">622</span></a>            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-623"><a href="#PumpWoodMicroService.request_post-623"><span class="linenos">623</span></a>            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
</span><span id="PumpWoodMicroService.request_post-624"><a href="#PumpWoodMicroService.request_post-624"><span class="linenos">624</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-625"><a href="#PumpWoodMicroService.request_post-625"><span class="linenos">625</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-626"><a href="#PumpWoodMicroService.request_post-626"><span class="linenos">626</span></a>                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-627"><a href="#PumpWoodMicroService.request_post-627"><span class="linenos">627</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-628"><a href="#PumpWoodMicroService.request_post-628"><span class="linenos">628</span></a>
</span><span id="PumpWoodMicroService.request_post-629"><a href="#PumpWoodMicroService.request_post-629"><span class="linenos">629</span></a>            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-630"><a href="#PumpWoodMicroService.request_post-630"><span class="linenos">630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService.request_post-631"><a href="#PumpWoodMicroService.request_post-631"><span class="linenos">631</span></a>                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-632"><a href="#PumpWoodMicroService.request_post-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-633"><a href="#PumpWoodMicroService.request_post-633"><span class="linenos">633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-634"><a href="#PumpWoodMicroService.request_post-634"><span class="linenos">634</span></a>                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-635"><a href="#PumpWoodMicroService.request_post-635"><span class="linenos">635</span></a>                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-636"><a href="#PumpWoodMicroService.request_post-636"><span class="linenos">636</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_post-637"><a href="#PumpWoodMicroService.request_post-637"><span class="linenos">637</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-638"><a href="#PumpWoodMicroService.request_post-638"><span class="linenos">638</span></a>                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-639"><a href="#PumpWoodMicroService.request_post-639"><span class="linenos">639</span></a>                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-640"><a href="#PumpWoodMicroService.request_post-640"><span class="linenos">640</span></a>
</span><span id="PumpWoodMicroService.request_post-641"><a href="#PumpWoodMicroService.request_post-641"><span class="linenos">641</span></a>        <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
</span><span id="PumpWoodMicroService.request_post-642"><a href="#PumpWoodMicroService.request_post-642"><span class="linenos">642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-643"><a href="#PumpWoodMicroService.request_post-643"><span class="linenos">643</span></a>
</span><span id="PumpWoodMicroService.request_post-644"><a href="#PumpWoodMicroService.request_post-644"><span class="linenos">644</span></a>        <span class="c1"># Check if response is a file</span>
</span><span id="PumpWoodMicroService.request_post-645"><a href="#PumpWoodMicroService.request_post-645"><span class="linenos">645</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="PumpWoodMicroService.request_post-646"><a href="#PumpWoodMicroService.request_post-646"><span class="linenos">646</span></a>        <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-647"><a href="#PumpWoodMicroService.request_post-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-648"><a href="#PumpWoodMicroService.request_post-648"><span class="linenos">648</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_post-649"><a href="#PumpWoodMicroService.request_post-649"><span class="linenos">649</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-650"><a href="#PumpWoodMicroService.request_post-650"><span class="linenos">650</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.request_post-651"><a href="#PumpWoodMicroService.request_post-651"><span class="linenos">651</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.request_post-652"><a href="#PumpWoodMicroService.request_post-652"><span class="linenos">652</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.request_post-653"><a href="#PumpWoodMicroService.request_post-653"><span class="linenos">653</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-654"><a href="#PumpWoodMicroService.request_post-654"><span class="linenos">654</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.request_post-655"><a href="#PumpWoodMicroService.request_post-655"><span class="linenos">655</span></a>                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_post-656"><a href="#PumpWoodMicroService.request_post-656"><span class="linenos">656</span></a>                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.request_post-657"><a href="#PumpWoodMicroService.request_post-657"><span class="linenos">657</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_post-658"><a href="#PumpWoodMicroService.request_post-658"><span class="linenos">658</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make a POST a request to url with data as JSON payload.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>url:</strong>  URL to make the request.</li>
<li><strong>data:</strong>  Data to be used as Json payload.</li>
<li><strong>files:</strong>  A dictonary with file data, files will be set on field
corresponding.to dictonary key.
<code>{'file1': open('file1', 'rb'), {'file2': open('file2', 'rb')}</code></li>
<li><strong>parameters:</strong>  URL parameters.</li>
<li><strong>auth_header:</strong>  AuthHeader to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return the post response data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException sub-types:</strong>  Response is passed to error_handler.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.request_get" class="classattr">
                                        <input id="PumpWoodMicroService.request_get-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">request_get</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span>, </span><span class="param"><span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.request_get-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.request_get"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.request_get-660"><a href="#PumpWoodMicroService.request_get-660"><span class="linenos">660</span></a>    <span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.request_get-661"><a href="#PumpWoodMicroService.request_get-661"><span class="linenos">661</span></a>                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.request_get-662"><a href="#PumpWoodMicroService.request_get-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a GET a request to url with data as JSON payload.</span>
</span><span id="PumpWoodMicroService.request_get-663"><a href="#PumpWoodMicroService.request_get-663"><span class="linenos">663</span></a>
</span><span id="PumpWoodMicroService.request_get-664"><a href="#PumpWoodMicroService.request_get-664"><span class="linenos">664</span></a><span class="sd">        Add the auth_header acording to login information and refresh token</span>
</span><span id="PumpWoodMicroService.request_get-665"><a href="#PumpWoodMicroService.request_get-665"><span class="linenos">665</span></a><span class="sd">        if auth_header=None and object token is expired.</span>
</span><span id="PumpWoodMicroService.request_get-666"><a href="#PumpWoodMicroService.request_get-666"><span class="linenos">666</span></a>
</span><span id="PumpWoodMicroService.request_get-667"><a href="#PumpWoodMicroService.request_get-667"><span class="linenos">667</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.request_get-668"><a href="#PumpWoodMicroService.request_get-668"><span class="linenos">668</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService.request_get-669"><a href="#PumpWoodMicroService.request_get-669"><span class="linenos">669</span></a><span class="sd">                URL to make the request.</span>
</span><span id="PumpWoodMicroService.request_get-670"><a href="#PumpWoodMicroService.request_get-670"><span class="linenos">670</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.request_get-671"><a href="#PumpWoodMicroService.request_get-671"><span class="linenos">671</span></a><span class="sd">                URL parameters to make the request.</span>
</span><span id="PumpWoodMicroService.request_get-672"><a href="#PumpWoodMicroService.request_get-672"><span class="linenos">672</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.request_get-673"><a href="#PumpWoodMicroService.request_get-673"><span class="linenos">673</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.request_get-674"><a href="#PumpWoodMicroService.request_get-674"><span class="linenos">674</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.request_get-675"><a href="#PumpWoodMicroService.request_get-675"><span class="linenos">675</span></a>
</span><span id="PumpWoodMicroService.request_get-676"><a href="#PumpWoodMicroService.request_get-676"><span class="linenos">676</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.request_get-677"><a href="#PumpWoodMicroService.request_get-677"><span class="linenos">677</span></a><span class="sd">            Return the post reponse data.</span>
</span><span id="PumpWoodMicroService.request_get-678"><a href="#PumpWoodMicroService.request_get-678"><span class="linenos">678</span></a>
</span><span id="PumpWoodMicroService.request_get-679"><a href="#PumpWoodMicroService.request_get-679"><span class="linenos">679</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.request_get-680"><a href="#PumpWoodMicroService.request_get-680"><span class="linenos">680</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService.request_get-681"><a href="#PumpWoodMicroService.request_get-681"><span class="linenos">681</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="PumpWoodMicroService.request_get-682"><a href="#PumpWoodMicroService.request_get-682"><span class="linenos">682</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="PumpWoodMicroService.request_get-683"><a href="#PumpWoodMicroService.request_get-683"><span class="linenos">683</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="PumpWoodMicroService.request_get-684"><a href="#PumpWoodMicroService.request_get-684"><span class="linenos">684</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService.request_get-685"><a href="#PumpWoodMicroService.request_get-685"><span class="linenos">685</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="PumpWoodMicroService.request_get-686"><a href="#PumpWoodMicroService.request_get-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.request_get-687"><a href="#PumpWoodMicroService.request_get-687"><span class="linenos">687</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-688"><a href="#PumpWoodMicroService.request_get-688"><span class="linenos">688</span></a>
</span><span id="PumpWoodMicroService.request_get-689"><a href="#PumpWoodMicroService.request_get-689"><span class="linenos">689</span></a>        <span class="c1"># If parameters are not none convert them to json before</span>
</span><span id="PumpWoodMicroService.request_get-690"><a href="#PumpWoodMicroService.request_get-690"><span class="linenos">690</span></a>        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
</span><span id="PumpWoodMicroService.request_get-691"><a href="#PumpWoodMicroService.request_get-691"><span class="linenos">691</span></a>        <span class="c1"># for example</span>
</span><span id="PumpWoodMicroService.request_get-692"><a href="#PumpWoodMicroService.request_get-692"><span class="linenos">692</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_get-693"><a href="#PumpWoodMicroService.request_get-693"><span class="linenos">693</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-694"><a href="#PumpWoodMicroService.request_get-694"><span class="linenos">694</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.request_get-695"><a href="#PumpWoodMicroService.request_get-695"><span class="linenos">695</span></a>                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
</span><span id="PumpWoodMicroService.request_get-696"><a href="#PumpWoodMicroService.request_get-696"><span class="linenos">696</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_get-697"><a href="#PumpWoodMicroService.request_get-697"><span class="linenos">697</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.request_get-698"><a href="#PumpWoodMicroService.request_get-698"><span class="linenos">698</span></a>
</span><span id="PumpWoodMicroService.request_get-699"><a href="#PumpWoodMicroService.request_get-699"><span class="linenos">699</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-700"><a href="#PumpWoodMicroService.request_get-700"><span class="linenos">700</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_get-701"><a href="#PumpWoodMicroService.request_get-701"><span class="linenos">701</span></a>            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_get-702"><a href="#PumpWoodMicroService.request_get-702"><span class="linenos">702</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-703"><a href="#PumpWoodMicroService.request_get-703"><span class="linenos">703</span></a>
</span><span id="PumpWoodMicroService.request_get-704"><a href="#PumpWoodMicroService.request_get-704"><span class="linenos">704</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.request_get-705"><a href="#PumpWoodMicroService.request_get-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService.request_get-706"><a href="#PumpWoodMicroService.request_get-706"><span class="linenos">706</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-707"><a href="#PumpWoodMicroService.request_get-707"><span class="linenos">707</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_get-708"><a href="#PumpWoodMicroService.request_get-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-709"><a href="#PumpWoodMicroService.request_get-709"><span class="linenos">709</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-710"><a href="#PumpWoodMicroService.request_get-710"><span class="linenos">710</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_get-711"><a href="#PumpWoodMicroService.request_get-711"><span class="linenos">711</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_get-712"><a href="#PumpWoodMicroService.request_get-712"><span class="linenos">712</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-713"><a href="#PumpWoodMicroService.request_get-713"><span class="linenos">713</span></a>
</span><span id="PumpWoodMicroService.request_get-714"><a href="#PumpWoodMicroService.request_get-714"><span class="linenos">714</span></a>        <span class="c1"># Re-raise Pumpwood exceptions</span>
</span><span id="PumpWoodMicroService.request_get-715"><a href="#PumpWoodMicroService.request_get-715"><span class="linenos">715</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-716"><a href="#PumpWoodMicroService.request_get-716"><span class="linenos">716</span></a>
</span><span id="PumpWoodMicroService.request_get-717"><a href="#PumpWoodMicroService.request_get-717"><span class="linenos">717</span></a>        <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.request_get-718"><a href="#PumpWoodMicroService.request_get-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_get-719"><a href="#PumpWoodMicroService.request_get-719"><span class="linenos">719</span></a>            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_get-720"><a href="#PumpWoodMicroService.request_get-720"><span class="linenos">720</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_get-721"><a href="#PumpWoodMicroService.request_get-721"><span class="linenos">721</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.request_get-722"><a href="#PumpWoodMicroService.request_get-722"><span class="linenos">722</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.request_get-723"><a href="#PumpWoodMicroService.request_get-723"><span class="linenos">723</span></a>
</span><span id="PumpWoodMicroService.request_get-724"><a href="#PumpWoodMicroService.request_get-724"><span class="linenos">724</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.request_get-725"><a href="#PumpWoodMicroService.request_get-725"><span class="linenos">725</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_get-726"><a href="#PumpWoodMicroService.request_get-726"><span class="linenos">726</span></a>                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.request_get-727"><a href="#PumpWoodMicroService.request_get-727"><span class="linenos">727</span></a>                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Make a GET a request to url with data as JSON payload.</p>

<p>Add the auth_header acording to login information and refresh token
if auth_header=None and object token is expired.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>url:</strong>  URL to make the request.</li>
<li><strong>parameters:</strong>  URL parameters to make the request.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return the post reponse data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException sub-types:</strong>  Raise exception if reponse is not 2XX and if 'type' key on
JSON payload if found at exceptions_dict. Use the same
exception, message and payload.</li>
<li><strong>PumpWoodOtherException:</strong>  If exception type is not found or return is not a json.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.request_delete" class="classattr">
                                        <input id="PumpWoodMicroService.request_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">request_delete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span>, </span><span class="param"><span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.request_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.request_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.request_delete-729"><a href="#PumpWoodMicroService.request_delete-729"><span class="linenos">729</span></a>    <span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_delete-730"><a href="#PumpWoodMicroService.request_delete-730"><span class="linenos">730</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.request_delete-731"><a href="#PumpWoodMicroService.request_delete-731"><span class="linenos">731</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a DELETE a request to url with data as Json payload.</span>
</span><span id="PumpWoodMicroService.request_delete-732"><a href="#PumpWoodMicroService.request_delete-732"><span class="linenos">732</span></a>
</span><span id="PumpWoodMicroService.request_delete-733"><a href="#PumpWoodMicroService.request_delete-733"><span class="linenos">733</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.request_delete-734"><a href="#PumpWoodMicroService.request_delete-734"><span class="linenos">734</span></a><span class="sd">            url:</span>
</span><span id="PumpWoodMicroService.request_delete-735"><a href="#PumpWoodMicroService.request_delete-735"><span class="linenos">735</span></a><span class="sd">                Url to make the request.</span>
</span><span id="PumpWoodMicroService.request_delete-736"><a href="#PumpWoodMicroService.request_delete-736"><span class="linenos">736</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.request_delete-737"><a href="#PumpWoodMicroService.request_delete-737"><span class="linenos">737</span></a><span class="sd">                Dictionary with Urls parameters.</span>
</span><span id="PumpWoodMicroService.request_delete-738"><a href="#PumpWoodMicroService.request_delete-738"><span class="linenos">738</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.request_delete-739"><a href="#PumpWoodMicroService.request_delete-739"><span class="linenos">739</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.request_delete-740"><a href="#PumpWoodMicroService.request_delete-740"><span class="linenos">740</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.request_delete-741"><a href="#PumpWoodMicroService.request_delete-741"><span class="linenos">741</span></a>
</span><span id="PumpWoodMicroService.request_delete-742"><a href="#PumpWoodMicroService.request_delete-742"><span class="linenos">742</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.request_delete-743"><a href="#PumpWoodMicroService.request_delete-743"><span class="linenos">743</span></a><span class="sd">            Return the delete reponse payload.</span>
</span><span id="PumpWoodMicroService.request_delete-744"><a href="#PumpWoodMicroService.request_delete-744"><span class="linenos">744</span></a>
</span><span id="PumpWoodMicroService.request_delete-745"><a href="#PumpWoodMicroService.request_delete-745"><span class="linenos">745</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.request_delete-746"><a href="#PumpWoodMicroService.request_delete-746"><span class="linenos">746</span></a><span class="sd">            PumpWoodException sub-types:</span>
</span><span id="PumpWoodMicroService.request_delete-747"><a href="#PumpWoodMicroService.request_delete-747"><span class="linenos">747</span></a><span class="sd">                Raise exception if reponse is not 2XX and if &#39;type&#39; key on</span>
</span><span id="PumpWoodMicroService.request_delete-748"><a href="#PumpWoodMicroService.request_delete-748"><span class="linenos">748</span></a><span class="sd">                JSON payload if found at exceptions_dict. Use the same</span>
</span><span id="PumpWoodMicroService.request_delete-749"><a href="#PumpWoodMicroService.request_delete-749"><span class="linenos">749</span></a><span class="sd">                exception, message and payload.</span>
</span><span id="PumpWoodMicroService.request_delete-750"><a href="#PumpWoodMicroService.request_delete-750"><span class="linenos">750</span></a><span class="sd">            PumpWoodOtherException:</span>
</span><span id="PumpWoodMicroService.request_delete-751"><a href="#PumpWoodMicroService.request_delete-751"><span class="linenos">751</span></a><span class="sd">                If exception type is not found or return is not a json.</span>
</span><span id="PumpWoodMicroService.request_delete-752"><a href="#PumpWoodMicroService.request_delete-752"><span class="linenos">752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.request_delete-753"><a href="#PumpWoodMicroService.request_delete-753"><span class="linenos">753</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-754"><a href="#PumpWoodMicroService.request_delete-754"><span class="linenos">754</span></a>
</span><span id="PumpWoodMicroService.request_delete-755"><a href="#PumpWoodMicroService.request_delete-755"><span class="linenos">755</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="PumpWoodMicroService.request_delete-756"><a href="#PumpWoodMicroService.request_delete-756"><span class="linenos">756</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_delete-757"><a href="#PumpWoodMicroService.request_delete-757"><span class="linenos">757</span></a>            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_delete-758"><a href="#PumpWoodMicroService.request_delete-758"><span class="linenos">758</span></a>            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-759"><a href="#PumpWoodMicroService.request_delete-759"><span class="linenos">759</span></a>
</span><span id="PumpWoodMicroService.request_delete-760"><a href="#PumpWoodMicroService.request_delete-760"><span class="linenos">760</span></a>        <span class="c1"># Retry request if token is not valid forcing token renew</span>
</span><span id="PumpWoodMicroService.request_delete-761"><a href="#PumpWoodMicroService.request_delete-761"><span class="linenos">761</span></a>        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.request_delete-762"><a href="#PumpWoodMicroService.request_delete-762"><span class="linenos">762</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="PumpWoodMicroService.request_delete-763"><a href="#PumpWoodMicroService.request_delete-763"><span class="linenos">763</span></a>            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-764"><a href="#PumpWoodMicroService.request_delete-764"><span class="linenos">764</span></a>        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.request_delete-765"><a href="#PumpWoodMicroService.request_delete-765"><span class="linenos">765</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-766"><a href="#PumpWoodMicroService.request_delete-766"><span class="linenos">766</span></a>            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-767"><a href="#PumpWoodMicroService.request_delete-767"><span class="linenos">767</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.request_delete-768"><a href="#PumpWoodMicroService.request_delete-768"><span class="linenos">768</span></a>                <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.request_delete-769"><a href="#PumpWoodMicroService.request_delete-769"><span class="linenos">769</span></a>                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-770"><a href="#PumpWoodMicroService.request_delete-770"><span class="linenos">770</span></a>
</span><span id="PumpWoodMicroService.request_delete-771"><a href="#PumpWoodMicroService.request_delete-771"><span class="linenos">771</span></a>        <span class="c1"># Re-raise Pumpwood Exceptions</span>
</span><span id="PumpWoodMicroService.request_delete-772"><a href="#PumpWoodMicroService.request_delete-772"><span class="linenos">772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.request_delete-773"><a href="#PumpWoodMicroService.request_delete-773"><span class="linenos">773</span></a>        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make a DELETE a request to url with data as Json payload.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>url:</strong>  Url to make the request.</li>
<li><strong>parameters:</strong>  Dictionary with Urls parameters.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return the delete reponse payload.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException sub-types:</strong>  Raise exception if reponse is not 2XX and if 'type' key on
JSON payload if found at exceptions_dict. Use the same
exception, message and payload.</li>
<li><strong>PumpWoodOtherException:</strong>  If exception type is not found or return is not a json.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_registered_routes" class="classattr">
                                        <input id="PumpWoodMicroService.list_registered_routes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_registered_routes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_registered_routes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_registered_routes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_registered_routes-775"><a href="#PumpWoodMicroService.list_registered_routes-775"><span class="linenos">775</span></a>    <span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.list_registered_routes-776"><a href="#PumpWoodMicroService.list_registered_routes-776"><span class="linenos">776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_registered_routes-777"><a href="#PumpWoodMicroService.list_registered_routes-777"><span class="linenos">777</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
</span><span id="PumpWoodMicroService.list_registered_routes-778"><a href="#PumpWoodMicroService.list_registered_routes-778"><span class="linenos">778</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_registered_routes-779"><a href="#PumpWoodMicroService.list_registered_routes-779"><span class="linenos">779</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_registered_routes-780"><a href="#PumpWoodMicroService.list_registered_routes-780"><span class="linenos">780</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PumpWoodMicroService.list_registered_routes-781"><a href="#PumpWoodMicroService.list_registered_routes-781"><span class="linenos">781</span></a>            <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.list_registered_routes-782"><a href="#PumpWoodMicroService.list_registered_routes-782"><span class="linenos">782</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span></pre></div>


            <div class="docstring"><p>List routes that have been registed at Kong.</p>
</div>


                            </div>
                            <div id="PumpWoodMicroService.is_microservice_registered" class="classattr">
                                        <input id="PumpWoodMicroService.is_microservice_registered-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_microservice_registered</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.is_microservice_registered-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.is_microservice_registered"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.is_microservice_registered-784"><a href="#PumpWoodMicroService.is_microservice_registered-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-785"><a href="#PumpWoodMicroService.is_microservice_registered-785"><span class="linenos">785</span></a>                                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-786"><a href="#PumpWoodMicroService.is_microservice_registered-786"><span class="linenos">786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a microservice (kong service) is registered at Kong.</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-787"><a href="#PumpWoodMicroService.is_microservice_registered-787"><span class="linenos">787</span></a>
</span><span id="PumpWoodMicroService.is_microservice_registered-788"><a href="#PumpWoodMicroService.is_microservice_registered-788"><span class="linenos">788</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-789"><a href="#PumpWoodMicroService.is_microservice_registered-789"><span class="linenos">789</span></a><span class="sd">            microservice:</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-790"><a href="#PumpWoodMicroService.is_microservice_registered-790"><span class="linenos">790</span></a><span class="sd">                Service associated with microservice registered on</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-791"><a href="#PumpWoodMicroService.is_microservice_registered-791"><span class="linenos">791</span></a><span class="sd">                Pumpwood Kong.</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-792"><a href="#PumpWoodMicroService.is_microservice_registered-792"><span class="linenos">792</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-793"><a href="#PumpWoodMicroService.is_microservice_registered-793"><span class="linenos">793</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-794"><a href="#PumpWoodMicroService.is_microservice_registered-794"><span class="linenos">794</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-795"><a href="#PumpWoodMicroService.is_microservice_registered-795"><span class="linenos">795</span></a>
</span><span id="PumpWoodMicroService.is_microservice_registered-796"><a href="#PumpWoodMicroService.is_microservice_registered-796"><span class="linenos">796</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-797"><a href="#PumpWoodMicroService.is_microservice_registered-797"><span class="linenos">797</span></a><span class="sd">            Return true if microservice is registered.</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-798"><a href="#PumpWoodMicroService.is_microservice_registered-798"><span class="linenos">798</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-799"><a href="#PumpWoodMicroService.is_microservice_registered-799"><span class="linenos">799</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.is_microservice_registered-800"><a href="#PumpWoodMicroService.is_microservice_registered-800"><span class="linenos">800</span></a>        <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Check if a microservice (kong service) is registered at Kong.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>microservice:</strong>  Service associated with microservice registered on
Pumpwood Kong.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return true if microservice is registered.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_registered_endpoints" class="classattr">
                                        <input id="PumpWoodMicroService.list_registered_endpoints-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_registered_endpoints</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">availability</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;front_avaiable&#39;</span></span><span class="return-annotation">) -> <span class="nb">list</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_registered_endpoints-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_registered_endpoints"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_registered_endpoints-802"><a href="#PumpWoodMicroService.list_registered_endpoints-802"><span class="linenos">802</span></a>    <span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-803"><a href="#PumpWoodMicroService.list_registered_endpoints-803"><span class="linenos">803</span></a>                                  <span class="n">availability</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;front_avaiable&#39;</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-804"><a href="#PumpWoodMicroService.list_registered_endpoints-804"><span class="linenos">804</span></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-805"><a href="#PumpWoodMicroService.list_registered_endpoints-805"><span class="linenos">805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all routes and services that have been registed at Kong.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-806"><a href="#PumpWoodMicroService.list_registered_endpoints-806"><span class="linenos">806</span></a>
</span><span id="PumpWoodMicroService.list_registered_endpoints-807"><a href="#PumpWoodMicroService.list_registered_endpoints-807"><span class="linenos">807</span></a><span class="sd">        It is possible to restrict the return to end-points that should be</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-808"><a href="#PumpWoodMicroService.list_registered_endpoints-808"><span class="linenos">808</span></a><span class="sd">        avaiable at the frontend. Using this feature it is possibel to &#39;hide&#39;</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-809"><a href="#PumpWoodMicroService.list_registered_endpoints-809"><span class="linenos">809</span></a><span class="sd">        services from GUI keeping them avaiable for programatic calls.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-810"><a href="#PumpWoodMicroService.list_registered_endpoints-810"><span class="linenos">810</span></a>
</span><span id="PumpWoodMicroService.list_registered_endpoints-811"><a href="#PumpWoodMicroService.list_registered_endpoints-811"><span class="linenos">811</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-812"><a href="#PumpWoodMicroService.list_registered_endpoints-812"><span class="linenos">812</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-813"><a href="#PumpWoodMicroService.list_registered_endpoints-813"><span class="linenos">813</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-814"><a href="#PumpWoodMicroService.list_registered_endpoints-814"><span class="linenos">814</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-815"><a href="#PumpWoodMicroService.list_registered_endpoints-815"><span class="linenos">815</span></a><span class="sd">            availability:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-816"><a href="#PumpWoodMicroService.list_registered_endpoints-816"><span class="linenos">816</span></a><span class="sd">                Set the availability that is associated with the service.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-817"><a href="#PumpWoodMicroService.list_registered_endpoints-817"><span class="linenos">817</span></a><span class="sd">                So far it is implemented &#39;front_avaiable&#39; and &#39;all&#39;.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-818"><a href="#PumpWoodMicroService.list_registered_endpoints-818"><span class="linenos">818</span></a>
</span><span id="PumpWoodMicroService.list_registered_endpoints-819"><a href="#PumpWoodMicroService.list_registered_endpoints-819"><span class="linenos">819</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-820"><a href="#PumpWoodMicroService.list_registered_endpoints-820"><span class="linenos">820</span></a><span class="sd">            Return a list of serialized services objects containing the</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-821"><a href="#PumpWoodMicroService.list_registered_endpoints-821"><span class="linenos">821</span></a><span class="sd">            routes associated with at `route_set`.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-822"><a href="#PumpWoodMicroService.list_registered_endpoints-822"><span class="linenos">822</span></a>
</span><span id="PumpWoodMicroService.list_registered_endpoints-823"><a href="#PumpWoodMicroService.list_registered_endpoints-823"><span class="linenos">823</span></a><span class="sd">            Service and routes have `notes__verbose` and `description__verbose`</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-824"><a href="#PumpWoodMicroService.list_registered_endpoints-824"><span class="linenos">824</span></a><span class="sd">            that are  the repective strings associated with note and</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-825"><a href="#PumpWoodMicroService.list_registered_endpoints-825"><span class="linenos">825</span></a><span class="sd">            description but translated using Pumpwood&#39;s I8s,</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-826"><a href="#PumpWoodMicroService.list_registered_endpoints-826"><span class="linenos">826</span></a>
</span><span id="PumpWoodMicroService.list_registered_endpoints-827"><a href="#PumpWoodMicroService.list_registered_endpoints-827"><span class="linenos">827</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-828"><a href="#PumpWoodMicroService.list_registered_endpoints-828"><span class="linenos">828</span></a><span class="sd">            PumpWoodWrongParameters:</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-829"><a href="#PumpWoodMicroService.list_registered_endpoints-829"><span class="linenos">829</span></a><span class="sd">                Raise PumpWoodWrongParameters if availability passed as</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-830"><a href="#PumpWoodMicroService.list_registered_endpoints-830"><span class="linenos">830</span></a><span class="sd">                paraemter is not implemented.</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-831"><a href="#PumpWoodMicroService.list_registered_endpoints-831"><span class="linenos">831</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-832"><a href="#PumpWoodMicroService.list_registered_endpoints-832"><span class="linenos">832</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-833"><a href="#PumpWoodMicroService.list_registered_endpoints-833"><span class="linenos">833</span></a>        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-834"><a href="#PumpWoodMicroService.list_registered_endpoints-834"><span class="linenos">834</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;availability&#39;</span><span class="p">:</span> <span class="n">availability</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-835"><a href="#PumpWoodMicroService.list_registered_endpoints-835"><span class="linenos">835</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_registered_endpoints-836"><a href="#PumpWoodMicroService.list_registered_endpoints-836"><span class="linenos">836</span></a>        <span class="k">return</span> <span class="n">routes</span>
</span></pre></div>


            <div class="docstring"><p>List all routes and services that have been registed at Kong.</p>

<p>It is possible to restrict the return to end-points that should be
avaiable at the frontend. Using this feature it is possibel to 'hide'
services from GUI keeping them avaiable for programatic calls.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>availability:</strong>  Set the availability that is associated with the service.
So far it is implemented 'front_avaiable' and 'all'.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a list of serialized services objects containing the
  routes associated with at <code>route_set</code>.</p>
  
  <p>Service and routes have <code>notes__verbose</code> and <code>description__verbose</code>
  that are  the repective strings associated with note and
  description but translated using Pumpwood's I8s,</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodWrongParameters:</strong>  Raise PumpWoodWrongParameters if availability passed as
paraemter is not implemented.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.dummy_call" class="classattr">
                                        <input id="PumpWoodMicroService.dummy_call-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dummy_call</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.dummy_call-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.dummy_call"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.dummy_call-838"><a href="#PumpWoodMicroService.dummy_call-838"><span class="linenos">838</span></a>    <span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.dummy_call-839"><a href="#PumpWoodMicroService.dummy_call-839"><span class="linenos">839</span></a>                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.dummy_call-840"><a href="#PumpWoodMicroService.dummy_call-840"><span class="linenos">840</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dummy call to ensure headers and payload reaching app.</span>
</span><span id="PumpWoodMicroService.dummy_call-841"><a href="#PumpWoodMicroService.dummy_call-841"><span class="linenos">841</span></a>
</span><span id="PumpWoodMicroService.dummy_call-842"><a href="#PumpWoodMicroService.dummy_call-842"><span class="linenos">842</span></a><span class="sd">        The request just bounce on the server and return the headers and</span>
</span><span id="PumpWoodMicroService.dummy_call-843"><a href="#PumpWoodMicroService.dummy_call-843"><span class="linenos">843</span></a><span class="sd">        payload that reached the application. It is usefull for probing</span>
</span><span id="PumpWoodMicroService.dummy_call-844"><a href="#PumpWoodMicroService.dummy_call-844"><span class="linenos">844</span></a><span class="sd">        proxy servers, API gateways and other security and load balance</span>
</span><span id="PumpWoodMicroService.dummy_call-845"><a href="#PumpWoodMicroService.dummy_call-845"><span class="linenos">845</span></a><span class="sd">        tools.</span>
</span><span id="PumpWoodMicroService.dummy_call-846"><a href="#PumpWoodMicroService.dummy_call-846"><span class="linenos">846</span></a>
</span><span id="PumpWoodMicroService.dummy_call-847"><a href="#PumpWoodMicroService.dummy_call-847"><span class="linenos">847</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.dummy_call-848"><a href="#PumpWoodMicroService.dummy_call-848"><span class="linenos">848</span></a><span class="sd">            payload:</span>
</span><span id="PumpWoodMicroService.dummy_call-849"><a href="#PumpWoodMicroService.dummy_call-849"><span class="linenos">849</span></a><span class="sd">                Payload to be returned by the dummy call end-point.</span>
</span><span id="PumpWoodMicroService.dummy_call-850"><a href="#PumpWoodMicroService.dummy_call-850"><span class="linenos">850</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.dummy_call-851"><a href="#PumpWoodMicroService.dummy_call-851"><span class="linenos">851</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.dummy_call-852"><a href="#PumpWoodMicroService.dummy_call-852"><span class="linenos">852</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.dummy_call-853"><a href="#PumpWoodMicroService.dummy_call-853"><span class="linenos">853</span></a>
</span><span id="PumpWoodMicroService.dummy_call-854"><a href="#PumpWoodMicroService.dummy_call-854"><span class="linenos">854</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.dummy_call-855"><a href="#PumpWoodMicroService.dummy_call-855"><span class="linenos">855</span></a><span class="sd">            Return a dictonary with:</span>
</span><span id="PumpWoodMicroService.dummy_call-856"><a href="#PumpWoodMicroService.dummy_call-856"><span class="linenos">856</span></a><span class="sd">            - **full_path**: Full path of the request.</span>
</span><span id="PumpWoodMicroService.dummy_call-857"><a href="#PumpWoodMicroService.dummy_call-857"><span class="linenos">857</span></a><span class="sd">            - **method**: Method used at the call</span>
</span><span id="PumpWoodMicroService.dummy_call-858"><a href="#PumpWoodMicroService.dummy_call-858"><span class="linenos">858</span></a><span class="sd">            - **headers**: Headers at the request.</span>
</span><span id="PumpWoodMicroService.dummy_call-859"><a href="#PumpWoodMicroService.dummy_call-859"><span class="linenos">859</span></a><span class="sd">            - **data**: Post payload sent at the request.</span>
</span><span id="PumpWoodMicroService.dummy_call-860"><a href="#PumpWoodMicroService.dummy_call-860"><span class="linenos">860</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.dummy_call-861"><a href="#PumpWoodMicroService.dummy_call-861"><span class="linenos">861</span></a>        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
</span><span id="PumpWoodMicroService.dummy_call-862"><a href="#PumpWoodMicroService.dummy_call-862"><span class="linenos">862</span></a>        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.dummy_call-863"><a href="#PumpWoodMicroService.dummy_call-863"><span class="linenos">863</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.dummy_call-864"><a href="#PumpWoodMicroService.dummy_call-864"><span class="linenos">864</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.dummy_call-865"><a href="#PumpWoodMicroService.dummy_call-865"><span class="linenos">865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.dummy_call-866"><a href="#PumpWoodMicroService.dummy_call-866"><span class="linenos">866</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.dummy_call-867"><a href="#PumpWoodMicroService.dummy_call-867"><span class="linenos">867</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.dummy_call-868"><a href="#PumpWoodMicroService.dummy_call-868"><span class="linenos">868</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a dummy call to ensure headers and payload reaching app.</p>

<p>The request just bounce on the server and return the headers and
payload that reached the application. It is usefull for probing
proxy servers, API gateways and other security and load balance
tools.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>payload:</strong>  Payload to be returned by the dummy call end-point.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictonary with:</p>
  
  <ul>
  <li><strong>full_path</strong>: Full path of the request.</li>
  <li><strong>method</strong>: Method used at the call</li>
  <li><strong>headers</strong>: Headers at the request.</li>
  <li><strong>data</strong>: Post payload sent at the request.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.dummy_raise" class="classattr">
                                        <input id="PumpWoodMicroService.dummy_raise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dummy_raise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.dummy_raise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.dummy_raise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.dummy_raise-870"><a href="#PumpWoodMicroService.dummy_raise-870"><span class="linenos">870</span></a>    <span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.dummy_raise-871"><a href="#PumpWoodMicroService.dummy_raise-871"><span class="linenos">871</span></a>                    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.dummy_raise-872"><a href="#PumpWoodMicroService.dummy_raise-872"><span class="linenos">872</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an Pumpwood error with the payload.</span>
</span><span id="PumpWoodMicroService.dummy_raise-873"><a href="#PumpWoodMicroService.dummy_raise-873"><span class="linenos">873</span></a>
</span><span id="PumpWoodMicroService.dummy_raise-874"><a href="#PumpWoodMicroService.dummy_raise-874"><span class="linenos">874</span></a><span class="sd">        This and point raises an Arbitrary PumpWoodException error, it can be</span>
</span><span id="PumpWoodMicroService.dummy_raise-875"><a href="#PumpWoodMicroService.dummy_raise-875"><span class="linenos">875</span></a><span class="sd">        used for debuging error treatment.</span>
</span><span id="PumpWoodMicroService.dummy_raise-876"><a href="#PumpWoodMicroService.dummy_raise-876"><span class="linenos">876</span></a>
</span><span id="PumpWoodMicroService.dummy_raise-877"><a href="#PumpWoodMicroService.dummy_raise-877"><span class="linenos">877</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.dummy_raise-878"><a href="#PumpWoodMicroService.dummy_raise-878"><span class="linenos">878</span></a><span class="sd">            exception_class:</span>
</span><span id="PumpWoodMicroService.dummy_raise-879"><a href="#PumpWoodMicroService.dummy_raise-879"><span class="linenos">879</span></a><span class="sd">                Class of the exception to be raised.</span>
</span><span id="PumpWoodMicroService.dummy_raise-880"><a href="#PumpWoodMicroService.dummy_raise-880"><span class="linenos">880</span></a><span class="sd">            exception_deep:</span>
</span><span id="PumpWoodMicroService.dummy_raise-881"><a href="#PumpWoodMicroService.dummy_raise-881"><span class="linenos">881</span></a><span class="sd">                Deep of the exception in microservice calls. This arg will</span>
</span><span id="PumpWoodMicroService.dummy_raise-882"><a href="#PumpWoodMicroService.dummy_raise-882"><span class="linenos">882</span></a><span class="sd">                make error recusive, calling the end-point it self for</span>
</span><span id="PumpWoodMicroService.dummy_raise-883"><a href="#PumpWoodMicroService.dummy_raise-883"><span class="linenos">883</span></a><span class="sd">                `exception_deep` time before raising the error.</span>
</span><span id="PumpWoodMicroService.dummy_raise-884"><a href="#PumpWoodMicroService.dummy_raise-884"><span class="linenos">884</span></a><span class="sd">            payload:</span>
</span><span id="PumpWoodMicroService.dummy_raise-885"><a href="#PumpWoodMicroService.dummy_raise-885"><span class="linenos">885</span></a><span class="sd">                Payload that will be returned with error.</span>
</span><span id="PumpWoodMicroService.dummy_raise-886"><a href="#PumpWoodMicroService.dummy_raise-886"><span class="linenos">886</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.dummy_raise-887"><a href="#PumpWoodMicroService.dummy_raise-887"><span class="linenos">887</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.dummy_raise-888"><a href="#PumpWoodMicroService.dummy_raise-888"><span class="linenos">888</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.dummy_raise-889"><a href="#PumpWoodMicroService.dummy_raise-889"><span class="linenos">889</span></a>
</span><span id="PumpWoodMicroService.dummy_raise-890"><a href="#PumpWoodMicroService.dummy_raise-890"><span class="linenos">890</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.dummy_raise-891"><a href="#PumpWoodMicroService.dummy_raise-891"><span class="linenos">891</span></a><span class="sd">            Should not return any results, all possible call should result</span>
</span><span id="PumpWoodMicroService.dummy_raise-892"><a href="#PumpWoodMicroService.dummy_raise-892"><span class="linenos">892</span></a><span class="sd">            in raising the correspondent error.</span>
</span><span id="PumpWoodMicroService.dummy_raise-893"><a href="#PumpWoodMicroService.dummy_raise-893"><span class="linenos">893</span></a>
</span><span id="PumpWoodMicroService.dummy_raise-894"><a href="#PumpWoodMicroService.dummy_raise-894"><span class="linenos">894</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.dummy_raise-895"><a href="#PumpWoodMicroService.dummy_raise-895"><span class="linenos">895</span></a><span class="sd">            Should raise the correspondent error passed on exception_class</span>
</span><span id="PumpWoodMicroService.dummy_raise-896"><a href="#PumpWoodMicroService.dummy_raise-896"><span class="linenos">896</span></a><span class="sd">            arg, with payload.</span>
</span><span id="PumpWoodMicroService.dummy_raise-897"><a href="#PumpWoodMicroService.dummy_raise-897"><span class="linenos">897</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.dummy_raise-898"><a href="#PumpWoodMicroService.dummy_raise-898"><span class="linenos">898</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
</span><span id="PumpWoodMicroService.dummy_raise-899"><a href="#PumpWoodMicroService.dummy_raise-899"><span class="linenos">899</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
</span><span id="PumpWoodMicroService.dummy_raise-900"><a href="#PumpWoodMicroService.dummy_raise-900"><span class="linenos">900</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
</span><span id="PumpWoodMicroService.dummy_raise-901"><a href="#PumpWoodMicroService.dummy_raise-901"><span class="linenos">901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Raise an Pumpwood error with the payload.</p>

<p>This and point raises an Arbitrary PumpWoodException error, it can be
used for debuging error treatment.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>exception_class:</strong>  Class of the exception to be raised.</li>
<li><strong>exception_deep:</strong>  Deep of the exception in microservice calls. This arg will
make error recusive, calling the end-point it self for
<code>exception_deep</code> time before raising the error.</li>
<li><strong>payload:</strong>  Payload that will be returned with error.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Should not return any results, all possible call should result
  in raising the correspondent error.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>Should raise the correspondent error passed on exception_class</li>
<li>arg, with payload.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.get_pks_from_unique_field" class="classattr">
                                        <input id="PumpWoodMicroService.get_pks_from_unique_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pks_from_unique_field</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.get_pks_from_unique_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.get_pks_from_unique_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.get_pks_from_unique_field-903"><a href="#PumpWoodMicroService.get_pks_from_unique_field-903"><span class="linenos">903</span></a>    <span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-904"><a href="#PumpWoodMicroService.get_pks_from_unique_field-904"><span class="linenos">904</span></a>                                  <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-905"><a href="#PumpWoodMicroService.get_pks_from_unique_field-905"><span class="linenos">905</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pk using unique fields values.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-906"><a href="#PumpWoodMicroService.get_pks_from_unique_field-906"><span class="linenos">906</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-907"><a href="#PumpWoodMicroService.get_pks_from_unique_field-907"><span class="linenos">907</span></a><span class="sd">        Use unique field values to retrieve pk of the objects. This end-point</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-908"><a href="#PumpWoodMicroService.get_pks_from_unique_field-908"><span class="linenos">908</span></a><span class="sd">        is usefull for retrieving pks of the objects associated with unique</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-909"><a href="#PumpWoodMicroService.get_pks_from_unique_field-909"><span class="linenos">909</span></a><span class="sd">        fields such as `description` (unique on most model of pumpwood).</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-910"><a href="#PumpWoodMicroService.get_pks_from_unique_field-910"><span class="linenos">910</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-911"><a href="#PumpWoodMicroService.get_pks_from_unique_field-911"><span class="linenos">911</span></a><span class="sd">        ```python</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-912"><a href="#PumpWoodMicroService.get_pks_from_unique_field-912"><span class="linenos">912</span></a><span class="sd">        # Using description to fetch pks from objects</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-913"><a href="#PumpWoodMicroService.get_pks_from_unique_field-913"><span class="linenos">913</span></a><span class="sd">        data: pd.DataFrame = [data with unique description but without pk]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-914"><a href="#PumpWoodMicroService.get_pks_from_unique_field-914"><span class="linenos">914</span></a><span class="sd">        data[&#39;attribute_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-915"><a href="#PumpWoodMicroService.get_pks_from_unique_field-915"><span class="linenos">915</span></a><span class="sd">            model_class=&quot;DescriptionAttribute&quot;,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-916"><a href="#PumpWoodMicroService.get_pks_from_unique_field-916"><span class="linenos">916</span></a><span class="sd">            field=&quot;description&quot;, values=data[&#39;attribute&#39;])[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-917"><a href="#PumpWoodMicroService.get_pks_from_unique_field-917"><span class="linenos">917</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-918"><a href="#PumpWoodMicroService.get_pks_from_unique_field-918"><span class="linenos">918</span></a><span class="sd">        # Using a dimension key to fetch pk of the objects, dimension</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-919"><a href="#PumpWoodMicroService.get_pks_from_unique_field-919"><span class="linenos">919</span></a><span class="sd">        # key must be unique</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-920"><a href="#PumpWoodMicroService.get_pks_from_unique_field-920"><span class="linenos">920</span></a><span class="sd">        data[&#39;georea_id&#39;] = microservice.get_pks_from_unique_field(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-921"><a href="#PumpWoodMicroService.get_pks_from_unique_field-921"><span class="linenos">921</span></a><span class="sd">            model_class=&quot;DescriptionGeoarea&quot;, field=&quot;dimension-&gt;city&quot;,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-922"><a href="#PumpWoodMicroService.get_pks_from_unique_field-922"><span class="linenos">922</span></a><span class="sd">            values=data[&#39;city&#39;])[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-923"><a href="#PumpWoodMicroService.get_pks_from_unique_field-923"><span class="linenos">923</span></a><span class="sd">        ```</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-924"><a href="#PumpWoodMicroService.get_pks_from_unique_field-924"><span class="linenos">924</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-925"><a href="#PumpWoodMicroService.get_pks_from_unique_field-925"><span class="linenos">925</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-926"><a href="#PumpWoodMicroService.get_pks_from_unique_field-926"><span class="linenos">926</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-927"><a href="#PumpWoodMicroService.get_pks_from_unique_field-927"><span class="linenos">927</span></a><span class="sd">                Model class of the objects.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-928"><a href="#PumpWoodMicroService.get_pks_from_unique_field-928"><span class="linenos">928</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-929"><a href="#PumpWoodMicroService.get_pks_from_unique_field-929"><span class="linenos">929</span></a><span class="sd">                Unique field to fetch pk. It is possible to use dimension keys</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-930"><a href="#PumpWoodMicroService.get_pks_from_unique_field-930"><span class="linenos">930</span></a><span class="sd">                as unique field, for that use `dimension-&gt;[key]` notation.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-931"><a href="#PumpWoodMicroService.get_pks_from_unique_field-931"><span class="linenos">931</span></a><span class="sd">            values:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-932"><a href="#PumpWoodMicroService.get_pks_from_unique_field-932"><span class="linenos">932</span></a><span class="sd">                List of the unique fields used to fetch primary keys.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-933"><a href="#PumpWoodMicroService.get_pks_from_unique_field-933"><span class="linenos">933</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-934"><a href="#PumpWoodMicroService.get_pks_from_unique_field-934"><span class="linenos">934</span></a><span class="sd">        Return:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-935"><a href="#PumpWoodMicroService.get_pks_from_unique_field-935"><span class="linenos">935</span></a><span class="sd">            Return a dataframe in same order as values with columns:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-936"><a href="#PumpWoodMicroService.get_pks_from_unique_field-936"><span class="linenos">936</span></a><span class="sd">            - **pk**: Correspondent primary key of the unique value.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-937"><a href="#PumpWoodMicroService.get_pks_from_unique_field-937"><span class="linenos">937</span></a><span class="sd">            - **[field]**: Column with same name of field argument,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-938"><a href="#PumpWoodMicroService.get_pks_from_unique_field-938"><span class="linenos">938</span></a><span class="sd">                correspondent to pk.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-939"><a href="#PumpWoodMicroService.get_pks_from_unique_field-939"><span class="linenos">939</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-940"><a href="#PumpWoodMicroService.get_pks_from_unique_field-940"><span class="linenos">940</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-941"><a href="#PumpWoodMicroService.get_pks_from_unique_field-941"><span class="linenos">941</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-942"><a href="#PumpWoodMicroService.get_pks_from_unique_field-942"><span class="linenos">942</span></a><span class="sd">                Raises if field is not found on the model and it is note</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-943"><a href="#PumpWoodMicroService.get_pks_from_unique_field-943"><span class="linenos">943</span></a><span class="sd">                associated with a dimension tag.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-944"><a href="#PumpWoodMicroService.get_pks_from_unique_field-944"><span class="linenos">944</span></a><span class="sd">            PumpWoodQueryException:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-945"><a href="#PumpWoodMicroService.get_pks_from_unique_field-945"><span class="linenos">945</span></a><span class="sd">                Raises if `field` does not have a unique restriction on</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-946"><a href="#PumpWoodMicroService.get_pks_from_unique_field-946"><span class="linenos">946</span></a><span class="sd">                database. Dimension keys does not check for uniqueness on</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-947"><a href="#PumpWoodMicroService.get_pks_from_unique_field-947"><span class="linenos">947</span></a><span class="sd">                database, be carefull not to duplicate the lines.</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-948"><a href="#PumpWoodMicroService.get_pks_from_unique_field-948"><span class="linenos">948</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-949"><a href="#PumpWoodMicroService.get_pks_from_unique_field-949"><span class="linenos">949</span></a>        <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-950"><a href="#PumpWoodMicroService.get_pks_from_unique_field-950"><span class="linenos">950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-951"><a href="#PumpWoodMicroService.get_pks_from_unique_field-951"><span class="linenos">951</span></a>            <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-952"><a href="#PumpWoodMicroService.get_pks_from_unique_field-952"><span class="linenos">952</span></a>            <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-953"><a href="#PumpWoodMicroService.get_pks_from_unique_field-953"><span class="linenos">953</span></a>            <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-954"><a href="#PumpWoodMicroService.get_pks_from_unique_field-954"><span class="linenos">954</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-955"><a href="#PumpWoodMicroService.get_pks_from_unique_field-955"><span class="linenos">955</span></a>                    <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-956"><a href="#PumpWoodMicroService.get_pks_from_unique_field-956"><span class="linenos">956</span></a>                    <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-957"><a href="#PumpWoodMicroService.get_pks_from_unique_field-957"><span class="linenos">957</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-958"><a href="#PumpWoodMicroService.get_pks_from_unique_field-958"><span class="linenos">958</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-959"><a href="#PumpWoodMicroService.get_pks_from_unique_field-959"><span class="linenos">959</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-960"><a href="#PumpWoodMicroService.get_pks_from_unique_field-960"><span class="linenos">960</span></a>            <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-961"><a href="#PumpWoodMicroService.get_pks_from_unique_field-961"><span class="linenos">961</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-962"><a href="#PumpWoodMicroService.get_pks_from_unique_field-962"><span class="linenos">962</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-963"><a href="#PumpWoodMicroService.get_pks_from_unique_field-963"><span class="linenos">963</span></a>                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-964"><a href="#PumpWoodMicroService.get_pks_from_unique_field-964"><span class="linenos">964</span></a>                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-965"><a href="#PumpWoodMicroService.get_pks_from_unique_field-965"><span class="linenos">965</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-966"><a href="#PumpWoodMicroService.get_pks_from_unique_field-966"><span class="linenos">966</span></a>        <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-967"><a href="#PumpWoodMicroService.get_pks_from_unique_field-967"><span class="linenos">967</span></a>        <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-968"><a href="#PumpWoodMicroService.get_pks_from_unique_field-968"><span class="linenos">968</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-969"><a href="#PumpWoodMicroService.get_pks_from_unique_field-969"><span class="linenos">969</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-970"><a href="#PumpWoodMicroService.get_pks_from_unique_field-970"><span class="linenos">970</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-971"><a href="#PumpWoodMicroService.get_pks_from_unique_field-971"><span class="linenos">971</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-972"><a href="#PumpWoodMicroService.get_pks_from_unique_field-972"><span class="linenos">972</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-973"><a href="#PumpWoodMicroService.get_pks_from_unique_field-973"><span class="linenos">973</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-974"><a href="#PumpWoodMicroService.get_pks_from_unique_field-974"><span class="linenos">974</span></a>        <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-975"><a href="#PumpWoodMicroService.get_pks_from_unique_field-975"><span class="linenos">975</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-976"><a href="#PumpWoodMicroService.get_pks_from_unique_field-976"><span class="linenos">976</span></a>            <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-977"><a href="#PumpWoodMicroService.get_pks_from_unique_field-977"><span class="linenos">977</span></a>            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-978"><a href="#PumpWoodMicroService.get_pks_from_unique_field-978"><span class="linenos">978</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-979"><a href="#PumpWoodMicroService.get_pks_from_unique_field-979"><span class="linenos">979</span></a>                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-980"><a href="#PumpWoodMicroService.get_pks_from_unique_field-980"><span class="linenos">980</span></a>            <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-981"><a href="#PumpWoodMicroService.get_pks_from_unique_field-981"><span class="linenos">981</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-982"><a href="#PumpWoodMicroService.get_pks_from_unique_field-982"><span class="linenos">982</span></a>                <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-983"><a href="#PumpWoodMicroService.get_pks_from_unique_field-983"><span class="linenos">983</span></a>                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-984"><a href="#PumpWoodMicroService.get_pks_from_unique_field-984"><span class="linenos">984</span></a>                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-985"><a href="#PumpWoodMicroService.get_pks_from_unique_field-985"><span class="linenos">985</span></a>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-986"><a href="#PumpWoodMicroService.get_pks_from_unique_field-986"><span class="linenos">986</span></a>        <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-987"><a href="#PumpWoodMicroService.get_pks_from_unique_field-987"><span class="linenos">987</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-988"><a href="#PumpWoodMicroService.get_pks_from_unique_field-988"><span class="linenos">988</span></a>            <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-989"><a href="#PumpWoodMicroService.get_pks_from_unique_field-989"><span class="linenos">989</span></a>            <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
</span><span id="PumpWoodMicroService.get_pks_from_unique_field-990"><a href="#PumpWoodMicroService.get_pks_from_unique_field-990"><span class="linenos">990</span></a>        <span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>Get pk using unique fields values.</p>

<p>Use unique field values to retrieve pk of the objects. This end-point
is usefull for retrieving pks of the objects associated with unique
fields such as <code>description</code> (unique on most model of pumpwood).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Using description to fetch pks from objects</span>
<span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span> <span class="k">with</span> <span class="n">unique</span> <span class="n">description</span> <span class="n">but</span> <span class="n">without</span> <span class="n">pk</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;attribute_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">microservice</span><span class="o">.</span><span class="n">get_pks_from_unique_field</span><span class="p">(</span>
    <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;DescriptionAttribute&quot;</span><span class="p">,</span>
    <span class="n">field</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;attribute&#39;</span><span class="p">])[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span>

<span class="c1"># Using a dimension key to fetch pk of the objects, dimension</span>
<span class="c1"># key must be unique</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;georea_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">microservice</span><span class="o">.</span><span class="n">get_pks_from_unique_field</span><span class="p">(</span>
    <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;DescriptionGeoarea&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;dimension-&gt;city&quot;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">])[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the objects.</li>
<li><strong>field:</strong>  Unique field to fetch pk. It is possible to use dimension keys
as unique field, for that use <code>dimension-&gt;[key]</code> notation.</li>
<li><strong>values:</strong>  List of the unique fields used to fetch primary keys.</li>
</ul>

<h6 id="return">Return:</h6>

<blockquote>
  <p>Return a dataframe in same order as values with columns:</p>
  
  <ul>
  <li><strong>pk</strong>: Correspondent primary key of the unique value.</li>
  <li><strong>[field]</strong>: Column with same name of field argument,
  correspondent to pk.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodQueryException:</strong>  Raises if field is not found on the model and it is note
associated with a dimension tag.</li>
<li><strong>PumpWoodQueryException:</strong>  Raises if <code>field</code> does not have a unique restriction on
database. Dimension keys does not check for uniqueness on
database, be carefull not to duplicate the lines.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list" class="classattr">
                                        <input id="PumpWoodMicroService.list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list-996"><a href="#PumpWoodMicroService.list-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.list-997"><a href="#PumpWoodMicroService.list-997"><span class="linenos"> 997</span></a>             <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService.list-998"><a href="#PumpWoodMicroService.list-998"><span class="linenos"> 998</span></a>             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list-999"><a href="#PumpWoodMicroService.list-999"><span class="linenos"> 999</span></a>             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list-1000"><a href="#PumpWoodMicroService.list-1000"><span class="linenos">1000</span></a>             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list-1001"><a href="#PumpWoodMicroService.list-1001"><span class="linenos">1001</span></a>             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.list-1002"><a href="#PumpWoodMicroService.list-1002"><span class="linenos">1002</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List objects with pagination.</span>
</span><span id="PumpWoodMicroService.list-1003"><a href="#PumpWoodMicroService.list-1003"><span class="linenos">1003</span></a>
</span><span id="PumpWoodMicroService.list-1004"><a href="#PumpWoodMicroService.list-1004"><span class="linenos">1004</span></a><span class="sd">        List end-point (resumed data) of PumpWood like systems,</span>
</span><span id="PumpWoodMicroService.list-1005"><a href="#PumpWoodMicroService.list-1005"><span class="linenos">1005</span></a><span class="sd">        results will be paginated. To get next pag, send all recived pk at</span>
</span><span id="PumpWoodMicroService.list-1006"><a href="#PumpWoodMicroService.list-1006"><span class="linenos">1006</span></a><span class="sd">        exclude dict (ex.: `exclude_dict={pk__in: [1,2,...,30]}`).</span>
</span><span id="PumpWoodMicroService.list-1007"><a href="#PumpWoodMicroService.list-1007"><span class="linenos">1007</span></a>
</span><span id="PumpWoodMicroService.list-1008"><a href="#PumpWoodMicroService.list-1008"><span class="linenos">1008</span></a><span class="sd">        It is possible to return foreign keys objects associated with</span>
</span><span id="PumpWoodMicroService.list-1009"><a href="#PumpWoodMicroService.list-1009"><span class="linenos">1009</span></a><span class="sd">        `model_class`. Use this with carefull since increase the backend</span>
</span><span id="PumpWoodMicroService.list-1010"><a href="#PumpWoodMicroService.list-1010"><span class="linenos">1010</span></a><span class="sd">        infrastructure consumption, each object is a retrieve call per</span>
</span><span id="PumpWoodMicroService.list-1011"><a href="#PumpWoodMicroService.list-1011"><span class="linenos">1011</span></a><span class="sd">        foreign key (otimization in progress).</span>
</span><span id="PumpWoodMicroService.list-1012"><a href="#PumpWoodMicroService.list-1012"><span class="linenos">1012</span></a>
</span><span id="PumpWoodMicroService.list-1013"><a href="#PumpWoodMicroService.list-1013"><span class="linenos">1013</span></a><span class="sd">        It is possible to use diferent operators using `__` after the name</span>
</span><span id="PumpWoodMicroService.list-1014"><a href="#PumpWoodMicroService.list-1014"><span class="linenos">1014</span></a><span class="sd">        of the field, some of the operators avaiable:</span>
</span><span id="PumpWoodMicroService.list-1015"><a href="#PumpWoodMicroService.list-1015"><span class="linenos">1015</span></a>
</span><span id="PumpWoodMicroService.list-1016"><a href="#PumpWoodMicroService.list-1016"><span class="linenos">1016</span></a><span class="sd">        ### General operators</span>
</span><span id="PumpWoodMicroService.list-1017"><a href="#PumpWoodMicroService.list-1017"><span class="linenos">1017</span></a><span class="sd">        - **__eq:** Check if the value is the same, same results if no</span>
</span><span id="PumpWoodMicroService.list-1018"><a href="#PumpWoodMicroService.list-1018"><span class="linenos">1018</span></a><span class="sd">            operator is passed.</span>
</span><span id="PumpWoodMicroService.list-1019"><a href="#PumpWoodMicroService.list-1019"><span class="linenos">1019</span></a><span class="sd">        - **__gt:** Check if value is greter then argument.</span>
</span><span id="PumpWoodMicroService.list-1020"><a href="#PumpWoodMicroService.list-1020"><span class="linenos">1020</span></a><span class="sd">        - **__lt:** Check if value is less then argument.</span>
</span><span id="PumpWoodMicroService.list-1021"><a href="#PumpWoodMicroService.list-1021"><span class="linenos">1021</span></a><span class="sd">        - **__gte:** Check if value is greter or equal then argument.</span>
</span><span id="PumpWoodMicroService.list-1022"><a href="#PumpWoodMicroService.list-1022"><span class="linenos">1022</span></a><span class="sd">        - **__lte:** Check if value is less or equal then argument.</span>
</span><span id="PumpWoodMicroService.list-1023"><a href="#PumpWoodMicroService.list-1023"><span class="linenos">1023</span></a><span class="sd">        - **__in:** Check if value is at a list, the argument of this operator</span>
</span><span id="PumpWoodMicroService.list-1024"><a href="#PumpWoodMicroService.list-1024"><span class="linenos">1024</span></a><span class="sd">            must be a list.</span>
</span><span id="PumpWoodMicroService.list-1025"><a href="#PumpWoodMicroService.list-1025"><span class="linenos">1025</span></a>
</span><span id="PumpWoodMicroService.list-1026"><a href="#PumpWoodMicroService.list-1026"><span class="linenos">1026</span></a><span class="sd">        ### Text field operators</span>
</span><span id="PumpWoodMicroService.list-1027"><a href="#PumpWoodMicroService.list-1027"><span class="linenos">1027</span></a><span class="sd">        - **__contains:** Check if value contains a string. It is case and</span>
</span><span id="PumpWoodMicroService.list-1028"><a href="#PumpWoodMicroService.list-1028"><span class="linenos">1028</span></a><span class="sd">            accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1029"><a href="#PumpWoodMicroService.list-1029"><span class="linenos">1029</span></a><span class="sd">        - **__icontains:** Check if a values contains a string, It is case</span>
</span><span id="PumpWoodMicroService.list-1030"><a href="#PumpWoodMicroService.list-1030"><span class="linenos">1030</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1031"><a href="#PumpWoodMicroService.list-1031"><span class="linenos">1031</span></a><span class="sd">        - **__unaccent_icontains:** Check if a values contains a string, It is</span>
</span><span id="PumpWoodMicroService.list-1032"><a href="#PumpWoodMicroService.list-1032"><span class="linenos">1032</span></a><span class="sd">            case insensitive and accent insensitive (consider a, à, á, ã, ...</span>
</span><span id="PumpWoodMicroService.list-1033"><a href="#PumpWoodMicroService.list-1033"><span class="linenos">1033</span></a><span class="sd">            the same).</span>
</span><span id="PumpWoodMicroService.list-1034"><a href="#PumpWoodMicroService.list-1034"><span class="linenos">1034</span></a><span class="sd">        - **__exact:** Same as __eq or not setting operator.</span>
</span><span id="PumpWoodMicroService.list-1035"><a href="#PumpWoodMicroService.list-1035"><span class="linenos">1035</span></a><span class="sd">        - **__iexact:** Same as __eq, but case insensitive and</span>
</span><span id="PumpWoodMicroService.list-1036"><a href="#PumpWoodMicroService.list-1036"><span class="linenos">1036</span></a><span class="sd">            accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1037"><a href="#PumpWoodMicroService.list-1037"><span class="linenos">1037</span></a><span class="sd">        - **__unaccent_iexact:** Same as __eq, but case insensitive and</span>
</span><span id="PumpWoodMicroService.list-1038"><a href="#PumpWoodMicroService.list-1038"><span class="linenos">1038</span></a><span class="sd">            accent insensitive.</span>
</span><span id="PumpWoodMicroService.list-1039"><a href="#PumpWoodMicroService.list-1039"><span class="linenos">1039</span></a><span class="sd">        - **__startswith:** Check if the value stats with a sub-string.</span>
</span><span id="PumpWoodMicroService.list-1040"><a href="#PumpWoodMicroService.list-1040"><span class="linenos">1040</span></a><span class="sd">            Case sensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1041"><a href="#PumpWoodMicroService.list-1041"><span class="linenos">1041</span></a><span class="sd">        - **__istartswith:** Check if the value stats with a sub-string.</span>
</span><span id="PumpWoodMicroService.list-1042"><a href="#PumpWoodMicroService.list-1042"><span class="linenos">1042</span></a><span class="sd">            Case insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1043"><a href="#PumpWoodMicroService.list-1043"><span class="linenos">1043</span></a><span class="sd">        - **__unaccent_istartswith:** Check if the value stats with a</span>
</span><span id="PumpWoodMicroService.list-1044"><a href="#PumpWoodMicroService.list-1044"><span class="linenos">1044</span></a><span class="sd">            sub-string. Case insensitive and accent insensitive.</span>
</span><span id="PumpWoodMicroService.list-1045"><a href="#PumpWoodMicroService.list-1045"><span class="linenos">1045</span></a><span class="sd">        - **__endswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="PumpWoodMicroService.list-1046"><a href="#PumpWoodMicroService.list-1046"><span class="linenos">1046</span></a><span class="sd">            sensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1047"><a href="#PumpWoodMicroService.list-1047"><span class="linenos">1047</span></a><span class="sd">        - **__iendswith:** Check if the value ends with a sub-string. Case</span>
</span><span id="PumpWoodMicroService.list-1048"><a href="#PumpWoodMicroService.list-1048"><span class="linenos">1048</span></a><span class="sd">            insensitive and accent sensitive.</span>
</span><span id="PumpWoodMicroService.list-1049"><a href="#PumpWoodMicroService.list-1049"><span class="linenos">1049</span></a><span class="sd">        - **__unaccent_iendswith:** Check if the value ends with a sub-string.</span>
</span><span id="PumpWoodMicroService.list-1050"><a href="#PumpWoodMicroService.list-1050"><span class="linenos">1050</span></a><span class="sd">            Case insensitive and accent insensitive.</span>
</span><span id="PumpWoodMicroService.list-1051"><a href="#PumpWoodMicroService.list-1051"><span class="linenos">1051</span></a>
</span><span id="PumpWoodMicroService.list-1052"><a href="#PumpWoodMicroService.list-1052"><span class="linenos">1052</span></a><span class="sd">        ### Null operators</span>
</span><span id="PumpWoodMicroService.list-1053"><a href="#PumpWoodMicroService.list-1053"><span class="linenos">1053</span></a><span class="sd">        - **__isnull:** Check if field is null, it uses as argument a `boolean`</span>
</span><span id="PumpWoodMicroService.list-1054"><a href="#PumpWoodMicroService.list-1054"><span class="linenos">1054</span></a><span class="sd">            value false will return all non NULL values and true will return</span>
</span><span id="PumpWoodMicroService.list-1055"><a href="#PumpWoodMicroService.list-1055"><span class="linenos">1055</span></a><span class="sd">            NULL values.</span>
</span><span id="PumpWoodMicroService.list-1056"><a href="#PumpWoodMicroService.list-1056"><span class="linenos">1056</span></a>
</span><span id="PumpWoodMicroService.list-1057"><a href="#PumpWoodMicroService.list-1057"><span class="linenos">1057</span></a><span class="sd">        ### Date and datetime operators:</span>
</span><span id="PumpWoodMicroService.list-1058"><a href="#PumpWoodMicroService.list-1058"><span class="linenos">1058</span></a><span class="sd">        - **__range:** Receive as argument a list of two elements and return</span>
</span><span id="PumpWoodMicroService.list-1059"><a href="#PumpWoodMicroService.list-1059"><span class="linenos">1059</span></a><span class="sd">            objects that field dates are between those values.</span>
</span><span id="PumpWoodMicroService.list-1060"><a href="#PumpWoodMicroService.list-1060"><span class="linenos">1060</span></a><span class="sd">        - **__year:** Return object that date field value year is equal to</span>
</span><span id="PumpWoodMicroService.list-1061"><a href="#PumpWoodMicroService.list-1061"><span class="linenos">1061</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService.list-1062"><a href="#PumpWoodMicroService.list-1062"><span class="linenos">1062</span></a><span class="sd">        - **__month:** Return object that date field value month is equal to</span>
</span><span id="PumpWoodMicroService.list-1063"><a href="#PumpWoodMicroService.list-1063"><span class="linenos">1063</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService.list-1064"><a href="#PumpWoodMicroService.list-1064"><span class="linenos">1064</span></a><span class="sd">        - **__day:** Return object that date field value day is equal to</span>
</span><span id="PumpWoodMicroService.list-1065"><a href="#PumpWoodMicroService.list-1065"><span class="linenos">1065</span></a><span class="sd">            argument.</span>
</span><span id="PumpWoodMicroService.list-1066"><a href="#PumpWoodMicroService.list-1066"><span class="linenos">1066</span></a>
</span><span id="PumpWoodMicroService.list-1067"><a href="#PumpWoodMicroService.list-1067"><span class="linenos">1067</span></a><span class="sd">        ### Dictionary fields operators:</span>
</span><span id="PumpWoodMicroService.list-1068"><a href="#PumpWoodMicroService.list-1068"><span class="linenos">1068</span></a><span class="sd">        - **__json_contained_by:**</span>
</span><span id="PumpWoodMicroService.list-1069"><a href="#PumpWoodMicroService.list-1069"><span class="linenos">1069</span></a><span class="sd">            Uses the function [contained_by](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by)</span>
</span><span id="PumpWoodMicroService.list-1070"><a href="#PumpWoodMicroService.list-1070"><span class="linenos">1070</span></a><span class="sd">            from SQLAlchemy to test if keys are a proper subset of the keys of</span>
</span><span id="PumpWoodMicroService.list-1071"><a href="#PumpWoodMicroService.list-1071"><span class="linenos">1071</span></a><span class="sd">            the argument jsonb expression (extracted from SQLAlchemy). The</span>
</span><span id="PumpWoodMicroService.list-1072"><a href="#PumpWoodMicroService.list-1072"><span class="linenos">1072</span></a><span class="sd">            argument is a list.</span>
</span><span id="PumpWoodMicroService.list-1073"><a href="#PumpWoodMicroService.list-1073"><span class="linenos">1073</span></a><span class="sd">        - **__json_has_any:**</span>
</span><span id="PumpWoodMicroService.list-1074"><a href="#PumpWoodMicroService.list-1074"><span class="linenos">1074</span></a><span class="sd">            Uses the function [has_any](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any)</span>
</span><span id="PumpWoodMicroService.list-1075"><a href="#PumpWoodMicroService.list-1075"><span class="linenos">1075</span></a><span class="sd">            from SQLAlchemy to test for presence of a key. Note that the key</span>
</span><span id="PumpWoodMicroService.list-1076"><a href="#PumpWoodMicroService.list-1076"><span class="linenos">1076</span></a><span class="sd">            may be a SQLA expression. (extracted from SQLAlchemy). The</span>
</span><span id="PumpWoodMicroService.list-1077"><a href="#PumpWoodMicroService.list-1077"><span class="linenos">1077</span></a><span class="sd">            argument is a list.</span>
</span><span id="PumpWoodMicroService.list-1078"><a href="#PumpWoodMicroService.list-1078"><span class="linenos">1078</span></a><span class="sd">        - **__json_has_key:**</span>
</span><span id="PumpWoodMicroService.list-1079"><a href="#PumpWoodMicroService.list-1079"><span class="linenos">1079</span></a><span class="sd">            Uses the function [has_key](https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key)</span>
</span><span id="PumpWoodMicroService.list-1080"><a href="#PumpWoodMicroService.list-1080"><span class="linenos">1080</span></a><span class="sd">            from SQLAlchemy to Test for presence of a key. Note that the key</span>
</span><span id="PumpWoodMicroService.list-1081"><a href="#PumpWoodMicroService.list-1081"><span class="linenos">1081</span></a><span class="sd">            may be a SQLA expression. The argument is a str.</span>
</span><span id="PumpWoodMicroService.list-1082"><a href="#PumpWoodMicroService.list-1082"><span class="linenos">1082</span></a>
</span><span id="PumpWoodMicroService.list-1083"><a href="#PumpWoodMicroService.list-1083"><span class="linenos">1083</span></a><span class="sd">        ### Text similarity operators</span>
</span><span id="PumpWoodMicroService.list-1084"><a href="#PumpWoodMicroService.list-1084"><span class="linenos">1084</span></a><span class="sd">        To use similariry querys on Postgres it is necessary to `pg_trgm` be</span>
</span><span id="PumpWoodMicroService.list-1085"><a href="#PumpWoodMicroService.list-1085"><span class="linenos">1085</span></a><span class="sd">        instaled on server. Check [oficial documentation]</span>
</span><span id="PumpWoodMicroService.list-1086"><a href="#PumpWoodMicroService.list-1086"><span class="linenos">1086</span></a><span class="sd">        (https://www.postgresql.org/docs/current/pgtrgm.html).</span>
</span><span id="PumpWoodMicroService.list-1087"><a href="#PumpWoodMicroService.list-1087"><span class="linenos">1087</span></a>
</span><span id="PumpWoodMicroService.list-1088"><a href="#PumpWoodMicroService.list-1088"><span class="linenos">1088</span></a><span class="sd">        - **__similarity:** Check if two strings are similar uses the `%`</span>
</span><span id="PumpWoodMicroService.list-1089"><a href="#PumpWoodMicroService.list-1089"><span class="linenos">1089</span></a><span class="sd">            operador.</span>
</span><span id="PumpWoodMicroService.list-1090"><a href="#PumpWoodMicroService.list-1090"><span class="linenos">1090</span></a><span class="sd">        - **__word_similar_left:** Check if two strings are similar uses the</span>
</span><span id="PumpWoodMicroService.list-1091"><a href="#PumpWoodMicroService.list-1091"><span class="linenos">1091</span></a><span class="sd">            `&lt;%` operador.</span>
</span><span id="PumpWoodMicroService.list-1092"><a href="#PumpWoodMicroService.list-1092"><span class="linenos">1092</span></a><span class="sd">        - **__word_similar_right:** Check if two strings are similar uses the</span>
</span><span id="PumpWoodMicroService.list-1093"><a href="#PumpWoodMicroService.list-1093"><span class="linenos">1093</span></a><span class="sd">            `%&gt;` operador.</span>
</span><span id="PumpWoodMicroService.list-1094"><a href="#PumpWoodMicroService.list-1094"><span class="linenos">1094</span></a><span class="sd">        - **__strict_word__similar_left:** Check if two strings are similar</span>
</span><span id="PumpWoodMicroService.list-1095"><a href="#PumpWoodMicroService.list-1095"><span class="linenos">1095</span></a><span class="sd">            uses the `&lt;&lt;%` operador.</span>
</span><span id="PumpWoodMicroService.list-1096"><a href="#PumpWoodMicroService.list-1096"><span class="linenos">1096</span></a><span class="sd">        - **__strict_word__similar_right:** Check if two strings are similar</span>
</span><span id="PumpWoodMicroService.list-1097"><a href="#PumpWoodMicroService.list-1097"><span class="linenos">1097</span></a><span class="sd">            uses the `%&gt;&gt;` operador.</span>
</span><span id="PumpWoodMicroService.list-1098"><a href="#PumpWoodMicroService.list-1098"><span class="linenos">1098</span></a>
</span><span id="PumpWoodMicroService.list-1099"><a href="#PumpWoodMicroService.list-1099"><span class="linenos">1099</span></a><span class="sd">        Some usage examples:</span>
</span><span id="PumpWoodMicroService.list-1100"><a href="#PumpWoodMicroService.list-1100"><span class="linenos">1100</span></a><span class="sd">        ```python</span>
</span><span id="PumpWoodMicroService.list-1101"><a href="#PumpWoodMicroService.list-1101"><span class="linenos">1101</span></a><span class="sd">        # Return the first 3 results ordered decreasing acording to `time` and</span>
</span><span id="PumpWoodMicroService.list-1102"><a href="#PumpWoodMicroService.list-1102"><span class="linenos">1102</span></a><span class="sd">        # them ordered by `modeling_unit_id`. Results must have time greater</span>
</span><span id="PumpWoodMicroService.list-1103"><a href="#PumpWoodMicroService.list-1103"><span class="linenos">1103</span></a><span class="sd">        # or equal to 2017-01-01 and less or equal to 2017-06-01. It also</span>
</span><span id="PumpWoodMicroService.list-1104"><a href="#PumpWoodMicroService.list-1104"><span class="linenos">1104</span></a><span class="sd">        # must have attribute_id equal to 6 and not contains modeling_unit_id</span>
</span><span id="PumpWoodMicroService.list-1105"><a href="#PumpWoodMicroService.list-1105"><span class="linenos">1105</span></a><span class="sd">        # 3 or 4.</span>
</span><span id="PumpWoodMicroService.list-1106"><a href="#PumpWoodMicroService.list-1106"><span class="linenos">1106</span></a><span class="sd">        microservice.list(</span>
</span><span id="PumpWoodMicroService.list-1107"><a href="#PumpWoodMicroService.list-1107"><span class="linenos">1107</span></a><span class="sd">            model_class=&quot;DatabaseVariable&quot;,</span>
</span><span id="PumpWoodMicroService.list-1108"><a href="#PumpWoodMicroService.list-1108"><span class="linenos">1108</span></a><span class="sd">            filter_dict={</span>
</span><span id="PumpWoodMicroService.list-1109"><a href="#PumpWoodMicroService.list-1109"><span class="linenos">1109</span></a><span class="sd">                &quot;time__gte&quot;: &quot;2017-01-01 00:00:00&quot;,</span>
</span><span id="PumpWoodMicroService.list-1110"><a href="#PumpWoodMicroService.list-1110"><span class="linenos">1110</span></a><span class="sd">                &quot;time__lte&quot;: &quot;2017-06-01 00:00:00&quot;,</span>
</span><span id="PumpWoodMicroService.list-1111"><a href="#PumpWoodMicroService.list-1111"><span class="linenos">1111</span></a><span class="sd">                &quot;attribute_id&quot;: 6},</span>
</span><span id="PumpWoodMicroService.list-1112"><a href="#PumpWoodMicroService.list-1112"><span class="linenos">1112</span></a><span class="sd">            exclude_dict={</span>
</span><span id="PumpWoodMicroService.list-1113"><a href="#PumpWoodMicroService.list-1113"><span class="linenos">1113</span></a><span class="sd">                &quot;modeling_unit_id__in&quot;: [3, 4]},</span>
</span><span id="PumpWoodMicroService.list-1114"><a href="#PumpWoodMicroService.list-1114"><span class="linenos">1114</span></a><span class="sd">            order_by=[&quot;-time&quot;, &quot;modeling_unit_id&quot;],</span>
</span><span id="PumpWoodMicroService.list-1115"><a href="#PumpWoodMicroService.list-1115"><span class="linenos">1115</span></a><span class="sd">            limit=3,</span>
</span><span id="PumpWoodMicroService.list-1116"><a href="#PumpWoodMicroService.list-1116"><span class="linenos">1116</span></a><span class="sd">            fields=[&quot;pk&quot;, &quot;model_class&quot;, &quot;time&quot;, &quot;modeling_unit_id&quot;, &quot;value&quot;])</span>
</span><span id="PumpWoodMicroService.list-1117"><a href="#PumpWoodMicroService.list-1117"><span class="linenos">1117</span></a>
</span><span id="PumpWoodMicroService.list-1118"><a href="#PumpWoodMicroService.list-1118"><span class="linenos">1118</span></a><span class="sd">        # Return all elements that dimensions field has a key type with</span>
</span><span id="PumpWoodMicroService.list-1119"><a href="#PumpWoodMicroService.list-1119"><span class="linenos">1119</span></a><span class="sd">        # value contains `selling` insensitive to case and accent.</span>
</span><span id="PumpWoodMicroService.list-1120"><a href="#PumpWoodMicroService.list-1120"><span class="linenos">1120</span></a><span class="sd">        microservice.list(</span>
</span><span id="PumpWoodMicroService.list-1121"><a href="#PumpWoodMicroService.list-1121"><span class="linenos">1121</span></a><span class="sd">            model_class=&quot;DatabaseAttribute&quot;,</span>
</span><span id="PumpWoodMicroService.list-1122"><a href="#PumpWoodMicroService.list-1122"><span class="linenos">1122</span></a><span class="sd">            filter_dict={</span>
</span><span id="PumpWoodMicroService.list-1123"><a href="#PumpWoodMicroService.list-1123"><span class="linenos">1123</span></a><span class="sd">                &quot;dimensions-&gt;type__unaccent_icontains&quot;: &quot;selling&quot;})</span>
</span><span id="PumpWoodMicroService.list-1124"><a href="#PumpWoodMicroService.list-1124"><span class="linenos">1124</span></a><span class="sd">        ```</span>
</span><span id="PumpWoodMicroService.list-1125"><a href="#PumpWoodMicroService.list-1125"><span class="linenos">1125</span></a>
</span><span id="PumpWoodMicroService.list-1126"><a href="#PumpWoodMicroService.list-1126"><span class="linenos">1126</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list-1127"><a href="#PumpWoodMicroService.list-1127"><span class="linenos">1127</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list-1128"><a href="#PumpWoodMicroService.list-1128"><span class="linenos">1128</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list-1129"><a href="#PumpWoodMicroService.list-1129"><span class="linenos">1129</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService.list-1130"><a href="#PumpWoodMicroService.list-1130"><span class="linenos">1130</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService.list-1131"><a href="#PumpWoodMicroService.list-1131"><span class="linenos">1131</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list-1132"><a href="#PumpWoodMicroService.list-1132"><span class="linenos">1132</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService.list-1133"><a href="#PumpWoodMicroService.list-1133"><span class="linenos">1133</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService.list-1134"><a href="#PumpWoodMicroService.list-1134"><span class="linenos">1134</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list-1135"><a href="#PumpWoodMicroService.list-1135"><span class="linenos">1135</span></a><span class="sd">            order_by: Order results acording to list of strings</span>
</span><span id="PumpWoodMicroService.list-1136"><a href="#PumpWoodMicroService.list-1136"><span class="linenos">1136</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="PumpWoodMicroService.list-1137"><a href="#PumpWoodMicroService.list-1137"><span class="linenos">1137</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="PumpWoodMicroService.list-1138"><a href="#PumpWoodMicroService.list-1138"><span class="linenos">1138</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="PumpWoodMicroService.list-1139"><a href="#PumpWoodMicroService.list-1139"><span class="linenos">1139</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="PumpWoodMicroService.list-1140"><a href="#PumpWoodMicroService.list-1140"><span class="linenos">1140</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list-1141"><a href="#PumpWoodMicroService.list-1141"><span class="linenos">1141</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list-1142"><a href="#PumpWoodMicroService.list-1142"><span class="linenos">1142</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list-1143"><a href="#PumpWoodMicroService.list-1143"><span class="linenos">1143</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService.list-1144"><a href="#PumpWoodMicroService.list-1144"><span class="linenos">1144</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.list-1145"><a href="#PumpWoodMicroService.list-1145"><span class="linenos">1145</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService.list-1146"><a href="#PumpWoodMicroService.list-1146"><span class="linenos">1146</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.list-1147"><a href="#PumpWoodMicroService.list-1147"><span class="linenos">1147</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.list-1148"><a href="#PumpWoodMicroService.list-1148"><span class="linenos">1148</span></a><span class="sd">            limit:</span>
</span><span id="PumpWoodMicroService.list-1149"><a href="#PumpWoodMicroService.list-1149"><span class="linenos">1149</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService.list-1150"><a href="#PumpWoodMicroService.list-1150"><span class="linenos">1150</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService.list-1151"><a href="#PumpWoodMicroService.list-1151"><span class="linenos">1151</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService.list-1152"><a href="#PumpWoodMicroService.list-1152"><span class="linenos">1152</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.list-1153"><a href="#PumpWoodMicroService.list-1153"><span class="linenos">1153</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.list-1154"><a href="#PumpWoodMicroService.list-1154"><span class="linenos">1154</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.list-1155"><a href="#PumpWoodMicroService.list-1155"><span class="linenos">1155</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.list-1156"><a href="#PumpWoodMicroService.list-1156"><span class="linenos">1156</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService.list-1157"><a href="#PumpWoodMicroService.list-1157"><span class="linenos">1157</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="PumpWoodMicroService.list-1158"><a href="#PumpWoodMicroService.list-1158"><span class="linenos">1158</span></a>
</span><span id="PumpWoodMicroService.list-1159"><a href="#PumpWoodMicroService.list-1159"><span class="linenos">1159</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list-1160"><a href="#PumpWoodMicroService.list-1160"><span class="linenos">1160</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService.list-1161"><a href="#PumpWoodMicroService.list-1161"><span class="linenos">1161</span></a>
</span><span id="PumpWoodMicroService.list-1162"><a href="#PumpWoodMicroService.list-1162"><span class="linenos">1162</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list-1163"><a href="#PumpWoodMicroService.list-1163"><span class="linenos">1163</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService.list-1164"><a href="#PumpWoodMicroService.list-1164"><span class="linenos">1164</span></a><span class="sd">        &quot;&quot;&quot;</span> <span class="c1"># NOQA</span>
</span><span id="PumpWoodMicroService.list-1165"><a href="#PumpWoodMicroService.list-1165"><span class="linenos">1165</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list-1166"><a href="#PumpWoodMicroService.list-1166"><span class="linenos">1166</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.list-1167"><a href="#PumpWoodMicroService.list-1167"><span class="linenos">1167</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list-1168"><a href="#PumpWoodMicroService.list-1168"><span class="linenos">1168</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list-1169"><a href="#PumpWoodMicroService.list-1169"><span class="linenos">1169</span></a>            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.list-1170"><a href="#PumpWoodMicroService.list-1170"><span class="linenos">1170</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list-1171"><a href="#PumpWoodMicroService.list-1171"><span class="linenos">1171</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService.list-1172"><a href="#PumpWoodMicroService.list-1172"><span class="linenos">1172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list-1173"><a href="#PumpWoodMicroService.list-1173"><span class="linenos">1173</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List objects with pagination.</p>

<p>List end-point (resumed data) of PumpWood like systems,
results will be paginated. To get next pag, send all recived pk at
exclude dict (ex.: <code>exclude_dict={pk__in: [1,2,...,30]}</code>).</p>

<p>It is possible to return foreign keys objects associated with
<code>model_class</code>. Use this with carefull since increase the backend
infrastructure consumption, each object is a retrieve call per
foreign key (otimization in progress).</p>

<p>It is possible to use diferent operators using <code>__</code> after the name
of the field, some of the operators avaiable:</p>

<h3 id="general-operators">General operators</h3>

<ul>
<li><strong>__eq:</strong> Check if the value is the same, same results if no
operator is passed.</li>
<li><strong>__gt:</strong> Check if value is greter then argument.</li>
<li><strong>__lt:</strong> Check if value is less then argument.</li>
<li><strong>__gte:</strong> Check if value is greter or equal then argument.</li>
<li><strong>__lte:</strong> Check if value is less or equal then argument.</li>
<li><strong>__in:</strong> Check if value is at a list, the argument of this operator
must be a list.</li>
</ul>

<h3 id="text-field-operators">Text field operators</h3>

<ul>
<li><strong>__contains:</strong> Check if value contains a string. It is case and
accent sensitive.</li>
<li><strong>__icontains:</strong> Check if a values contains a string, It is case
insensitive and accent sensitive.</li>
<li><strong>__unaccent_icontains:</strong> Check if a values contains a string, It is
case insensitive and accent insensitive (consider a, à, á, ã, ...
the same).</li>
<li><strong>__exact:</strong> Same as __eq or not setting operator.</li>
<li><strong>__iexact:</strong> Same as __eq, but case insensitive and
accent sensitive.</li>
<li><strong>__unaccent_iexact:</strong> Same as __eq, but case insensitive and
accent insensitive.</li>
<li><strong>__startswith:</strong> Check if the value stats with a sub-string.
Case sensitive and accent sensitive.</li>
<li><strong>__istartswith:</strong> Check if the value stats with a sub-string.
Case insensitive and accent sensitive.</li>
<li><strong>__unaccent_istartswith:</strong> Check if the value stats with a
sub-string. Case insensitive and accent insensitive.</li>
<li><strong>__endswith:</strong> Check if the value ends with a sub-string. Case
sensitive and accent sensitive.</li>
<li><strong>__iendswith:</strong> Check if the value ends with a sub-string. Case
insensitive and accent sensitive.</li>
<li><strong>__unaccent_iendswith:</strong> Check if the value ends with a sub-string.
Case insensitive and accent insensitive.</li>
</ul>

<h3 id="null-operators">Null operators</h3>

<ul>
<li><strong>__isnull:</strong> Check if field is null, it uses as argument a <code>boolean</code>
value false will return all non NULL values and true will return
NULL values.</li>
</ul>

<h3 id="date-and-datetime-operators">Date and datetime operators:</h3>

<ul>
<li><strong>__range:</strong> Receive as argument a list of two elements and return
objects that field dates are between those values.</li>
<li><strong>__year:</strong> Return object that date field value year is equal to
argument.</li>
<li><strong>__month:</strong> Return object that date field value month is equal to
argument.</li>
<li><strong>__day:</strong> Return object that date field value day is equal to
argument.</li>
</ul>

<h3 id="dictionary-fields-operators">Dictionary fields operators:</h3>

<ul>
<li><strong>__json_contained_by:</strong>
Uses the function <a href="https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by">contained_by</a>
from SQLAlchemy to test if keys are a proper subset of the keys of
the argument jsonb expression (extracted from SQLAlchemy). The
argument is a list.</li>
<li><strong>__json_has_any:</strong>
Uses the function <a href="https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any">has_any</a>
from SQLAlchemy to test for presence of a key. Note that the key
may be a SQLA expression. (extracted from SQLAlchemy). The
argument is a list.</li>
<li><strong>__json_has_key:</strong>
Uses the function <a href="https://docs.sqlalchemy.org/en/20/dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key">has_key</a>
from SQLAlchemy to Test for presence of a key. Note that the key
may be a SQLA expression. The argument is a str.</li>
</ul>

<h3 id="text-similarity-operators">Text similarity operators</h3>

<p>To use similariry querys on Postgres it is necessary to <code>pg_trgm</code> be
instaled on server. Check [oficial documentation]
(https://www.postgresql.org/docs/current/pgtrgm.html).</p>

<ul>
<li><strong>__similarity:</strong> Check if two strings are similar uses the <code>%</code>
operador.</li>
<li><strong>__word_similar_left:</strong> Check if two strings are similar uses the
<code>&lt;%</code> operador.</li>
<li><strong>__word_similar_right:</strong> Check if two strings are similar uses the
<code>%&gt;</code> operador.</li>
<li><strong>__strict_word__similar_left:</strong> Check if two strings are similar
uses the <code>&lt;&lt;%</code> operador.</li>
<li><strong>__strict_word__similar_right:</strong> Check if two strings are similar
uses the <code>%&gt;&gt;</code> operador.</li>
</ul>

<p>Some usage examples:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Return the first 3 results ordered decreasing acording to `time` and</span>
<span class="c1"># them ordered by `modeling_unit_id`. Results must have time greater</span>
<span class="c1"># or equal to 2017-01-01 and less or equal to 2017-06-01. It also</span>
<span class="c1"># must have attribute_id equal to 6 and not contains modeling_unit_id</span>
<span class="c1"># 3 or 4.</span>
<span class="n">microservice</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
    <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;DatabaseVariable&quot;</span><span class="p">,</span>
    <span class="n">filter_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;time__gte&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01-01 00:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time__lte&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-06-01 00:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attribute_id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
    <span class="n">exclude_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;modeling_unit_id__in&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span>
    <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;-time&quot;</span><span class="p">,</span> <span class="s2">&quot;modeling_unit_id&quot;</span><span class="p">],</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;model_class&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;modeling_unit_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span>

<span class="c1"># Return all elements that dimensions field has a key type with</span>
<span class="c1"># value contains `selling` insensitive to case and accent.</span>
<span class="n">microservice</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
    <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;DatabaseAttribute&quot;</span><span class="p">,</span>
    <span class="n">filter_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;dimensions-&gt;type__unaccent_icontains&quot;</span><span class="p">:</span> <span class="s2">&quot;selling&quot;</span><span class="p">})</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>filter_dict:</strong>  Filter dict to be used at the query. Filter elements from query
return that satifies all statements of the dictonary.</li>
<li><strong>exclude_dict:</strong>  Exclude dict to be used at the query. Remove elements from
query return that satifies all statements of the dictonary.</li>
<li><strong>order_by:</strong>  Order results acording to list of strings
correspondent to fields. It is possible to use '-' at the
begginng of the field name for reverse ordering. Ex.:
['description'] for accendent ordering and ['-description']
for descendent ordering.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields:</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields:</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>limit:</strong>  Set the limit of elements of the returned query. By default,
backend usually return 50 elements.</li>
<li><strong>foreign_key_fields:</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
<li><strong>**kwargs:</strong>  Other parameters for compatibility.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Containing objects serialized by list Serializer.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No especific raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_by_chunks" class="classattr">
                                        <input id="PumpWoodMicroService.list_by_chunks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_by_chunks</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_by_chunks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_by_chunks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_by_chunks-1175"><a href="#PumpWoodMicroService.list_by_chunks-1175"><span class="linenos">1175</span></a>    <span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1176"><a href="#PumpWoodMicroService.list_by_chunks-1176"><span class="linenos">1176</span></a>                       <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1177"><a href="#PumpWoodMicroService.list_by_chunks-1177"><span class="linenos">1177</span></a>                       <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1178"><a href="#PumpWoodMicroService.list_by_chunks-1178"><span class="linenos">1178</span></a>                       <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1179"><a href="#PumpWoodMicroService.list_by_chunks-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object fetching them by chucks using pk to paginate.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1180"><a href="#PumpWoodMicroService.list_by_chunks-1180"><span class="linenos">1180</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1181"><a href="#PumpWoodMicroService.list_by_chunks-1181"><span class="linenos">1181</span></a><span class="sd">        List data by chunck to load by datasets without breaking the backend</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1182"><a href="#PumpWoodMicroService.list_by_chunks-1182"><span class="linenos">1182</span></a><span class="sd">        or receive server timeout. It load chunks orderring the results using</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1183"><a href="#PumpWoodMicroService.list_by_chunks-1183"><span class="linenos">1183</span></a><span class="sd">        id of the tables, it can be changed but it should be unique otherwise</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1184"><a href="#PumpWoodMicroService.list_by_chunks-1184"><span class="linenos">1184</span></a><span class="sd">        unexpected results may occur.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1185"><a href="#PumpWoodMicroService.list_by_chunks-1185"><span class="linenos">1185</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1186"><a href="#PumpWoodMicroService.list_by_chunks-1186"><span class="linenos">1186</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1187"><a href="#PumpWoodMicroService.list_by_chunks-1187"><span class="linenos">1187</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1188"><a href="#PumpWoodMicroService.list_by_chunks-1188"><span class="linenos">1188</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1189"><a href="#PumpWoodMicroService.list_by_chunks-1189"><span class="linenos">1189</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1190"><a href="#PumpWoodMicroService.list_by_chunks-1190"><span class="linenos">1190</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1191"><a href="#PumpWoodMicroService.list_by_chunks-1191"><span class="linenos">1191</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1192"><a href="#PumpWoodMicroService.list_by_chunks-1192"><span class="linenos">1192</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1193"><a href="#PumpWoodMicroService.list_by_chunks-1193"><span class="linenos">1193</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1194"><a href="#PumpWoodMicroService.list_by_chunks-1194"><span class="linenos">1194</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1195"><a href="#PumpWoodMicroService.list_by_chunks-1195"><span class="linenos">1195</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1196"><a href="#PumpWoodMicroService.list_by_chunks-1196"><span class="linenos">1196</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1197"><a href="#PumpWoodMicroService.list_by_chunks-1197"><span class="linenos">1197</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1198"><a href="#PumpWoodMicroService.list_by_chunks-1198"><span class="linenos">1198</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1199"><a href="#PumpWoodMicroService.list_by_chunks-1199"><span class="linenos">1199</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1200"><a href="#PumpWoodMicroService.list_by_chunks-1200"><span class="linenos">1200</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1201"><a href="#PumpWoodMicroService.list_by_chunks-1201"><span class="linenos">1201</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1202"><a href="#PumpWoodMicroService.list_by_chunks-1202"><span class="linenos">1202</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1203"><a href="#PumpWoodMicroService.list_by_chunks-1203"><span class="linenos">1203</span></a><span class="sd">            chunk_size:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1204"><a href="#PumpWoodMicroService.list_by_chunks-1204"><span class="linenos">1204</span></a><span class="sd">                Number of objects to be fetched each query.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1205"><a href="#PumpWoodMicroService.list_by_chunks-1205"><span class="linenos">1205</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1206"><a href="#PumpWoodMicroService.list_by_chunks-1206"><span class="linenos">1206</span></a><span class="sd">                Other parameters for compatibility.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1207"><a href="#PumpWoodMicroService.list_by_chunks-1207"><span class="linenos">1207</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1208"><a href="#PumpWoodMicroService.list_by_chunks-1208"><span class="linenos">1208</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1209"><a href="#PumpWoodMicroService.list_by_chunks-1209"><span class="linenos">1209</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1210"><a href="#PumpWoodMicroService.list_by_chunks-1210"><span class="linenos">1210</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1211"><a href="#PumpWoodMicroService.list_by_chunks-1211"><span class="linenos">1211</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1212"><a href="#PumpWoodMicroService.list_by_chunks-1212"><span class="linenos">1212</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1213"><a href="#PumpWoodMicroService.list_by_chunks-1213"><span class="linenos">1213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1214"><a href="#PumpWoodMicroService.list_by_chunks-1214"><span class="linenos">1214</span></a>        <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1215"><a href="#PumpWoodMicroService.list_by_chunks-1215"><span class="linenos">1215</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1216"><a href="#PumpWoodMicroService.list_by_chunks-1216"><span class="linenos">1216</span></a>        <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1217"><a href="#PumpWoodMicroService.list_by_chunks-1217"><span class="linenos">1217</span></a>        <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1218"><a href="#PumpWoodMicroService.list_by_chunks-1218"><span class="linenos">1218</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1219"><a href="#PumpWoodMicroService.list_by_chunks-1219"><span class="linenos">1219</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1220"><a href="#PumpWoodMicroService.list_by_chunks-1220"><span class="linenos">1220</span></a>            <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1221"><a href="#PumpWoodMicroService.list_by_chunks-1221"><span class="linenos">1221</span></a>            <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1222"><a href="#PumpWoodMicroService.list_by_chunks-1222"><span class="linenos">1222</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1223"><a href="#PumpWoodMicroService.list_by_chunks-1223"><span class="linenos">1223</span></a>                <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1224"><a href="#PumpWoodMicroService.list_by_chunks-1224"><span class="linenos">1224</span></a>                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1225"><a href="#PumpWoodMicroService.list_by_chunks-1225"><span class="linenos">1225</span></a>                <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1226"><a href="#PumpWoodMicroService.list_by_chunks-1226"><span class="linenos">1226</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1227"><a href="#PumpWoodMicroService.list_by_chunks-1227"><span class="linenos">1227</span></a>            <span class="c1"># Break if results is empty</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1228"><a href="#PumpWoodMicroService.list_by_chunks-1228"><span class="linenos">1228</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1229"><a href="#PumpWoodMicroService.list_by_chunks-1229"><span class="linenos">1229</span></a>                <span class="k">break</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1230"><a href="#PumpWoodMicroService.list_by_chunks-1230"><span class="linenos">1230</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1231"><a href="#PumpWoodMicroService.list_by_chunks-1231"><span class="linenos">1231</span></a>            <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1232"><a href="#PumpWoodMicroService.list_by_chunks-1232"><span class="linenos">1232</span></a>            <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_by_chunks-1233"><a href="#PumpWoodMicroService.list_by_chunks-1233"><span class="linenos">1233</span></a>
</span><span id="PumpWoodMicroService.list_by_chunks-1234"><a href="#PumpWoodMicroService.list_by_chunks-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="n">list_all_results</span>
</span></pre></div>


            <div class="docstring"><p>List object fetching them by chucks using pk to paginate.</p>

<p>List data by chunck to load by datasets without breaking the backend
or receive server timeout. It load chunks orderring the results using
id of the tables, it can be changed but it should be unique otherwise
unexpected results may occur.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>filter_dict:</strong>  Filter dict to be used at the query. Filter elements from query
return that satifies all statements of the dictonary.</li>
<li><strong>exclude_dict:</strong>  Exclude dict to be used at the query. Remove elements from
query return that satifies all statements of the dictonary.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields:</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields:</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>chunk_size:</strong>  Number of objects to be fetched each query.</li>
<li><strong>**kwargs:</strong>  Other parameters for compatibility.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Containing objects serialized by list Serializer.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No especific raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_without_pag" class="classattr">
                                        <input id="PumpWoodMicroService.list_without_pag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_without_pag</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">order_by</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span>,</span><span class="param">	<span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_without_pag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_without_pag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_without_pag-1240"><a href="#PumpWoodMicroService.list_without_pag-1240"><span class="linenos">1240</span></a>    <span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.list_without_pag-1241"><a href="#PumpWoodMicroService.list_without_pag-1241"><span class="linenos">1241</span></a>                         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService.list_without_pag-1242"><a href="#PumpWoodMicroService.list_without_pag-1242"><span class="linenos">1242</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1243"><a href="#PumpWoodMicroService.list_without_pag-1243"><span class="linenos">1243</span></a>                         <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1244"><a href="#PumpWoodMicroService.list_without_pag-1244"><span class="linenos">1244</span></a>                         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1245"><a href="#PumpWoodMicroService.list_without_pag-1245"><span class="linenos">1245</span></a>                         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1246"><a href="#PumpWoodMicroService.list_without_pag-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List object without pagination.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1247"><a href="#PumpWoodMicroService.list_without_pag-1247"><span class="linenos">1247</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1248"><a href="#PumpWoodMicroService.list_without_pag-1248"><span class="linenos">1248</span></a><span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
</span><span id="PumpWoodMicroService.list_without_pag-1249"><a href="#PumpWoodMicroService.list_without_pag-1249"><span class="linenos">1249</span></a><span class="sd">        systems, results won&#39;t be paginated.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1250"><a href="#PumpWoodMicroService.list_without_pag-1250"><span class="linenos">1250</span></a><span class="sd">        **Be carefull with large returns.**</span>
</span><span id="PumpWoodMicroService.list_without_pag-1251"><a href="#PumpWoodMicroService.list_without_pag-1251"><span class="linenos">1251</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1252"><a href="#PumpWoodMicroService.list_without_pag-1252"><span class="linenos">1252</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1253"><a href="#PumpWoodMicroService.list_without_pag-1253"><span class="linenos">1253</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1254"><a href="#PumpWoodMicroService.list_without_pag-1254"><span class="linenos">1254</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list_without_pag-1255"><a href="#PumpWoodMicroService.list_without_pag-1255"><span class="linenos">1255</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1256"><a href="#PumpWoodMicroService.list_without_pag-1256"><span class="linenos">1256</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService.list_without_pag-1257"><a href="#PumpWoodMicroService.list_without_pag-1257"><span class="linenos">1257</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1258"><a href="#PumpWoodMicroService.list_without_pag-1258"><span class="linenos">1258</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1259"><a href="#PumpWoodMicroService.list_without_pag-1259"><span class="linenos">1259</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService.list_without_pag-1260"><a href="#PumpWoodMicroService.list_without_pag-1260"><span class="linenos">1260</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1261"><a href="#PumpWoodMicroService.list_without_pag-1261"><span class="linenos">1261</span></a><span class="sd">            order_by (bool):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1262"><a href="#PumpWoodMicroService.list_without_pag-1262"><span class="linenos">1262</span></a><span class="sd">                Order results acording to list of strings</span>
</span><span id="PumpWoodMicroService.list_without_pag-1263"><a href="#PumpWoodMicroService.list_without_pag-1263"><span class="linenos">1263</span></a><span class="sd">                correspondent to fields. It is possible to use &#39;-&#39; at the</span>
</span><span id="PumpWoodMicroService.list_without_pag-1264"><a href="#PumpWoodMicroService.list_without_pag-1264"><span class="linenos">1264</span></a><span class="sd">                begginng of the field name for reverse ordering. Ex.:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1265"><a href="#PumpWoodMicroService.list_without_pag-1265"><span class="linenos">1265</span></a><span class="sd">                [&#39;description&#39;] for accendent ordering and [&#39;-description&#39;]</span>
</span><span id="PumpWoodMicroService.list_without_pag-1266"><a href="#PumpWoodMicroService.list_without_pag-1266"><span class="linenos">1266</span></a><span class="sd">                for descendent ordering.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1267"><a href="#PumpWoodMicroService.list_without_pag-1267"><span class="linenos">1267</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1268"><a href="#PumpWoodMicroService.list_without_pag-1268"><span class="linenos">1268</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_without_pag-1269"><a href="#PumpWoodMicroService.list_without_pag-1269"><span class="linenos">1269</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_without_pag-1270"><a href="#PumpWoodMicroService.list_without_pag-1270"><span class="linenos">1270</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1271"><a href="#PumpWoodMicroService.list_without_pag-1271"><span class="linenos">1271</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1272"><a href="#PumpWoodMicroService.list_without_pag-1272"><span class="linenos">1272</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1273"><a href="#PumpWoodMicroService.list_without_pag-1273"><span class="linenos">1273</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.list_without_pag-1274"><a href="#PumpWoodMicroService.list_without_pag-1274"><span class="linenos">1274</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1275"><a href="#PumpWoodMicroService.list_without_pag-1275"><span class="linenos">1275</span></a><span class="sd">            limit (int):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1276"><a href="#PumpWoodMicroService.list_without_pag-1276"><span class="linenos">1276</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1277"><a href="#PumpWoodMicroService.list_without_pag-1277"><span class="linenos">1277</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1278"><a href="#PumpWoodMicroService.list_without_pag-1278"><span class="linenos">1278</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1279"><a href="#PumpWoodMicroService.list_without_pag-1279"><span class="linenos">1279</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.list_without_pag-1280"><a href="#PumpWoodMicroService.list_without_pag-1280"><span class="linenos">1280</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.list_without_pag-1281"><a href="#PumpWoodMicroService.list_without_pag-1281"><span class="linenos">1281</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.list_without_pag-1282"><a href="#PumpWoodMicroService.list_without_pag-1282"><span class="linenos">1282</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1283"><a href="#PumpWoodMicroService.list_without_pag-1283"><span class="linenos">1283</span></a><span class="sd">            convert_geometry (bool):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1284"><a href="#PumpWoodMicroService.list_without_pag-1284"><span class="linenos">1284</span></a><span class="sd">                If geometry columns should be convert to shapely geometry.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1285"><a href="#PumpWoodMicroService.list_without_pag-1285"><span class="linenos">1285</span></a><span class="sd">                Fields with key &#39;geometry&#39; will be considered geometry.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1286"><a href="#PumpWoodMicroService.list_without_pag-1286"><span class="linenos">1286</span></a><span class="sd">            return_type (str):</span>
</span><span id="PumpWoodMicroService.list_without_pag-1287"><a href="#PumpWoodMicroService.list_without_pag-1287"><span class="linenos">1287</span></a><span class="sd">                Set return type to list of dictinary `list` or to a pandas</span>
</span><span id="PumpWoodMicroService.list_without_pag-1288"><a href="#PumpWoodMicroService.list_without_pag-1288"><span class="linenos">1288</span></a><span class="sd">                dataframe `dataframe`.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1289"><a href="#PumpWoodMicroService.list_without_pag-1289"><span class="linenos">1289</span></a><span class="sd">            **kwargs:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1290"><a href="#PumpWoodMicroService.list_without_pag-1290"><span class="linenos">1290</span></a><span class="sd">                Other unused arguments for compatibility.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1291"><a href="#PumpWoodMicroService.list_without_pag-1291"><span class="linenos">1291</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1292"><a href="#PumpWoodMicroService.list_without_pag-1292"><span class="linenos">1292</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1293"><a href="#PumpWoodMicroService.list_without_pag-1293"><span class="linenos">1293</span></a><span class="sd">          Containing objects serialized by list Serializer.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1294"><a href="#PumpWoodMicroService.list_without_pag-1294"><span class="linenos">1294</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1295"><a href="#PumpWoodMicroService.list_without_pag-1295"><span class="linenos">1295</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1296"><a href="#PumpWoodMicroService.list_without_pag-1296"><span class="linenos">1296</span></a><span class="sd">          No especific raises.</span>
</span><span id="PumpWoodMicroService.list_without_pag-1297"><a href="#PumpWoodMicroService.list_without_pag-1297"><span class="linenos">1297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_without_pag-1298"><a href="#PumpWoodMicroService.list_without_pag-1298"><span class="linenos">1298</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1299"><a href="#PumpWoodMicroService.list_without_pag-1299"><span class="linenos">1299</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.list_without_pag-1300"><a href="#PumpWoodMicroService.list_without_pag-1300"><span class="linenos">1300</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1301"><a href="#PumpWoodMicroService.list_without_pag-1301"><span class="linenos">1301</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_without_pag-1302"><a href="#PumpWoodMicroService.list_without_pag-1302"><span class="linenos">1302</span></a>            <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.list_without_pag-1303"><a href="#PumpWoodMicroService.list_without_pag-1303"><span class="linenos">1303</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1304"><a href="#PumpWoodMicroService.list_without_pag-1304"><span class="linenos">1304</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1305"><a href="#PumpWoodMicroService.list_without_pag-1305"><span class="linenos">1305</span></a>            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService.list_without_pag-1306"><a href="#PumpWoodMicroService.list_without_pag-1306"><span class="linenos">1306</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_without_pag-1307"><a href="#PumpWoodMicroService.list_without_pag-1307"><span class="linenos">1307</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1308"><a href="#PumpWoodMicroService.list_without_pag-1308"><span class="linenos">1308</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1309"><a href="#PumpWoodMicroService.list_without_pag-1309"><span class="linenos">1309</span></a>        <span class="c1">##################################################</span>
</span><span id="PumpWoodMicroService.list_without_pag-1310"><a href="#PumpWoodMicroService.list_without_pag-1310"><span class="linenos">1310</span></a>        <span class="c1"># Converting geometry to Shapely objects in Python</span>
</span><span id="PumpWoodMicroService.list_without_pag-1311"><a href="#PumpWoodMicroService.list_without_pag-1311"><span class="linenos">1311</span></a>        <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService.list_without_pag-1312"><a href="#PumpWoodMicroService.list_without_pag-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1313"><a href="#PumpWoodMicroService.list_without_pag-1313"><span class="linenos">1313</span></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1314"><a href="#PumpWoodMicroService.list_without_pag-1314"><span class="linenos">1314</span></a>                <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1315"><a href="#PumpWoodMicroService.list_without_pag-1315"><span class="linenos">1315</span></a>                <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1316"><a href="#PumpWoodMicroService.list_without_pag-1316"><span class="linenos">1316</span></a>                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1317"><a href="#PumpWoodMicroService.list_without_pag-1317"><span class="linenos">1317</span></a>                    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.list_without_pag-1318"><a href="#PumpWoodMicroService.list_without_pag-1318"><span class="linenos">1318</span></a>        <span class="c1">##################################################</span>
</span><span id="PumpWoodMicroService.list_without_pag-1319"><a href="#PumpWoodMicroService.list_without_pag-1319"><span class="linenos">1319</span></a>
</span><span id="PumpWoodMicroService.list_without_pag-1320"><a href="#PumpWoodMicroService.list_without_pag-1320"><span class="linenos">1320</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1321"><a href="#PumpWoodMicroService.list_without_pag-1321"><span class="linenos">1321</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="PumpWoodMicroService.list_without_pag-1322"><a href="#PumpWoodMicroService.list_without_pag-1322"><span class="linenos">1322</span></a>        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1323"><a href="#PumpWoodMicroService.list_without_pag-1323"><span class="linenos">1323</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="PumpWoodMicroService.list_without_pag-1324"><a href="#PumpWoodMicroService.list_without_pag-1324"><span class="linenos">1324</span></a>                    <span class="n">geometry_in_results</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1325"><a href="#PumpWoodMicroService.list_without_pag-1325"><span class="linenos">1325</span></a>                <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1326"><a href="#PumpWoodMicroService.list_without_pag-1326"><span class="linenos">1326</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1327"><a href="#PumpWoodMicroService.list_without_pag-1327"><span class="linenos">1327</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_without_pag-1328"><a href="#PumpWoodMicroService.list_without_pag-1328"><span class="linenos">1328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_without_pag-1329"><a href="#PumpWoodMicroService.list_without_pag-1329"><span class="linenos">1329</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List object without pagination.</p>

<p>Function to post at list end-point (resumed data) of PumpWood like
systems, results won't be paginated.
<strong>Be carefull with large returns.</strong></p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class (str):</strong>  Model class of the end-point</li>
<li><strong>filter_dict (dict):</strong>  Filter dict to be used at the query. Filter elements from query
return that satifies all statements of the dictonary.</li>
<li><strong>exclude_dict (dict):</strong>  Exclude dict to be used at the query. Remove elements from
query return that satifies all statements of the dictonary.</li>
<li><strong>order_by (bool):</strong>  Order results acording to list of strings
correspondent to fields. It is possible to use '-' at the
begginng of the field name for reverse ordering. Ex.:
['description'] for accendent ordering and ['-description']
for descendent ordering.</li>
<li><strong>auth_header (dict):</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields (List[str]):</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields (bool):</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>limit (int):</strong>  Set the limit of elements of the returned query. By default,
backend usually return 50 elements.</li>
<li><strong>foreign_key_fields (bool):</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
<li><strong>convert_geometry (bool):</strong>  If geometry columns should be convert to shapely geometry.
Fields with key 'geometry' will be considered geometry.</li>
<li><strong>return_type (str):</strong>  Set return type to list of dictinary <code><a href="#PumpWoodMicroService.list">list</a></code> or to a pandas
dataframe <code>dataframe</code>.</li>
<li><strong>**kwargs:</strong>  Other unused arguments for compatibility.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Containing objects serialized by list Serializer.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No especific raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_dimensions" class="classattr">
                                        <input id="PumpWoodMicroService.list_dimensions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_dimensions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_dimensions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_dimensions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_dimensions-1335"><a href="#PumpWoodMicroService.list_dimensions-1335"><span class="linenos">1335</span></a>    <span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.list_dimensions-1336"><a href="#PumpWoodMicroService.list_dimensions-1336"><span class="linenos">1336</span></a>                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.list_dimensions-1337"><a href="#PumpWoodMicroService.list_dimensions-1337"><span class="linenos">1337</span></a>                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1338"><a href="#PumpWoodMicroService.list_dimensions-1338"><span class="linenos">1338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class.</span>
</span><span id="PumpWoodMicroService.list_dimensions-1339"><a href="#PumpWoodMicroService.list_dimensions-1339"><span class="linenos">1339</span></a>
</span><span id="PumpWoodMicroService.list_dimensions-1340"><a href="#PumpWoodMicroService.list_dimensions-1340"><span class="linenos">1340</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="PumpWoodMicroService.list_dimensions-1341"><a href="#PumpWoodMicroService.list_dimensions-1341"><span class="linenos">1341</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService.list_dimensions-1342"><a href="#PumpWoodMicroService.list_dimensions-1342"><span class="linenos">1342</span></a>
</span><span id="PumpWoodMicroService.list_dimensions-1343"><a href="#PumpWoodMicroService.list_dimensions-1343"><span class="linenos">1343</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1344"><a href="#PumpWoodMicroService.list_dimensions-1344"><span class="linenos">1344</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1345"><a href="#PumpWoodMicroService.list_dimensions-1345"><span class="linenos">1345</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list_dimensions-1346"><a href="#PumpWoodMicroService.list_dimensions-1346"><span class="linenos">1346</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1347"><a href="#PumpWoodMicroService.list_dimensions-1347"><span class="linenos">1347</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService.list_dimensions-1348"><a href="#PumpWoodMicroService.list_dimensions-1348"><span class="linenos">1348</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_dimensions-1349"><a href="#PumpWoodMicroService.list_dimensions-1349"><span class="linenos">1349</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1350"><a href="#PumpWoodMicroService.list_dimensions-1350"><span class="linenos">1350</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService.list_dimensions-1351"><a href="#PumpWoodMicroService.list_dimensions-1351"><span class="linenos">1351</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_dimensions-1352"><a href="#PumpWoodMicroService.list_dimensions-1352"><span class="linenos">1352</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1353"><a href="#PumpWoodMicroService.list_dimensions-1353"><span class="linenos">1353</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_dimensions-1354"><a href="#PumpWoodMicroService.list_dimensions-1354"><span class="linenos">1354</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_dimensions-1355"><a href="#PumpWoodMicroService.list_dimensions-1355"><span class="linenos">1355</span></a>
</span><span id="PumpWoodMicroService.list_dimensions-1356"><a href="#PumpWoodMicroService.list_dimensions-1356"><span class="linenos">1356</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_dimensions-1357"><a href="#PumpWoodMicroService.list_dimensions-1357"><span class="linenos">1357</span></a><span class="sd">            List of keys avaiable in results from the query dict.</span>
</span><span id="PumpWoodMicroService.list_dimensions-1358"><a href="#PumpWoodMicroService.list_dimensions-1358"><span class="linenos">1358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_dimensions-1359"><a href="#PumpWoodMicroService.list_dimensions-1359"><span class="linenos">1359</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_dimensions-1360"><a href="#PumpWoodMicroService.list_dimensions-1360"><span class="linenos">1360</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.list_dimensions-1361"><a href="#PumpWoodMicroService.list_dimensions-1361"><span class="linenos">1361</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_dimensions-1362"><a href="#PumpWoodMicroService.list_dimensions-1362"><span class="linenos">1362</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List dimensions avaiable for model_class.</p>

<p>It list all keys avaiable at dimension retricting the results with
query parameters <code>filter_dict</code> and <code>exclude_dict</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>filter_dict:</strong>  Filter dict to be used at the query. Filter elements from query
return that satifies all statements of the dictonary.</li>
<li><strong>exclude_dict:</strong>  Exclude dict to be used at the query. Remove elements from
query return that satifies all statements of the dictonary.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of keys avaiable in results from the query dict.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_dimension_values" class="classattr">
                                        <input id="PumpWoodMicroService.list_dimension_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_dimension_values</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_dimension_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_dimension_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_dimension_values-1368"><a href="#PumpWoodMicroService.list_dimension_values-1368"><span class="linenos">1368</span></a>    <span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1369"><a href="#PumpWoodMicroService.list_dimension_values-1369"><span class="linenos">1369</span></a>                              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1370"><a href="#PumpWoodMicroService.list_dimension_values-1370"><span class="linenos">1370</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1371"><a href="#PumpWoodMicroService.list_dimension_values-1371"><span class="linenos">1371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List values associated with dimensions key.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1372"><a href="#PumpWoodMicroService.list_dimension_values-1372"><span class="linenos">1372</span></a>
</span><span id="PumpWoodMicroService.list_dimension_values-1373"><a href="#PumpWoodMicroService.list_dimension_values-1373"><span class="linenos">1373</span></a><span class="sd">        It list all keys avaiable at dimension retricting the results with</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1374"><a href="#PumpWoodMicroService.list_dimension_values-1374"><span class="linenos">1374</span></a><span class="sd">        query parameters `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1375"><a href="#PumpWoodMicroService.list_dimension_values-1375"><span class="linenos">1375</span></a>
</span><span id="PumpWoodMicroService.list_dimension_values-1376"><a href="#PumpWoodMicroService.list_dimension_values-1376"><span class="linenos">1376</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1377"><a href="#PumpWoodMicroService.list_dimension_values-1377"><span class="linenos">1377</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1378"><a href="#PumpWoodMicroService.list_dimension_values-1378"><span class="linenos">1378</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1379"><a href="#PumpWoodMicroService.list_dimension_values-1379"><span class="linenos">1379</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1380"><a href="#PumpWoodMicroService.list_dimension_values-1380"><span class="linenos">1380</span></a><span class="sd">                Filter dict to be used at the query. Filter elements from query</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1381"><a href="#PumpWoodMicroService.list_dimension_values-1381"><span class="linenos">1381</span></a><span class="sd">                return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1382"><a href="#PumpWoodMicroService.list_dimension_values-1382"><span class="linenos">1382</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1383"><a href="#PumpWoodMicroService.list_dimension_values-1383"><span class="linenos">1383</span></a><span class="sd">                Exclude dict to be used at the query. Remove elements from</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1384"><a href="#PumpWoodMicroService.list_dimension_values-1384"><span class="linenos">1384</span></a><span class="sd">                query return that satifies all statements of the dictonary.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1385"><a href="#PumpWoodMicroService.list_dimension_values-1385"><span class="linenos">1385</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1386"><a href="#PumpWoodMicroService.list_dimension_values-1386"><span class="linenos">1386</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1387"><a href="#PumpWoodMicroService.list_dimension_values-1387"><span class="linenos">1387</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1388"><a href="#PumpWoodMicroService.list_dimension_values-1388"><span class="linenos">1388</span></a><span class="sd">            key:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1389"><a href="#PumpWoodMicroService.list_dimension_values-1389"><span class="linenos">1389</span></a><span class="sd">                Key to list the avaiable values using the query filter</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1390"><a href="#PumpWoodMicroService.list_dimension_values-1390"><span class="linenos">1390</span></a><span class="sd">                and exclude.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1391"><a href="#PumpWoodMicroService.list_dimension_values-1391"><span class="linenos">1391</span></a>
</span><span id="PumpWoodMicroService.list_dimension_values-1392"><a href="#PumpWoodMicroService.list_dimension_values-1392"><span class="linenos">1392</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1393"><a href="#PumpWoodMicroService.list_dimension_values-1393"><span class="linenos">1393</span></a><span class="sd">            List of values associated with dimensions key at the objects that</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1394"><a href="#PumpWoodMicroService.list_dimension_values-1394"><span class="linenos">1394</span></a><span class="sd">            are returned with `filter_dict` and `exclude_dict`.</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1395"><a href="#PumpWoodMicroService.list_dimension_values-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1396"><a href="#PumpWoodMicroService.list_dimension_values-1396"><span class="linenos">1396</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1397"><a href="#PumpWoodMicroService.list_dimension_values-1397"><span class="linenos">1397</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1398"><a href="#PumpWoodMicroService.list_dimension_values-1398"><span class="linenos">1398</span></a>                     <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1399"><a href="#PumpWoodMicroService.list_dimension_values-1399"><span class="linenos">1399</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_dimension_values-1400"><a href="#PumpWoodMicroService.list_dimension_values-1400"><span class="linenos">1400</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List values associated with dimensions key.</p>

<p>It list all keys avaiable at dimension retricting the results with
query parameters <code>filter_dict</code> and <code>exclude_dict</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>filter_dict:</strong>  Filter dict to be used at the query. Filter elements from query
return that satifies all statements of the dictonary.</li>
<li><strong>exclude_dict:</strong>  Exclude dict to be used at the query. Remove elements from
query return that satifies all statements of the dictonary.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>key:</strong>  Key to list the avaiable values using the query filter
and exclude.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of values associated with dimensions key at the objects that
  are returned with <code>filter_dict</code> and <code>exclude_dict</code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_one" class="classattr">
                                        <input id="PumpWoodMicroService.list_one-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_one</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_one-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_one"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_one-1406"><a href="#PumpWoodMicroService.list_one-1406"><span class="linenos">1406</span></a>    <span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_one-1407"><a href="#PumpWoodMicroService.list_one-1407"><span class="linenos">1407</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_one-1408"><a href="#PumpWoodMicroService.list_one-1408"><span class="linenos">1408</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.list_one-1409"><a href="#PumpWoodMicroService.list_one-1409"><span class="linenos">1409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object using list serializer (simple).</span>
</span><span id="PumpWoodMicroService.list_one-1410"><a href="#PumpWoodMicroService.list_one-1410"><span class="linenos">1410</span></a>
</span><span id="PumpWoodMicroService.list_one-1411"><a href="#PumpWoodMicroService.list_one-1411"><span class="linenos">1411</span></a><span class="sd">        **# DEPRECTED #** It is the same as retrieve using</span>
</span><span id="PumpWoodMicroService.list_one-1412"><a href="#PumpWoodMicroService.list_one-1412"><span class="linenos">1412</span></a><span class="sd">        `default_fields: bool = True`, if possible migrate to retrieve</span>
</span><span id="PumpWoodMicroService.list_one-1413"><a href="#PumpWoodMicroService.list_one-1413"><span class="linenos">1413</span></a><span class="sd">        function.</span>
</span><span id="PumpWoodMicroService.list_one-1414"><a href="#PumpWoodMicroService.list_one-1414"><span class="linenos">1414</span></a>
</span><span id="PumpWoodMicroService.list_one-1415"><a href="#PumpWoodMicroService.list_one-1415"><span class="linenos">1415</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_one-1416"><a href="#PumpWoodMicroService.list_one-1416"><span class="linenos">1416</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list_one-1417"><a href="#PumpWoodMicroService.list_one-1417"><span class="linenos">1417</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.list_one-1418"><a href="#PumpWoodMicroService.list_one-1418"><span class="linenos">1418</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.list_one-1419"><a href="#PumpWoodMicroService.list_one-1419"><span class="linenos">1419</span></a><span class="sd">                Object pk</span>
</span><span id="PumpWoodMicroService.list_one-1420"><a href="#PumpWoodMicroService.list_one-1420"><span class="linenos">1420</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_one-1421"><a href="#PumpWoodMicroService.list_one-1421"><span class="linenos">1421</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_one-1422"><a href="#PumpWoodMicroService.list_one-1422"><span class="linenos">1422</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_one-1423"><a href="#PumpWoodMicroService.list_one-1423"><span class="linenos">1423</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService.list_one-1424"><a href="#PumpWoodMicroService.list_one-1424"><span class="linenos">1424</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.list_one-1425"><a href="#PumpWoodMicroService.list_one-1425"><span class="linenos">1425</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService.list_one-1426"><a href="#PumpWoodMicroService.list_one-1426"><span class="linenos">1426</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.list_one-1427"><a href="#PumpWoodMicroService.list_one-1427"><span class="linenos">1427</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.list_one-1428"><a href="#PumpWoodMicroService.list_one-1428"><span class="linenos">1428</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService.list_one-1429"><a href="#PumpWoodMicroService.list_one-1429"><span class="linenos">1429</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.list_one-1430"><a href="#PumpWoodMicroService.list_one-1430"><span class="linenos">1430</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.list_one-1431"><a href="#PumpWoodMicroService.list_one-1431"><span class="linenos">1431</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.list_one-1432"><a href="#PumpWoodMicroService.list_one-1432"><span class="linenos">1432</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.list_one-1433"><a href="#PumpWoodMicroService.list_one-1433"><span class="linenos">1433</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService.list_one-1434"><a href="#PumpWoodMicroService.list_one-1434"><span class="linenos">1434</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService.list_one-1435"><a href="#PumpWoodMicroService.list_one-1435"><span class="linenos">1435</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService.list_one-1436"><a href="#PumpWoodMicroService.list_one-1436"><span class="linenos">1436</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService.list_one-1437"><a href="#PumpWoodMicroService.list_one-1437"><span class="linenos">1437</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService.list_one-1438"><a href="#PumpWoodMicroService.list_one-1438"><span class="linenos">1438</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService.list_one-1439"><a href="#PumpWoodMicroService.list_one-1439"><span class="linenos">1439</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService.list_one-1440"><a href="#PumpWoodMicroService.list_one-1440"><span class="linenos">1440</span></a>
</span><span id="PumpWoodMicroService.list_one-1441"><a href="#PumpWoodMicroService.list_one-1441"><span class="linenos">1441</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_one-1442"><a href="#PumpWoodMicroService.list_one-1442"><span class="linenos">1442</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="PumpWoodMicroService.list_one-1443"><a href="#PumpWoodMicroService.list_one-1443"><span class="linenos">1443</span></a>
</span><span id="PumpWoodMicroService.list_one-1444"><a href="#PumpWoodMicroService.list_one-1444"><span class="linenos">1444</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_one-1445"><a href="#PumpWoodMicroService.list_one-1445"><span class="linenos">1445</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.list_one-1446"><a href="#PumpWoodMicroService.list_one-1446"><span class="linenos">1446</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="PumpWoodMicroService.list_one-1447"><a href="#PumpWoodMicroService.list_one-1447"><span class="linenos">1447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_one-1448"><a href="#PumpWoodMicroService.list_one-1448"><span class="linenos">1448</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.list_one-1449"><a href="#PumpWoodMicroService.list_one-1449"><span class="linenos">1449</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_one-1450"><a href="#PumpWoodMicroService.list_one-1450"><span class="linenos">1450</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.list_one-1451"><a href="#PumpWoodMicroService.list_one-1451"><span class="linenos">1451</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_one-1452"><a href="#PumpWoodMicroService.list_one-1452"><span class="linenos">1452</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_one-1453"><a href="#PumpWoodMicroService.list_one-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_one-1454"><a href="#PumpWoodMicroService.list_one-1454"><span class="linenos">1454</span></a>            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve an object using list serializer (simple).</p>

<p><strong># DEPRECTED #</strong> It is the same as retrieve using
<code>default_fields: bool = True</code>, if possible migrate to retrieve
function.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>pk:</strong>  Object pk</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields:</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields:</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>foreign_key_fields:</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
<li><strong>related_fields:</strong>  Return related fields objects. Related field objects are
objects that have a forenging key associated with this
model_class, results will be returned as a list of
dictionaries usually in a field with <code>_set</code> at end.
Returning related_fields consume backend resorces, use
carefully.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return object with the correspondent pk.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  If pk not found on database.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.retrieve" class="classattr">
                                        <input id="PumpWoodMicroService.retrieve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">retrieve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.retrieve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.retrieve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.retrieve-1460"><a href="#PumpWoodMicroService.retrieve-1460"><span class="linenos">1460</span></a>    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1461"><a href="#PumpWoodMicroService.retrieve-1461"><span class="linenos">1461</span></a>                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1462"><a href="#PumpWoodMicroService.retrieve-1462"><span class="linenos">1462</span></a>                 <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1463"><a href="#PumpWoodMicroService.retrieve-1463"><span class="linenos">1463</span></a>                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1464"><a href="#PumpWoodMicroService.retrieve-1464"><span class="linenos">1464</span></a>                 <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1465"><a href="#PumpWoodMicroService.retrieve-1465"><span class="linenos">1465</span></a>                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve-1466"><a href="#PumpWoodMicroService.retrieve-1466"><span class="linenos">1466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an object from PumpWood.</span>
</span><span id="PumpWoodMicroService.retrieve-1467"><a href="#PumpWoodMicroService.retrieve-1467"><span class="linenos">1467</span></a>
</span><span id="PumpWoodMicroService.retrieve-1468"><a href="#PumpWoodMicroService.retrieve-1468"><span class="linenos">1468</span></a><span class="sd">        Function to get object serialized by retrieve end-point</span>
</span><span id="PumpWoodMicroService.retrieve-1469"><a href="#PumpWoodMicroService.retrieve-1469"><span class="linenos">1469</span></a><span class="sd">        (more detailed data).</span>
</span><span id="PumpWoodMicroService.retrieve-1470"><a href="#PumpWoodMicroService.retrieve-1470"><span class="linenos">1470</span></a>
</span><span id="PumpWoodMicroService.retrieve-1471"><a href="#PumpWoodMicroService.retrieve-1471"><span class="linenos">1471</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.retrieve-1472"><a href="#PumpWoodMicroService.retrieve-1472"><span class="linenos">1472</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.retrieve-1473"><a href="#PumpWoodMicroService.retrieve-1473"><span class="linenos">1473</span></a><span class="sd">                Model class of the end-point</span>
</span><span id="PumpWoodMicroService.retrieve-1474"><a href="#PumpWoodMicroService.retrieve-1474"><span class="linenos">1474</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.retrieve-1475"><a href="#PumpWoodMicroService.retrieve-1475"><span class="linenos">1475</span></a><span class="sd">                Object pk</span>
</span><span id="PumpWoodMicroService.retrieve-1476"><a href="#PumpWoodMicroService.retrieve-1476"><span class="linenos">1476</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve-1477"><a href="#PumpWoodMicroService.retrieve-1477"><span class="linenos">1477</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.retrieve-1478"><a href="#PumpWoodMicroService.retrieve-1478"><span class="linenos">1478</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.retrieve-1479"><a href="#PumpWoodMicroService.retrieve-1479"><span class="linenos">1479</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService.retrieve-1480"><a href="#PumpWoodMicroService.retrieve-1480"><span class="linenos">1480</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.retrieve-1481"><a href="#PumpWoodMicroService.retrieve-1481"><span class="linenos">1481</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService.retrieve-1482"><a href="#PumpWoodMicroService.retrieve-1482"><span class="linenos">1482</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.retrieve-1483"><a href="#PumpWoodMicroService.retrieve-1483"><span class="linenos">1483</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.retrieve-1484"><a href="#PumpWoodMicroService.retrieve-1484"><span class="linenos">1484</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService.retrieve-1485"><a href="#PumpWoodMicroService.retrieve-1485"><span class="linenos">1485</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.retrieve-1486"><a href="#PumpWoodMicroService.retrieve-1486"><span class="linenos">1486</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.retrieve-1487"><a href="#PumpWoodMicroService.retrieve-1487"><span class="linenos">1487</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.retrieve-1488"><a href="#PumpWoodMicroService.retrieve-1488"><span class="linenos">1488</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.retrieve-1489"><a href="#PumpWoodMicroService.retrieve-1489"><span class="linenos">1489</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService.retrieve-1490"><a href="#PumpWoodMicroService.retrieve-1490"><span class="linenos">1490</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService.retrieve-1491"><a href="#PumpWoodMicroService.retrieve-1491"><span class="linenos">1491</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService.retrieve-1492"><a href="#PumpWoodMicroService.retrieve-1492"><span class="linenos">1492</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService.retrieve-1493"><a href="#PumpWoodMicroService.retrieve-1493"><span class="linenos">1493</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService.retrieve-1494"><a href="#PumpWoodMicroService.retrieve-1494"><span class="linenos">1494</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService.retrieve-1495"><a href="#PumpWoodMicroService.retrieve-1495"><span class="linenos">1495</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService.retrieve-1496"><a href="#PumpWoodMicroService.retrieve-1496"><span class="linenos">1496</span></a>
</span><span id="PumpWoodMicroService.retrieve-1497"><a href="#PumpWoodMicroService.retrieve-1497"><span class="linenos">1497</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.retrieve-1498"><a href="#PumpWoodMicroService.retrieve-1498"><span class="linenos">1498</span></a><span class="sd">            Return object with the correspondent pk.</span>
</span><span id="PumpWoodMicroService.retrieve-1499"><a href="#PumpWoodMicroService.retrieve-1499"><span class="linenos">1499</span></a>
</span><span id="PumpWoodMicroService.retrieve-1500"><a href="#PumpWoodMicroService.retrieve-1500"><span class="linenos">1500</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.retrieve-1501"><a href="#PumpWoodMicroService.retrieve-1501"><span class="linenos">1501</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.retrieve-1502"><a href="#PumpWoodMicroService.retrieve-1502"><span class="linenos">1502</span></a><span class="sd">                If pk not found on database.</span>
</span><span id="PumpWoodMicroService.retrieve-1503"><a href="#PumpWoodMicroService.retrieve-1503"><span class="linenos">1503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.retrieve-1504"><a href="#PumpWoodMicroService.retrieve-1504"><span class="linenos">1504</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve-1505"><a href="#PumpWoodMicroService.retrieve-1505"><span class="linenos">1505</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve-1506"><a href="#PumpWoodMicroService.retrieve-1506"><span class="linenos">1506</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.retrieve-1507"><a href="#PumpWoodMicroService.retrieve-1507"><span class="linenos">1507</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1508"><a href="#PumpWoodMicroService.retrieve-1508"><span class="linenos">1508</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve-1509"><a href="#PumpWoodMicroService.retrieve-1509"><span class="linenos">1509</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.retrieve-1510"><a href="#PumpWoodMicroService.retrieve-1510"><span class="linenos">1510</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve an object from PumpWood.</p>

<p>Function to get object serialized by retrieve end-point
(more detailed data).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the end-point</li>
<li><strong>pk:</strong>  Object pk</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields:</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields:</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>foreign_key_fields:</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
<li><strong>related_fields:</strong>  Return related fields objects. Related field objects are
objects that have a forenging key associated with this
model_class, results will be returned as a list of
dictionaries usually in a field with <code>_set</code> at end.
Returning related_fields consume backend resorces, use
carefully.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return object with the correspondent pk.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  If pk not found on database.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.retrieve_file" class="classattr">
                                        <input id="PumpWoodMicroService.retrieve_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">retrieve_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>,</span><span class="param">	<span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;fail&#39;</span></span><span class="return-annotation">) -> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.retrieve_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.retrieve_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.retrieve_file-1516"><a href="#PumpWoodMicroService.retrieve_file-1516"><span class="linenos">1516</span></a>    <span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_file-1517"><a href="#PumpWoodMicroService.retrieve_file-1517"><span class="linenos">1517</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_file-1518"><a href="#PumpWoodMicroService.retrieve_file-1518"><span class="linenos">1518</span></a>                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_file-1519"><a href="#PumpWoodMicroService.retrieve_file-1519"><span class="linenos">1519</span></a>                      <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1520"><a href="#PumpWoodMicroService.retrieve_file-1520"><span class="linenos">1520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1521"><a href="#PumpWoodMicroService.retrieve_file-1521"><span class="linenos">1521</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1522"><a href="#PumpWoodMicroService.retrieve_file-1522"><span class="linenos">1522</span></a><span class="sd">        This function will retrieve file as a single request, depending on the</span>
</span><span id="PumpWoodMicroService.retrieve_file-1523"><a href="#PumpWoodMicroService.retrieve_file-1523"><span class="linenos">1523</span></a><span class="sd">        size of the files it would be preferred to use streaming end-point.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1524"><a href="#PumpWoodMicroService.retrieve_file-1524"><span class="linenos">1524</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1525"><a href="#PumpWoodMicroService.retrieve_file-1525"><span class="linenos">1525</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1526"><a href="#PumpWoodMicroService.retrieve_file-1526"><span class="linenos">1526</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1527"><a href="#PumpWoodMicroService.retrieve_file-1527"><span class="linenos">1527</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1528"><a href="#PumpWoodMicroService.retrieve_file-1528"><span class="linenos">1528</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1529"><a href="#PumpWoodMicroService.retrieve_file-1529"><span class="linenos">1529</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1530"><a href="#PumpWoodMicroService.retrieve_file-1530"><span class="linenos">1530</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1531"><a href="#PumpWoodMicroService.retrieve_file-1531"><span class="linenos">1531</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1532"><a href="#PumpWoodMicroService.retrieve_file-1532"><span class="linenos">1532</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1533"><a href="#PumpWoodMicroService.retrieve_file-1533"><span class="linenos">1533</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1534"><a href="#PumpWoodMicroService.retrieve_file-1534"><span class="linenos">1534</span></a><span class="sd">            save_file:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1535"><a href="#PumpWoodMicroService.retrieve_file-1535"><span class="linenos">1535</span></a><span class="sd">                If data is to be saved as file or return get</span>
</span><span id="PumpWoodMicroService.retrieve_file-1536"><a href="#PumpWoodMicroService.retrieve_file-1536"><span class="linenos">1536</span></a><span class="sd">                response.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1537"><a href="#PumpWoodMicroService.retrieve_file-1537"><span class="linenos">1537</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1538"><a href="#PumpWoodMicroService.retrieve_file-1538"><span class="linenos">1538</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1539"><a href="#PumpWoodMicroService.retrieve_file-1539"><span class="linenos">1539</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1540"><a href="#PumpWoodMicroService.retrieve_file-1540"><span class="linenos">1540</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="PumpWoodMicroService.retrieve_file-1541"><a href="#PumpWoodMicroService.retrieve_file-1541"><span class="linenos">1541</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1542"><a href="#PumpWoodMicroService.retrieve_file-1542"><span class="linenos">1542</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1543"><a href="#PumpWoodMicroService.retrieve_file-1543"><span class="linenos">1543</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1544"><a href="#PumpWoodMicroService.retrieve_file-1544"><span class="linenos">1544</span></a><span class="sd">                Set what to do if there is a file with same name. Skip</span>
</span><span id="PumpWoodMicroService.retrieve_file-1545"><a href="#PumpWoodMicroService.retrieve_file-1545"><span class="linenos">1545</span></a><span class="sd">                will not download file if there is already with same</span>
</span><span id="PumpWoodMicroService.retrieve_file-1546"><a href="#PumpWoodMicroService.retrieve_file-1546"><span class="linenos">1546</span></a><span class="sd">                os.path.join(save_path, file_name), file_name must be set</span>
</span><span id="PumpWoodMicroService.retrieve_file-1547"><a href="#PumpWoodMicroService.retrieve_file-1547"><span class="linenos">1547</span></a><span class="sd">                for skip argument.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1548"><a href="#PumpWoodMicroService.retrieve_file-1548"><span class="linenos">1548</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1549"><a href="#PumpWoodMicroService.retrieve_file-1549"><span class="linenos">1549</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.retrieve_file-1550"><a href="#PumpWoodMicroService.retrieve_file-1550"><span class="linenos">1550</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.retrieve_file-1551"><a href="#PumpWoodMicroService.retrieve_file-1551"><span class="linenos">1551</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1552"><a href="#PumpWoodMicroService.retrieve_file-1552"><span class="linenos">1552</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1553"><a href="#PumpWoodMicroService.retrieve_file-1553"><span class="linenos">1553</span></a><span class="sd">            May return the file name if save_file=True; If false will return</span>
</span><span id="PumpWoodMicroService.retrieve_file-1554"><a href="#PumpWoodMicroService.retrieve_file-1554"><span class="linenos">1554</span></a><span class="sd">            a dictonary with keys `filename` with original file name and</span>
</span><span id="PumpWoodMicroService.retrieve_file-1555"><a href="#PumpWoodMicroService.retrieve_file-1555"><span class="linenos">1555</span></a><span class="sd">            `content` with binary data of file content.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1556"><a href="#PumpWoodMicroService.retrieve_file-1556"><span class="linenos">1556</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1557"><a href="#PumpWoodMicroService.retrieve_file-1557"><span class="linenos">1557</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1558"><a href="#PumpWoodMicroService.retrieve_file-1558"><span class="linenos">1558</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1559"><a href="#PumpWoodMicroService.retrieve_file-1559"><span class="linenos">1559</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService.retrieve_file-1560"><a href="#PumpWoodMicroService.retrieve_file-1560"><span class="linenos">1560</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="PumpWoodMicroService.retrieve_file-1561"><a href="#PumpWoodMicroService.retrieve_file-1561"><span class="linenos">1561</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="PumpWoodMicroService.retrieve_file-1562"><a href="#PumpWoodMicroService.retrieve_file-1562"><span class="linenos">1562</span></a><span class="sd">                operations,</span>
</span><span id="PumpWoodMicroService.retrieve_file-1563"><a href="#PumpWoodMicroService.retrieve_file-1563"><span class="linenos">1563</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1564"><a href="#PumpWoodMicroService.retrieve_file-1564"><span class="linenos">1564</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService.retrieve_file-1565"><a href="#PumpWoodMicroService.retrieve_file-1565"><span class="linenos">1565</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="PumpWoodMicroService.retrieve_file-1566"><a href="#PumpWoodMicroService.retrieve_file-1566"><span class="linenos">1566</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1567"><a href="#PumpWoodMicroService.retrieve_file-1567"><span class="linenos">1567</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1568"><a href="#PumpWoodMicroService.retrieve_file-1568"><span class="linenos">1568</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="PumpWoodMicroService.retrieve_file-1569"><a href="#PumpWoodMicroService.retrieve_file-1569"><span class="linenos">1569</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1570"><a href="#PumpWoodMicroService.retrieve_file-1570"><span class="linenos">1570</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1571"><a href="#PumpWoodMicroService.retrieve_file-1571"><span class="linenos">1571</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="PumpWoodMicroService.retrieve_file-1572"><a href="#PumpWoodMicroService.retrieve_file-1572"><span class="linenos">1572</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="PumpWoodMicroService.retrieve_file-1573"><a href="#PumpWoodMicroService.retrieve_file-1573"><span class="linenos">1573</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="PumpWoodMicroService.retrieve_file-1574"><a href="#PumpWoodMicroService.retrieve_file-1574"><span class="linenos">1574</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="PumpWoodMicroService.retrieve_file-1575"><a href="#PumpWoodMicroService.retrieve_file-1575"><span class="linenos">1575</span></a><span class="sd">                files on storage.</span>
</span><span id="PumpWoodMicroService.retrieve_file-1576"><a href="#PumpWoodMicroService.retrieve_file-1576"><span class="linenos">1576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.retrieve_file-1577"><a href="#PumpWoodMicroService.retrieve_file-1577"><span class="linenos">1577</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1578"><a href="#PumpWoodMicroService.retrieve_file-1578"><span class="linenos">1578</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1579"><a href="#PumpWoodMicroService.retrieve_file-1579"><span class="linenos">1579</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
</span><span id="PumpWoodMicroService.retrieve_file-1580"><a href="#PumpWoodMicroService.retrieve_file-1580"><span class="linenos">1580</span></a>                <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1581"><a href="#PumpWoodMicroService.retrieve_file-1581"><span class="linenos">1581</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1582"><a href="#PumpWoodMicroService.retrieve_file-1582"><span class="linenos">1582</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1583"><a href="#PumpWoodMicroService.retrieve_file-1583"><span class="linenos">1583</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1584"><a href="#PumpWoodMicroService.retrieve_file-1584"><span class="linenos">1584</span></a>            <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1585"><a href="#PumpWoodMicroService.retrieve_file-1585"><span class="linenos">1585</span></a>            <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1586"><a href="#PumpWoodMicroService.retrieve_file-1586"><span class="linenos">1586</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1587"><a href="#PumpWoodMicroService.retrieve_file-1587"><span class="linenos">1587</span></a>                <span class="k">return</span> <span class="n">file_path</span>
</span><span id="PumpWoodMicroService.retrieve_file-1588"><a href="#PumpWoodMicroService.retrieve_file-1588"><span class="linenos">1588</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1589"><a href="#PumpWoodMicroService.retrieve_file-1589"><span class="linenos">1589</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1590"><a href="#PumpWoodMicroService.retrieve_file-1590"><span class="linenos">1590</span></a>        <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1591"><a href="#PumpWoodMicroService.retrieve_file-1591"><span class="linenos">1591</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.retrieve_file-1592"><a href="#PumpWoodMicroService.retrieve_file-1592"><span class="linenos">1592</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1593"><a href="#PumpWoodMicroService.retrieve_file-1593"><span class="linenos">1593</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1594"><a href="#PumpWoodMicroService.retrieve_file-1594"><span class="linenos">1594</span></a>            <span class="k">return</span> <span class="n">file_response</span>
</span><span id="PumpWoodMicroService.retrieve_file-1595"><a href="#PumpWoodMicroService.retrieve_file-1595"><span class="linenos">1595</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1596"><a href="#PumpWoodMicroService.retrieve_file-1596"><span class="linenos">1596</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_file-1597"><a href="#PumpWoodMicroService.retrieve_file-1597"><span class="linenos">1597</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1598"><a href="#PumpWoodMicroService.retrieve_file-1598"><span class="linenos">1598</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1599"><a href="#PumpWoodMicroService.retrieve_file-1599"><span class="linenos">1599</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.retrieve_file-1600"><a href="#PumpWoodMicroService.retrieve_file-1600"><span class="linenos">1600</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1601"><a href="#PumpWoodMicroService.retrieve_file-1601"><span class="linenos">1601</span></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.retrieve_file-1602"><a href="#PumpWoodMicroService.retrieve_file-1602"><span class="linenos">1602</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1603"><a href="#PumpWoodMicroService.retrieve_file-1603"><span class="linenos">1603</span></a>        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1604"><a href="#PumpWoodMicroService.retrieve_file-1604"><span class="linenos">1604</span></a>        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1605"><a href="#PumpWoodMicroService.retrieve_file-1605"><span class="linenos">1605</span></a>            <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1606"><a href="#PumpWoodMicroService.retrieve_file-1606"><span class="linenos">1606</span></a>                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1607"><a href="#PumpWoodMicroService.retrieve_file-1607"><span class="linenos">1607</span></a>                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.retrieve_file-1608"><a href="#PumpWoodMicroService.retrieve_file-1608"><span class="linenos">1608</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_file-1609"><a href="#PumpWoodMicroService.retrieve_file-1609"><span class="linenos">1609</span></a>                    <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1610"><a href="#PumpWoodMicroService.retrieve_file-1610"><span class="linenos">1610</span></a>                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_file-1611"><a href="#PumpWoodMicroService.retrieve_file-1611"><span class="linenos">1611</span></a>                        <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_file-1612"><a href="#PumpWoodMicroService.retrieve_file-1612"><span class="linenos">1612</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_file-1613"><a href="#PumpWoodMicroService.retrieve_file-1613"><span class="linenos">1613</span></a>                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="PumpWoodMicroService.retrieve_file-1614"><a href="#PumpWoodMicroService.retrieve_file-1614"><span class="linenos">1614</span></a>                        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService.retrieve_file-1615"><a href="#PumpWoodMicroService.retrieve_file-1615"><span class="linenos">1615</span></a>                        <span class="k">break</span>
</span><span id="PumpWoodMicroService.retrieve_file-1616"><a href="#PumpWoodMicroService.retrieve_file-1616"><span class="linenos">1616</span></a>                <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1617"><a href="#PumpWoodMicroService.retrieve_file-1617"><span class="linenos">1617</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1618"><a href="#PumpWoodMicroService.retrieve_file-1618"><span class="linenos">1618</span></a>                        <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.retrieve_file-1619"><a href="#PumpWoodMicroService.retrieve_file-1619"><span class="linenos">1619</span></a>                         <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.retrieve_file-1620"><a href="#PumpWoodMicroService.retrieve_file-1620"><span class="linenos">1620</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1621"><a href="#PumpWoodMicroService.retrieve_file-1621"><span class="linenos">1621</span></a>            <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1622"><a href="#PumpWoodMicroService.retrieve_file-1622"><span class="linenos">1622</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_file-1623"><a href="#PumpWoodMicroService.retrieve_file-1623"><span class="linenos">1623</span></a>                    <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.retrieve_file-1624"><a href="#PumpWoodMicroService.retrieve_file-1624"><span class="linenos">1624</span></a>                     <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.retrieve_file-1625"><a href="#PumpWoodMicroService.retrieve_file-1625"><span class="linenos">1625</span></a>
</span><span id="PumpWoodMicroService.retrieve_file-1626"><a href="#PumpWoodMicroService.retrieve_file-1626"><span class="linenos">1626</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_file-1627"><a href="#PumpWoodMicroService.retrieve_file-1627"><span class="linenos">1627</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.retrieve_file-1628"><a href="#PumpWoodMicroService.retrieve_file-1628"><span class="linenos">1628</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve a file from PumpWood.</p>

<p>This function will retrieve file as a single request, depending on the
size of the files it would be preferred to use streaming end-point.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Class of the model to retrieve file.</li>
<li><strong>pk:</strong>  Pk of the object associeted file.</li>
<li><strong>file_field:</strong>  Field of the file to be downloaded.</li>
<li><strong>auth_header:</strong>  Dictionary containing the auth header.</li>
<li><strong>save_file:</strong>  If data is to be saved as file or return get
response.</li>
<li><strong>save_path:</strong>  Path of the directory to save file.</li>
<li><strong>file_name:</strong>  Name of the file, if None it will have same name as
saved in PumpWood.</li>
<li><strong>if_exists:</strong>  Values must be in {'fail', 'change_name', 'overwrite', 'skip'}.
Set what to do if there is a file with same name. Skip
will not download file if there is already with same
os.path.join(save_path, file_name), file_name must be set
for skip argument.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>May return the file name if save_file=True; If false will return
  a dictonary with keys <code>filename</code> with original file name and
  <code>content</code> with binary data of file content.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodForbidden:</strong>  'storage_object attribute not set for view, file operations
are disable'. This indicates that storage for this backend
was not configured, so it is not possible to make storage
operations,</li>
<li><strong>PumpWoodForbidden:</strong>  'file_field must be set on self.file_fields dictionary'. This
indicates that the <code>file_field</code> parameter is not listed as
a file field on the backend.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'field [{}] not found or null at object'. This indicates that
the file field requested is not present on object fields.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'Object not found in storage [{}]'. This indicates that the
file associated with file_field is not avaiable at the
storage. This should not ocorrur, it might have a manual
update at the model_class table or manual removal/rename of
files on storage.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.retrieve_streaming_file" class="classattr">
                                        <input id="PumpWoodMicroService.retrieve_streaming_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">retrieve_streaming_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>,</span><span class="param">	<span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;fail&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.retrieve_streaming_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.retrieve_streaming_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.retrieve_streaming_file-1635"><a href="#PumpWoodMicroService.retrieve_streaming_file-1635"><span class="linenos">1635</span></a>    <span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1636"><a href="#PumpWoodMicroService.retrieve_streaming_file-1636"><span class="linenos">1636</span></a>                                <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1637"><a href="#PumpWoodMicroService.retrieve_streaming_file-1637"><span class="linenos">1637</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1638"><a href="#PumpWoodMicroService.retrieve_streaming_file-1638"><span class="linenos">1638</span></a>                                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1639"><a href="#PumpWoodMicroService.retrieve_streaming_file-1639"><span class="linenos">1639</span></a>                                <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1640"><a href="#PumpWoodMicroService.retrieve_streaming_file-1640"><span class="linenos">1640</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a file from PumpWood using streaming to retrieve content.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1641"><a href="#PumpWoodMicroService.retrieve_streaming_file-1641"><span class="linenos">1641</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1642"><a href="#PumpWoodMicroService.retrieve_streaming_file-1642"><span class="linenos">1642</span></a><span class="sd">        This funcion uses file streaming to retrieve file content, it should be</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1643"><a href="#PumpWoodMicroService.retrieve_streaming_file-1643"><span class="linenos">1643</span></a><span class="sd">        prefered when dealing with large (bigger than 10Mb) files transfer.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1644"><a href="#PumpWoodMicroService.retrieve_streaming_file-1644"><span class="linenos">1644</span></a><span class="sd">        Using this end-point the file is not loaded on backend memory content</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1645"><a href="#PumpWoodMicroService.retrieve_streaming_file-1645"><span class="linenos">1645</span></a><span class="sd">        is transfered by chucks that are read at the storage and transfered</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1646"><a href="#PumpWoodMicroService.retrieve_streaming_file-1646"><span class="linenos">1646</span></a><span class="sd">        to user.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1647"><a href="#PumpWoodMicroService.retrieve_streaming_file-1647"><span class="linenos">1647</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1648"><a href="#PumpWoodMicroService.retrieve_streaming_file-1648"><span class="linenos">1648</span></a><span class="sd">        It will necessarily save the content as a file, there is not the</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1649"><a href="#PumpWoodMicroService.retrieve_streaming_file-1649"><span class="linenos">1649</span></a><span class="sd">        possibility of retrieving the content directly from request.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1650"><a href="#PumpWoodMicroService.retrieve_streaming_file-1650"><span class="linenos">1650</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1651"><a href="#PumpWoodMicroService.retrieve_streaming_file-1651"><span class="linenos">1651</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1652"><a href="#PumpWoodMicroService.retrieve_streaming_file-1652"><span class="linenos">1652</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1653"><a href="#PumpWoodMicroService.retrieve_streaming_file-1653"><span class="linenos">1653</span></a><span class="sd">                Class of the model to retrieve file.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1654"><a href="#PumpWoodMicroService.retrieve_streaming_file-1654"><span class="linenos">1654</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1655"><a href="#PumpWoodMicroService.retrieve_streaming_file-1655"><span class="linenos">1655</span></a><span class="sd">                Pk of the object associeted file.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1656"><a href="#PumpWoodMicroService.retrieve_streaming_file-1656"><span class="linenos">1656</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1657"><a href="#PumpWoodMicroService.retrieve_streaming_file-1657"><span class="linenos">1657</span></a><span class="sd">                Field of the file to be downloaded.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1658"><a href="#PumpWoodMicroService.retrieve_streaming_file-1658"><span class="linenos">1658</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1659"><a href="#PumpWoodMicroService.retrieve_streaming_file-1659"><span class="linenos">1659</span></a><span class="sd">                Dictionary containing the auth header.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1660"><a href="#PumpWoodMicroService.retrieve_streaming_file-1660"><span class="linenos">1660</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1661"><a href="#PumpWoodMicroService.retrieve_streaming_file-1661"><span class="linenos">1661</span></a><span class="sd">                Path of the directory to save file.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1662"><a href="#PumpWoodMicroService.retrieve_streaming_file-1662"><span class="linenos">1662</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1663"><a href="#PumpWoodMicroService.retrieve_streaming_file-1663"><span class="linenos">1663</span></a><span class="sd">                Name of the file, if None it will have same name as</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1664"><a href="#PumpWoodMicroService.retrieve_streaming_file-1664"><span class="linenos">1664</span></a><span class="sd">                saved in PumpWood.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1665"><a href="#PumpWoodMicroService.retrieve_streaming_file-1665"><span class="linenos">1665</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1666"><a href="#PumpWoodMicroService.retrieve_streaming_file-1666"><span class="linenos">1666</span></a><span class="sd">                Values must be in {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1667"><a href="#PumpWoodMicroService.retrieve_streaming_file-1667"><span class="linenos">1667</span></a><span class="sd">                Set what to do if there is a file with same name.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1668"><a href="#PumpWoodMicroService.retrieve_streaming_file-1668"><span class="linenos">1668</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1669"><a href="#PumpWoodMicroService.retrieve_streaming_file-1669"><span class="linenos">1669</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1670"><a href="#PumpWoodMicroService.retrieve_streaming_file-1670"><span class="linenos">1670</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1671"><a href="#PumpWoodMicroService.retrieve_streaming_file-1671"><span class="linenos">1671</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1672"><a href="#PumpWoodMicroService.retrieve_streaming_file-1672"><span class="linenos">1672</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1673"><a href="#PumpWoodMicroService.retrieve_streaming_file-1673"><span class="linenos">1673</span></a><span class="sd">            Returns the file path that recived the file content.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1674"><a href="#PumpWoodMicroService.retrieve_streaming_file-1674"><span class="linenos">1674</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1675"><a href="#PumpWoodMicroService.retrieve_streaming_file-1675"><span class="linenos">1675</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1676"><a href="#PumpWoodMicroService.retrieve_streaming_file-1676"><span class="linenos">1676</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1677"><a href="#PumpWoodMicroService.retrieve_streaming_file-1677"><span class="linenos">1677</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1678"><a href="#PumpWoodMicroService.retrieve_streaming_file-1678"><span class="linenos">1678</span></a><span class="sd">                are disable&#39;. This indicates that storage for this backend</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1679"><a href="#PumpWoodMicroService.retrieve_streaming_file-1679"><span class="linenos">1679</span></a><span class="sd">                was not configured, so it is not possible to make storage</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1680"><a href="#PumpWoodMicroService.retrieve_streaming_file-1680"><span class="linenos">1680</span></a><span class="sd">                operations,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1681"><a href="#PumpWoodMicroService.retrieve_streaming_file-1681"><span class="linenos">1681</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1682"><a href="#PumpWoodMicroService.retrieve_streaming_file-1682"><span class="linenos">1682</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1683"><a href="#PumpWoodMicroService.retrieve_streaming_file-1683"><span class="linenos">1683</span></a><span class="sd">                indicates that the `file_field` parameter is not listed as</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1684"><a href="#PumpWoodMicroService.retrieve_streaming_file-1684"><span class="linenos">1684</span></a><span class="sd">                a file field on the backend.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1685"><a href="#PumpWoodMicroService.retrieve_streaming_file-1685"><span class="linenos">1685</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1686"><a href="#PumpWoodMicroService.retrieve_streaming_file-1686"><span class="linenos">1686</span></a><span class="sd">                &#39;field [{}] not found or null at object&#39;. This indicates that</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1687"><a href="#PumpWoodMicroService.retrieve_streaming_file-1687"><span class="linenos">1687</span></a><span class="sd">                the file field requested is not present on object fields.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1688"><a href="#PumpWoodMicroService.retrieve_streaming_file-1688"><span class="linenos">1688</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1689"><a href="#PumpWoodMicroService.retrieve_streaming_file-1689"><span class="linenos">1689</span></a><span class="sd">                &#39;Object not found in storage [{}]&#39;. This indicates that the</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1690"><a href="#PumpWoodMicroService.retrieve_streaming_file-1690"><span class="linenos">1690</span></a><span class="sd">                file associated with file_field is not avaiable at the</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1691"><a href="#PumpWoodMicroService.retrieve_streaming_file-1691"><span class="linenos">1691</span></a><span class="sd">                storage. This should not ocorrur, it might have a manual</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1692"><a href="#PumpWoodMicroService.retrieve_streaming_file-1692"><span class="linenos">1692</span></a><span class="sd">                update at the model_class table or manual removal/rename of</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1693"><a href="#PumpWoodMicroService.retrieve_streaming_file-1693"><span class="linenos">1693</span></a><span class="sd">                files on storage.</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1694"><a href="#PumpWoodMicroService.retrieve_streaming_file-1694"><span class="linenos">1694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1695"><a href="#PumpWoodMicroService.retrieve_streaming_file-1695"><span class="linenos">1695</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1696"><a href="#PumpWoodMicroService.retrieve_streaming_file-1696"><span class="linenos">1696</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1697"><a href="#PumpWoodMicroService.retrieve_streaming_file-1697"><span class="linenos">1697</span></a>        <span class="c1"># begin Args check</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1698"><a href="#PumpWoodMicroService.retrieve_streaming_file-1698"><span class="linenos">1698</span></a>        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1699"><a href="#PumpWoodMicroService.retrieve_streaming_file-1699"><span class="linenos">1699</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1700"><a href="#PumpWoodMicroService.retrieve_streaming_file-1700"><span class="linenos">1700</span></a>                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1701"><a href="#PumpWoodMicroService.retrieve_streaming_file-1701"><span class="linenos">1701</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1702"><a href="#PumpWoodMicroService.retrieve_streaming_file-1702"><span class="linenos">1702</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1703"><a href="#PumpWoodMicroService.retrieve_streaming_file-1703"><span class="linenos">1703</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1704"><a href="#PumpWoodMicroService.retrieve_streaming_file-1704"><span class="linenos">1704</span></a>                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1705"><a href="#PumpWoodMicroService.retrieve_streaming_file-1705"><span class="linenos">1705</span></a>                    <span class="n">save_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1706"><a href="#PumpWoodMicroService.retrieve_streaming_file-1706"><span class="linenos">1706</span></a>        <span class="c1"># end Args check</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1707"><a href="#PumpWoodMicroService.retrieve_streaming_file-1707"><span class="linenos">1707</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1708"><a href="#PumpWoodMicroService.retrieve_streaming_file-1708"><span class="linenos">1708</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1709"><a href="#PumpWoodMicroService.retrieve_streaming_file-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1710"><a href="#PumpWoodMicroService.retrieve_streaming_file-1710"><span class="linenos">1710</span></a>            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1711"><a href="#PumpWoodMicroService.retrieve_streaming_file-1711"><span class="linenos">1711</span></a>            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1712"><a href="#PumpWoodMicroService.retrieve_streaming_file-1712"><span class="linenos">1712</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1713"><a href="#PumpWoodMicroService.retrieve_streaming_file-1713"><span class="linenos">1713</span></a>                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1714"><a href="#PumpWoodMicroService.retrieve_streaming_file-1714"><span class="linenos">1714</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1715"><a href="#PumpWoodMicroService.retrieve_streaming_file-1715"><span class="linenos">1715</span></a>                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1716"><a href="#PumpWoodMicroService.retrieve_streaming_file-1716"><span class="linenos">1716</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1717"><a href="#PumpWoodMicroService.retrieve_streaming_file-1717"><span class="linenos">1717</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1718"><a href="#PumpWoodMicroService.retrieve_streaming_file-1718"><span class="linenos">1718</span></a>                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1719"><a href="#PumpWoodMicroService.retrieve_streaming_file-1719"><span class="linenos">1719</span></a>                    <span class="k">break</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1720"><a href="#PumpWoodMicroService.retrieve_streaming_file-1720"><span class="linenos">1720</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1721"><a href="#PumpWoodMicroService.retrieve_streaming_file-1721"><span class="linenos">1721</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1722"><a href="#PumpWoodMicroService.retrieve_streaming_file-1722"><span class="linenos">1722</span></a>                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1723"><a href="#PumpWoodMicroService.retrieve_streaming_file-1723"><span class="linenos">1723</span></a>                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1724"><a href="#PumpWoodMicroService.retrieve_streaming_file-1724"><span class="linenos">1724</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1725"><a href="#PumpWoodMicroService.retrieve_streaming_file-1725"><span class="linenos">1725</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1726"><a href="#PumpWoodMicroService.retrieve_streaming_file-1726"><span class="linenos">1726</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1727"><a href="#PumpWoodMicroService.retrieve_streaming_file-1727"><span class="linenos">1727</span></a>                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1728"><a href="#PumpWoodMicroService.retrieve_streaming_file-1728"><span class="linenos">1728</span></a>                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1729"><a href="#PumpWoodMicroService.retrieve_streaming_file-1729"><span class="linenos">1729</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1730"><a href="#PumpWoodMicroService.retrieve_streaming_file-1730"><span class="linenos">1730</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1731"><a href="#PumpWoodMicroService.retrieve_streaming_file-1731"><span class="linenos">1731</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1732"><a href="#PumpWoodMicroService.retrieve_streaming_file-1732"><span class="linenos">1732</span></a>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1733"><a href="#PumpWoodMicroService.retrieve_streaming_file-1733"><span class="linenos">1733</span></a>        <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1734"><a href="#PumpWoodMicroService.retrieve_streaming_file-1734"><span class="linenos">1734</span></a>        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1735"><a href="#PumpWoodMicroService.retrieve_streaming_file-1735"><span class="linenos">1735</span></a>                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1736"><a href="#PumpWoodMicroService.retrieve_streaming_file-1736"><span class="linenos">1736</span></a>                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1737"><a href="#PumpWoodMicroService.retrieve_streaming_file-1737"><span class="linenos">1737</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1738"><a href="#PumpWoodMicroService.retrieve_streaming_file-1738"><span class="linenos">1738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1739"><a href="#PumpWoodMicroService.retrieve_streaming_file-1739"><span class="linenos">1739</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1740"><a href="#PumpWoodMicroService.retrieve_streaming_file-1740"><span class="linenos">1740</span></a>                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1741"><a href="#PumpWoodMicroService.retrieve_streaming_file-1741"><span class="linenos">1741</span></a>                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1742"><a href="#PumpWoodMicroService.retrieve_streaming_file-1742"><span class="linenos">1742</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.retrieve_streaming_file-1743"><a href="#PumpWoodMicroService.retrieve_streaming_file-1743"><span class="linenos">1743</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve a file from PumpWood using streaming to retrieve content.</p>

<p>This funcion uses file streaming to retrieve file content, it should be
prefered when dealing with large (bigger than 10Mb) files transfer.
Using this end-point the file is not loaded on backend memory content
is transfered by chucks that are read at the storage and transfered
to user.</p>

<p>It will necessarily save the content as a file, there is not the
possibility of retrieving the content directly from request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Class of the model to retrieve file.</li>
<li><strong>pk:</strong>  Pk of the object associeted file.</li>
<li><strong>file_field:</strong>  Field of the file to be downloaded.</li>
<li><strong>auth_header:</strong>  Dictionary containing the auth header.</li>
<li><strong>save_path:</strong>  Path of the directory to save file.</li>
<li><strong>file_name:</strong>  Name of the file, if None it will have same name as
saved in PumpWood.</li>
<li><strong>if_exists:</strong>  Values must be in {'fail', 'change_name', 'overwrite'}.
Set what to do if there is a file with same name.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Returns the file path that recived the file content.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodForbidden:</strong>  'storage_object attribute not set for view, file operations
are disable'. This indicates that storage for this backend
was not configured, so it is not possible to make storage
operations,</li>
<li><strong>PumpWoodForbidden:</strong>  'file_field must be set on self.file_fields dictionary'. This
indicates that the <code>file_field</code> parameter is not listed as
a file field on the backend.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'field [{}] not found or null at object'. This indicates that
the file field requested is not present on object fields.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'Object not found in storage [{}]'. This indicates that the
file associated with file_field is not avaiable at the
storage. This should not ocorrur, it might have a manual
update at the model_class table or manual removal/rename of
files on storage.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.save" class="classattr">
                                        <input id="PumpWoodMicroService.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj_dict</span>, </span><span class="param"><span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.save-1749"><a href="#PumpWoodMicroService.save-1749"><span class="linenos">1749</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.save-1750"><a href="#PumpWoodMicroService.save-1750"><span class="linenos">1750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save or Update a new object.</span>
</span><span id="PumpWoodMicroService.save-1751"><a href="#PumpWoodMicroService.save-1751"><span class="linenos">1751</span></a>
</span><span id="PumpWoodMicroService.save-1752"><a href="#PumpWoodMicroService.save-1752"><span class="linenos">1752</span></a><span class="sd">        Function to save or update a new model_class object. If obj_dict[&#39;pk&#39;]</span>
</span><span id="PumpWoodMicroService.save-1753"><a href="#PumpWoodMicroService.save-1753"><span class="linenos">1753</span></a><span class="sd">        is None or not defined a new object will be created. The obj</span>
</span><span id="PumpWoodMicroService.save-1754"><a href="#PumpWoodMicroService.save-1754"><span class="linenos">1754</span></a><span class="sd">        model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
</span><span id="PumpWoodMicroService.save-1755"><a href="#PumpWoodMicroService.save-1755"><span class="linenos">1755</span></a><span class="sd">        PumpWoodObjectSavingException will be raised.</span>
</span><span id="PumpWoodMicroService.save-1756"><a href="#PumpWoodMicroService.save-1756"><span class="linenos">1756</span></a>
</span><span id="PumpWoodMicroService.save-1757"><a href="#PumpWoodMicroService.save-1757"><span class="linenos">1757</span></a><span class="sd">        If files argument is set, request will be transfered using a multipart</span>
</span><span id="PumpWoodMicroService.save-1758"><a href="#PumpWoodMicroService.save-1758"><span class="linenos">1758</span></a><span class="sd">        request file files mapping file key to file field on backend.</span>
</span><span id="PumpWoodMicroService.save-1759"><a href="#PumpWoodMicroService.save-1759"><span class="linenos">1759</span></a>
</span><span id="PumpWoodMicroService.save-1760"><a href="#PumpWoodMicroService.save-1760"><span class="linenos">1760</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.save-1761"><a href="#PumpWoodMicroService.save-1761"><span class="linenos">1761</span></a><span class="sd">            obj_dict:</span>
</span><span id="PumpWoodMicroService.save-1762"><a href="#PumpWoodMicroService.save-1762"><span class="linenos">1762</span></a><span class="sd">                Model data dictionary. It must have &#39;model_class&#39;</span>
</span><span id="PumpWoodMicroService.save-1763"><a href="#PumpWoodMicroService.save-1763"><span class="linenos">1763</span></a><span class="sd">                key and if &#39;pk&#39; key is not defined a new object will</span>
</span><span id="PumpWoodMicroService.save-1764"><a href="#PumpWoodMicroService.save-1764"><span class="linenos">1764</span></a><span class="sd">                be created, else object with pk will be updated.</span>
</span><span id="PumpWoodMicroService.save-1765"><a href="#PumpWoodMicroService.save-1765"><span class="linenos">1765</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService.save-1766"><a href="#PumpWoodMicroService.save-1766"><span class="linenos">1766</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="PumpWoodMicroService.save-1767"><a href="#PumpWoodMicroService.save-1767"><span class="linenos">1767</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="PumpWoodMicroService.save-1768"><a href="#PumpWoodMicroService.save-1768"><span class="linenos">1768</span></a><span class="sd">                bytes.</span>
</span><span id="PumpWoodMicroService.save-1769"><a href="#PumpWoodMicroService.save-1769"><span class="linenos">1769</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.save-1770"><a href="#PumpWoodMicroService.save-1770"><span class="linenos">1770</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.save-1771"><a href="#PumpWoodMicroService.save-1771"><span class="linenos">1771</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.save-1772"><a href="#PumpWoodMicroService.save-1772"><span class="linenos">1772</span></a>
</span><span id="PumpWoodMicroService.save-1773"><a href="#PumpWoodMicroService.save-1773"><span class="linenos">1773</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.save-1774"><a href="#PumpWoodMicroService.save-1774"><span class="linenos">1774</span></a><span class="sd">            Return updated/created object data.</span>
</span><span id="PumpWoodMicroService.save-1775"><a href="#PumpWoodMicroService.save-1775"><span class="linenos">1775</span></a>
</span><span id="PumpWoodMicroService.save-1776"><a href="#PumpWoodMicroService.save-1776"><span class="linenos">1776</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.save-1777"><a href="#PumpWoodMicroService.save-1777"><span class="linenos">1777</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="PumpWoodMicroService.save-1778"><a href="#PumpWoodMicroService.save-1778"><span class="linenos">1778</span></a><span class="sd">                &#39;To save an object obj_dict must have model_class defined.&#39;</span>
</span><span id="PumpWoodMicroService.save-1779"><a href="#PumpWoodMicroService.save-1779"><span class="linenos">1779</span></a><span class="sd">                This indicates that the obj_dict must have key `model_class`</span>
</span><span id="PumpWoodMicroService.save-1780"><a href="#PumpWoodMicroService.save-1780"><span class="linenos">1780</span></a><span class="sd">                indicating model class of the object that will be</span>
</span><span id="PumpWoodMicroService.save-1781"><a href="#PumpWoodMicroService.save-1781"><span class="linenos">1781</span></a><span class="sd">                updated/created.</span>
</span><span id="PumpWoodMicroService.save-1782"><a href="#PumpWoodMicroService.save-1782"><span class="linenos">1782</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.save-1783"><a href="#PumpWoodMicroService.save-1783"><span class="linenos">1783</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="PumpWoodMicroService.save-1784"><a href="#PumpWoodMicroService.save-1784"><span class="linenos">1784</span></a><span class="sd">                indicates that the pk passed on obj_dict was not found on</span>
</span><span id="PumpWoodMicroService.save-1785"><a href="#PumpWoodMicroService.save-1785"><span class="linenos">1785</span></a><span class="sd">                backend database.</span>
</span><span id="PumpWoodMicroService.save-1786"><a href="#PumpWoodMicroService.save-1786"><span class="linenos">1786</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="PumpWoodMicroService.save-1787"><a href="#PumpWoodMicroService.save-1787"><span class="linenos">1787</span></a><span class="sd">                Error raised when IntegrityError is raised on database. This</span>
</span><span id="PumpWoodMicroService.save-1788"><a href="#PumpWoodMicroService.save-1788"><span class="linenos">1788</span></a><span class="sd">                might ocorrur when saving objects that does not respect</span>
</span><span id="PumpWoodMicroService.save-1789"><a href="#PumpWoodMicroService.save-1789"><span class="linenos">1789</span></a><span class="sd">                uniqueness restriction on database or other IntegrityError</span>
</span><span id="PumpWoodMicroService.save-1790"><a href="#PumpWoodMicroService.save-1790"><span class="linenos">1790</span></a><span class="sd">                like removal of foreign keys with related data.</span>
</span><span id="PumpWoodMicroService.save-1791"><a href="#PumpWoodMicroService.save-1791"><span class="linenos">1791</span></a><span class="sd">            PumpWoodObjectSavingException:</span>
</span><span id="PumpWoodMicroService.save-1792"><a href="#PumpWoodMicroService.save-1792"><span class="linenos">1792</span></a><span class="sd">                Return error at object validation on de-serializing the</span>
</span><span id="PumpWoodMicroService.save-1793"><a href="#PumpWoodMicroService.save-1793"><span class="linenos">1793</span></a><span class="sd">                object or files with unexpected extensions.</span>
</span><span id="PumpWoodMicroService.save-1794"><a href="#PumpWoodMicroService.save-1794"><span class="linenos">1794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.save-1795"><a href="#PumpWoodMicroService.save-1795"><span class="linenos">1795</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save-1796"><a href="#PumpWoodMicroService.save-1796"><span class="linenos">1796</span></a>        <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.save-1797"><a href="#PumpWoodMicroService.save-1797"><span class="linenos">1797</span></a>            <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save-1798"><a href="#PumpWoodMicroService.save-1798"><span class="linenos">1798</span></a>                <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save-1799"><a href="#PumpWoodMicroService.save-1799"><span class="linenos">1799</span></a>
</span><span id="PumpWoodMicroService.save-1800"><a href="#PumpWoodMicroService.save-1800"><span class="linenos">1800</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save-1801"><a href="#PumpWoodMicroService.save-1801"><span class="linenos">1801</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save-1802"><a href="#PumpWoodMicroService.save-1802"><span class="linenos">1802</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.save-1803"><a href="#PumpWoodMicroService.save-1803"><span class="linenos">1803</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save or Update a new object.</p>

<p>Function to save or update a new model_class object. If obj_dict['pk']
is None or not defined a new object will be created. The obj
model class is defided at obj_dict['model_class'] and if not defined an
PumpWoodObjectSavingException will be raised.</p>

<p>If files argument is set, request will be transfered using a multipart
request file files mapping file key to file field on backend.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>obj_dict:</strong>  Model data dictionary. It must have 'model_class'
key and if 'pk' key is not defined a new object will
be created, else object with pk will be updated.</li>
<li><strong>files:</strong>  A dictionary of files to be added to as a multi-part
post request. File must be passed as a file object with read
bytes.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return updated/created object data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodObjectSavingException:</strong>  'To save an object obj_dict must have model_class defined.'
This indicates that the obj_dict must have key <code>model_class</code>
indicating model class of the object that will be
updated/created.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'Requested object {model_class}[{pk}] not found.'. This
indicates that the pk passed on obj_dict was not found on
backend database.</li>
<li><strong>PumpWoodIntegrityError:</strong>  Error raised when IntegrityError is raised on database. This
might ocorrur when saving objects that does not respect
uniqueness restriction on database or other IntegrityError
like removal of foreign keys with related data.</li>
<li><strong>PumpWoodObjectSavingException:</strong>  Return error at object validation on de-serializing the
object or files with unexpected extensions.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.save_streaming_file" class="classattr">
                                        <input id="PumpWoodMicroService.save_streaming_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_streaming_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file</span><span class="p">:</span> <span class="n">_io</span><span class="o">.</span><span class="n">BufferedReader</span>,</span><span class="param">	<span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.save_streaming_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.save_streaming_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.save_streaming_file-1810"><a href="#PumpWoodMicroService.save_streaming_file-1810"><span class="linenos">1810</span></a>    <span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1811"><a href="#PumpWoodMicroService.save_streaming_file-1811"><span class="linenos">1811</span></a>                            <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1812"><a href="#PumpWoodMicroService.save_streaming_file-1812"><span class="linenos">1812</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1813"><a href="#PumpWoodMicroService.save_streaming_file-1813"><span class="linenos">1813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream file to PumpWood.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1814"><a href="#PumpWoodMicroService.save_streaming_file-1814"><span class="linenos">1814</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1815"><a href="#PumpWoodMicroService.save_streaming_file-1815"><span class="linenos">1815</span></a><span class="sd">        Use streaming to transfer a file content to Pumpwood storage, this</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1816"><a href="#PumpWoodMicroService.save_streaming_file-1816"><span class="linenos">1816</span></a><span class="sd">        end-point is prefered when transmiting files bigger than 10Mb. It</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1817"><a href="#PumpWoodMicroService.save_streaming_file-1817"><span class="linenos">1817</span></a><span class="sd">        is necessary to have the object created before the file transfer.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1818"><a href="#PumpWoodMicroService.save_streaming_file-1818"><span class="linenos">1818</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1819"><a href="#PumpWoodMicroService.save_streaming_file-1819"><span class="linenos">1819</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1820"><a href="#PumpWoodMicroService.save_streaming_file-1820"><span class="linenos">1820</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1821"><a href="#PumpWoodMicroService.save_streaming_file-1821"><span class="linenos">1821</span></a><span class="sd">                Model class of the object.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1822"><a href="#PumpWoodMicroService.save_streaming_file-1822"><span class="linenos">1822</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1823"><a href="#PumpWoodMicroService.save_streaming_file-1823"><span class="linenos">1823</span></a><span class="sd">                pk of the object.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1824"><a href="#PumpWoodMicroService.save_streaming_file-1824"><span class="linenos">1824</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1825"><a href="#PumpWoodMicroService.save_streaming_file-1825"><span class="linenos">1825</span></a><span class="sd">                File field that will receive file stream.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1826"><a href="#PumpWoodMicroService.save_streaming_file-1826"><span class="linenos">1826</span></a><span class="sd">            file:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1827"><a href="#PumpWoodMicroService.save_streaming_file-1827"><span class="linenos">1827</span></a><span class="sd">                File to upload as a file object with read bytes option.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1828"><a href="#PumpWoodMicroService.save_streaming_file-1828"><span class="linenos">1828</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1829"><a href="#PumpWoodMicroService.save_streaming_file-1829"><span class="linenos">1829</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1830"><a href="#PumpWoodMicroService.save_streaming_file-1830"><span class="linenos">1830</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1831"><a href="#PumpWoodMicroService.save_streaming_file-1831"><span class="linenos">1831</span></a><span class="sd">            file_name:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1832"><a href="#PumpWoodMicroService.save_streaming_file-1832"><span class="linenos">1832</span></a><span class="sd">                Name of the file, if not set it will be saved as</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1833"><a href="#PumpWoodMicroService.save_streaming_file-1833"><span class="linenos">1833</span></a><span class="sd">                {pk}__{file_field}.{extension at permited extension}</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1834"><a href="#PumpWoodMicroService.save_streaming_file-1834"><span class="linenos">1834</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1835"><a href="#PumpWoodMicroService.save_streaming_file-1835"><span class="linenos">1835</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1836"><a href="#PumpWoodMicroService.save_streaming_file-1836"><span class="linenos">1836</span></a><span class="sd">            Return the file name associated with data at the storage.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1837"><a href="#PumpWoodMicroService.save_streaming_file-1837"><span class="linenos">1837</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1838"><a href="#PumpWoodMicroService.save_streaming_file-1838"><span class="linenos">1838</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1839"><a href="#PumpWoodMicroService.save_streaming_file-1839"><span class="linenos">1839</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1840"><a href="#PumpWoodMicroService.save_streaming_file-1840"><span class="linenos">1840</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary&#39;. This</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1841"><a href="#PumpWoodMicroService.save_streaming_file-1841"><span class="linenos">1841</span></a><span class="sd">                indicates that the `file_field` passed is not associated</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1842"><a href="#PumpWoodMicroService.save_streaming_file-1842"><span class="linenos">1842</span></a><span class="sd">                with a file field on the backend.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1843"><a href="#PumpWoodMicroService.save_streaming_file-1843"><span class="linenos">1843</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1844"><a href="#PumpWoodMicroService.save_streaming_file-1844"><span class="linenos">1844</span></a><span class="sd">                &#39;Saved bytes in streaming [{}] differ from file bytes [{}].&#39;.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1845"><a href="#PumpWoodMicroService.save_streaming_file-1845"><span class="linenos">1845</span></a><span class="sd">                This indicates that there was an error when transfering data</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1846"><a href="#PumpWoodMicroService.save_streaming_file-1846"><span class="linenos">1846</span></a><span class="sd">                to storage, the file bytes and transfered bytes does not</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1847"><a href="#PumpWoodMicroService.save_streaming_file-1847"><span class="linenos">1847</span></a><span class="sd">                match.</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1848"><a href="#PumpWoodMicroService.save_streaming_file-1848"><span class="linenos">1848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1849"><a href="#PumpWoodMicroService.save_streaming_file-1849"><span class="linenos">1849</span></a>        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1850"><a href="#PumpWoodMicroService.save_streaming_file-1850"><span class="linenos">1850</span></a>        <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1851"><a href="#PumpWoodMicroService.save_streaming_file-1851"><span class="linenos">1851</span></a>        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1852"><a href="#PumpWoodMicroService.save_streaming_file-1852"><span class="linenos">1852</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1853"><a href="#PumpWoodMicroService.save_streaming_file-1853"><span class="linenos">1853</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1854"><a href="#PumpWoodMicroService.save_streaming_file-1854"><span class="linenos">1854</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1855"><a href="#PumpWoodMicroService.save_streaming_file-1855"><span class="linenos">1855</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1856"><a href="#PumpWoodMicroService.save_streaming_file-1856"><span class="linenos">1856</span></a>        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1857"><a href="#PumpWoodMicroService.save_streaming_file-1857"><span class="linenos">1857</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1858"><a href="#PumpWoodMicroService.save_streaming_file-1858"><span class="linenos">1858</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1859"><a href="#PumpWoodMicroService.save_streaming_file-1859"><span class="linenos">1859</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1860"><a href="#PumpWoodMicroService.save_streaming_file-1860"><span class="linenos">1860</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1861"><a href="#PumpWoodMicroService.save_streaming_file-1861"><span class="linenos">1861</span></a>            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1862"><a href="#PumpWoodMicroService.save_streaming_file-1862"><span class="linenos">1862</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timeout</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1863"><a href="#PumpWoodMicroService.save_streaming_file-1863"><span class="linenos">1863</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1864"><a href="#PumpWoodMicroService.save_streaming_file-1864"><span class="linenos">1864</span></a>        <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1865"><a href="#PumpWoodMicroService.save_streaming_file-1865"><span class="linenos">1865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1866"><a href="#PumpWoodMicroService.save_streaming_file-1866"><span class="linenos">1866</span></a>        <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1867"><a href="#PumpWoodMicroService.save_streaming_file-1867"><span class="linenos">1867</span></a>
</span><span id="PumpWoodMicroService.save_streaming_file-1868"><a href="#PumpWoodMicroService.save_streaming_file-1868"><span class="linenos">1868</span></a>        <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1869"><a href="#PumpWoodMicroService.save_streaming_file-1869"><span class="linenos">1869</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1870"><a href="#PumpWoodMicroService.save_streaming_file-1870"><span class="linenos">1870</span></a>                <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1871"><a href="#PumpWoodMicroService.save_streaming_file-1871"><span class="linenos">1871</span></a>                <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1872"><a href="#PumpWoodMicroService.save_streaming_file-1872"><span class="linenos">1872</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1873"><a href="#PumpWoodMicroService.save_streaming_file-1873"><span class="linenos">1873</span></a>                    <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1874"><a href="#PumpWoodMicroService.save_streaming_file-1874"><span class="linenos">1874</span></a>                        <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.save_streaming_file-1875"><a href="#PumpWoodMicroService.save_streaming_file-1875"><span class="linenos">1875</span></a>        <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Stream file to PumpWood.</p>

<p>Use streaming to transfer a file content to Pumpwood storage, this
end-point is prefered when transmiting files bigger than 10Mb. It
is necessary to have the object created before the file transfer.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the object.</li>
<li><strong>pk:</strong>  pk of the object.</li>
<li><strong>file_field:</strong>  File field that will receive file stream.</li>
<li><strong>file:</strong>  File to upload as a file object with read bytes option.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>file_name:</strong>  Name of the file, if not set it will be saved as
{pk}__{file_field}.{extension at permited extension}</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return the file name associated with data at the storage.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodForbidden:</strong>  'file_field must be set on self.file_fields dictionary'. This
indicates that the <code>file_field</code> passed is not associated
with a file field on the backend.</li>
<li><strong>PumpWoodException:</strong>  'Saved bytes in streaming [{}] differ from file bytes [{}].'.
This indicates that there was an error when transfering data
to storage, the file bytes and transfered bytes does not
match.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.delete" class="classattr">
                                        <input id="PumpWoodMicroService.delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.delete-1881"><a href="#PumpWoodMicroService.delete-1881"><span class="linenos">1881</span></a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.delete-1882"><a href="#PumpWoodMicroService.delete-1882"><span class="linenos">1882</span></a>               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.delete-1883"><a href="#PumpWoodMicroService.delete-1883"><span class="linenos">1883</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="PumpWoodMicroService.delete-1884"><a href="#PumpWoodMicroService.delete-1884"><span class="linenos">1884</span></a>
</span><span id="PumpWoodMicroService.delete-1885"><a href="#PumpWoodMicroService.delete-1885"><span class="linenos">1885</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="PumpWoodMicroService.delete-1886"><a href="#PumpWoodMicroService.delete-1886"><span class="linenos">1886</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="PumpWoodMicroService.delete-1887"><a href="#PumpWoodMicroService.delete-1887"><span class="linenos">1887</span></a>
</span><span id="PumpWoodMicroService.delete-1888"><a href="#PumpWoodMicroService.delete-1888"><span class="linenos">1888</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.delete-1889"><a href="#PumpWoodMicroService.delete-1889"><span class="linenos">1889</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.delete-1890"><a href="#PumpWoodMicroService.delete-1890"><span class="linenos">1890</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService.delete-1891"><a href="#PumpWoodMicroService.delete-1891"><span class="linenos">1891</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.delete-1892"><a href="#PumpWoodMicroService.delete-1892"><span class="linenos">1892</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="PumpWoodMicroService.delete-1893"><a href="#PumpWoodMicroService.delete-1893"><span class="linenos">1893</span></a><span class="sd">                have been implemented). Some model_class with &#39;deleted&#39; field</span>
</span><span id="PumpWoodMicroService.delete-1894"><a href="#PumpWoodMicroService.delete-1894"><span class="linenos">1894</span></a><span class="sd">                does not remove the entry, it will flag deleted=True at this</span>
</span><span id="PumpWoodMicroService.delete-1895"><a href="#PumpWoodMicroService.delete-1895"><span class="linenos">1895</span></a><span class="sd">                cases. Model class with delete=True will be not retrieved</span>
</span><span id="PumpWoodMicroService.delete-1896"><a href="#PumpWoodMicroService.delete-1896"><span class="linenos">1896</span></a><span class="sd">                by default on `list` and `list_without_pag` end-points.</span>
</span><span id="PumpWoodMicroService.delete-1897"><a href="#PumpWoodMicroService.delete-1897"><span class="linenos">1897</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.delete-1898"><a href="#PumpWoodMicroService.delete-1898"><span class="linenos">1898</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.delete-1899"><a href="#PumpWoodMicroService.delete-1899"><span class="linenos">1899</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.delete-1900"><a href="#PumpWoodMicroService.delete-1900"><span class="linenos">1900</span></a>
</span><span id="PumpWoodMicroService.delete-1901"><a href="#PumpWoodMicroService.delete-1901"><span class="linenos">1901</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.delete-1902"><a href="#PumpWoodMicroService.delete-1902"><span class="linenos">1902</span></a><span class="sd">            Returns delete object.</span>
</span><span id="PumpWoodMicroService.delete-1903"><a href="#PumpWoodMicroService.delete-1903"><span class="linenos">1903</span></a>
</span><span id="PumpWoodMicroService.delete-1904"><a href="#PumpWoodMicroService.delete-1904"><span class="linenos">1904</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.delete-1905"><a href="#PumpWoodMicroService.delete-1905"><span class="linenos">1905</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.delete-1906"><a href="#PumpWoodMicroService.delete-1906"><span class="linenos">1906</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39; This</span>
</span><span id="PumpWoodMicroService.delete-1907"><a href="#PumpWoodMicroService.delete-1907"><span class="linenos">1907</span></a><span class="sd">                indicates that the pk was not found in database.</span>
</span><span id="PumpWoodMicroService.delete-1908"><a href="#PumpWoodMicroService.delete-1908"><span class="linenos">1908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.delete-1909"><a href="#PumpWoodMicroService.delete-1909"><span class="linenos">1909</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.delete-1910"><a href="#PumpWoodMicroService.delete-1910"><span class="linenos">1910</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send delete request to a PumpWood object.</p>

<p>Delete (or whatever the PumpWood system have been implemented) the
object with the specified pk.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to delete the object</li>
<li><strong>pk:</strong>  Object pk to be deleted (or whatever the PumpWood system
have been implemented). Some model_class with 'deleted' field
does not remove the entry, it will flag deleted=True at this
cases. Model class with delete=True will be not retrieved
by default on <code><a href="#PumpWoodMicroService.list">list</a></code> and <code><a href="#PumpWoodMicroService.list_without_pag">list_without_pag</a></code> end-points.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Returns delete object.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'Requested object {model_class}[{pk}] not found.' This
indicates that the pk was not found in database.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.remove_file_field" class="classattr">
                                        <input id="PumpWoodMicroService.remove_file_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_file_field</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.remove_file_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.remove_file_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.remove_file_field-1916"><a href="#PumpWoodMicroService.remove_file_field-1916"><span class="linenos">1916</span></a>    <span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.remove_file_field-1917"><a href="#PumpWoodMicroService.remove_file_field-1917"><span class="linenos">1917</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1918"><a href="#PumpWoodMicroService.remove_file_field-1918"><span class="linenos">1918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send delete request to a PumpWood object.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1919"><a href="#PumpWoodMicroService.remove_file_field-1919"><span class="linenos">1919</span></a>
</span><span id="PumpWoodMicroService.remove_file_field-1920"><a href="#PumpWoodMicroService.remove_file_field-1920"><span class="linenos">1920</span></a><span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
</span><span id="PumpWoodMicroService.remove_file_field-1921"><a href="#PumpWoodMicroService.remove_file_field-1921"><span class="linenos">1921</span></a><span class="sd">        object with the specified pk.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1922"><a href="#PumpWoodMicroService.remove_file_field-1922"><span class="linenos">1922</span></a>
</span><span id="PumpWoodMicroService.remove_file_field-1923"><a href="#PumpWoodMicroService.remove_file_field-1923"><span class="linenos">1923</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1924"><a href="#PumpWoodMicroService.remove_file_field-1924"><span class="linenos">1924</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1925"><a href="#PumpWoodMicroService.remove_file_field-1925"><span class="linenos">1925</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService.remove_file_field-1926"><a href="#PumpWoodMicroService.remove_file_field-1926"><span class="linenos">1926</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1927"><a href="#PumpWoodMicroService.remove_file_field-1927"><span class="linenos">1927</span></a><span class="sd">                Object pk to be deleted (or whatever the PumpWood system</span>
</span><span id="PumpWoodMicroService.remove_file_field-1928"><a href="#PumpWoodMicroService.remove_file_field-1928"><span class="linenos">1928</span></a><span class="sd">                have been implemented).</span>
</span><span id="PumpWoodMicroService.remove_file_field-1929"><a href="#PumpWoodMicroService.remove_file_field-1929"><span class="linenos">1929</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1930"><a href="#PumpWoodMicroService.remove_file_field-1930"><span class="linenos">1930</span></a><span class="sd">                File field to be removed from storage.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1931"><a href="#PumpWoodMicroService.remove_file_field-1931"><span class="linenos">1931</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1932"><a href="#PumpWoodMicroService.remove_file_field-1932"><span class="linenos">1932</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.remove_file_field-1933"><a href="#PumpWoodMicroService.remove_file_field-1933"><span class="linenos">1933</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.remove_file_field-1934"><a href="#PumpWoodMicroService.remove_file_field-1934"><span class="linenos">1934</span></a>
</span><span id="PumpWoodMicroService.remove_file_field-1935"><a href="#PumpWoodMicroService.remove_file_field-1935"><span class="linenos">1935</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1936"><a href="#PumpWoodMicroService.remove_file_field-1936"><span class="linenos">1936</span></a><span class="sd">            Return True is file was successful removed</span>
</span><span id="PumpWoodMicroService.remove_file_field-1937"><a href="#PumpWoodMicroService.remove_file_field-1937"><span class="linenos">1937</span></a>
</span><span id="PumpWoodMicroService.remove_file_field-1938"><a href="#PumpWoodMicroService.remove_file_field-1938"><span class="linenos">1938</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1939"><a href="#PumpWoodMicroService.remove_file_field-1939"><span class="linenos">1939</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1940"><a href="#PumpWoodMicroService.remove_file_field-1940"><span class="linenos">1940</span></a><span class="sd">                &#39;storage_object attribute not set for view, file operations</span>
</span><span id="PumpWoodMicroService.remove_file_field-1941"><a href="#PumpWoodMicroService.remove_file_field-1941"><span class="linenos">1941</span></a><span class="sd">                are disable&#39;. This indicates that storage_object is not</span>
</span><span id="PumpWoodMicroService.remove_file_field-1942"><a href="#PumpWoodMicroService.remove_file_field-1942"><span class="linenos">1942</span></a><span class="sd">                associated with view, not allowing it to make storage</span>
</span><span id="PumpWoodMicroService.remove_file_field-1943"><a href="#PumpWoodMicroService.remove_file_field-1943"><span class="linenos">1943</span></a><span class="sd">                operations.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1944"><a href="#PumpWoodMicroService.remove_file_field-1944"><span class="linenos">1944</span></a><span class="sd">            PumpWoodForbidden:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1945"><a href="#PumpWoodMicroService.remove_file_field-1945"><span class="linenos">1945</span></a><span class="sd">                &#39;file_field must be set on self.file_fields dictionary.&#39;.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1946"><a href="#PumpWoodMicroService.remove_file_field-1946"><span class="linenos">1946</span></a><span class="sd">                This indicates that the `file_field` was not set as a file</span>
</span><span id="PumpWoodMicroService.remove_file_field-1947"><a href="#PumpWoodMicroService.remove_file_field-1947"><span class="linenos">1947</span></a><span class="sd">                field on the backend.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1948"><a href="#PumpWoodMicroService.remove_file_field-1948"><span class="linenos">1948</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.remove_file_field-1949"><a href="#PumpWoodMicroService.remove_file_field-1949"><span class="linenos">1949</span></a><span class="sd">                &#39;File does not exist. File field [{}] is set as None&#39;.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1950"><a href="#PumpWoodMicroService.remove_file_field-1950"><span class="linenos">1950</span></a><span class="sd">                This indicates that the object does not exists on storage,</span>
</span><span id="PumpWoodMicroService.remove_file_field-1951"><a href="#PumpWoodMicroService.remove_file_field-1951"><span class="linenos">1951</span></a><span class="sd">                it should not occur. It might have been some manual update</span>
</span><span id="PumpWoodMicroService.remove_file_field-1952"><a href="#PumpWoodMicroService.remove_file_field-1952"><span class="linenos">1952</span></a><span class="sd">                of the database or at the storage level.</span>
</span><span id="PumpWoodMicroService.remove_file_field-1953"><a href="#PumpWoodMicroService.remove_file_field-1953"><span class="linenos">1953</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.remove_file_field-1954"><a href="#PumpWoodMicroService.remove_file_field-1954"><span class="linenos">1954</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.remove_file_field-1955"><a href="#PumpWoodMicroService.remove_file_field-1955"><span class="linenos">1955</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.remove_file_field-1956"><a href="#PumpWoodMicroService.remove_file_field-1956"><span class="linenos">1956</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.remove_file_field-1957"><a href="#PumpWoodMicroService.remove_file_field-1957"><span class="linenos">1957</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>Send delete request to a PumpWood object.</p>

<p>Delete (or whatever the PumpWood system have been implemented) the
object with the specified pk.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to delete the object</li>
<li><strong>pk:</strong>  Object pk to be deleted (or whatever the PumpWood system
have been implemented).</li>
<li><strong>file_field:</strong>  File field to be removed from storage.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return True is file was successful removed</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodForbidden:</strong>  'storage_object attribute not set for view, file operations
are disable'. This indicates that storage_object is not
associated with view, not allowing it to make storage
operations.</li>
<li><strong>PumpWoodForbidden:</strong>  'file_field must be set on self.file_fields dictionary.'.
This indicates that the <code>file_field</code> was not set as a file
field on the backend.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'File does not exist. File field [{}] is set as None'.
This indicates that the object does not exists on storage,
it should not occur. It might have been some manual update
of the database or at the storage level.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.delete_many" class="classattr">
                                        <input id="PumpWoodMicroService.delete_many-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_many</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.delete_many-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.delete_many"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.delete_many-1963"><a href="#PumpWoodMicroService.delete_many-1963"><span class="linenos">1963</span></a>    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.delete_many-1964"><a href="#PumpWoodMicroService.delete_many-1964"><span class="linenos">1964</span></a>                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.delete_many-1965"><a href="#PumpWoodMicroService.delete_many-1965"><span class="linenos">1965</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove many objects using query to retrict removal.</span>
</span><span id="PumpWoodMicroService.delete_many-1966"><a href="#PumpWoodMicroService.delete_many-1966"><span class="linenos">1966</span></a>
</span><span id="PumpWoodMicroService.delete_many-1967"><a href="#PumpWoodMicroService.delete_many-1967"><span class="linenos">1967</span></a><span class="sd">        CAUTION It is not possible to undo this operation, model_class</span>
</span><span id="PumpWoodMicroService.delete_many-1968"><a href="#PumpWoodMicroService.delete_many-1968"><span class="linenos">1968</span></a><span class="sd">        this deleted field will be removed from database when using this</span>
</span><span id="PumpWoodMicroService.delete_many-1969"><a href="#PumpWoodMicroService.delete_many-1969"><span class="linenos">1969</span></a><span class="sd">        end-point, different from using delete end-point.</span>
</span><span id="PumpWoodMicroService.delete_many-1970"><a href="#PumpWoodMicroService.delete_many-1970"><span class="linenos">1970</span></a>
</span><span id="PumpWoodMicroService.delete_many-1971"><a href="#PumpWoodMicroService.delete_many-1971"><span class="linenos">1971</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.delete_many-1972"><a href="#PumpWoodMicroService.delete_many-1972"><span class="linenos">1972</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.delete_many-1973"><a href="#PumpWoodMicroService.delete_many-1973"><span class="linenos">1973</span></a><span class="sd">                Model class to delete the object</span>
</span><span id="PumpWoodMicroService.delete_many-1974"><a href="#PumpWoodMicroService.delete_many-1974"><span class="linenos">1974</span></a><span class="sd">            filter_dict:</span>
</span><span id="PumpWoodMicroService.delete_many-1975"><a href="#PumpWoodMicroService.delete_many-1975"><span class="linenos">1975</span></a><span class="sd">                Dictionary to make filter query.</span>
</span><span id="PumpWoodMicroService.delete_many-1976"><a href="#PumpWoodMicroService.delete_many-1976"><span class="linenos">1976</span></a><span class="sd">            exclude_dict:</span>
</span><span id="PumpWoodMicroService.delete_many-1977"><a href="#PumpWoodMicroService.delete_many-1977"><span class="linenos">1977</span></a><span class="sd">                Dictionary to make exclude query.</span>
</span><span id="PumpWoodMicroService.delete_many-1978"><a href="#PumpWoodMicroService.delete_many-1978"><span class="linenos">1978</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.delete_many-1979"><a href="#PumpWoodMicroService.delete_many-1979"><span class="linenos">1979</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.delete_many-1980"><a href="#PumpWoodMicroService.delete_many-1980"><span class="linenos">1980</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.delete_many-1981"><a href="#PumpWoodMicroService.delete_many-1981"><span class="linenos">1981</span></a>
</span><span id="PumpWoodMicroService.delete_many-1982"><a href="#PumpWoodMicroService.delete_many-1982"><span class="linenos">1982</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.delete_many-1983"><a href="#PumpWoodMicroService.delete_many-1983"><span class="linenos">1983</span></a><span class="sd">            True if delete is ok.</span>
</span><span id="PumpWoodMicroService.delete_many-1984"><a href="#PumpWoodMicroService.delete_many-1984"><span class="linenos">1984</span></a>
</span><span id="PumpWoodMicroService.delete_many-1985"><a href="#PumpWoodMicroService.delete_many-1985"><span class="linenos">1985</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.delete_many-1986"><a href="#PumpWoodMicroService.delete_many-1986"><span class="linenos">1986</span></a><span class="sd">            PumpWoodObjectDeleteException:</span>
</span><span id="PumpWoodMicroService.delete_many-1987"><a href="#PumpWoodMicroService.delete_many-1987"><span class="linenos">1987</span></a><span class="sd">                Raises error if there is any error when commiting object</span>
</span><span id="PumpWoodMicroService.delete_many-1988"><a href="#PumpWoodMicroService.delete_many-1988"><span class="linenos">1988</span></a><span class="sd">                deletion on database.</span>
</span><span id="PumpWoodMicroService.delete_many-1989"><a href="#PumpWoodMicroService.delete_many-1989"><span class="linenos">1989</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.delete_many-1990"><a href="#PumpWoodMicroService.delete_many-1990"><span class="linenos">1990</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.delete_many-1991"><a href="#PumpWoodMicroService.delete_many-1991"><span class="linenos">1991</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.delete_many-1992"><a href="#PumpWoodMicroService.delete_many-1992"><span class="linenos">1992</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.delete_many-1993"><a href="#PumpWoodMicroService.delete_many-1993"><span class="linenos">1993</span></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.delete_many-1994"><a href="#PumpWoodMicroService.delete_many-1994"><span class="linenos">1994</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove many objects using query to retrict removal.</p>

<p>CAUTION It is not possible to undo this operation, model_class
this deleted field will be removed from database when using this
end-point, different from using delete end-point.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to delete the object</li>
<li><strong>filter_dict:</strong>  Dictionary to make filter query.</li>
<li><strong>exclude_dict:</strong>  Dictionary to make exclude query.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>True if delete is ok.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodObjectDeleteException:</strong>  Raises error if there is any error when commiting object
deletion on database.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_actions" class="classattr">
                                        <input id="PumpWoodMicroService.list_actions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_actions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_actions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_actions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_actions-1996"><a href="#PumpWoodMicroService.list_actions-1996"><span class="linenos">1996</span></a>    <span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.list_actions-1997"><a href="#PumpWoodMicroService.list_actions-1997"><span class="linenos">1997</span></a>                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.list_actions-1998"><a href="#PumpWoodMicroService.list_actions-1998"><span class="linenos">1998</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all actions avaiable at this model class.</span>
</span><span id="PumpWoodMicroService.list_actions-1999"><a href="#PumpWoodMicroService.list_actions-1999"><span class="linenos">1999</span></a>
</span><span id="PumpWoodMicroService.list_actions-2000"><a href="#PumpWoodMicroService.list_actions-2000"><span class="linenos">2000</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_actions-2001"><a href="#PumpWoodMicroService.list_actions-2001"><span class="linenos">2001</span></a><span class="sd">          model_class:</span>
</span><span id="PumpWoodMicroService.list_actions-2002"><a href="#PumpWoodMicroService.list_actions-2002"><span class="linenos">2002</span></a><span class="sd">              Model class to list possible actions.</span>
</span><span id="PumpWoodMicroService.list_actions-2003"><a href="#PumpWoodMicroService.list_actions-2003"><span class="linenos">2003</span></a><span class="sd">          auth_header:</span>
</span><span id="PumpWoodMicroService.list_actions-2004"><a href="#PumpWoodMicroService.list_actions-2004"><span class="linenos">2004</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_actions-2005"><a href="#PumpWoodMicroService.list_actions-2005"><span class="linenos">2005</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_actions-2006"><a href="#PumpWoodMicroService.list_actions-2006"><span class="linenos">2006</span></a>
</span><span id="PumpWoodMicroService.list_actions-2007"><a href="#PumpWoodMicroService.list_actions-2007"><span class="linenos">2007</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_actions-2008"><a href="#PumpWoodMicroService.list_actions-2008"><span class="linenos">2008</span></a><span class="sd">          List of possible actions and its descriptions.</span>
</span><span id="PumpWoodMicroService.list_actions-2009"><a href="#PumpWoodMicroService.list_actions-2009"><span class="linenos">2009</span></a>
</span><span id="PumpWoodMicroService.list_actions-2010"><a href="#PumpWoodMicroService.list_actions-2010"><span class="linenos">2010</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_actions-2011"><a href="#PumpWoodMicroService.list_actions-2011"><span class="linenos">2011</span></a><span class="sd">            No particular errors.</span>
</span><span id="PumpWoodMicroService.list_actions-2012"><a href="#PumpWoodMicroService.list_actions-2012"><span class="linenos">2012</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_actions-2013"><a href="#PumpWoodMicroService.list_actions-2013"><span class="linenos">2013</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.list_actions-2014"><a href="#PumpWoodMicroService.list_actions-2014"><span class="linenos">2014</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a list of all actions avaiable at this model class.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to list possible actions.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of possible actions and its descriptions.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular errors.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.execute_action" class="classattr">
                                        <input id="PumpWoodMicroService.execute_action-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">execute_action</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">action</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">files</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.execute_action-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.execute_action"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.execute_action-2024"><a href="#PumpWoodMicroService.execute_action-2024"><span class="linenos">2024</span></a>    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.execute_action-2025"><a href="#PumpWoodMicroService.execute_action-2025"><span class="linenos">2025</span></a>                       <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.execute_action-2026"><a href="#PumpWoodMicroService.execute_action-2026"><span class="linenos">2026</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.execute_action-2027"><a href="#PumpWoodMicroService.execute_action-2027"><span class="linenos">2027</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute action associated with a model class.</span>
</span><span id="PumpWoodMicroService.execute_action-2028"><a href="#PumpWoodMicroService.execute_action-2028"><span class="linenos">2028</span></a>
</span><span id="PumpWoodMicroService.execute_action-2029"><a href="#PumpWoodMicroService.execute_action-2029"><span class="linenos">2029</span></a><span class="sd">        If action is static or classfunction no pk is necessary.</span>
</span><span id="PumpWoodMicroService.execute_action-2030"><a href="#PumpWoodMicroService.execute_action-2030"><span class="linenos">2030</span></a>
</span><span id="PumpWoodMicroService.execute_action-2031"><a href="#PumpWoodMicroService.execute_action-2031"><span class="linenos">2031</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.execute_action-2032"><a href="#PumpWoodMicroService.execute_action-2032"><span class="linenos">2032</span></a><span class="sd">            pk (int):</span>
</span><span id="PumpWoodMicroService.execute_action-2033"><a href="#PumpWoodMicroService.execute_action-2033"><span class="linenos">2033</span></a><span class="sd">                PK of the object to run action at. If not set action will be</span>
</span><span id="PumpWoodMicroService.execute_action-2034"><a href="#PumpWoodMicroService.execute_action-2034"><span class="linenos">2034</span></a><span class="sd">                considered a classmethod and will run over the class.</span>
</span><span id="PumpWoodMicroService.execute_action-2035"><a href="#PumpWoodMicroService.execute_action-2035"><span class="linenos">2035</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.execute_action-2036"><a href="#PumpWoodMicroService.execute_action-2036"><span class="linenos">2036</span></a><span class="sd">                Model class to run action the object</span>
</span><span id="PumpWoodMicroService.execute_action-2037"><a href="#PumpWoodMicroService.execute_action-2037"><span class="linenos">2037</span></a><span class="sd">            action:</span>
</span><span id="PumpWoodMicroService.execute_action-2038"><a href="#PumpWoodMicroService.execute_action-2038"><span class="linenos">2038</span></a><span class="sd">                Action that will be performed.</span>
</span><span id="PumpWoodMicroService.execute_action-2039"><a href="#PumpWoodMicroService.execute_action-2039"><span class="linenos">2039</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.execute_action-2040"><a href="#PumpWoodMicroService.execute_action-2040"><span class="linenos">2040</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.execute_action-2041"><a href="#PumpWoodMicroService.execute_action-2041"><span class="linenos">2041</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.execute_action-2042"><a href="#PumpWoodMicroService.execute_action-2042"><span class="linenos">2042</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.execute_action-2043"><a href="#PumpWoodMicroService.execute_action-2043"><span class="linenos">2043</span></a><span class="sd">                Dictionary with the function parameters.</span>
</span><span id="PumpWoodMicroService.execute_action-2044"><a href="#PumpWoodMicroService.execute_action-2044"><span class="linenos">2044</span></a><span class="sd">            files:</span>
</span><span id="PumpWoodMicroService.execute_action-2045"><a href="#PumpWoodMicroService.execute_action-2045"><span class="linenos">2045</span></a><span class="sd">                A dictionary of files to be added to as a multi-part</span>
</span><span id="PumpWoodMicroService.execute_action-2046"><a href="#PumpWoodMicroService.execute_action-2046"><span class="linenos">2046</span></a><span class="sd">                post request. File must be passed as a file object with read</span>
</span><span id="PumpWoodMicroService.execute_action-2047"><a href="#PumpWoodMicroService.execute_action-2047"><span class="linenos">2047</span></a><span class="sd">                bytes.</span>
</span><span id="PumpWoodMicroService.execute_action-2048"><a href="#PumpWoodMicroService.execute_action-2048"><span class="linenos">2048</span></a>
</span><span id="PumpWoodMicroService.execute_action-2049"><a href="#PumpWoodMicroService.execute_action-2049"><span class="linenos">2049</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.execute_action-2050"><a href="#PumpWoodMicroService.execute_action-2050"><span class="linenos">2050</span></a><span class="sd">            Return a dictonary with keys:</span>
</span><span id="PumpWoodMicroService.execute_action-2051"><a href="#PumpWoodMicroService.execute_action-2051"><span class="linenos">2051</span></a><span class="sd">            - **result:**: Result of the action that was performed.</span>
</span><span id="PumpWoodMicroService.execute_action-2052"><a href="#PumpWoodMicroService.execute_action-2052"><span class="linenos">2052</span></a><span class="sd">            - **action:**: Information of the action that was performed.</span>
</span><span id="PumpWoodMicroService.execute_action-2053"><a href="#PumpWoodMicroService.execute_action-2053"><span class="linenos">2053</span></a><span class="sd">            - **parameters:** Parameters that were passed to perform the</span>
</span><span id="PumpWoodMicroService.execute_action-2054"><a href="#PumpWoodMicroService.execute_action-2054"><span class="linenos">2054</span></a><span class="sd">                action.</span>
</span><span id="PumpWoodMicroService.execute_action-2055"><a href="#PumpWoodMicroService.execute_action-2055"><span class="linenos">2055</span></a><span class="sd">            - **object:** If a pk was passed to execute and action (not</span>
</span><span id="PumpWoodMicroService.execute_action-2056"><a href="#PumpWoodMicroService.execute_action-2056"><span class="linenos">2056</span></a><span class="sd">                classmethod or staticmethod), the object with the correspondent</span>
</span><span id="PumpWoodMicroService.execute_action-2057"><a href="#PumpWoodMicroService.execute_action-2057"><span class="linenos">2057</span></a><span class="sd">                pk is returned.</span>
</span><span id="PumpWoodMicroService.execute_action-2058"><a href="#PumpWoodMicroService.execute_action-2058"><span class="linenos">2058</span></a>
</span><span id="PumpWoodMicroService.execute_action-2059"><a href="#PumpWoodMicroService.execute_action-2059"><span class="linenos">2059</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.execute_action-2060"><a href="#PumpWoodMicroService.execute_action-2060"><span class="linenos">2060</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.execute_action-2061"><a href="#PumpWoodMicroService.execute_action-2061"><span class="linenos">2061</span></a><span class="sd">                &#39;There is no method {action} in rest actions for {class_name}&#39;.</span>
</span><span id="PumpWoodMicroService.execute_action-2062"><a href="#PumpWoodMicroService.execute_action-2062"><span class="linenos">2062</span></a><span class="sd">                This indicates that action requested is not associated with</span>
</span><span id="PumpWoodMicroService.execute_action-2063"><a href="#PumpWoodMicroService.execute_action-2063"><span class="linenos">2063</span></a><span class="sd">                the model_class.</span>
</span><span id="PumpWoodMicroService.execute_action-2064"><a href="#PumpWoodMicroService.execute_action-2064"><span class="linenos">2064</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="PumpWoodMicroService.execute_action-2065"><a href="#PumpWoodMicroService.execute_action-2065"><span class="linenos">2065</span></a><span class="sd">                &#39;Function is not static and pk is Null&#39;. This indicate that</span>
</span><span id="PumpWoodMicroService.execute_action-2066"><a href="#PumpWoodMicroService.execute_action-2066"><span class="linenos">2066</span></a><span class="sd">                the action solicitated is not static/class method and a pk</span>
</span><span id="PumpWoodMicroService.execute_action-2067"><a href="#PumpWoodMicroService.execute_action-2067"><span class="linenos">2067</span></a><span class="sd">                was not passed as argument.</span>
</span><span id="PumpWoodMicroService.execute_action-2068"><a href="#PumpWoodMicroService.execute_action-2068"><span class="linenos">2068</span></a><span class="sd">            PumpWoodActionArgsException:</span>
</span><span id="PumpWoodMicroService.execute_action-2069"><a href="#PumpWoodMicroService.execute_action-2069"><span class="linenos">2069</span></a><span class="sd">                &#39;Function is static and pk is not Null&#39;. This indicate that</span>
</span><span id="PumpWoodMicroService.execute_action-2070"><a href="#PumpWoodMicroService.execute_action-2070"><span class="linenos">2070</span></a><span class="sd">                the action solicitated is static/class method and a pk</span>
</span><span id="PumpWoodMicroService.execute_action-2071"><a href="#PumpWoodMicroService.execute_action-2071"><span class="linenos">2071</span></a><span class="sd">                was passed as argument.</span>
</span><span id="PumpWoodMicroService.execute_action-2072"><a href="#PumpWoodMicroService.execute_action-2072"><span class="linenos">2072</span></a><span class="sd">            PumpWoodObjectDoesNotExist:</span>
</span><span id="PumpWoodMicroService.execute_action-2073"><a href="#PumpWoodMicroService.execute_action-2073"><span class="linenos">2073</span></a><span class="sd">                &#39;Requested object {model_class}[{pk}] not found.&#39;. This</span>
</span><span id="PumpWoodMicroService.execute_action-2074"><a href="#PumpWoodMicroService.execute_action-2074"><span class="linenos">2074</span></a><span class="sd">                indicate that pk associated with model class was not found</span>
</span><span id="PumpWoodMicroService.execute_action-2075"><a href="#PumpWoodMicroService.execute_action-2075"><span class="linenos">2075</span></a><span class="sd">                on database.</span>
</span><span id="PumpWoodMicroService.execute_action-2076"><a href="#PumpWoodMicroService.execute_action-2076"><span class="linenos">2076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.execute_action-2077"><a href="#PumpWoodMicroService.execute_action-2077"><span class="linenos">2077</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.execute_action-2078"><a href="#PumpWoodMicroService.execute_action-2078"><span class="linenos">2078</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.execute_action-2079"><a href="#PumpWoodMicroService.execute_action-2079"><span class="linenos">2079</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.execute_action-2080"><a href="#PumpWoodMicroService.execute_action-2080"><span class="linenos">2080</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.execute_action-2081"><a href="#PumpWoodMicroService.execute_action-2081"><span class="linenos">2081</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Execute action associated with a model class.</p>

<p>If action is static or classfunction no pk is necessary.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>pk (int):</strong>  PK of the object to run action at. If not set action will be
considered a classmethod and will run over the class.</li>
<li><strong>model_class:</strong>  Model class to run action the object</li>
<li><strong>action:</strong>  Action that will be performed.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>parameters:</strong>  Dictionary with the function parameters.</li>
<li><strong>files:</strong>  A dictionary of files to be added to as a multi-part
post request. File must be passed as a file object with read
bytes.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictonary with keys:</p>
  
  <ul>
  <li><strong>result:</strong>: Result of the action that was performed.</li>
  <li><strong>action:</strong>: Information of the action that was performed.</li>
  <li><strong>parameters:</strong> Parameters that were passed to perform the
  action.</li>
  <li><strong>object:</strong> If a pk was passed to execute and action (not
  classmethod or staticmethod), the object with the correspondent
  pk is returned.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'There is no method {action} in rest actions for {class_name}'.
This indicates that action requested is not associated with
the model_class.</li>
<li><strong>PumpWoodActionArgsException:</strong>  'Function is not static and pk is Null'. This indicate that
the action solicitated is not static/class method and a pk
was not passed as argument.</li>
<li><strong>PumpWoodActionArgsException:</strong>  'Function is static and pk is not Null'. This indicate that
the action solicitated is static/class method and a pk
was passed as argument.</li>
<li><strong>PumpWoodObjectDoesNotExist:</strong>  'Requested object {model_class}[{pk}] not found.'. This
indicate that pk associated with model class was not found
on database.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.search_options" class="classattr">
                                        <input id="PumpWoodMicroService.search_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.search_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.search_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.search_options-2083"><a href="#PumpWoodMicroService.search_options-2083"><span class="linenos">2083</span></a>    <span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.search_options-2084"><a href="#PumpWoodMicroService.search_options-2084"><span class="linenos">2084</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.search_options-2085"><a href="#PumpWoodMicroService.search_options-2085"><span class="linenos">2085</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return search options.</span>
</span><span id="PumpWoodMicroService.search_options-2086"><a href="#PumpWoodMicroService.search_options-2086"><span class="linenos">2086</span></a>
</span><span id="PumpWoodMicroService.search_options-2087"><a href="#PumpWoodMicroService.search_options-2087"><span class="linenos">2087</span></a><span class="sd">        DEPRECTED Use `list_options` function instead.</span>
</span><span id="PumpWoodMicroService.search_options-2088"><a href="#PumpWoodMicroService.search_options-2088"><span class="linenos">2088</span></a>
</span><span id="PumpWoodMicroService.search_options-2089"><a href="#PumpWoodMicroService.search_options-2089"><span class="linenos">2089</span></a><span class="sd">        Return information of the fields including avaiable options for</span>
</span><span id="PumpWoodMicroService.search_options-2090"><a href="#PumpWoodMicroService.search_options-2090"><span class="linenos">2090</span></a><span class="sd">        options fields and model associated with the foreign key.</span>
</span><span id="PumpWoodMicroService.search_options-2091"><a href="#PumpWoodMicroService.search_options-2091"><span class="linenos">2091</span></a>
</span><span id="PumpWoodMicroService.search_options-2092"><a href="#PumpWoodMicroService.search_options-2092"><span class="linenos">2092</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.search_options-2093"><a href="#PumpWoodMicroService.search_options-2093"><span class="linenos">2093</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.search_options-2094"><a href="#PumpWoodMicroService.search_options-2094"><span class="linenos">2094</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="PumpWoodMicroService.search_options-2095"><a href="#PumpWoodMicroService.search_options-2095"><span class="linenos">2095</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.search_options-2096"><a href="#PumpWoodMicroService.search_options-2096"><span class="linenos">2096</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.search_options-2097"><a href="#PumpWoodMicroService.search_options-2097"><span class="linenos">2097</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.search_options-2098"><a href="#PumpWoodMicroService.search_options-2098"><span class="linenos">2098</span></a>
</span><span id="PumpWoodMicroService.search_options-2099"><a href="#PumpWoodMicroService.search_options-2099"><span class="linenos">2099</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.search_options-2100"><a href="#PumpWoodMicroService.search_options-2100"><span class="linenos">2100</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="PumpWoodMicroService.search_options-2101"><a href="#PumpWoodMicroService.search_options-2101"><span class="linenos">2101</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="PumpWoodMicroService.search_options-2102"><a href="#PumpWoodMicroService.search_options-2102"><span class="linenos">2102</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="PumpWoodMicroService.search_options-2103"><a href="#PumpWoodMicroService.search_options-2103"><span class="linenos">2103</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="PumpWoodMicroService.search_options-2104"><a href="#PumpWoodMicroService.search_options-2104"><span class="linenos">2104</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="PumpWoodMicroService.search_options-2105"><a href="#PumpWoodMicroService.search_options-2105"><span class="linenos">2105</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="PumpWoodMicroService.search_options-2106"><a href="#PumpWoodMicroService.search_options-2106"><span class="linenos">2106</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService.search_options-2107"><a href="#PumpWoodMicroService.search_options-2107"><span class="linenos">2107</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="PumpWoodMicroService.search_options-2108"><a href="#PumpWoodMicroService.search_options-2108"><span class="linenos">2108</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="PumpWoodMicroService.search_options-2109"><a href="#PumpWoodMicroService.search_options-2109"><span class="linenos">2109</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService.search_options-2110"><a href="#PumpWoodMicroService.search_options-2110"><span class="linenos">2110</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="PumpWoodMicroService.search_options-2111"><a href="#PumpWoodMicroService.search_options-2111"><span class="linenos">2111</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="PumpWoodMicroService.search_options-2112"><a href="#PumpWoodMicroService.search_options-2112"><span class="linenos">2112</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="PumpWoodMicroService.search_options-2113"><a href="#PumpWoodMicroService.search_options-2113"><span class="linenos">2113</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="PumpWoodMicroService.search_options-2114"><a href="#PumpWoodMicroService.search_options-2114"><span class="linenos">2114</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="PumpWoodMicroService.search_options-2115"><a href="#PumpWoodMicroService.search_options-2115"><span class="linenos">2115</span></a><span class="sd">                save end-poin.</span>
</span><span id="PumpWoodMicroService.search_options-2116"><a href="#PumpWoodMicroService.search_options-2116"><span class="linenos">2116</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="PumpWoodMicroService.search_options-2117"><a href="#PumpWoodMicroService.search_options-2117"><span class="linenos">2117</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="PumpWoodMicroService.search_options-2118"><a href="#PumpWoodMicroService.search_options-2118"><span class="linenos">2118</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="PumpWoodMicroService.search_options-2119"><a href="#PumpWoodMicroService.search_options-2119"><span class="linenos">2119</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="PumpWoodMicroService.search_options-2120"><a href="#PumpWoodMicroService.search_options-2120"><span class="linenos">2120</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="PumpWoodMicroService.search_options-2121"><a href="#PumpWoodMicroService.search_options-2121"><span class="linenos">2121</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="PumpWoodMicroService.search_options-2122"><a href="#PumpWoodMicroService.search_options-2122"><span class="linenos">2122</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="PumpWoodMicroService.search_options-2123"><a href="#PumpWoodMicroService.search_options-2123"><span class="linenos">2123</span></a><span class="sd">                as values.</span>
</span><span id="PumpWoodMicroService.search_options-2124"><a href="#PumpWoodMicroService.search_options-2124"><span class="linenos">2124</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="PumpWoodMicroService.search_options-2125"><a href="#PumpWoodMicroService.search_options-2125"><span class="linenos">2125</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="PumpWoodMicroService.search_options-2126"><a href="#PumpWoodMicroService.search_options-2126"><span class="linenos">2126</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="PumpWoodMicroService.search_options-2127"><a href="#PumpWoodMicroService.search_options-2127"><span class="linenos">2127</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="PumpWoodMicroService.search_options-2128"><a href="#PumpWoodMicroService.search_options-2128"><span class="linenos">2128</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="PumpWoodMicroService.search_options-2129"><a href="#PumpWoodMicroService.search_options-2129"><span class="linenos">2129</span></a>
</span><span id="PumpWoodMicroService.search_options-2130"><a href="#PumpWoodMicroService.search_options-2130"><span class="linenos">2130</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.search_options-2131"><a href="#PumpWoodMicroService.search_options-2131"><span class="linenos">2131</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.search_options-2132"><a href="#PumpWoodMicroService.search_options-2132"><span class="linenos">2132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.search_options-2133"><a href="#PumpWoodMicroService.search_options-2133"><span class="linenos">2133</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService.search_options-2134"><a href="#PumpWoodMicroService.search_options-2134"><span class="linenos">2134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return search options.</p>

<p>DEPRECTED Use <code><a href="#PumpWoodMicroService.list_options">list_options</a></code> function instead.</p>

<p>Return information of the fields including avaiable options for
options fields and model associated with the foreign key.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to check search parameters</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictonary with field names as keys and information of
  them as values. Information at values:</p>
  
  <ul>
  <li><strong>primary_key [bool]:</strong>: Boolean indicating if field is part
  of model_class primary key.</li>
  <li><strong>column [str]:</strong>: Name of the column.</li>
  <li><strong>column__verbose [str]:</strong> Name of the column translated using
  Pumpwood I8s.</li>
  <li><strong>help_text [str]:</strong> Help text associated with column.</li>
  <li><strong>help_text__verbose [str]:</strong> Help text associated with column
  translated using Pumpwood I8s.</li>
  <li><strong>type [str]:</strong> Python type associated with the column.</li>
  <li><strong>nullable [bool]:</strong> If field can be set as null (None).</li>
  <li><strong>read_only [bool]:</strong> If field is marked as read-only. Passsing
  information for this field will not be used in save end-point.</li>
  <li><strong>default [any]:</strong> Default value of the field if not set using
  save end-poin.</li>
  <li><strong>unique [bool]:</strong> If the there is a constrain in database
  setting this field to be unique.</li>
  <li><strong>extra_info:</strong> Some extra infomations used to pass associated
  model class for forenging key and related fields.</li>
  <li><strong>in [dict]:</strong> At options fields, have their options listed in
  <code>in</code> keys. It will return the values as key and de description
  and description__verbose (translated by Pumpwood I8s)
  as values.</li>
  <li><strong>partition:</strong> At pk field, this key indicates if the database
  if partitioned. Partitioned will perform better in queries if
  partition is used on filter or exclude clauses. If table has
  more than one level o partition, at least the first one must
  be used when retrieving data.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.fill_options" class="classattr">
                                        <input id="PumpWoodMicroService.fill_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fill_options</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span>,</span><span class="param">	<span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.fill_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.fill_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.fill_options-2136"><a href="#PumpWoodMicroService.fill_options-2136"><span class="linenos">2136</span></a>    <span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.fill_options-2137"><a href="#PumpWoodMicroService.fill_options-2137"><span class="linenos">2137</span></a>                     <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.fill_options-2138"><a href="#PumpWoodMicroService.fill_options-2138"><span class="linenos">2138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="PumpWoodMicroService.fill_options-2139"><a href="#PumpWoodMicroService.fill_options-2139"><span class="linenos">2139</span></a>
</span><span id="PumpWoodMicroService.fill_options-2140"><a href="#PumpWoodMicroService.fill_options-2140"><span class="linenos">2140</span></a><span class="sd">        DEPRECTED Use `fill_validation` function instead.</span>
</span><span id="PumpWoodMicroService.fill_options-2141"><a href="#PumpWoodMicroService.fill_options-2141"><span class="linenos">2141</span></a>
</span><span id="PumpWoodMicroService.fill_options-2142"><a href="#PumpWoodMicroService.fill_options-2142"><span class="linenos">2142</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService.fill_options-2143"><a href="#PumpWoodMicroService.fill_options-2143"><span class="linenos">2143</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService.fill_options-2144"><a href="#PumpWoodMicroService.fill_options-2144"><span class="linenos">2144</span></a>
</span><span id="PumpWoodMicroService.fill_options-2145"><a href="#PumpWoodMicroService.fill_options-2145"><span class="linenos">2145</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.fill_options-2146"><a href="#PumpWoodMicroService.fill_options-2146"><span class="linenos">2146</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.fill_options-2147"><a href="#PumpWoodMicroService.fill_options-2147"><span class="linenos">2147</span></a><span class="sd">                Model class to check search parameters</span>
</span><span id="PumpWoodMicroService.fill_options-2148"><a href="#PumpWoodMicroService.fill_options-2148"><span class="linenos">2148</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.fill_options-2149"><a href="#PumpWoodMicroService.fill_options-2149"><span class="linenos">2149</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.fill_options-2150"><a href="#PumpWoodMicroService.fill_options-2150"><span class="linenos">2150</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.fill_options-2151"><a href="#PumpWoodMicroService.fill_options-2151"><span class="linenos">2151</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="PumpWoodMicroService.fill_options-2152"><a href="#PumpWoodMicroService.fill_options-2152"><span class="linenos">2152</span></a><span class="sd">                Partial object that is sent to backend for validation and</span>
</span><span id="PumpWoodMicroService.fill_options-2153"><a href="#PumpWoodMicroService.fill_options-2153"><span class="linenos">2153</span></a><span class="sd">                update fill options acording to values passed for each field.</span>
</span><span id="PumpWoodMicroService.fill_options-2154"><a href="#PumpWoodMicroService.fill_options-2154"><span class="linenos">2154</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService.fill_options-2155"><a href="#PumpWoodMicroService.fill_options-2155"><span class="linenos">2155</span></a><span class="sd">                Retrict validation for an especific field if implemented.</span>
</span><span id="PumpWoodMicroService.fill_options-2156"><a href="#PumpWoodMicroService.fill_options-2156"><span class="linenos">2156</span></a>
</span><span id="PumpWoodMicroService.fill_options-2157"><a href="#PumpWoodMicroService.fill_options-2157"><span class="linenos">2157</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.fill_options-2158"><a href="#PumpWoodMicroService.fill_options-2158"><span class="linenos">2158</span></a><span class="sd">            Return a dictonary with field names as keys and information of</span>
</span><span id="PumpWoodMicroService.fill_options-2159"><a href="#PumpWoodMicroService.fill_options-2159"><span class="linenos">2159</span></a><span class="sd">            them as values. Information at values:</span>
</span><span id="PumpWoodMicroService.fill_options-2160"><a href="#PumpWoodMicroService.fill_options-2160"><span class="linenos">2160</span></a><span class="sd">            - **primary_key [bool]:**: Boolean indicating if field is part</span>
</span><span id="PumpWoodMicroService.fill_options-2161"><a href="#PumpWoodMicroService.fill_options-2161"><span class="linenos">2161</span></a><span class="sd">                of model_class primary key.</span>
</span><span id="PumpWoodMicroService.fill_options-2162"><a href="#PumpWoodMicroService.fill_options-2162"><span class="linenos">2162</span></a><span class="sd">            - **column [str]:**: Name of the column.</span>
</span><span id="PumpWoodMicroService.fill_options-2163"><a href="#PumpWoodMicroService.fill_options-2163"><span class="linenos">2163</span></a><span class="sd">            - **column__verbose [str]:** Name of the column translated using</span>
</span><span id="PumpWoodMicroService.fill_options-2164"><a href="#PumpWoodMicroService.fill_options-2164"><span class="linenos">2164</span></a><span class="sd">                Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService.fill_options-2165"><a href="#PumpWoodMicroService.fill_options-2165"><span class="linenos">2165</span></a><span class="sd">            - **help_text [str]:** Help text associated with column.</span>
</span><span id="PumpWoodMicroService.fill_options-2166"><a href="#PumpWoodMicroService.fill_options-2166"><span class="linenos">2166</span></a><span class="sd">            - **help_text__verbose [str]:** Help text associated with column</span>
</span><span id="PumpWoodMicroService.fill_options-2167"><a href="#PumpWoodMicroService.fill_options-2167"><span class="linenos">2167</span></a><span class="sd">                translated using Pumpwood I8s.</span>
</span><span id="PumpWoodMicroService.fill_options-2168"><a href="#PumpWoodMicroService.fill_options-2168"><span class="linenos">2168</span></a><span class="sd">            - **type [str]:** Python type associated with the column.</span>
</span><span id="PumpWoodMicroService.fill_options-2169"><a href="#PumpWoodMicroService.fill_options-2169"><span class="linenos">2169</span></a><span class="sd">            - **nullable [bool]:** If field can be set as null (None).</span>
</span><span id="PumpWoodMicroService.fill_options-2170"><a href="#PumpWoodMicroService.fill_options-2170"><span class="linenos">2170</span></a><span class="sd">            - **read_only [bool]:** If field is marked as read-only. Passsing</span>
</span><span id="PumpWoodMicroService.fill_options-2171"><a href="#PumpWoodMicroService.fill_options-2171"><span class="linenos">2171</span></a><span class="sd">                information for this field will not be used in save end-point.</span>
</span><span id="PumpWoodMicroService.fill_options-2172"><a href="#PumpWoodMicroService.fill_options-2172"><span class="linenos">2172</span></a><span class="sd">            - **default [any]:** Default value of the field if not set using</span>
</span><span id="PumpWoodMicroService.fill_options-2173"><a href="#PumpWoodMicroService.fill_options-2173"><span class="linenos">2173</span></a><span class="sd">                save end-poin.</span>
</span><span id="PumpWoodMicroService.fill_options-2174"><a href="#PumpWoodMicroService.fill_options-2174"><span class="linenos">2174</span></a><span class="sd">            - **unique [bool]:** If the there is a constrain in database</span>
</span><span id="PumpWoodMicroService.fill_options-2175"><a href="#PumpWoodMicroService.fill_options-2175"><span class="linenos">2175</span></a><span class="sd">                setting this field to be unique.</span>
</span><span id="PumpWoodMicroService.fill_options-2176"><a href="#PumpWoodMicroService.fill_options-2176"><span class="linenos">2176</span></a><span class="sd">            - **extra_info:** Some extra infomations used to pass associated</span>
</span><span id="PumpWoodMicroService.fill_options-2177"><a href="#PumpWoodMicroService.fill_options-2177"><span class="linenos">2177</span></a><span class="sd">                model class for forenging key and related fields.</span>
</span><span id="PumpWoodMicroService.fill_options-2178"><a href="#PumpWoodMicroService.fill_options-2178"><span class="linenos">2178</span></a><span class="sd">            - **in [dict]:** At options fields, have their options listed in</span>
</span><span id="PumpWoodMicroService.fill_options-2179"><a href="#PumpWoodMicroService.fill_options-2179"><span class="linenos">2179</span></a><span class="sd">                `in` keys. It will return the values as key and de description</span>
</span><span id="PumpWoodMicroService.fill_options-2180"><a href="#PumpWoodMicroService.fill_options-2180"><span class="linenos">2180</span></a><span class="sd">                and description__verbose (translated by Pumpwood I8s)</span>
</span><span id="PumpWoodMicroService.fill_options-2181"><a href="#PumpWoodMicroService.fill_options-2181"><span class="linenos">2181</span></a><span class="sd">                as values.</span>
</span><span id="PumpWoodMicroService.fill_options-2182"><a href="#PumpWoodMicroService.fill_options-2182"><span class="linenos">2182</span></a><span class="sd">            - **partition:** At pk field, this key indicates if the database</span>
</span><span id="PumpWoodMicroService.fill_options-2183"><a href="#PumpWoodMicroService.fill_options-2183"><span class="linenos">2183</span></a><span class="sd">                if partitioned. Partitioned will perform better in queries if</span>
</span><span id="PumpWoodMicroService.fill_options-2184"><a href="#PumpWoodMicroService.fill_options-2184"><span class="linenos">2184</span></a><span class="sd">                partition is used on filter or exclude clauses. If table has</span>
</span><span id="PumpWoodMicroService.fill_options-2185"><a href="#PumpWoodMicroService.fill_options-2185"><span class="linenos">2185</span></a><span class="sd">                more than one level o partition, at least the first one must</span>
</span><span id="PumpWoodMicroService.fill_options-2186"><a href="#PumpWoodMicroService.fill_options-2186"><span class="linenos">2186</span></a><span class="sd">                be used when retrieving data.</span>
</span><span id="PumpWoodMicroService.fill_options-2187"><a href="#PumpWoodMicroService.fill_options-2187"><span class="linenos">2187</span></a>
</span><span id="PumpWoodMicroService.fill_options-2188"><a href="#PumpWoodMicroService.fill_options-2188"><span class="linenos">2188</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.fill_options-2189"><a href="#PumpWoodMicroService.fill_options-2189"><span class="linenos">2189</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.fill_options-2190"><a href="#PumpWoodMicroService.fill_options-2190"><span class="linenos">2190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.fill_options-2191"><a href="#PumpWoodMicroService.fill_options-2191"><span class="linenos">2191</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
</span><span id="PumpWoodMicroService.fill_options-2192"><a href="#PumpWoodMicroService.fill_options-2192"><span class="linenos">2192</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.fill_options-2193"><a href="#PumpWoodMicroService.fill_options-2193"><span class="linenos">2193</span></a>            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService.fill_options-2194"><a href="#PumpWoodMicroService.fill_options-2194"><span class="linenos">2194</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.fill_options-2195"><a href="#PumpWoodMicroService.fill_options-2195"><span class="linenos">2195</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.fill_options-2196"><a href="#PumpWoodMicroService.fill_options-2196"><span class="linenos">2196</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return options for object fields.</p>

<p>DEPRECTED Use <code><a href="#PumpWoodMicroService.fill_validation">fill_validation</a></code> function instead.</p>

<p>This function send partial object data and return options to finish
object fillment.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to check search parameters</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>parcial_obj_dict:</strong>  Partial object that is sent to backend for validation and
update fill options acording to values passed for each field.</li>
<li><strong>field:</strong>  Retrict validation for an especific field if implemented.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictonary with field names as keys and information of
  them as values. Information at values:</p>
  
  <ul>
  <li><strong>primary_key [bool]:</strong>: Boolean indicating if field is part
  of model_class primary key.</li>
  <li><strong>column [str]:</strong>: Name of the column.</li>
  <li><strong>column__verbose [str]:</strong> Name of the column translated using
  Pumpwood I8s.</li>
  <li><strong>help_text [str]:</strong> Help text associated with column.</li>
  <li><strong>help_text__verbose [str]:</strong> Help text associated with column
  translated using Pumpwood I8s.</li>
  <li><strong>type [str]:</strong> Python type associated with the column.</li>
  <li><strong>nullable [bool]:</strong> If field can be set as null (None).</li>
  <li><strong>read_only [bool]:</strong> If field is marked as read-only. Passsing
  information for this field will not be used in save end-point.</li>
  <li><strong>default [any]:</strong> Default value of the field if not set using
  save end-poin.</li>
  <li><strong>unique [bool]:</strong> If the there is a constrain in database
  setting this field to be unique.</li>
  <li><strong>extra_info:</strong> Some extra infomations used to pass associated
  model class for forenging key and related fields.</li>
  <li><strong>in [dict]:</strong> At options fields, have their options listed in
  <code>in</code> keys. It will return the values as key and de description
  and description__verbose (translated by Pumpwood I8s)
  as values.</li>
  <li><strong>partition:</strong> At pk field, this key indicates if the database
  if partitioned. Partitioned will perform better in queries if
  partition is used on filter or exclude clauses. If table has
  more than one level o partition, at least the first one must
  be used when retrieving data.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.list_options" class="classattr">
                                        <input id="PumpWoodMicroService.list_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.list_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.list_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.list_options-2198"><a href="#PumpWoodMicroService.list_options-2198"><span class="linenos">2198</span></a>    <span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.list_options-2199"><a href="#PumpWoodMicroService.list_options-2199"><span class="linenos">2199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render list views.</span>
</span><span id="PumpWoodMicroService.list_options-2200"><a href="#PumpWoodMicroService.list_options-2200"><span class="linenos">2200</span></a>
</span><span id="PumpWoodMicroService.list_options-2201"><a href="#PumpWoodMicroService.list_options-2201"><span class="linenos">2201</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService.list_options-2202"><a href="#PumpWoodMicroService.list_options-2202"><span class="linenos">2202</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService.list_options-2203"><a href="#PumpWoodMicroService.list_options-2203"><span class="linenos">2203</span></a>
</span><span id="PumpWoodMicroService.list_options-2204"><a href="#PumpWoodMicroService.list_options-2204"><span class="linenos">2204</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.list_options-2205"><a href="#PumpWoodMicroService.list_options-2205"><span class="linenos">2205</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.list_options-2206"><a href="#PumpWoodMicroService.list_options-2206"><span class="linenos">2206</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService.list_options-2207"><a href="#PumpWoodMicroService.list_options-2207"><span class="linenos">2207</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.list_options-2208"><a href="#PumpWoodMicroService.list_options-2208"><span class="linenos">2208</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.list_options-2209"><a href="#PumpWoodMicroService.list_options-2209"><span class="linenos">2209</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.list_options-2210"><a href="#PumpWoodMicroService.list_options-2210"><span class="linenos">2210</span></a>
</span><span id="PumpWoodMicroService.list_options-2211"><a href="#PumpWoodMicroService.list_options-2211"><span class="linenos">2211</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.list_options-2212"><a href="#PumpWoodMicroService.list_options-2212"><span class="linenos">2212</span></a><span class="sd">            Dictionary with keys:</span>
</span><span id="PumpWoodMicroService.list_options-2213"><a href="#PumpWoodMicroService.list_options-2213"><span class="linenos">2213</span></a><span class="sd">            - **default_list_fields:** Default list field defined on the</span>
</span><span id="PumpWoodMicroService.list_options-2214"><a href="#PumpWoodMicroService.list_options-2214"><span class="linenos">2214</span></a><span class="sd">                application backend.</span>
</span><span id="PumpWoodMicroService.list_options-2215"><a href="#PumpWoodMicroService.list_options-2215"><span class="linenos">2215</span></a><span class="sd">            - **field_descriptions:** Description of the fields associated</span>
</span><span id="PumpWoodMicroService.list_options-2216"><a href="#PumpWoodMicroService.list_options-2216"><span class="linenos">2216</span></a><span class="sd">                with the model class.</span>
</span><span id="PumpWoodMicroService.list_options-2217"><a href="#PumpWoodMicroService.list_options-2217"><span class="linenos">2217</span></a>
</span><span id="PumpWoodMicroService.list_options-2218"><a href="#PumpWoodMicroService.list_options-2218"><span class="linenos">2218</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.list_options-2219"><a href="#PumpWoodMicroService.list_options-2219"><span class="linenos">2219</span></a><span class="sd">          No particular raise.</span>
</span><span id="PumpWoodMicroService.list_options-2220"><a href="#PumpWoodMicroService.list_options-2220"><span class="linenos">2220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.list_options-2221"><a href="#PumpWoodMicroService.list_options-2221"><span class="linenos">2221</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_options-2222"><a href="#PumpWoodMicroService.list_options-2222"><span class="linenos">2222</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.list_options-2223"><a href="#PumpWoodMicroService.list_options-2223"><span class="linenos">2223</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.list_options-2224"><a href="#PumpWoodMicroService.list_options-2224"><span class="linenos">2224</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return options to render list views.</p>

<p>This function send partial object data and return options to finish
object fillment.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to check search parameters.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Dictionary with keys:</p>
  
  <ul>
  <li><strong>default_list_fields:</strong> Default list field defined on the
  application backend.</li>
  <li><strong>field_descriptions:</strong> Description of the fields associated
  with the model class.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raise.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.retrieve_options" class="classattr">
                                        <input id="PumpWoodMicroService.retrieve_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">retrieve_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.retrieve_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.retrieve_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.retrieve_options-2226"><a href="#PumpWoodMicroService.retrieve_options-2226"><span class="linenos">2226</span></a>    <span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.retrieve_options-2227"><a href="#PumpWoodMicroService.retrieve_options-2227"><span class="linenos">2227</span></a>                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2228"><a href="#PumpWoodMicroService.retrieve_options-2228"><span class="linenos">2228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options to render retrieve views.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2229"><a href="#PumpWoodMicroService.retrieve_options-2229"><span class="linenos">2229</span></a>
</span><span id="PumpWoodMicroService.retrieve_options-2230"><a href="#PumpWoodMicroService.retrieve_options-2230"><span class="linenos">2230</span></a><span class="sd">        Return information of the field sets that can be used to create</span>
</span><span id="PumpWoodMicroService.retrieve_options-2231"><a href="#PumpWoodMicroService.retrieve_options-2231"><span class="linenos">2231</span></a><span class="sd">        frontend site. It also return a `verbose_field` which can be used</span>
</span><span id="PumpWoodMicroService.retrieve_options-2232"><a href="#PumpWoodMicroService.retrieve_options-2232"><span class="linenos">2232</span></a><span class="sd">        to create the tittle of the page substituing the values with</span>
</span><span id="PumpWoodMicroService.retrieve_options-2233"><a href="#PumpWoodMicroService.retrieve_options-2233"><span class="linenos">2233</span></a><span class="sd">        information of the object.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2234"><a href="#PumpWoodMicroService.retrieve_options-2234"><span class="linenos">2234</span></a>
</span><span id="PumpWoodMicroService.retrieve_options-2235"><a href="#PumpWoodMicroService.retrieve_options-2235"><span class="linenos">2235</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2236"><a href="#PumpWoodMicroService.retrieve_options-2236"><span class="linenos">2236</span></a><span class="sd">          model_class:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2237"><a href="#PumpWoodMicroService.retrieve_options-2237"><span class="linenos">2237</span></a><span class="sd">              Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2238"><a href="#PumpWoodMicroService.retrieve_options-2238"><span class="linenos">2238</span></a><span class="sd">          auth_header:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2239"><a href="#PumpWoodMicroService.retrieve_options-2239"><span class="linenos">2239</span></a><span class="sd">              Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.retrieve_options-2240"><a href="#PumpWoodMicroService.retrieve_options-2240"><span class="linenos">2240</span></a><span class="sd">              at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.retrieve_options-2241"><a href="#PumpWoodMicroService.retrieve_options-2241"><span class="linenos">2241</span></a>
</span><span id="PumpWoodMicroService.retrieve_options-2242"><a href="#PumpWoodMicroService.retrieve_options-2242"><span class="linenos">2242</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2243"><a href="#PumpWoodMicroService.retrieve_options-2243"><span class="linenos">2243</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2244"><a href="#PumpWoodMicroService.retrieve_options-2244"><span class="linenos">2244</span></a><span class="sd">            - **verbose_field:** String sugesting how the tittle of the</span>
</span><span id="PumpWoodMicroService.retrieve_options-2245"><a href="#PumpWoodMicroService.retrieve_options-2245"><span class="linenos">2245</span></a><span class="sd">                retrieve might be created. It will use Python format</span>
</span><span id="PumpWoodMicroService.retrieve_options-2246"><a href="#PumpWoodMicroService.retrieve_options-2246"><span class="linenos">2246</span></a><span class="sd">                information ex.: `&#39;{pk} | {description}&#39;`.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2247"><a href="#PumpWoodMicroService.retrieve_options-2247"><span class="linenos">2247</span></a><span class="sd">            - **fieldset:** An dictinary with organization of data,</span>
</span><span id="PumpWoodMicroService.retrieve_options-2248"><a href="#PumpWoodMicroService.retrieve_options-2248"><span class="linenos">2248</span></a><span class="sd">                setting field sets that could be grouped toguether in</span>
</span><span id="PumpWoodMicroService.retrieve_options-2249"><a href="#PumpWoodMicroService.retrieve_options-2249"><span class="linenos">2249</span></a><span class="sd">                tabs.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2250"><a href="#PumpWoodMicroService.retrieve_options-2250"><span class="linenos">2250</span></a>
</span><span id="PumpWoodMicroService.retrieve_options-2251"><a href="#PumpWoodMicroService.retrieve_options-2251"><span class="linenos">2251</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.retrieve_options-2252"><a href="#PumpWoodMicroService.retrieve_options-2252"><span class="linenos">2252</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.retrieve_options-2253"><a href="#PumpWoodMicroService.retrieve_options-2253"><span class="linenos">2253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.retrieve_options-2254"><a href="#PumpWoodMicroService.retrieve_options-2254"><span class="linenos">2254</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_options-2255"><a href="#PumpWoodMicroService.retrieve_options-2255"><span class="linenos">2255</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.retrieve_options-2256"><a href="#PumpWoodMicroService.retrieve_options-2256"><span class="linenos">2256</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.retrieve_options-2257"><a href="#PumpWoodMicroService.retrieve_options-2257"><span class="linenos">2257</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return options to render retrieve views.</p>

<p>Return information of the field sets that can be used to create
frontend site. It also return a <code>verbose_field</code> which can be used
to create the tittle of the page substituing the values with
information of the object.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to check search parameters.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictinary with keys:</p>
  
  <ul>
  <li><strong>verbose_field:</strong> String sugesting how the tittle of the
  retrieve might be created. It will use Python format
  information ex.: <code>'{pk} | {description}'</code>.</li>
  <li><strong>fieldset:</strong> An dictinary with organization of data,
  setting field sets that could be grouped toguether in
  tabs.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.fill_validation" class="classattr">
                                        <input id="PumpWoodMicroService.fill_validation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fill_validation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.fill_validation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.fill_validation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.fill_validation-2259"><a href="#PumpWoodMicroService.fill_validation-2259"><span class="linenos">2259</span></a>    <span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.fill_validation-2260"><a href="#PumpWoodMicroService.fill_validation-2260"><span class="linenos">2260</span></a>                        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.fill_validation-2261"><a href="#PumpWoodMicroService.fill_validation-2261"><span class="linenos">2261</span></a>                        <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.fill_validation-2262"><a href="#PumpWoodMicroService.fill_validation-2262"><span class="linenos">2262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return options for object fields.</span>
</span><span id="PumpWoodMicroService.fill_validation-2263"><a href="#PumpWoodMicroService.fill_validation-2263"><span class="linenos">2263</span></a>
</span><span id="PumpWoodMicroService.fill_validation-2264"><a href="#PumpWoodMicroService.fill_validation-2264"><span class="linenos">2264</span></a><span class="sd">        This function send partial object data and return options to finish</span>
</span><span id="PumpWoodMicroService.fill_validation-2265"><a href="#PumpWoodMicroService.fill_validation-2265"><span class="linenos">2265</span></a><span class="sd">        object fillment.</span>
</span><span id="PumpWoodMicroService.fill_validation-2266"><a href="#PumpWoodMicroService.fill_validation-2266"><span class="linenos">2266</span></a>
</span><span id="PumpWoodMicroService.fill_validation-2267"><a href="#PumpWoodMicroService.fill_validation-2267"><span class="linenos">2267</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.fill_validation-2268"><a href="#PumpWoodMicroService.fill_validation-2268"><span class="linenos">2268</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.fill_validation-2269"><a href="#PumpWoodMicroService.fill_validation-2269"><span class="linenos">2269</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService.fill_validation-2270"><a href="#PumpWoodMicroService.fill_validation-2270"><span class="linenos">2270</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.fill_validation-2271"><a href="#PumpWoodMicroService.fill_validation-2271"><span class="linenos">2271</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.fill_validation-2272"><a href="#PumpWoodMicroService.fill_validation-2272"><span class="linenos">2272</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.fill_validation-2273"><a href="#PumpWoodMicroService.fill_validation-2273"><span class="linenos">2273</span></a><span class="sd">            parcial_obj_dict:</span>
</span><span id="PumpWoodMicroService.fill_validation-2274"><a href="#PumpWoodMicroService.fill_validation-2274"><span class="linenos">2274</span></a><span class="sd">                Partial object data to be validated by the backend.</span>
</span><span id="PumpWoodMicroService.fill_validation-2275"><a href="#PumpWoodMicroService.fill_validation-2275"><span class="linenos">2275</span></a><span class="sd">            field:</span>
</span><span id="PumpWoodMicroService.fill_validation-2276"><a href="#PumpWoodMicroService.fill_validation-2276"><span class="linenos">2276</span></a><span class="sd">                Set an especific field to be validated if implemented.</span>
</span><span id="PumpWoodMicroService.fill_validation-2277"><a href="#PumpWoodMicroService.fill_validation-2277"><span class="linenos">2277</span></a><span class="sd">            user_type:</span>
</span><span id="PumpWoodMicroService.fill_validation-2278"><a href="#PumpWoodMicroService.fill_validation-2278"><span class="linenos">2278</span></a><span class="sd">                Set the type of user is requesting fill validation. It is</span>
</span><span id="PumpWoodMicroService.fill_validation-2279"><a href="#PumpWoodMicroService.fill_validation-2279"><span class="linenos">2279</span></a><span class="sd">                possible to set `api` and `gui`. Gui user_type will return</span>
</span><span id="PumpWoodMicroService.fill_validation-2280"><a href="#PumpWoodMicroService.fill_validation-2280"><span class="linenos">2280</span></a><span class="sd">                fields listed in gui_readonly as read-only fields to</span>
</span><span id="PumpWoodMicroService.fill_validation-2281"><a href="#PumpWoodMicroService.fill_validation-2281"><span class="linenos">2281</span></a><span class="sd">                facilitate navegation.</span>
</span><span id="PumpWoodMicroService.fill_validation-2282"><a href="#PumpWoodMicroService.fill_validation-2282"><span class="linenos">2282</span></a>
</span><span id="PumpWoodMicroService.fill_validation-2283"><a href="#PumpWoodMicroService.fill_validation-2283"><span class="linenos">2283</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.fill_validation-2284"><a href="#PumpWoodMicroService.fill_validation-2284"><span class="linenos">2284</span></a><span class="sd">            Return a dictinary with keys:</span>
</span><span id="PumpWoodMicroService.fill_validation-2285"><a href="#PumpWoodMicroService.fill_validation-2285"><span class="linenos">2285</span></a><span class="sd">            - **field_descriptions:** Same of fill_options, but setting as</span>
</span><span id="PumpWoodMicroService.fill_validation-2286"><a href="#PumpWoodMicroService.fill_validation-2286"><span class="linenos">2286</span></a><span class="sd">                read_only=True fields listed on gui_readonly if</span>
</span><span id="PumpWoodMicroService.fill_validation-2287"><a href="#PumpWoodMicroService.fill_validation-2287"><span class="linenos">2287</span></a><span class="sd">                user_type=&#39;gui&#39;.</span>
</span><span id="PumpWoodMicroService.fill_validation-2288"><a href="#PumpWoodMicroService.fill_validation-2288"><span class="linenos">2288</span></a><span class="sd">            - **gui_readonly:** Return a list of fields that will be</span>
</span><span id="PumpWoodMicroService.fill_validation-2289"><a href="#PumpWoodMicroService.fill_validation-2289"><span class="linenos">2289</span></a><span class="sd">                considered as read-only if user_type=&#39;gui&#39; is requested.</span>
</span><span id="PumpWoodMicroService.fill_validation-2290"><a href="#PumpWoodMicroService.fill_validation-2290"><span class="linenos">2290</span></a>
</span><span id="PumpWoodMicroService.fill_validation-2291"><a href="#PumpWoodMicroService.fill_validation-2291"><span class="linenos">2291</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.fill_validation-2292"><a href="#PumpWoodMicroService.fill_validation-2292"><span class="linenos">2292</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.fill_validation-2293"><a href="#PumpWoodMicroService.fill_validation-2293"><span class="linenos">2293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.fill_validation-2294"><a href="#PumpWoodMicroService.fill_validation-2294"><span class="linenos">2294</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.fill_validation-2295"><a href="#PumpWoodMicroService.fill_validation-2295"><span class="linenos">2295</span></a>            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.fill_validation-2296"><a href="#PumpWoodMicroService.fill_validation-2296"><span class="linenos">2296</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.fill_validation-2297"><a href="#PumpWoodMicroService.fill_validation-2297"><span class="linenos">2297</span></a>        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.fill_validation-2298"><a href="#PumpWoodMicroService.fill_validation-2298"><span class="linenos">2298</span></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
</span><span id="PumpWoodMicroService.fill_validation-2299"><a href="#PumpWoodMicroService.fill_validation-2299"><span class="linenos">2299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.fill_validation-2300"><a href="#PumpWoodMicroService.fill_validation-2300"><span class="linenos">2300</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.fill_validation-2301"><a href="#PumpWoodMicroService.fill_validation-2301"><span class="linenos">2301</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return options for object fields.</p>

<p>This function send partial object data and return options to finish
object fillment.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class to check search parameters.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>parcial_obj_dict:</strong>  Partial object data to be validated by the backend.</li>
<li><strong>field:</strong>  Set an especific field to be validated if implemented.</li>
<li><strong>user_type:</strong>  Set the type of user is requesting fill validation. It is
possible to set <code>api</code> and <code>gui</code>. Gui user_type will return
fields listed in gui_readonly as read-only fields to
facilitate navegation.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a dictinary with keys:</p>
  
  <ul>
  <li><strong>field_descriptions:</strong> Same of fill_options, but setting as
  read_only=True fields listed on gui_readonly if
  user_type='gui'.</li>
  <li><strong>gui_readonly:</strong> Return a list of fields that will be
  considered as read-only if user_type='gui' is requested.</li>
  </ul>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.pivot" class="classattr">
                                        <input id="PumpWoodMicroService.pivot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pivot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">order_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">add_pk_column</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.pivot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.pivot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.pivot-2307"><a href="#PumpWoodMicroService.pivot-2307"><span class="linenos">2307</span></a>    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService.pivot-2308"><a href="#PumpWoodMicroService.pivot-2308"><span class="linenos">2308</span></a>              <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.pivot-2309"><a href="#PumpWoodMicroService.pivot-2309"><span class="linenos">2309</span></a>              <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="PumpWoodMicroService.pivot-2310"><a href="#PumpWoodMicroService.pivot-2310"><span class="linenos">2310</span></a>              <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.pivot-2311"><a href="#PumpWoodMicroService.pivot-2311"><span class="linenos">2311</span></a>              <span class="n">add_pk_column</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.pivot-2312"><a href="#PumpWoodMicroService.pivot-2312"><span class="linenos">2312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pivot object data acording to columns specified.</span>
</span><span id="PumpWoodMicroService.pivot-2313"><a href="#PumpWoodMicroService.pivot-2313"><span class="linenos">2313</span></a>
</span><span id="PumpWoodMicroService.pivot-2314"><a href="#PumpWoodMicroService.pivot-2314"><span class="linenos">2314</span></a><span class="sd">        Pivoting per-se is not usually used, beeing the name of the function</span>
</span><span id="PumpWoodMicroService.pivot-2315"><a href="#PumpWoodMicroService.pivot-2315"><span class="linenos">2315</span></a><span class="sd">        a legacy. Normality data transformation is done at the client level.</span>
</span><span id="PumpWoodMicroService.pivot-2316"><a href="#PumpWoodMicroService.pivot-2316"><span class="linenos">2316</span></a>
</span><span id="PumpWoodMicroService.pivot-2317"><a href="#PumpWoodMicroService.pivot-2317"><span class="linenos">2317</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.pivot-2318"><a href="#PumpWoodMicroService.pivot-2318"><span class="linenos">2318</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService.pivot-2319"><a href="#PumpWoodMicroService.pivot-2319"><span class="linenos">2319</span></a><span class="sd">                Model class to check search parameters.</span>
</span><span id="PumpWoodMicroService.pivot-2320"><a href="#PumpWoodMicroService.pivot-2320"><span class="linenos">2320</span></a><span class="sd">            columns (List[str]):</span>
</span><span id="PumpWoodMicroService.pivot-2321"><a href="#PumpWoodMicroService.pivot-2321"><span class="linenos">2321</span></a><span class="sd">                List of fields to be used as columns when pivoting the data.</span>
</span><span id="PumpWoodMicroService.pivot-2322"><a href="#PumpWoodMicroService.pivot-2322"><span class="linenos">2322</span></a><span class="sd">            format (str):</span>
</span><span id="PumpWoodMicroService.pivot-2323"><a href="#PumpWoodMicroService.pivot-2323"><span class="linenos">2323</span></a><span class="sd">                Format to be used to convert pandas.DataFrame to</span>
</span><span id="PumpWoodMicroService.pivot-2324"><a href="#PumpWoodMicroService.pivot-2324"><span class="linenos">2324</span></a><span class="sd">                dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
</span><span id="PumpWoodMicroService.pivot-2325"><a href="#PumpWoodMicroService.pivot-2325"><span class="linenos">2325</span></a><span class="sd">                &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
</span><span id="PumpWoodMicroService.pivot-2326"><a href="#PumpWoodMicroService.pivot-2326"><span class="linenos">2326</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService.pivot-2327"><a href="#PumpWoodMicroService.pivot-2327"><span class="linenos">2327</span></a><span class="sd">                Same as list function.</span>
</span><span id="PumpWoodMicroService.pivot-2328"><a href="#PumpWoodMicroService.pivot-2328"><span class="linenos">2328</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService.pivot-2329"><a href="#PumpWoodMicroService.pivot-2329"><span class="linenos">2329</span></a><span class="sd">                Same as list function.</span>
</span><span id="PumpWoodMicroService.pivot-2330"><a href="#PumpWoodMicroService.pivot-2330"><span class="linenos">2330</span></a><span class="sd">            order_by (List[str]):</span>
</span><span id="PumpWoodMicroService.pivot-2331"><a href="#PumpWoodMicroService.pivot-2331"><span class="linenos">2331</span></a><span class="sd">                 Same as list function.</span>
</span><span id="PumpWoodMicroService.pivot-2332"><a href="#PumpWoodMicroService.pivot-2332"><span class="linenos">2332</span></a><span class="sd">            variables (List[str]):</span>
</span><span id="PumpWoodMicroService.pivot-2333"><a href="#PumpWoodMicroService.pivot-2333"><span class="linenos">2333</span></a><span class="sd">                List of the fields to be returned, if None, the default</span>
</span><span id="PumpWoodMicroService.pivot-2334"><a href="#PumpWoodMicroService.pivot-2334"><span class="linenos">2334</span></a><span class="sd">                variables will be returned. Same as fields on list functions.</span>
</span><span id="PumpWoodMicroService.pivot-2335"><a href="#PumpWoodMicroService.pivot-2335"><span class="linenos">2335</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="PumpWoodMicroService.pivot-2336"><a href="#PumpWoodMicroService.pivot-2336"><span class="linenos">2336</span></a><span class="sd">                Fields with deleted column will have objects with deleted=True</span>
</span><span id="PumpWoodMicroService.pivot-2337"><a href="#PumpWoodMicroService.pivot-2337"><span class="linenos">2337</span></a><span class="sd">                omited from results. show_deleted=True will return this</span>
</span><span id="PumpWoodMicroService.pivot-2338"><a href="#PumpWoodMicroService.pivot-2338"><span class="linenos">2338</span></a><span class="sd">                information.</span>
</span><span id="PumpWoodMicroService.pivot-2339"><a href="#PumpWoodMicroService.pivot-2339"><span class="linenos">2339</span></a><span class="sd">            add_pk_column (bool):</span>
</span><span id="PumpWoodMicroService.pivot-2340"><a href="#PumpWoodMicroService.pivot-2340"><span class="linenos">2340</span></a><span class="sd">                If add pk values of the objects at pivot results. Adding</span>
</span><span id="PumpWoodMicroService.pivot-2341"><a href="#PumpWoodMicroService.pivot-2341"><span class="linenos">2341</span></a><span class="sd">                pk key on pivot end-points won&#39;t be possible to pivot since</span>
</span><span id="PumpWoodMicroService.pivot-2342"><a href="#PumpWoodMicroService.pivot-2342"><span class="linenos">2342</span></a><span class="sd">                pk is unique for each entry.</span>
</span><span id="PumpWoodMicroService.pivot-2343"><a href="#PumpWoodMicroService.pivot-2343"><span class="linenos">2343</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService.pivot-2344"><a href="#PumpWoodMicroService.pivot-2344"><span class="linenos">2344</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.pivot-2345"><a href="#PumpWoodMicroService.pivot-2345"><span class="linenos">2345</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.pivot-2346"><a href="#PumpWoodMicroService.pivot-2346"><span class="linenos">2346</span></a>
</span><span id="PumpWoodMicroService.pivot-2347"><a href="#PumpWoodMicroService.pivot-2347"><span class="linenos">2347</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.pivot-2348"><a href="#PumpWoodMicroService.pivot-2348"><span class="linenos">2348</span></a><span class="sd">            Return a list or a dictinary depending on the format set on</span>
</span><span id="PumpWoodMicroService.pivot-2349"><a href="#PumpWoodMicroService.pivot-2349"><span class="linenos">2349</span></a><span class="sd">            format parameter.</span>
</span><span id="PumpWoodMicroService.pivot-2350"><a href="#PumpWoodMicroService.pivot-2350"><span class="linenos">2350</span></a>
</span><span id="PumpWoodMicroService.pivot-2351"><a href="#PumpWoodMicroService.pivot-2351"><span class="linenos">2351</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.pivot-2352"><a href="#PumpWoodMicroService.pivot-2352"><span class="linenos">2352</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.pivot-2353"><a href="#PumpWoodMicroService.pivot-2353"><span class="linenos">2353</span></a><span class="sd">                &#39;Columns must be a list of elements.&#39;. Indicates that the list</span>
</span><span id="PumpWoodMicroService.pivot-2354"><a href="#PumpWoodMicroService.pivot-2354"><span class="linenos">2354</span></a><span class="sd">                argument was not a list.</span>
</span><span id="PumpWoodMicroService.pivot-2355"><a href="#PumpWoodMicroService.pivot-2355"><span class="linenos">2355</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.pivot-2356"><a href="#PumpWoodMicroService.pivot-2356"><span class="linenos">2356</span></a><span class="sd">                &#39;Column chosen as pivot is not at model variables&#39;. Indicates</span>
</span><span id="PumpWoodMicroService.pivot-2357"><a href="#PumpWoodMicroService.pivot-2357"><span class="linenos">2357</span></a><span class="sd">                that columns that were set to pivot are not present on model</span>
</span><span id="PumpWoodMicroService.pivot-2358"><a href="#PumpWoodMicroService.pivot-2358"><span class="linenos">2358</span></a><span class="sd">                variables.</span>
</span><span id="PumpWoodMicroService.pivot-2359"><a href="#PumpWoodMicroService.pivot-2359"><span class="linenos">2359</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.pivot-2360"><a href="#PumpWoodMicroService.pivot-2360"><span class="linenos">2360</span></a><span class="sd">                &quot;Format must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,&#39;split&#39;,</span>
</span><span id="PumpWoodMicroService.pivot-2361"><a href="#PumpWoodMicroService.pivot-2361"><span class="linenos">2361</span></a><span class="sd">                &#39;records&#39;,&#39;index&#39;]&quot;. Indicates that format set as paramenter</span>
</span><span id="PumpWoodMicroService.pivot-2362"><a href="#PumpWoodMicroService.pivot-2362"><span class="linenos">2362</span></a><span class="sd">                is not implemented.</span>
</span><span id="PumpWoodMicroService.pivot-2363"><a href="#PumpWoodMicroService.pivot-2363"><span class="linenos">2363</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.pivot-2364"><a href="#PumpWoodMicroService.pivot-2364"><span class="linenos">2364</span></a><span class="sd">                &quot;Can not add pk column and pivot information&quot;. If</span>
</span><span id="PumpWoodMicroService.pivot-2365"><a href="#PumpWoodMicroService.pivot-2365"><span class="linenos">2365</span></a><span class="sd">                add_pk_column is True (results will have the pk column), it is</span>
</span><span id="PumpWoodMicroService.pivot-2366"><a href="#PumpWoodMicroService.pivot-2366"><span class="linenos">2366</span></a><span class="sd">                not possible to pivot the information (pk is an unique value</span>
</span><span id="PumpWoodMicroService.pivot-2367"><a href="#PumpWoodMicroService.pivot-2367"><span class="linenos">2367</span></a><span class="sd">                for each object, there is no reason to pivot it).</span>
</span><span id="PumpWoodMicroService.pivot-2368"><a href="#PumpWoodMicroService.pivot-2368"><span class="linenos">2368</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.pivot-2369"><a href="#PumpWoodMicroService.pivot-2369"><span class="linenos">2369</span></a><span class="sd">                &quot;&#39;value&#39; column not at melted data, it is not possible</span>
</span><span id="PumpWoodMicroService.pivot-2370"><a href="#PumpWoodMicroService.pivot-2370"><span class="linenos">2370</span></a><span class="sd">                to pivot dataframe.&quot;. Indicates that data does not have a value</span>
</span><span id="PumpWoodMicroService.pivot-2371"><a href="#PumpWoodMicroService.pivot-2371"><span class="linenos">2371</span></a><span class="sd">                column, it must have it to populate pivoted table.</span>
</span><span id="PumpWoodMicroService.pivot-2372"><a href="#PumpWoodMicroService.pivot-2372"><span class="linenos">2372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.pivot-2373"><a href="#PumpWoodMicroService.pivot-2373"><span class="linenos">2373</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.pivot-2374"><a href="#PumpWoodMicroService.pivot-2374"><span class="linenos">2374</span></a>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.pivot-2375"><a href="#PumpWoodMicroService.pivot-2375"><span class="linenos">2375</span></a>            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.pivot-2376"><a href="#PumpWoodMicroService.pivot-2376"><span class="linenos">2376</span></a>            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.pivot-2377"><a href="#PumpWoodMicroService.pivot-2377"><span class="linenos">2377</span></a>            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.pivot-2378"><a href="#PumpWoodMicroService.pivot-2378"><span class="linenos">2378</span></a>            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span> <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="n">add_pk_column</span><span class="p">}</span>
</span><span id="PumpWoodMicroService.pivot-2379"><a href="#PumpWoodMicroService.pivot-2379"><span class="linenos">2379</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.pivot-2380"><a href="#PumpWoodMicroService.pivot-2380"><span class="linenos">2380</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pivot object data acording to columns specified.</p>

<p>Pivoting per-se is not usually used, beeing the name of the function
a legacy. Normality data transformation is done at the client level.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class (str):</strong>  Model class to check search parameters.</li>
<li><strong>columns (List[str]):</strong>  List of fields to be used as columns when pivoting the data.</li>
<li><strong>format (str):</strong>  Format to be used to convert pandas.DataFrame to
dictionary, must be in ['dict','list','series',
'split', 'records','index'].</li>
<li><strong>filter_dict (dict):</strong>  Same as list function.</li>
<li><strong>exclude_dict (dict):</strong>  Same as list function.</li>
<li><strong>order_by (List[str]):</strong>  Same as list function.</li>
<li><strong>variables (List[str]):</strong>  List of the fields to be returned, if None, the default
variables will be returned. Same as fields on list functions.</li>
<li><strong>show_deleted (bool):</strong>  Fields with deleted column will have objects with deleted=True
omited from results. show_deleted=True will return this
information.</li>
<li><strong>add_pk_column (bool):</strong>  If add pk values of the objects at pivot results. Adding
pk key on pivot end-points won't be possible to pivot since
pk is unique for each entry.</li>
<li><strong>auth_header (dict):</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a list or a dictinary depending on the format set on
  format parameter.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'Columns must be a list of elements.'. Indicates that the list
argument was not a list.</li>
<li><strong>PumpWoodException:</strong>  'Column chosen as pivot is not at model variables'. Indicates
that columns that were set to pivot are not present on model
variables.</li>
<li><strong>PumpWoodException:</strong>  "Format must be in ['dict','list','series','split',
'records','index']". Indicates that format set as paramenter
is not implemented.</li>
<li><strong>PumpWoodException:</strong>  "Can not add pk column and pivot information". If
add_pk_column is True (results will have the pk column), it is
not possible to pivot the information (pk is an unique value
for each object, there is no reason to pivot it).</li>
<li><strong>PumpWoodException:</strong>  "'value' column not at melted data, it is not possible
to pivot dataframe.". Indicates that data does not have a value
column, it must have it to populate pivoted table.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.flat_list_by_chunks" class="classattr">
                                        <input id="PumpWoodMicroService.flat_list_by_chunks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flat_list_by_chunks</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.flat_list_by_chunks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.flat_list_by_chunks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.flat_list_by_chunks-2430"><a href="#PumpWoodMicroService.flat_list_by_chunks-2430"><span class="linenos">2430</span></a>    <span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2431"><a href="#PumpWoodMicroService.flat_list_by_chunks-2431"><span class="linenos">2431</span></a>                            <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2432"><a href="#PumpWoodMicroService.flat_list_by_chunks-2432"><span class="linenos">2432</span></a>                            <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2433"><a href="#PumpWoodMicroService.flat_list_by_chunks-2433"><span class="linenos">2433</span></a>                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2434"><a href="#PumpWoodMicroService.flat_list_by_chunks-2434"><span class="linenos">2434</span></a>                            <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2435"><a href="#PumpWoodMicroService.flat_list_by_chunks-2435"><span class="linenos">2435</span></a>                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2436"><a href="#PumpWoodMicroService.flat_list_by_chunks-2436"><span class="linenos">2436</span></a>                            <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2437"><a href="#PumpWoodMicroService.flat_list_by_chunks-2437"><span class="linenos">2437</span></a>                            <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2438"><a href="#PumpWoodMicroService.flat_list_by_chunks-2438"><span class="linenos">2438</span></a>                            <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2439"><a href="#PumpWoodMicroService.flat_list_by_chunks-2439"><span class="linenos">2439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Incrementally fetch data from pivot end-point.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2440"><a href="#PumpWoodMicroService.flat_list_by_chunks-2440"><span class="linenos">2440</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2441"><a href="#PumpWoodMicroService.flat_list_by_chunks-2441"><span class="linenos">2441</span></a><span class="sd">        Fetch data from pivot end-point paginating by id of chunk_size lenght.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2442"><a href="#PumpWoodMicroService.flat_list_by_chunks-2442"><span class="linenos">2442</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2443"><a href="#PumpWoodMicroService.flat_list_by_chunks-2443"><span class="linenos">2443</span></a><span class="sd">        If table is partitioned it will split the query acording to partition</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2444"><a href="#PumpWoodMicroService.flat_list_by_chunks-2444"><span class="linenos">2444</span></a><span class="sd">        to facilitate query at the database.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2445"><a href="#PumpWoodMicroService.flat_list_by_chunks-2445"><span class="linenos">2445</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2446"><a href="#PumpWoodMicroService.flat_list_by_chunks-2446"><span class="linenos">2446</span></a><span class="sd">        If start_date and end_date are set, also breaks the query by month</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2447"><a href="#PumpWoodMicroService.flat_list_by_chunks-2447"><span class="linenos">2447</span></a><span class="sd">        retrieving each month data in parallel.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2448"><a href="#PumpWoodMicroService.flat_list_by_chunks-2448"><span class="linenos">2448</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2449"><a href="#PumpWoodMicroService.flat_list_by_chunks-2449"><span class="linenos">2449</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2450"><a href="#PumpWoodMicroService.flat_list_by_chunks-2450"><span class="linenos">2450</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2451"><a href="#PumpWoodMicroService.flat_list_by_chunks-2451"><span class="linenos">2451</span></a><span class="sd">                Model class to be pivoted.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2452"><a href="#PumpWoodMicroService.flat_list_by_chunks-2452"><span class="linenos">2452</span></a><span class="sd">            filter_dict (dict):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2453"><a href="#PumpWoodMicroService.flat_list_by_chunks-2453"><span class="linenos">2453</span></a><span class="sd">                Dictionary to to be used in objects.filter argument</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2454"><a href="#PumpWoodMicroService.flat_list_by_chunks-2454"><span class="linenos">2454</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2455"><a href="#PumpWoodMicroService.flat_list_by_chunks-2455"><span class="linenos">2455</span></a><span class="sd">            exclude_dict (dict):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2456"><a href="#PumpWoodMicroService.flat_list_by_chunks-2456"><span class="linenos">2456</span></a><span class="sd">                Dictionary to to be used in objects.exclude argument</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2457"><a href="#PumpWoodMicroService.flat_list_by_chunks-2457"><span class="linenos">2457</span></a><span class="sd">                (Same as list end-point).</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2458"><a href="#PumpWoodMicroService.flat_list_by_chunks-2458"><span class="linenos">2458</span></a><span class="sd">            fields (List[str] | None):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2459"><a href="#PumpWoodMicroService.flat_list_by_chunks-2459"><span class="linenos">2459</span></a><span class="sd">                List of the variables to be returned,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2460"><a href="#PumpWoodMicroService.flat_list_by_chunks-2460"><span class="linenos">2460</span></a><span class="sd">                if None, the default variables will be returned.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2461"><a href="#PumpWoodMicroService.flat_list_by_chunks-2461"><span class="linenos">2461</span></a><span class="sd">                If fields is set, dataframe will return that columns</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2462"><a href="#PumpWoodMicroService.flat_list_by_chunks-2462"><span class="linenos">2462</span></a><span class="sd">                even if data is empty.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2463"><a href="#PumpWoodMicroService.flat_list_by_chunks-2463"><span class="linenos">2463</span></a><span class="sd">            start_date (datetime | str):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2464"><a href="#PumpWoodMicroService.flat_list_by_chunks-2464"><span class="linenos">2464</span></a><span class="sd">                Set a begin date for the query. If begin and end date are</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2465"><a href="#PumpWoodMicroService.flat_list_by_chunks-2465"><span class="linenos">2465</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2466"><a href="#PumpWoodMicroService.flat_list_by_chunks-2466"><span class="linenos">2466</span></a><span class="sd">                requested in parallel.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2467"><a href="#PumpWoodMicroService.flat_list_by_chunks-2467"><span class="linenos">2467</span></a><span class="sd">            end_date (datetime | str):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2468"><a href="#PumpWoodMicroService.flat_list_by_chunks-2468"><span class="linenos">2468</span></a><span class="sd">                Set a end date for the query. If begin and end date are</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2469"><a href="#PumpWoodMicroService.flat_list_by_chunks-2469"><span class="linenos">2469</span></a><span class="sd">                set, query will be splited with chucks by month that will be</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2470"><a href="#PumpWoodMicroService.flat_list_by_chunks-2470"><span class="linenos">2470</span></a><span class="sd">                requested in parallel.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2471"><a href="#PumpWoodMicroService.flat_list_by_chunks-2471"><span class="linenos">2471</span></a><span class="sd">            show_deleted (bool):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2472"><a href="#PumpWoodMicroService.flat_list_by_chunks-2472"><span class="linenos">2472</span></a><span class="sd">                If deleted data should be returned.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2473"><a href="#PumpWoodMicroService.flat_list_by_chunks-2473"><span class="linenos">2473</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2474"><a href="#PumpWoodMicroService.flat_list_by_chunks-2474"><span class="linenos">2474</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2475"><a href="#PumpWoodMicroService.flat_list_by_chunks-2475"><span class="linenos">2475</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2476"><a href="#PumpWoodMicroService.flat_list_by_chunks-2476"><span class="linenos">2476</span></a><span class="sd">            chunk_size (int):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2477"><a href="#PumpWoodMicroService.flat_list_by_chunks-2477"><span class="linenos">2477</span></a><span class="sd">                Limit of data to fetch per call.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2478"><a href="#PumpWoodMicroService.flat_list_by_chunks-2478"><span class="linenos">2478</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2479"><a href="#PumpWoodMicroService.flat_list_by_chunks-2479"><span class="linenos">2479</span></a><span class="sd">                Number of parallel process to perform.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2480"><a href="#PumpWoodMicroService.flat_list_by_chunks-2480"><span class="linenos">2480</span></a><span class="sd">            create_composite_pk (bool):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2481"><a href="#PumpWoodMicroService.flat_list_by_chunks-2481"><span class="linenos">2481</span></a><span class="sd">                If true and table has a composite pk, it will create pk</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2482"><a href="#PumpWoodMicroService.flat_list_by_chunks-2482"><span class="linenos">2482</span></a><span class="sd">                value based on the hash on the json serialized dictionary</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2483"><a href="#PumpWoodMicroService.flat_list_by_chunks-2483"><span class="linenos">2483</span></a><span class="sd">                of the components of the primary key.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2484"><a href="#PumpWoodMicroService.flat_list_by_chunks-2484"><span class="linenos">2484</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2485"><a href="#PumpWoodMicroService.flat_list_by_chunks-2485"><span class="linenos">2485</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2486"><a href="#PumpWoodMicroService.flat_list_by_chunks-2486"><span class="linenos">2486</span></a><span class="sd">            Returns a dataframe with all information fetched.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2487"><a href="#PumpWoodMicroService.flat_list_by_chunks-2487"><span class="linenos">2487</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2488"><a href="#PumpWoodMicroService.flat_list_by_chunks-2488"><span class="linenos">2488</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2489"><a href="#PumpWoodMicroService.flat_list_by_chunks-2489"><span class="linenos">2489</span></a><span class="sd">            No particular raise.</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2490"><a href="#PumpWoodMicroService.flat_list_by_chunks-2490"><span class="linenos">2490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2491"><a href="#PumpWoodMicroService.flat_list_by_chunks-2491"><span class="linenos">2491</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2492"><a href="#PumpWoodMicroService.flat_list_by_chunks-2492"><span class="linenos">2492</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2493"><a href="#PumpWoodMicroService.flat_list_by_chunks-2493"><span class="linenos">2493</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2494"><a href="#PumpWoodMicroService.flat_list_by_chunks-2494"><span class="linenos">2494</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2495"><a href="#PumpWoodMicroService.flat_list_by_chunks-2495"><span class="linenos">2495</span></a>        <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2496"><a href="#PumpWoodMicroService.flat_list_by_chunks-2496"><span class="linenos">2496</span></a>        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2497"><a href="#PumpWoodMicroService.flat_list_by_chunks-2497"><span class="linenos">2497</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2498"><a href="#PumpWoodMicroService.flat_list_by_chunks-2498"><span class="linenos">2498</span></a>        <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2499"><a href="#PumpWoodMicroService.flat_list_by_chunks-2499"><span class="linenos">2499</span></a>        <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2500"><a href="#PumpWoodMicroService.flat_list_by_chunks-2500"><span class="linenos">2500</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2501"><a href="#PumpWoodMicroService.flat_list_by_chunks-2501"><span class="linenos">2501</span></a>        <span class="c1"># Create a list of month and include start and end dates if not at</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2502"><a href="#PumpWoodMicroService.flat_list_by_chunks-2502"><span class="linenos">2502</span></a>        <span class="c1"># the beginning of a month</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2503"><a href="#PumpWoodMicroService.flat_list_by_chunks-2503"><span class="linenos">2503</span></a>        <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2504"><a href="#PumpWoodMicroService.flat_list_by_chunks-2504"><span class="linenos">2504</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2505"><a href="#PumpWoodMicroService.flat_list_by_chunks-2505"><span class="linenos">2505</span></a>            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2506"><a href="#PumpWoodMicroService.flat_list_by_chunks-2506"><span class="linenos">2506</span></a>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2507"><a href="#PumpWoodMicroService.flat_list_by_chunks-2507"><span class="linenos">2507</span></a>            <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2508"><a href="#PumpWoodMicroService.flat_list_by_chunks-2508"><span class="linenos">2508</span></a>                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2509"><a href="#PumpWoodMicroService.flat_list_by_chunks-2509"><span class="linenos">2509</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2510"><a href="#PumpWoodMicroService.flat_list_by_chunks-2510"><span class="linenos">2510</span></a>                <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2511"><a href="#PumpWoodMicroService.flat_list_by_chunks-2511"><span class="linenos">2511</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2512"><a href="#PumpWoodMicroService.flat_list_by_chunks-2512"><span class="linenos">2512</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2513"><a href="#PumpWoodMicroService.flat_list_by_chunks-2513"><span class="linenos">2513</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2514"><a href="#PumpWoodMicroService.flat_list_by_chunks-2514"><span class="linenos">2514</span></a>            <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2515"><a href="#PumpWoodMicroService.flat_list_by_chunks-2515"><span class="linenos">2515</span></a>            <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2516"><a href="#PumpWoodMicroService.flat_list_by_chunks-2516"><span class="linenos">2516</span></a>            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2517"><a href="#PumpWoodMicroService.flat_list_by_chunks-2517"><span class="linenos">2517</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2518"><a href="#PumpWoodMicroService.flat_list_by_chunks-2518"><span class="linenos">2518</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2519"><a href="#PumpWoodMicroService.flat_list_by_chunks-2519"><span class="linenos">2519</span></a>                <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2520"><a href="#PumpWoodMicroService.flat_list_by_chunks-2520"><span class="linenos">2520</span></a>                <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2521"><a href="#PumpWoodMicroService.flat_list_by_chunks-2521"><span class="linenos">2521</span></a>                <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2522"><a href="#PumpWoodMicroService.flat_list_by_chunks-2522"><span class="linenos">2522</span></a>                <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2523"><a href="#PumpWoodMicroService.flat_list_by_chunks-2523"><span class="linenos">2523</span></a>                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2524"><a href="#PumpWoodMicroService.flat_list_by_chunks-2524"><span class="linenos">2524</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2525"><a href="#PumpWoodMicroService.flat_list_by_chunks-2525"><span class="linenos">2525</span></a>                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2526"><a href="#PumpWoodMicroService.flat_list_by_chunks-2526"><span class="linenos">2526</span></a>                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2527"><a href="#PumpWoodMicroService.flat_list_by_chunks-2527"><span class="linenos">2527</span></a>                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2528"><a href="#PumpWoodMicroService.flat_list_by_chunks-2528"><span class="linenos">2528</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2529"><a href="#PumpWoodMicroService.flat_list_by_chunks-2529"><span class="linenos">2529</span></a>        <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2530"><a href="#PumpWoodMicroService.flat_list_by_chunks-2530"><span class="linenos">2530</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2531"><a href="#PumpWoodMicroService.flat_list_by_chunks-2531"><span class="linenos">2531</span></a>        <span class="c1">##########################################################</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2532"><a href="#PumpWoodMicroService.flat_list_by_chunks-2532"><span class="linenos">2532</span></a>        <span class="c1"># If table have more than one partition, run in parallel #</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2533"><a href="#PumpWoodMicroService.flat_list_by_chunks-2533"><span class="linenos">2533</span></a>        <span class="c1"># the {partition}__in elements along with dates          #</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2534"><a href="#PumpWoodMicroService.flat_list_by_chunks-2534"><span class="linenos">2534</span></a>        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2535"><a href="#PumpWoodMicroService.flat_list_by_chunks-2535"><span class="linenos">2535</span></a>            <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2536"><a href="#PumpWoodMicroService.flat_list_by_chunks-2536"><span class="linenos">2536</span></a>            <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2537"><a href="#PumpWoodMicroService.flat_list_by_chunks-2537"><span class="linenos">2537</span></a>            <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2538"><a href="#PumpWoodMicroService.flat_list_by_chunks-2538"><span class="linenos">2538</span></a>            <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2539"><a href="#PumpWoodMicroService.flat_list_by_chunks-2539"><span class="linenos">2539</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2540"><a href="#PumpWoodMicroService.flat_list_by_chunks-2540"><span class="linenos">2540</span></a>                <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2541"><a href="#PumpWoodMicroService.flat_list_by_chunks-2541"><span class="linenos">2541</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2542"><a href="#PumpWoodMicroService.flat_list_by_chunks-2542"><span class="linenos">2542</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2543"><a href="#PumpWoodMicroService.flat_list_by_chunks-2543"><span class="linenos">2543</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2544"><a href="#PumpWoodMicroService.flat_list_by_chunks-2544"><span class="linenos">2544</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2545"><a href="#PumpWoodMicroService.flat_list_by_chunks-2545"><span class="linenos">2545</span></a>                <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2546"><a href="#PumpWoodMicroService.flat_list_by_chunks-2546"><span class="linenos">2546</span></a>                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2547"><a href="#PumpWoodMicroService.flat_list_by_chunks-2547"><span class="linenos">2547</span></a>                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2548"><a href="#PumpWoodMicroService.flat_list_by_chunks-2548"><span class="linenos">2548</span></a>                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2549"><a href="#PumpWoodMicroService.flat_list_by_chunks-2549"><span class="linenos">2549</span></a>                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2550"><a href="#PumpWoodMicroService.flat_list_by_chunks-2550"><span class="linenos">2550</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2551"><a href="#PumpWoodMicroService.flat_list_by_chunks-2551"><span class="linenos">2551</span></a>            <span class="c1"># Validating query for partitioned tables</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2552"><a href="#PumpWoodMicroService.flat_list_by_chunks-2552"><span class="linenos">2552</span></a>            <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2553"><a href="#PumpWoodMicroService.flat_list_by_chunks-2553"><span class="linenos">2553</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2554"><a href="#PumpWoodMicroService.flat_list_by_chunks-2554"><span class="linenos">2554</span></a>                    <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2555"><a href="#PumpWoodMicroService.flat_list_by_chunks-2555"><span class="linenos">2555</span></a>                    <span class="s2">&quot;queries without at least first level partition will &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2556"><a href="#PumpWoodMicroService.flat_list_by_chunks-2556"><span class="linenos">2556</span></a>                    <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2557"><a href="#PumpWoodMicroService.flat_list_by_chunks-2557"><span class="linenos">2557</span></a>                    <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2558"><a href="#PumpWoodMicroService.flat_list_by_chunks-2558"><span class="linenos">2558</span></a>                    <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2559"><a href="#PumpWoodMicroService.flat_list_by_chunks-2559"><span class="linenos">2559</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2560"><a href="#PumpWoodMicroService.flat_list_by_chunks-2560"><span class="linenos">2560</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2561"><a href="#PumpWoodMicroService.flat_list_by_chunks-2561"><span class="linenos">2561</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2562"><a href="#PumpWoodMicroService.flat_list_by_chunks-2562"><span class="linenos">2562</span></a>            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2563"><a href="#PumpWoodMicroService.flat_list_by_chunks-2563"><span class="linenos">2563</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2564"><a href="#PumpWoodMicroService.flat_list_by_chunks-2564"><span class="linenos">2564</span></a>                    <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2565"><a href="#PumpWoodMicroService.flat_list_by_chunks-2565"><span class="linenos">2565</span></a>                    <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2566"><a href="#PumpWoodMicroService.flat_list_by_chunks-2566"><span class="linenos">2566</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2567"><a href="#PumpWoodMicroService.flat_list_by_chunks-2567"><span class="linenos">2567</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2568"><a href="#PumpWoodMicroService.flat_list_by_chunks-2568"><span class="linenos">2568</span></a>            <span class="c1"># Parallelizing query using partition columns</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2569"><a href="#PumpWoodMicroService.flat_list_by_chunks-2569"><span class="linenos">2569</span></a>            <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2570"><a href="#PumpWoodMicroService.flat_list_by_chunks-2570"><span class="linenos">2570</span></a>            <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2571"><a href="#PumpWoodMicroService.flat_list_by_chunks-2571"><span class="linenos">2571</span></a>                <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2572"><a href="#PumpWoodMicroService.flat_list_by_chunks-2572"><span class="linenos">2572</span></a>                <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2573"><a href="#PumpWoodMicroService.flat_list_by_chunks-2573"><span class="linenos">2573</span></a>                <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2574"><a href="#PumpWoodMicroService.flat_list_by_chunks-2574"><span class="linenos">2574</span></a>                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2575"><a href="#PumpWoodMicroService.flat_list_by_chunks-2575"><span class="linenos">2575</span></a>                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2576"><a href="#PumpWoodMicroService.flat_list_by_chunks-2576"><span class="linenos">2576</span></a>                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2577"><a href="#PumpWoodMicroService.flat_list_by_chunks-2577"><span class="linenos">2577</span></a>                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2578"><a href="#PumpWoodMicroService.flat_list_by_chunks-2578"><span class="linenos">2578</span></a>                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2579"><a href="#PumpWoodMicroService.flat_list_by_chunks-2579"><span class="linenos">2579</span></a>                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2580"><a href="#PumpWoodMicroService.flat_list_by_chunks-2580"><span class="linenos">2580</span></a>                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2581"><a href="#PumpWoodMicroService.flat_list_by_chunks-2581"><span class="linenos">2581</span></a>                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2582"><a href="#PumpWoodMicroService.flat_list_by_chunks-2582"><span class="linenos">2582</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2583"><a href="#PumpWoodMicroService.flat_list_by_chunks-2583"><span class="linenos">2583</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2584"><a href="#PumpWoodMicroService.flat_list_by_chunks-2584"><span class="linenos">2584</span></a>                        <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2585"><a href="#PumpWoodMicroService.flat_list_by_chunks-2585"><span class="linenos">2585</span></a>                            <span class="n">request_filter_dict</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2586"><a href="#PumpWoodMicroService.flat_list_by_chunks-2586"><span class="linenos">2586</span></a>                        <span class="c1"># If is not the last interval, query using open</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2587"><a href="#PumpWoodMicroService.flat_list_by_chunks-2587"><span class="linenos">2587</span></a>                        <span class="c1"># right interval so subsequence queries does</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2588"><a href="#PumpWoodMicroService.flat_list_by_chunks-2588"><span class="linenos">2588</span></a>                        <span class="c1"># not overlap</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2589"><a href="#PumpWoodMicroService.flat_list_by_chunks-2589"><span class="linenos">2589</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2590"><a href="#PumpWoodMicroService.flat_list_by_chunks-2590"><span class="linenos">2590</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2591"><a href="#PumpWoodMicroService.flat_list_by_chunks-2591"><span class="linenos">2591</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2592"><a href="#PumpWoodMicroService.flat_list_by_chunks-2592"><span class="linenos">2592</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2593"><a href="#PumpWoodMicroService.flat_list_by_chunks-2593"><span class="linenos">2593</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2594"><a href="#PumpWoodMicroService.flat_list_by_chunks-2594"><span class="linenos">2594</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2595"><a href="#PumpWoodMicroService.flat_list_by_chunks-2595"><span class="linenos">2595</span></a>                        <span class="c1"># At the last interval use closed right interval so</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2596"><a href="#PumpWoodMicroService.flat_list_by_chunks-2596"><span class="linenos">2596</span></a>                        <span class="c1"># last element is also included in the interval</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2597"><a href="#PumpWoodMicroService.flat_list_by_chunks-2597"><span class="linenos">2597</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2598"><a href="#PumpWoodMicroService.flat_list_by_chunks-2598"><span class="linenos">2598</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2599"><a href="#PumpWoodMicroService.flat_list_by_chunks-2599"><span class="linenos">2599</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2600"><a href="#PumpWoodMicroService.flat_list_by_chunks-2600"><span class="linenos">2600</span></a>                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2601"><a href="#PumpWoodMicroService.flat_list_by_chunks-2601"><span class="linenos">2601</span></a>                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2602"><a href="#PumpWoodMicroService.flat_list_by_chunks-2602"><span class="linenos">2602</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2603"><a href="#PumpWoodMicroService.flat_list_by_chunks-2603"><span class="linenos">2603</span></a>                        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2604"><a href="#PumpWoodMicroService.flat_list_by_chunks-2604"><span class="linenos">2604</span></a>                            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2605"><a href="#PumpWoodMicroService.flat_list_by_chunks-2605"><span class="linenos">2605</span></a>                            <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2606"><a href="#PumpWoodMicroService.flat_list_by_chunks-2606"><span class="linenos">2606</span></a>                            <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2607"><a href="#PumpWoodMicroService.flat_list_by_chunks-2607"><span class="linenos">2607</span></a>                            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2608"><a href="#PumpWoodMicroService.flat_list_by_chunks-2608"><span class="linenos">2608</span></a>                            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2609"><a href="#PumpWoodMicroService.flat_list_by_chunks-2609"><span class="linenos">2609</span></a>                            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2610"><a href="#PumpWoodMicroService.flat_list_by_chunks-2610"><span class="linenos">2610</span></a>                            <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2611"><a href="#PumpWoodMicroService.flat_list_by_chunks-2611"><span class="linenos">2611</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2612"><a href="#PumpWoodMicroService.flat_list_by_chunks-2612"><span class="linenos">2612</span></a>            <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2613"><a href="#PumpWoodMicroService.flat_list_by_chunks-2613"><span class="linenos">2613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2614"><a href="#PumpWoodMicroService.flat_list_by_chunks-2614"><span class="linenos">2614</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2615"><a href="#PumpWoodMicroService.flat_list_by_chunks-2615"><span class="linenos">2615</span></a>                <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2616"><a href="#PumpWoodMicroService.flat_list_by_chunks-2616"><span class="linenos">2616</span></a>                    <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2617"><a href="#PumpWoodMicroService.flat_list_by_chunks-2617"><span class="linenos">2617</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2618"><a href="#PumpWoodMicroService.flat_list_by_chunks-2618"><span class="linenos">2618</span></a>                        <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2619"><a href="#PumpWoodMicroService.flat_list_by_chunks-2619"><span class="linenos">2619</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2620"><a href="#PumpWoodMicroService.flat_list_by_chunks-2620"><span class="linenos">2620</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2621"><a href="#PumpWoodMicroService.flat_list_by_chunks-2621"><span class="linenos">2621</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2622"><a href="#PumpWoodMicroService.flat_list_by_chunks-2622"><span class="linenos">2622</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2623"><a href="#PumpWoodMicroService.flat_list_by_chunks-2623"><span class="linenos">2623</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2624"><a href="#PumpWoodMicroService.flat_list_by_chunks-2624"><span class="linenos">2624</span></a>        <span class="c1">############################################</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2625"><a href="#PumpWoodMicroService.flat_list_by_chunks-2625"><span class="linenos">2625</span></a>        <span class="c1"># If table have partition, run in parallel #</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2626"><a href="#PumpWoodMicroService.flat_list_by_chunks-2626"><span class="linenos">2626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2627"><a href="#PumpWoodMicroService.flat_list_by_chunks-2627"><span class="linenos">2627</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2628"><a href="#PumpWoodMicroService.flat_list_by_chunks-2628"><span class="linenos">2628</span></a>                <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2629"><a href="#PumpWoodMicroService.flat_list_by_chunks-2629"><span class="linenos">2629</span></a>                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2630"><a href="#PumpWoodMicroService.flat_list_by_chunks-2630"><span class="linenos">2630</span></a>                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2631"><a href="#PumpWoodMicroService.flat_list_by_chunks-2631"><span class="linenos">2631</span></a>                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2632"><a href="#PumpWoodMicroService.flat_list_by_chunks-2632"><span class="linenos">2632</span></a>                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2633"><a href="#PumpWoodMicroService.flat_list_by_chunks-2633"><span class="linenos">2633</span></a>                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2634"><a href="#PumpWoodMicroService.flat_list_by_chunks-2634"><span class="linenos">2634</span></a>                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2635"><a href="#PumpWoodMicroService.flat_list_by_chunks-2635"><span class="linenos">2635</span></a>                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2636"><a href="#PumpWoodMicroService.flat_list_by_chunks-2636"><span class="linenos">2636</span></a>                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2637"><a href="#PumpWoodMicroService.flat_list_by_chunks-2637"><span class="linenos">2637</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2638"><a href="#PumpWoodMicroService.flat_list_by_chunks-2638"><span class="linenos">2638</span></a>                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2639"><a href="#PumpWoodMicroService.flat_list_by_chunks-2639"><span class="linenos">2639</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2640"><a href="#PumpWoodMicroService.flat_list_by_chunks-2640"><span class="linenos">2640</span></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2641"><a href="#PumpWoodMicroService.flat_list_by_chunks-2641"><span class="linenos">2641</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2642"><a href="#PumpWoodMicroService.flat_list_by_chunks-2642"><span class="linenos">2642</span></a>            <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2643"><a href="#PumpWoodMicroService.flat_list_by_chunks-2643"><span class="linenos">2643</span></a>                <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2644"><a href="#PumpWoodMicroService.flat_list_by_chunks-2644"><span class="linenos">2644</span></a>                <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2645"><a href="#PumpWoodMicroService.flat_list_by_chunks-2645"><span class="linenos">2645</span></a>            <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2646"><a href="#PumpWoodMicroService.flat_list_by_chunks-2646"><span class="linenos">2646</span></a>                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">fields</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2647"><a href="#PumpWoodMicroService.flat_list_by_chunks-2647"><span class="linenos">2647</span></a>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2648"><a href="#PumpWoodMicroService.flat_list_by_chunks-2648"><span class="linenos">2648</span></a>        <span class="c1"># Adjust columns to return the columns set at fields</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2649"><a href="#PumpWoodMicroService.flat_list_by_chunks-2649"><span class="linenos">2649</span></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2650"><a href="#PumpWoodMicroService.flat_list_by_chunks-2650"><span class="linenos">2650</span></a>            <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resp_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.flat_list_by_chunks-2651"><a href="#PumpWoodMicroService.flat_list_by_chunks-2651"><span class="linenos">2651</span></a>        <span class="k">return</span> <span class="n">resp_df</span>
</span></pre></div>


            <div class="docstring"><p>Incrementally fetch data from pivot end-point.</p>

<p>Fetch data from pivot end-point paginating by id of chunk_size lenght.</p>

<p>If table is partitioned it will split the query acording to partition
to facilitate query at the database.</p>

<p>If start_date and end_date are set, also breaks the query by month
retrieving each month data in parallel.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class (str):</strong>  Model class to be pivoted.</li>
<li><strong>filter_dict (dict):</strong>  Dictionary to to be used in objects.filter argument
(Same as list end-point).</li>
<li><strong>exclude_dict (dict):</strong>  Dictionary to to be used in objects.exclude argument
(Same as list end-point).</li>
<li><strong>fields (List[str] | None):</strong>  List of the variables to be returned,
if None, the default variables will be returned.
If fields is set, dataframe will return that columns
even if data is empty.</li>
<li><strong>start_date (datetime | str):</strong>  Set a begin date for the query. If begin and end date are
set, query will be splited with chucks by month that will be
requested in parallel.</li>
<li><strong>end_date (datetime | str):</strong>  Set a end date for the query. If begin and end date are
set, query will be splited with chucks by month that will be
requested in parallel.</li>
<li><strong>show_deleted (bool):</strong>  If deleted data should be returned.</li>
<li><strong>auth_header (dict):</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>chunk_size (int):</strong>  Limit of data to fetch per call.</li>
<li><strong>n_parallel (int):</strong>  Number of parallel process to perform.</li>
<li><strong>create_composite_pk (bool):</strong>  If true and table has a composite pk, it will create pk
value based on the hash on the json serialized dictionary
of the components of the primary key.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Returns a dataframe with all information fetched.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raise.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.bulk_save" class="classattr">
                                        <input id="PumpWoodMicroService.bulk_save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bulk_save</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data_to_save</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.bulk_save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.bulk_save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.bulk_save-2657"><a href="#PumpWoodMicroService.bulk_save-2657"><span class="linenos">2657</span></a>    <span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.bulk_save-2658"><a href="#PumpWoodMicroService.bulk_save-2658"><span class="linenos">2658</span></a>                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.bulk_save-2659"><a href="#PumpWoodMicroService.bulk_save-2659"><span class="linenos">2659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a list of objects with one request.</span>
</span><span id="PumpWoodMicroService.bulk_save-2660"><a href="#PumpWoodMicroService.bulk_save-2660"><span class="linenos">2660</span></a>
</span><span id="PumpWoodMicroService.bulk_save-2661"><a href="#PumpWoodMicroService.bulk_save-2661"><span class="linenos">2661</span></a><span class="sd">        It is used with a unique call save many objects at the same time. It</span>
</span><span id="PumpWoodMicroService.bulk_save-2662"><a href="#PumpWoodMicroService.bulk_save-2662"><span class="linenos">2662</span></a><span class="sd">        is necessary that the end-point is able to receive bulk save requests</span>
</span><span id="PumpWoodMicroService.bulk_save-2663"><a href="#PumpWoodMicroService.bulk_save-2663"><span class="linenos">2663</span></a><span class="sd">        and all objects been of the same model class.</span>
</span><span id="PumpWoodMicroService.bulk_save-2664"><a href="#PumpWoodMicroService.bulk_save-2664"><span class="linenos">2664</span></a>
</span><span id="PumpWoodMicroService.bulk_save-2665"><a href="#PumpWoodMicroService.bulk_save-2665"><span class="linenos">2665</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.bulk_save-2666"><a href="#PumpWoodMicroService.bulk_save-2666"><span class="linenos">2666</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.bulk_save-2667"><a href="#PumpWoodMicroService.bulk_save-2667"><span class="linenos">2667</span></a><span class="sd">                Data model class.</span>
</span><span id="PumpWoodMicroService.bulk_save-2668"><a href="#PumpWoodMicroService.bulk_save-2668"><span class="linenos">2668</span></a><span class="sd">            data_to_save:</span>
</span><span id="PumpWoodMicroService.bulk_save-2669"><a href="#PumpWoodMicroService.bulk_save-2669"><span class="linenos">2669</span></a><span class="sd">                A list of objects to be saved.</span>
</span><span id="PumpWoodMicroService.bulk_save-2670"><a href="#PumpWoodMicroService.bulk_save-2670"><span class="linenos">2670</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.bulk_save-2671"><a href="#PumpWoodMicroService.bulk_save-2671"><span class="linenos">2671</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.bulk_save-2672"><a href="#PumpWoodMicroService.bulk_save-2672"><span class="linenos">2672</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.bulk_save-2673"><a href="#PumpWoodMicroService.bulk_save-2673"><span class="linenos">2673</span></a>
</span><span id="PumpWoodMicroService.bulk_save-2674"><a href="#PumpWoodMicroService.bulk_save-2674"><span class="linenos">2674</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.bulk_save-2675"><a href="#PumpWoodMicroService.bulk_save-2675"><span class="linenos">2675</span></a><span class="sd">            A dictinary with `saved_count` as key indicating the number of</span>
</span><span id="PumpWoodMicroService.bulk_save-2676"><a href="#PumpWoodMicroService.bulk_save-2676"><span class="linenos">2676</span></a><span class="sd">            objects that were saved in database.</span>
</span><span id="PumpWoodMicroService.bulk_save-2677"><a href="#PumpWoodMicroService.bulk_save-2677"><span class="linenos">2677</span></a>
</span><span id="PumpWoodMicroService.bulk_save-2678"><a href="#PumpWoodMicroService.bulk_save-2678"><span class="linenos">2678</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.bulk_save-2679"><a href="#PumpWoodMicroService.bulk_save-2679"><span class="linenos">2679</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.bulk_save-2680"><a href="#PumpWoodMicroService.bulk_save-2680"><span class="linenos">2680</span></a><span class="sd">                &#39;Expected columns and data columns do not match: Expected</span>
</span><span id="PumpWoodMicroService.bulk_save-2681"><a href="#PumpWoodMicroService.bulk_save-2681"><span class="linenos">2681</span></a><span class="sd">                columns: {expected} Data columns: {data_cols}&#39;. Indicates</span>
</span><span id="PumpWoodMicroService.bulk_save-2682"><a href="#PumpWoodMicroService.bulk_save-2682"><span class="linenos">2682</span></a><span class="sd">                that the expected fields of the object were not met at the</span>
</span><span id="PumpWoodMicroService.bulk_save-2683"><a href="#PumpWoodMicroService.bulk_save-2683"><span class="linenos">2683</span></a><span class="sd">                objects passed to save.</span>
</span><span id="PumpWoodMicroService.bulk_save-2684"><a href="#PumpWoodMicroService.bulk_save-2684"><span class="linenos">2684</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.bulk_save-2685"><a href="#PumpWoodMicroService.bulk_save-2685"><span class="linenos">2685</span></a><span class="sd">                Other sqlalchemy and psycopg2 errors not associated with</span>
</span><span id="PumpWoodMicroService.bulk_save-2686"><a href="#PumpWoodMicroService.bulk_save-2686"><span class="linenos">2686</span></a><span class="sd">                IntegrityError.</span>
</span><span id="PumpWoodMicroService.bulk_save-2687"><a href="#PumpWoodMicroService.bulk_save-2687"><span class="linenos">2687</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.bulk_save-2688"><a href="#PumpWoodMicroService.bulk_save-2688"><span class="linenos">2688</span></a><span class="sd">                &#39;Bulk save not avaiable.&#39;. Indicates that Bulk save end-point</span>
</span><span id="PumpWoodMicroService.bulk_save-2689"><a href="#PumpWoodMicroService.bulk_save-2689"><span class="linenos">2689</span></a><span class="sd">                was not configured for this model_class.</span>
</span><span id="PumpWoodMicroService.bulk_save-2690"><a href="#PumpWoodMicroService.bulk_save-2690"><span class="linenos">2690</span></a><span class="sd">            PumpWoodIntegrityError:</span>
</span><span id="PumpWoodMicroService.bulk_save-2691"><a href="#PumpWoodMicroService.bulk_save-2691"><span class="linenos">2691</span></a><span class="sd">                Raise integrity errors from sqlalchemy and psycopg2. Usually</span>
</span><span id="PumpWoodMicroService.bulk_save-2692"><a href="#PumpWoodMicroService.bulk_save-2692"><span class="linenos">2692</span></a><span class="sd">                associated with uniqueness of some column.</span>
</span><span id="PumpWoodMicroService.bulk_save-2693"><a href="#PumpWoodMicroService.bulk_save-2693"><span class="linenos">2693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.bulk_save-2694"><a href="#PumpWoodMicroService.bulk_save-2694"><span class="linenos">2694</span></a>        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.bulk_save-2695"><a href="#PumpWoodMicroService.bulk_save-2695"><span class="linenos">2695</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.bulk_save-2696"><a href="#PumpWoodMicroService.bulk_save-2696"><span class="linenos">2696</span></a>            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.bulk_save-2697"><a href="#PumpWoodMicroService.bulk_save-2697"><span class="linenos">2697</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save a list of objects with one request.</p>

<p>It is used with a unique call save many objects at the same time. It
is necessary that the end-point is able to receive bulk save requests
and all objects been of the same model class.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Data model class.</li>
<li><strong>data_to_save:</strong>  A list of objects to be saved.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A dictinary with <code>saved_count</code> as key indicating the number of
  objects that were saved in database.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'Expected columns and data columns do not match: Expected
columns: {expected} Data columns: {data_cols}'. Indicates
that the expected fields of the object were not met at the
objects passed to save.</li>
<li><strong>PumpWoodException:</strong>  Other sqlalchemy and psycopg2 errors not associated with
IntegrityError.</li>
<li><strong>PumpWoodException:</strong>  'Bulk save not avaiable.'. Indicates that Bulk save end-point
was not configured for this model_class.</li>
<li><strong>PumpWoodIntegrityError:</strong>  Raise integrity errors from sqlalchemy and psycopg2. Usually
associated with uniqueness of some column.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.flatten_parallel" class="classattr">
                                        <input id="PumpWoodMicroService.flatten_parallel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">flatten_parallel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parallel_result</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.flatten_parallel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.flatten_parallel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.flatten_parallel-2701"><a href="#PumpWoodMicroService.flatten_parallel-2701"><span class="linenos">2701</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2702"><a href="#PumpWoodMicroService.flatten_parallel-2702"><span class="linenos">2702</span></a>    <span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2703"><a href="#PumpWoodMicroService.flatten_parallel-2703"><span class="linenos">2703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Concat all parallel return to one list.</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2704"><a href="#PumpWoodMicroService.flatten_parallel-2704"><span class="linenos">2704</span></a>
</span><span id="PumpWoodMicroService.flatten_parallel-2705"><a href="#PumpWoodMicroService.flatten_parallel-2705"><span class="linenos">2705</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2706"><a href="#PumpWoodMicroService.flatten_parallel-2706"><span class="linenos">2706</span></a><span class="sd">            parallel_result:</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2707"><a href="#PumpWoodMicroService.flatten_parallel-2707"><span class="linenos">2707</span></a><span class="sd">                A list of lists to be flated (concatenate</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2708"><a href="#PumpWoodMicroService.flatten_parallel-2708"><span class="linenos">2708</span></a><span class="sd">                all lists into one).</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2709"><a href="#PumpWoodMicroService.flatten_parallel-2709"><span class="linenos">2709</span></a>
</span><span id="PumpWoodMicroService.flatten_parallel-2710"><a href="#PumpWoodMicroService.flatten_parallel-2710"><span class="linenos">2710</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2711"><a href="#PumpWoodMicroService.flatten_parallel-2711"><span class="linenos">2711</span></a><span class="sd">            A list with all sub list itens.</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2712"><a href="#PumpWoodMicroService.flatten_parallel-2712"><span class="linenos">2712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2713"><a href="#PumpWoodMicroService.flatten_parallel-2713"><span class="linenos">2713</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2714"><a href="#PumpWoodMicroService.flatten_parallel-2714"><span class="linenos">2714</span></a>            <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
</span><span id="PumpWoodMicroService.flatten_parallel-2715"><a href="#PumpWoodMicroService.flatten_parallel-2715"><span class="linenos">2715</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Concat all parallel return to one list.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>parallel_result:</strong>  A list of lists to be flated (concatenate
all lists into one).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list with all sub list itens.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_request_get" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_request_get-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_request_get</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">urls_list</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_request_get-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_request_get"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_request_get-2726"><a href="#PumpWoodMicroService.parallel_request_get-2726"><span class="linenos">2726</span></a>    <span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2727"><a href="#PumpWoodMicroService.parallel_request_get-2727"><span class="linenos">2727</span></a>                             <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2728"><a href="#PumpWoodMicroService.parallel_request_get-2728"><span class="linenos">2728</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2729"><a href="#PumpWoodMicroService.parallel_request_get-2729"><span class="linenos">2729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel get requests.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2730"><a href="#PumpWoodMicroService.parallel_request_get-2730"><span class="linenos">2730</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2731"><a href="#PumpWoodMicroService.parallel_request_get-2731"><span class="linenos">2731</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2732"><a href="#PumpWoodMicroService.parallel_request_get-2732"><span class="linenos">2732</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2733"><a href="#PumpWoodMicroService.parallel_request_get-2733"><span class="linenos">2733</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2734"><a href="#PumpWoodMicroService.parallel_request_get-2734"><span class="linenos">2734</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2735"><a href="#PumpWoodMicroService.parallel_request_get-2735"><span class="linenos">2735</span></a><span class="sd">                A list of dictionary or a dictionary that will be replicated</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2736"><a href="#PumpWoodMicroService.parallel_request_get-2736"><span class="linenos">2736</span></a><span class="sd">                len(urls_list) and passed to parallel request as url</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2737"><a href="#PumpWoodMicroService.parallel_request_get-2737"><span class="linenos">2737</span></a><span class="sd">                parameter. If not set, empty dictionary will be passed to all</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2738"><a href="#PumpWoodMicroService.parallel_request_get-2738"><span class="linenos">2738</span></a><span class="sd">                request as default.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2739"><a href="#PumpWoodMicroService.parallel_request_get-2739"><span class="linenos">2739</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2740"><a href="#PumpWoodMicroService.parallel_request_get-2740"><span class="linenos">2740</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2741"><a href="#PumpWoodMicroService.parallel_request_get-2741"><span class="linenos">2741</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2742"><a href="#PumpWoodMicroService.parallel_request_get-2742"><span class="linenos">2742</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2743"><a href="#PumpWoodMicroService.parallel_request_get-2743"><span class="linenos">2743</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2744"><a href="#PumpWoodMicroService.parallel_request_get-2744"><span class="linenos">2744</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2745"><a href="#PumpWoodMicroService.parallel_request_get-2745"><span class="linenos">2745</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2746"><a href="#PumpWoodMicroService.parallel_request_get-2746"><span class="linenos">2746</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2747"><a href="#PumpWoodMicroService.parallel_request_get-2747"><span class="linenos">2747</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2748"><a href="#PumpWoodMicroService.parallel_request_get-2748"><span class="linenos">2748</span></a><span class="sd">            Return a list with all get request reponses. The results are</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2749"><a href="#PumpWoodMicroService.parallel_request_get-2749"><span class="linenos">2749</span></a><span class="sd">            on the same order of argument list.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2750"><a href="#PumpWoodMicroService.parallel_request_get-2750"><span class="linenos">2750</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2751"><a href="#PumpWoodMicroService.parallel_request_get-2751"><span class="linenos">2751</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2752"><a href="#PumpWoodMicroService.parallel_request_get-2752"><span class="linenos">2752</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2753"><a href="#PumpWoodMicroService.parallel_request_get-2753"><span class="linenos">2753</span></a><span class="sd">                &#39;lenght of urls_list[{}] is different of parameters[{}]&#39;.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2754"><a href="#PumpWoodMicroService.parallel_request_get-2754"><span class="linenos">2754</span></a><span class="sd">                Indicates that the function arguments `urls_list` and</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2755"><a href="#PumpWoodMicroService.parallel_request_get-2755"><span class="linenos">2755</span></a><span class="sd">                `parameters` (when passed as a list of dictionaries)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2756"><a href="#PumpWoodMicroService.parallel_request_get-2756"><span class="linenos">2756</span></a><span class="sd">                does not have de same lenght.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2757"><a href="#PumpWoodMicroService.parallel_request_get-2757"><span class="linenos">2757</span></a><span class="sd">            PumpWoodNotImplementedError:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2758"><a href="#PumpWoodMicroService.parallel_request_get-2758"><span class="linenos">2758</span></a><span class="sd">                &#39;paraemters type[{}] is not implemented&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2759"><a href="#PumpWoodMicroService.parallel_request_get-2759"><span class="linenos">2759</span></a><span class="sd">                `parameters` passed as function argument is not a list of dict</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2760"><a href="#PumpWoodMicroService.parallel_request_get-2760"><span class="linenos">2760</span></a><span class="sd">                or a dictinary, so not implemented.</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2761"><a href="#PumpWoodMicroService.parallel_request_get-2761"><span class="linenos">2761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2762"><a href="#PumpWoodMicroService.parallel_request_get-2762"><span class="linenos">2762</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2763"><a href="#PumpWoodMicroService.parallel_request_get-2763"><span class="linenos">2763</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2764"><a href="#PumpWoodMicroService.parallel_request_get-2764"><span class="linenos">2764</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2765"><a href="#PumpWoodMicroService.parallel_request_get-2765"><span class="linenos">2765</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2766"><a href="#PumpWoodMicroService.parallel_request_get-2766"><span class="linenos">2766</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2767"><a href="#PumpWoodMicroService.parallel_request_get-2767"><span class="linenos">2767</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2768"><a href="#PumpWoodMicroService.parallel_request_get-2768"><span class="linenos">2768</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2769"><a href="#PumpWoodMicroService.parallel_request_get-2769"><span class="linenos">2769</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2770"><a href="#PumpWoodMicroService.parallel_request_get-2770"><span class="linenos">2770</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2771"><a href="#PumpWoodMicroService.parallel_request_get-2771"><span class="linenos">2771</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2772"><a href="#PumpWoodMicroService.parallel_request_get-2772"><span class="linenos">2772</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2773"><a href="#PumpWoodMicroService.parallel_request_get-2773"><span class="linenos">2773</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2774"><a href="#PumpWoodMicroService.parallel_request_get-2774"><span class="linenos">2774</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2775"><a href="#PumpWoodMicroService.parallel_request_get-2775"><span class="linenos">2775</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2776"><a href="#PumpWoodMicroService.parallel_request_get-2776"><span class="linenos">2776</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2777"><a href="#PumpWoodMicroService.parallel_request_get-2777"><span class="linenos">2777</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2778"><a href="#PumpWoodMicroService.parallel_request_get-2778"><span class="linenos">2778</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2779"><a href="#PumpWoodMicroService.parallel_request_get-2779"><span class="linenos">2779</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2780"><a href="#PumpWoodMicroService.parallel_request_get-2780"><span class="linenos">2780</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2781"><a href="#PumpWoodMicroService.parallel_request_get-2781"><span class="linenos">2781</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2782"><a href="#PumpWoodMicroService.parallel_request_get-2782"><span class="linenos">2782</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2783"><a href="#PumpWoodMicroService.parallel_request_get-2783"><span class="linenos">2783</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2784"><a href="#PumpWoodMicroService.parallel_request_get-2784"><span class="linenos">2784</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2785"><a href="#PumpWoodMicroService.parallel_request_get-2785"><span class="linenos">2785</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2786"><a href="#PumpWoodMicroService.parallel_request_get-2786"><span class="linenos">2786</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2787"><a href="#PumpWoodMicroService.parallel_request_get-2787"><span class="linenos">2787</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2788"><a href="#PumpWoodMicroService.parallel_request_get-2788"><span class="linenos">2788</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2789"><a href="#PumpWoodMicroService.parallel_request_get-2789"><span class="linenos">2789</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2790"><a href="#PumpWoodMicroService.parallel_request_get-2790"><span class="linenos">2790</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2791"><a href="#PumpWoodMicroService.parallel_request_get-2791"><span class="linenos">2791</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2792"><a href="#PumpWoodMicroService.parallel_request_get-2792"><span class="linenos">2792</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2793"><a href="#PumpWoodMicroService.parallel_request_get-2793"><span class="linenos">2793</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2794"><a href="#PumpWoodMicroService.parallel_request_get-2794"><span class="linenos">2794</span></a>
</span><span id="PumpWoodMicroService.parallel_request_get-2795"><a href="#PumpWoodMicroService.parallel_request_get-2795"><span class="linenos">2795</span></a>        <span class="c1"># Run requests in parallel</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2796"><a href="#PumpWoodMicroService.parallel_request_get-2796"><span class="linenos">2796</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2797"><a href="#PumpWoodMicroService.parallel_request_get-2797"><span class="linenos">2797</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2798"><a href="#PumpWoodMicroService.parallel_request_get-2798"><span class="linenos">2798</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_request_get-2799"><a href="#PumpWoodMicroService.parallel_request_get-2799"><span class="linenos">2799</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel get requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>urls_list:</strong>  List of urls to make get requests.</li>
<li><strong>parameters:</strong>  A list of dictionary or a dictionary that will be replicated
len(urls_list) and passed to parallel request as url
parameter. If not set, empty dictionary will be passed to all
request as default.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Return a list with all get request reponses. The results are
  on the same order of argument list.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'lenght of urls_list[{}] is different of parameters[{}]'.
Indicates that the function arguments <code>urls_list</code> and
<code>parameters</code> (when passed as a list of dictionaries)
does not have de same lenght.</li>
<li><strong>PumpWoodNotImplementedError:</strong>  'paraemters type[{}] is not implemented'. Indicates that
<code>parameters</code> passed as function argument is not a list of dict
or a dictinary, so not implemented.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.paralell_request_post" class="classattr">
                                        <input id="PumpWoodMicroService.paralell_request_post-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">paralell_request_post</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">data_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">any</span><span class="o">&gt;</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.paralell_request_post-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.paralell_request_post"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.paralell_request_post-2810"><a href="#PumpWoodMicroService.paralell_request_post-2810"><span class="linenos">2810</span></a>    <span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2811"><a href="#PumpWoodMicroService.paralell_request_post-2811"><span class="linenos">2811</span></a>                              <span class="n">data_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2812"><a href="#PumpWoodMicroService.paralell_request_post-2812"><span class="linenos">2812</span></a>                              <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2813"><a href="#PumpWoodMicroService.paralell_request_post-2813"><span class="linenos">2813</span></a>                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2814"><a href="#PumpWoodMicroService.paralell_request_post-2814"><span class="linenos">2814</span></a>                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">any</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2815"><a href="#PumpWoodMicroService.paralell_request_post-2815"><span class="linenos">2815</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel post request.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2816"><a href="#PumpWoodMicroService.paralell_request_post-2816"><span class="linenos">2816</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2817"><a href="#PumpWoodMicroService.paralell_request_post-2817"><span class="linenos">2817</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2818"><a href="#PumpWoodMicroService.paralell_request_post-2818"><span class="linenos">2818</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2819"><a href="#PumpWoodMicroService.paralell_request_post-2819"><span class="linenos">2819</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2820"><a href="#PumpWoodMicroService.paralell_request_post-2820"><span class="linenos">2820</span></a><span class="sd">            data_list:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2821"><a href="#PumpWoodMicroService.paralell_request_post-2821"><span class="linenos">2821</span></a><span class="sd">                List of data to be used as post payloads.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2822"><a href="#PumpWoodMicroService.paralell_request_post-2822"><span class="linenos">2822</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2823"><a href="#PumpWoodMicroService.paralell_request_post-2823"><span class="linenos">2823</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2824"><a href="#PumpWoodMicroService.paralell_request_post-2824"><span class="linenos">2824</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2825"><a href="#PumpWoodMicroService.paralell_request_post-2825"><span class="linenos">2825</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2826"><a href="#PumpWoodMicroService.paralell_request_post-2826"><span class="linenos">2826</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2827"><a href="#PumpWoodMicroService.paralell_request_post-2827"><span class="linenos">2827</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2828"><a href="#PumpWoodMicroService.paralell_request_post-2828"><span class="linenos">2828</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2829"><a href="#PumpWoodMicroService.paralell_request_post-2829"><span class="linenos">2829</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2830"><a href="#PumpWoodMicroService.paralell_request_post-2830"><span class="linenos">2830</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2831"><a href="#PumpWoodMicroService.paralell_request_post-2831"><span class="linenos">2831</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2832"><a href="#PumpWoodMicroService.paralell_request_post-2832"><span class="linenos">2832</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2833"><a href="#PumpWoodMicroService.paralell_request_post-2833"><span class="linenos">2833</span></a><span class="sd">            List of the post request reponses.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2834"><a href="#PumpWoodMicroService.paralell_request_post-2834"><span class="linenos">2834</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2835"><a href="#PumpWoodMicroService.paralell_request_post-2835"><span class="linenos">2835</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2836"><a href="#PumpWoodMicroService.paralell_request_post-2836"><span class="linenos">2836</span></a><span class="sd">            No particular raises</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2837"><a href="#PumpWoodMicroService.paralell_request_post-2837"><span class="linenos">2837</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2838"><a href="#PumpWoodMicroService.paralell_request_post-2838"><span class="linenos">2838</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2839"><a href="#PumpWoodMicroService.paralell_request_post-2839"><span class="linenos">2839</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2840"><a href="#PumpWoodMicroService.paralell_request_post-2840"><span class="linenos">2840</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2841"><a href="#PumpWoodMicroService.paralell_request_post-2841"><span class="linenos">2841</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2842"><a href="#PumpWoodMicroService.paralell_request_post-2842"><span class="linenos">2842</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2843"><a href="#PumpWoodMicroService.paralell_request_post-2843"><span class="linenos">2843</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2844"><a href="#PumpWoodMicroService.paralell_request_post-2844"><span class="linenos">2844</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2845"><a href="#PumpWoodMicroService.paralell_request_post-2845"><span class="linenos">2845</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2846"><a href="#PumpWoodMicroService.paralell_request_post-2846"><span class="linenos">2846</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2847"><a href="#PumpWoodMicroService.paralell_request_post-2847"><span class="linenos">2847</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2848"><a href="#PumpWoodMicroService.paralell_request_post-2848"><span class="linenos">2848</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2849"><a href="#PumpWoodMicroService.paralell_request_post-2849"><span class="linenos">2849</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2850"><a href="#PumpWoodMicroService.paralell_request_post-2850"><span class="linenos">2850</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2851"><a href="#PumpWoodMicroService.paralell_request_post-2851"><span class="linenos">2851</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2852"><a href="#PumpWoodMicroService.paralell_request_post-2852"><span class="linenos">2852</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2853"><a href="#PumpWoodMicroService.paralell_request_post-2853"><span class="linenos">2853</span></a>            <span class="n">parameters_list</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2854"><a href="#PumpWoodMicroService.paralell_request_post-2854"><span class="linenos">2854</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2855"><a href="#PumpWoodMicroService.paralell_request_post-2855"><span class="linenos">2855</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2856"><a href="#PumpWoodMicroService.paralell_request_post-2856"><span class="linenos">2856</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2857"><a href="#PumpWoodMicroService.paralell_request_post-2857"><span class="linenos">2857</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2858"><a href="#PumpWoodMicroService.paralell_request_post-2858"><span class="linenos">2858</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2859"><a href="#PumpWoodMicroService.paralell_request_post-2859"><span class="linenos">2859</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2860"><a href="#PumpWoodMicroService.paralell_request_post-2860"><span class="linenos">2860</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2861"><a href="#PumpWoodMicroService.paralell_request_post-2861"><span class="linenos">2861</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2862"><a href="#PumpWoodMicroService.paralell_request_post-2862"><span class="linenos">2862</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2863"><a href="#PumpWoodMicroService.paralell_request_post-2863"><span class="linenos">2863</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2864"><a href="#PumpWoodMicroService.paralell_request_post-2864"><span class="linenos">2864</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2865"><a href="#PumpWoodMicroService.paralell_request_post-2865"><span class="linenos">2865</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2866"><a href="#PumpWoodMicroService.paralell_request_post-2866"><span class="linenos">2866</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2867"><a href="#PumpWoodMicroService.paralell_request_post-2867"><span class="linenos">2867</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2868"><a href="#PumpWoodMicroService.paralell_request_post-2868"><span class="linenos">2868</span></a>        <span class="c1"># Validate if length of URL is the same of data_list</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2869"><a href="#PumpWoodMicroService.paralell_request_post-2869"><span class="linenos">2869</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2870"><a href="#PumpWoodMicroService.paralell_request_post-2870"><span class="linenos">2870</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2871"><a href="#PumpWoodMicroService.paralell_request_post-2871"><span class="linenos">2871</span></a>                <span class="s1">&#39;len(urls_list)[</span><span class="si">{}</span><span class="s1">] must be equal &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2872"><a href="#PumpWoodMicroService.paralell_request_post-2872"><span class="linenos">2872</span></a>                <span class="s1">&#39;to len(data_list)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2873"><a href="#PumpWoodMicroService.paralell_request_post-2873"><span class="linenos">2873</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2874"><a href="#PumpWoodMicroService.paralell_request_post-2874"><span class="linenos">2874</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2875"><a href="#PumpWoodMicroService.paralell_request_post-2875"><span class="linenos">2875</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2876"><a href="#PumpWoodMicroService.paralell_request_post-2876"><span class="linenos">2876</span></a>        <span class="c1"># Create the arguments for parallel requests</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2877"><a href="#PumpWoodMicroService.paralell_request_post-2877"><span class="linenos">2877</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2878"><a href="#PumpWoodMicroService.paralell_request_post-2878"><span class="linenos">2878</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2879"><a href="#PumpWoodMicroService.paralell_request_post-2879"><span class="linenos">2879</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2880"><a href="#PumpWoodMicroService.paralell_request_post-2880"><span class="linenos">2880</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2881"><a href="#PumpWoodMicroService.paralell_request_post-2881"><span class="linenos">2881</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2882"><a href="#PumpWoodMicroService.paralell_request_post-2882"><span class="linenos">2882</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2883"><a href="#PumpWoodMicroService.paralell_request_post-2883"><span class="linenos">2883</span></a>                <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2884"><a href="#PumpWoodMicroService.paralell_request_post-2884"><span class="linenos">2884</span></a>
</span><span id="PumpWoodMicroService.paralell_request_post-2885"><a href="#PumpWoodMicroService.paralell_request_post-2885"><span class="linenos">2885</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2886"><a href="#PumpWoodMicroService.paralell_request_post-2886"><span class="linenos">2886</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2887"><a href="#PumpWoodMicroService.paralell_request_post-2887"><span class="linenos">2887</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_post-2888"><a href="#PumpWoodMicroService.paralell_request_post-2888"><span class="linenos">2888</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel post request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>urls_list:</strong>  List of urls to make get requests.</li>
<li><strong>data_list:</strong>  List of data to be used as post payloads.</li>
<li><strong>parameters:</strong>  URL paramenters to make the post requests.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the post request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example yet.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.paralell_request_delete" class="classattr">
                                        <input id="PumpWoodMicroService.paralell_request_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">paralell_request_delete</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.paralell_request_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.paralell_request_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.paralell_request_delete-2899"><a href="#PumpWoodMicroService.paralell_request_delete-2899"><span class="linenos">2899</span></a>    <span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2900"><a href="#PumpWoodMicroService.paralell_request_delete-2900"><span class="linenos">2900</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2901"><a href="#PumpWoodMicroService.paralell_request_delete-2901"><span class="linenos">2901</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2902"><a href="#PumpWoodMicroService.paralell_request_delete-2902"><span class="linenos">2902</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2903"><a href="#PumpWoodMicroService.paralell_request_delete-2903"><span class="linenos">2903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete request.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2904"><a href="#PumpWoodMicroService.paralell_request_delete-2904"><span class="linenos">2904</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2905"><a href="#PumpWoodMicroService.paralell_request_delete-2905"><span class="linenos">2905</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2906"><a href="#PumpWoodMicroService.paralell_request_delete-2906"><span class="linenos">2906</span></a><span class="sd">            urls_list:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2907"><a href="#PumpWoodMicroService.paralell_request_delete-2907"><span class="linenos">2907</span></a><span class="sd">                List of urls to make get requests.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2908"><a href="#PumpWoodMicroService.paralell_request_delete-2908"><span class="linenos">2908</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2909"><a href="#PumpWoodMicroService.paralell_request_delete-2909"><span class="linenos">2909</span></a><span class="sd">                URL paramenters to make the post requests.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2910"><a href="#PumpWoodMicroService.paralell_request_delete-2910"><span class="linenos">2910</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2911"><a href="#PumpWoodMicroService.paralell_request_delete-2911"><span class="linenos">2911</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2912"><a href="#PumpWoodMicroService.paralell_request_delete-2912"><span class="linenos">2912</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2913"><a href="#PumpWoodMicroService.paralell_request_delete-2913"><span class="linenos">2913</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2914"><a href="#PumpWoodMicroService.paralell_request_delete-2914"><span class="linenos">2914</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2915"><a href="#PumpWoodMicroService.paralell_request_delete-2915"><span class="linenos">2915</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2916"><a href="#PumpWoodMicroService.paralell_request_delete-2916"><span class="linenos">2916</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2917"><a href="#PumpWoodMicroService.paralell_request_delete-2917"><span class="linenos">2917</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2918"><a href="#PumpWoodMicroService.paralell_request_delete-2918"><span class="linenos">2918</span></a><span class="sd">            list: List of the get request reponses.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2919"><a href="#PumpWoodMicroService.paralell_request_delete-2919"><span class="linenos">2919</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2920"><a href="#PumpWoodMicroService.paralell_request_delete-2920"><span class="linenos">2920</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2921"><a href="#PumpWoodMicroService.paralell_request_delete-2921"><span class="linenos">2921</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2922"><a href="#PumpWoodMicroService.paralell_request_delete-2922"><span class="linenos">2922</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2923"><a href="#PumpWoodMicroService.paralell_request_delete-2923"><span class="linenos">2923</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2924"><a href="#PumpWoodMicroService.paralell_request_delete-2924"><span class="linenos">2924</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2925"><a href="#PumpWoodMicroService.paralell_request_delete-2925"><span class="linenos">2925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2926"><a href="#PumpWoodMicroService.paralell_request_delete-2926"><span class="linenos">2926</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2927"><a href="#PumpWoodMicroService.paralell_request_delete-2927"><span class="linenos">2927</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2928"><a href="#PumpWoodMicroService.paralell_request_delete-2928"><span class="linenos">2928</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2929"><a href="#PumpWoodMicroService.paralell_request_delete-2929"><span class="linenos">2929</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2930"><a href="#PumpWoodMicroService.paralell_request_delete-2930"><span class="linenos">2930</span></a>        <span class="c1"># Create URL parameters if not set as parameter with</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2931"><a href="#PumpWoodMicroService.paralell_request_delete-2931"><span class="linenos">2931</span></a>        <span class="c1"># empty dicionaries</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2932"><a href="#PumpWoodMicroService.paralell_request_delete-2932"><span class="linenos">2932</span></a>        <span class="n">n_urls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2933"><a href="#PumpWoodMicroService.paralell_request_delete-2933"><span class="linenos">2933</span></a>        <span class="n">parameters_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2934"><a href="#PumpWoodMicroService.paralell_request_delete-2934"><span class="linenos">2934</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2935"><a href="#PumpWoodMicroService.paralell_request_delete-2935"><span class="linenos">2935</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2936"><a href="#PumpWoodMicroService.paralell_request_delete-2936"><span class="linenos">2936</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2937"><a href="#PumpWoodMicroService.paralell_request_delete-2937"><span class="linenos">2937</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="n">parameters</span><span class="p">}]</span> <span class="o">*</span> <span class="n">n_urls</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2938"><a href="#PumpWoodMicroService.paralell_request_delete-2938"><span class="linenos">2938</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2939"><a href="#PumpWoodMicroService.paralell_request_delete-2939"><span class="linenos">2939</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_urls</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2940"><a href="#PumpWoodMicroService.paralell_request_delete-2940"><span class="linenos">2940</span></a>                <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2941"><a href="#PumpWoodMicroService.paralell_request_delete-2941"><span class="linenos">2941</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2942"><a href="#PumpWoodMicroService.paralell_request_delete-2942"><span class="linenos">2942</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2943"><a href="#PumpWoodMicroService.paralell_request_delete-2943"><span class="linenos">2943</span></a>                    <span class="s1">&#39;lenght of urls_list[</span><span class="si">{}</span><span class="s1">] is different of &#39;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2944"><a href="#PumpWoodMicroService.paralell_request_delete-2944"><span class="linenos">2944</span></a>                    <span class="s1">&#39;parameters[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2945"><a href="#PumpWoodMicroService.paralell_request_delete-2945"><span class="linenos">2945</span></a>                        <span class="n">n_urls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2946"><a href="#PumpWoodMicroService.paralell_request_delete-2946"><span class="linenos">2946</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2947"><a href="#PumpWoodMicroService.paralell_request_delete-2947"><span class="linenos">2947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2948"><a href="#PumpWoodMicroService.paralell_request_delete-2948"><span class="linenos">2948</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;paraemters type[</span><span class="si">{}</span><span class="s1">] is not implemented&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2949"><a href="#PumpWoodMicroService.paralell_request_delete-2949"><span class="linenos">2949</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2950"><a href="#PumpWoodMicroService.paralell_request_delete-2950"><span class="linenos">2950</span></a>            <span class="k">raise</span> <span class="n">PumpWoodNotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2951"><a href="#PumpWoodMicroService.paralell_request_delete-2951"><span class="linenos">2951</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2952"><a href="#PumpWoodMicroService.paralell_request_delete-2952"><span class="linenos">2952</span></a>        <span class="c1"># Create Pool arguments to run in parallel</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2953"><a href="#PumpWoodMicroService.paralell_request_delete-2953"><span class="linenos">2953</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2954"><a href="#PumpWoodMicroService.paralell_request_delete-2954"><span class="linenos">2954</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2955"><a href="#PumpWoodMicroService.paralell_request_delete-2955"><span class="linenos">2955</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2956"><a href="#PumpWoodMicroService.paralell_request_delete-2956"><span class="linenos">2956</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2957"><a href="#PumpWoodMicroService.paralell_request_delete-2957"><span class="linenos">2957</span></a>                <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2958"><a href="#PumpWoodMicroService.paralell_request_delete-2958"><span class="linenos">2958</span></a>
</span><span id="PumpWoodMicroService.paralell_request_delete-2959"><a href="#PumpWoodMicroService.paralell_request_delete-2959"><span class="linenos">2959</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2960"><a href="#PumpWoodMicroService.paralell_request_delete-2960"><span class="linenos">2960</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2961"><a href="#PumpWoodMicroService.paralell_request_delete-2961"><span class="linenos">2961</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.paralell_request_delete-2962"><a href="#PumpWoodMicroService.paralell_request_delete-2962"><span class="linenos">2962</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel delete request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>urls_list:</strong>  List of urls to make get requests.</li>
<li><strong>parameters:</strong>  URL paramenters to make the post requests.</li>
<li><strong>n_parallel (int):</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list: List of the get request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example yet.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_retrieve" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_retrieve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_retrieve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_retrieve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_retrieve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_retrieve-2966"><a href="#PumpWoodMicroService.parallel_retrieve-2966"><span class="linenos">2966</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2967"><a href="#PumpWoodMicroService.parallel_retrieve-2967"><span class="linenos">2967</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2968"><a href="#PumpWoodMicroService.parallel_retrieve-2968"><span class="linenos">2968</span></a>                          <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2969"><a href="#PumpWoodMicroService.parallel_retrieve-2969"><span class="linenos">2969</span></a>                          <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2970"><a href="#PumpWoodMicroService.parallel_retrieve-2970"><span class="linenos">2970</span></a>                          <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2971"><a href="#PumpWoodMicroService.parallel_retrieve-2971"><span class="linenos">2971</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2972"><a href="#PumpWoodMicroService.parallel_retrieve-2972"><span class="linenos">2972</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel retrieve request.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2973"><a href="#PumpWoodMicroService.parallel_retrieve-2973"><span class="linenos">2973</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-2974"><a href="#PumpWoodMicroService.parallel_retrieve-2974"><span class="linenos">2974</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2975"><a href="#PumpWoodMicroService.parallel_retrieve-2975"><span class="linenos">2975</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2976"><a href="#PumpWoodMicroService.parallel_retrieve-2976"><span class="linenos">2976</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2977"><a href="#PumpWoodMicroService.parallel_retrieve-2977"><span class="linenos">2977</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2978"><a href="#PumpWoodMicroService.parallel_retrieve-2978"><span class="linenos">2978</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2979"><a href="#PumpWoodMicroService.parallel_retrieve-2979"><span class="linenos">2979</span></a><span class="sd">            fields:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2980"><a href="#PumpWoodMicroService.parallel_retrieve-2980"><span class="linenos">2980</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2981"><a href="#PumpWoodMicroService.parallel_retrieve-2981"><span class="linenos">2981</span></a><span class="sd">            default_fields:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2982"><a href="#PumpWoodMicroService.parallel_retrieve-2982"><span class="linenos">2982</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2983"><a href="#PumpWoodMicroService.parallel_retrieve-2983"><span class="linenos">2983</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2984"><a href="#PumpWoodMicroService.parallel_retrieve-2984"><span class="linenos">2984</span></a><span class="sd">            foreign_key_fields:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2985"><a href="#PumpWoodMicroService.parallel_retrieve-2985"><span class="linenos">2985</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2986"><a href="#PumpWoodMicroService.parallel_retrieve-2986"><span class="linenos">2986</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2987"><a href="#PumpWoodMicroService.parallel_retrieve-2987"><span class="linenos">2987</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2988"><a href="#PumpWoodMicroService.parallel_retrieve-2988"><span class="linenos">2988</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2989"><a href="#PumpWoodMicroService.parallel_retrieve-2989"><span class="linenos">2989</span></a><span class="sd">            related_fields:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2990"><a href="#PumpWoodMicroService.parallel_retrieve-2990"><span class="linenos">2990</span></a><span class="sd">                Return related fields objects. Related field objects are</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2991"><a href="#PumpWoodMicroService.parallel_retrieve-2991"><span class="linenos">2991</span></a><span class="sd">                objects that have a forenging key associated with this</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2992"><a href="#PumpWoodMicroService.parallel_retrieve-2992"><span class="linenos">2992</span></a><span class="sd">                model_class, results will be returned as a list of</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2993"><a href="#PumpWoodMicroService.parallel_retrieve-2993"><span class="linenos">2993</span></a><span class="sd">                dictionaries usually in a field with `_set` at end.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2994"><a href="#PumpWoodMicroService.parallel_retrieve-2994"><span class="linenos">2994</span></a><span class="sd">                Returning related_fields consume backend resorces, use</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2995"><a href="#PumpWoodMicroService.parallel_retrieve-2995"><span class="linenos">2995</span></a><span class="sd">                carefully.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2996"><a href="#PumpWoodMicroService.parallel_retrieve-2996"><span class="linenos">2996</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2997"><a href="#PumpWoodMicroService.parallel_retrieve-2997"><span class="linenos">2997</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2998"><a href="#PumpWoodMicroService.parallel_retrieve-2998"><span class="linenos">2998</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-2999"><a href="#PumpWoodMicroService.parallel_retrieve-2999"><span class="linenos">2999</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3000"><a href="#PumpWoodMicroService.parallel_retrieve-3000"><span class="linenos">3000</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3001"><a href="#PumpWoodMicroService.parallel_retrieve-3001"><span class="linenos">3001</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3002"><a href="#PumpWoodMicroService.parallel_retrieve-3002"><span class="linenos">3002</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-3003"><a href="#PumpWoodMicroService.parallel_retrieve-3003"><span class="linenos">3003</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3004"><a href="#PumpWoodMicroService.parallel_retrieve-3004"><span class="linenos">3004</span></a><span class="sd">            List of the retrieve request data.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3005"><a href="#PumpWoodMicroService.parallel_retrieve-3005"><span class="linenos">3005</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-3006"><a href="#PumpWoodMicroService.parallel_retrieve-3006"><span class="linenos">3006</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3007"><a href="#PumpWoodMicroService.parallel_retrieve-3007"><span class="linenos">3007</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3008"><a href="#PumpWoodMicroService.parallel_retrieve-3008"><span class="linenos">3008</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_pk)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3009"><a href="#PumpWoodMicroService.parallel_retrieve-3009"><span class="linenos">3009</span></a><span class="sd">                the lenght of the arguments model_class and list_pk are</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3010"><a href="#PumpWoodMicroService.parallel_retrieve-3010"><span class="linenos">3010</span></a><span class="sd">                incompatible.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3011"><a href="#PumpWoodMicroService.parallel_retrieve-3011"><span class="linenos">3011</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3012"><a href="#PumpWoodMicroService.parallel_retrieve-3012"><span class="linenos">3012</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3013"><a href="#PumpWoodMicroService.parallel_retrieve-3013"><span class="linenos">3013</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3014"><a href="#PumpWoodMicroService.parallel_retrieve-3014"><span class="linenos">3014</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3015"><a href="#PumpWoodMicroService.parallel_retrieve-3015"><span class="linenos">3015</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-3016"><a href="#PumpWoodMicroService.parallel_retrieve-3016"><span class="linenos">3016</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3017"><a href="#PumpWoodMicroService.parallel_retrieve-3017"><span class="linenos">3017</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3018"><a href="#PumpWoodMicroService.parallel_retrieve-3018"><span class="linenos">3018</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3019"><a href="#PumpWoodMicroService.parallel_retrieve-3019"><span class="linenos">3019</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3020"><a href="#PumpWoodMicroService.parallel_retrieve-3020"><span class="linenos">3020</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3021"><a href="#PumpWoodMicroService.parallel_retrieve-3021"><span class="linenos">3021</span></a>                    <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_pk)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3022"><a href="#PumpWoodMicroService.parallel_retrieve-3022"><span class="linenos">3022</span></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3023"><a href="#PumpWoodMicroService.parallel_retrieve-3023"><span class="linenos">3023</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3024"><a href="#PumpWoodMicroService.parallel_retrieve-3024"><span class="linenos">3024</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-3025"><a href="#PumpWoodMicroService.parallel_retrieve-3025"><span class="linenos">3025</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3026"><a href="#PumpWoodMicroService.parallel_retrieve-3026"><span class="linenos">3026</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3027"><a href="#PumpWoodMicroService.parallel_retrieve-3027"><span class="linenos">3027</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3028"><a href="#PumpWoodMicroService.parallel_retrieve-3028"><span class="linenos">3028</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3029"><a href="#PumpWoodMicroService.parallel_retrieve-3029"><span class="linenos">3029</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve-3030"><a href="#PumpWoodMicroService.parallel_retrieve-3030"><span class="linenos">3030</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3031"><a href="#PumpWoodMicroService.parallel_retrieve-3031"><span class="linenos">3031</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3032"><a href="#PumpWoodMicroService.parallel_retrieve-3032"><span class="linenos">3032</span></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3033"><a href="#PumpWoodMicroService.parallel_retrieve-3033"><span class="linenos">3033</span></a>                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3034"><a href="#PumpWoodMicroService.parallel_retrieve-3034"><span class="linenos">3034</span></a>                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3035"><a href="#PumpWoodMicroService.parallel_retrieve-3035"><span class="linenos">3035</span></a>                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">},</span>
</span><span id="PumpWoodMicroService.parallel_retrieve-3036"><a href="#PumpWoodMicroService.parallel_retrieve-3036"><span class="linenos">3036</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel retrieve request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to retrieve.</li>
<li><strong>list_pk:</strong>  List of the pks to retrieve.</li>
<li><strong>fields:</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields:</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>foreign_key_fields:</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
<li><strong>related_fields:</strong>  Return related fields objects. Related field objects are
objects that have a forenging key associated with this
model_class, results will be returned as a list of
dictionaries usually in a field with <code>_set</code> at end.
Returning related_fields consume backend resorces, use
carefully.</li>
<li><strong>n_parallel (int):</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the retrieve request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class)[{}] != len(list_pk)[{}]'. Indicates that
the lenght of the arguments model_class and list_pk are
incompatible.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_retrieve_file" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_retrieve_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_retrieve_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>,</span><span class="param">	<span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;fail&#39;</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_retrieve_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_retrieve_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_retrieve_file-3046"><a href="#PumpWoodMicroService.parallel_retrieve_file-3046"><span class="linenos">3046</span></a>    <span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3047"><a href="#PumpWoodMicroService.parallel_retrieve_file-3047"><span class="linenos">3047</span></a>                               <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3048"><a href="#PumpWoodMicroService.parallel_retrieve_file-3048"><span class="linenos">3048</span></a>                               <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3049"><a href="#PumpWoodMicroService.parallel_retrieve_file-3049"><span class="linenos">3049</span></a>                               <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3050"><a href="#PumpWoodMicroService.parallel_retrieve_file-3050"><span class="linenos">3050</span></a>                               <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3051"><a href="#PumpWoodMicroService.parallel_retrieve_file-3051"><span class="linenos">3051</span></a>                               <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3052"><a href="#PumpWoodMicroService.parallel_retrieve_file-3052"><span class="linenos">3052</span></a>                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3053"><a href="#PumpWoodMicroService.parallel_retrieve_file-3053"><span class="linenos">3053</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] retrieve request.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3054"><a href="#PumpWoodMicroService.parallel_retrieve_file-3054"><span class="linenos">3054</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3055"><a href="#PumpWoodMicroService.parallel_retrieve_file-3055"><span class="linenos">3055</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3056"><a href="#PumpWoodMicroService.parallel_retrieve_file-3056"><span class="linenos">3056</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3057"><a href="#PumpWoodMicroService.parallel_retrieve_file-3057"><span class="linenos">3057</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3058"><a href="#PumpWoodMicroService.parallel_retrieve_file-3058"><span class="linenos">3058</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3059"><a href="#PumpWoodMicroService.parallel_retrieve_file-3059"><span class="linenos">3059</span></a><span class="sd">                List of the pks to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3060"><a href="#PumpWoodMicroService.parallel_retrieve_file-3060"><span class="linenos">3060</span></a><span class="sd">            file_field:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3061"><a href="#PumpWoodMicroService.parallel_retrieve_file-3061"><span class="linenos">3061</span></a><span class="sd">                Indicates the file field to download from.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3062"><a href="#PumpWoodMicroService.parallel_retrieve_file-3062"><span class="linenos">3062</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3063"><a href="#PumpWoodMicroService.parallel_retrieve_file-3063"><span class="linenos">3063</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3064"><a href="#PumpWoodMicroService.parallel_retrieve_file-3064"><span class="linenos">3064</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3065"><a href="#PumpWoodMicroService.parallel_retrieve_file-3065"><span class="linenos">3065</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3066"><a href="#PumpWoodMicroService.parallel_retrieve_file-3066"><span class="linenos">3066</span></a><span class="sd">            save_path:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3067"><a href="#PumpWoodMicroService.parallel_retrieve_file-3067"><span class="linenos">3067</span></a><span class="sd">                Path to be used to save files.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3068"><a href="#PumpWoodMicroService.parallel_retrieve_file-3068"><span class="linenos">3068</span></a><span class="sd">            save_file:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3069"><a href="#PumpWoodMicroService.parallel_retrieve_file-3069"><span class="linenos">3069</span></a><span class="sd">                True save file locally, False return file content as bites.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3070"><a href="#PumpWoodMicroService.parallel_retrieve_file-3070"><span class="linenos">3070</span></a><span class="sd">            list_file_name:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3071"><a href="#PumpWoodMicroService.parallel_retrieve_file-3071"><span class="linenos">3071</span></a><span class="sd">                Set a file name for each file download.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3072"><a href="#PumpWoodMicroService.parallel_retrieve_file-3072"><span class="linenos">3072</span></a><span class="sd">            if_exists:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3073"><a href="#PumpWoodMicroService.parallel_retrieve_file-3073"><span class="linenos">3073</span></a><span class="sd">                Set how treat when a file will be saved</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3074"><a href="#PumpWoodMicroService.parallel_retrieve_file-3074"><span class="linenos">3074</span></a><span class="sd">                and there is another at same path. &quot;fail&quot; will raise an error;</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3075"><a href="#PumpWoodMicroService.parallel_retrieve_file-3075"><span class="linenos">3075</span></a><span class="sd">                &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3076"><a href="#PumpWoodMicroService.parallel_retrieve_file-3076"><span class="linenos">3076</span></a><span class="sd">                when list_file_name is set, check before downloaded it file</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3077"><a href="#PumpWoodMicroService.parallel_retrieve_file-3077"><span class="linenos">3077</span></a><span class="sd">                already exists, if so skip the download.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3078"><a href="#PumpWoodMicroService.parallel_retrieve_file-3078"><span class="linenos">3078</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3079"><a href="#PumpWoodMicroService.parallel_retrieve_file-3079"><span class="linenos">3079</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3080"><a href="#PumpWoodMicroService.parallel_retrieve_file-3080"><span class="linenos">3080</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3081"><a href="#PumpWoodMicroService.parallel_retrieve_file-3081"><span class="linenos">3081</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3082"><a href="#PumpWoodMicroService.parallel_retrieve_file-3082"><span class="linenos">3082</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3083"><a href="#PumpWoodMicroService.parallel_retrieve_file-3083"><span class="linenos">3083</span></a><span class="sd">            List of the retrieve file request data.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3084"><a href="#PumpWoodMicroService.parallel_retrieve_file-3084"><span class="linenos">3084</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3085"><a href="#PumpWoodMicroService.parallel_retrieve_file-3085"><span class="linenos">3085</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3086"><a href="#PumpWoodMicroService.parallel_retrieve_file-3086"><span class="linenos">3086</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3087"><a href="#PumpWoodMicroService.parallel_retrieve_file-3087"><span class="linenos">3087</span></a><span class="sd">                &#39;Lenght of list_file_name and list_pk are not equal:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3088"><a href="#PumpWoodMicroService.parallel_retrieve_file-3088"><span class="linenos">3088</span></a><span class="sd">                len(list_file_name)={list_file_name}; len(list_pk)={list_pk}&#39;.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3089"><a href="#PumpWoodMicroService.parallel_retrieve_file-3089"><span class="linenos">3089</span></a><span class="sd">                Indicates that len(list_file_name) and len(list_pk) function</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3090"><a href="#PumpWoodMicroService.parallel_retrieve_file-3090"><span class="linenos">3090</span></a><span class="sd">                arguments are not equal.</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3091"><a href="#PumpWoodMicroService.parallel_retrieve_file-3091"><span class="linenos">3091</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3092"><a href="#PumpWoodMicroService.parallel_retrieve_file-3092"><span class="linenos">3092</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3093"><a href="#PumpWoodMicroService.parallel_retrieve_file-3093"><span class="linenos">3093</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3094"><a href="#PumpWoodMicroService.parallel_retrieve_file-3094"><span class="linenos">3094</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3095"><a href="#PumpWoodMicroService.parallel_retrieve_file-3095"><span class="linenos">3095</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3096"><a href="#PumpWoodMicroService.parallel_retrieve_file-3096"><span class="linenos">3096</span></a>        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3097"><a href="#PumpWoodMicroService.parallel_retrieve_file-3097"><span class="linenos">3097</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3098"><a href="#PumpWoodMicroService.parallel_retrieve_file-3098"><span class="linenos">3098</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3099"><a href="#PumpWoodMicroService.parallel_retrieve_file-3099"><span class="linenos">3099</span></a>                    <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3100"><a href="#PumpWoodMicroService.parallel_retrieve_file-3100"><span class="linenos">3100</span></a>                    <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span> <span class="o">+</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3101"><a href="#PumpWoodMicroService.parallel_retrieve_file-3101"><span class="linenos">3101</span></a>                    <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3102"><a href="#PumpWoodMicroService.parallel_retrieve_file-3102"><span class="linenos">3102</span></a>                        <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3103"><a href="#PumpWoodMicroService.parallel_retrieve_file-3103"><span class="linenos">3103</span></a>                        <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3104"><a href="#PumpWoodMicroService.parallel_retrieve_file-3104"><span class="linenos">3104</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3105"><a href="#PumpWoodMicroService.parallel_retrieve_file-3105"><span class="linenos">3105</span></a>        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3106"><a href="#PumpWoodMicroService.parallel_retrieve_file-3106"><span class="linenos">3106</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3107"><a href="#PumpWoodMicroService.parallel_retrieve_file-3107"><span class="linenos">3107</span></a>            <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3108"><a href="#PumpWoodMicroService.parallel_retrieve_file-3108"><span class="linenos">3108</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3109"><a href="#PumpWoodMicroService.parallel_retrieve_file-3109"><span class="linenos">3109</span></a>            <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3110"><a href="#PumpWoodMicroService.parallel_retrieve_file-3110"><span class="linenos">3110</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3111"><a href="#PumpWoodMicroService.parallel_retrieve_file-3111"><span class="linenos">3111</span></a>            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3112"><a href="#PumpWoodMicroService.parallel_retrieve_file-3112"><span class="linenos">3112</span></a>                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3113"><a href="#PumpWoodMicroService.parallel_retrieve_file-3113"><span class="linenos">3113</span></a>                <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3114"><a href="#PumpWoodMicroService.parallel_retrieve_file-3114"><span class="linenos">3114</span></a>                <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3115"><a href="#PumpWoodMicroService.parallel_retrieve_file-3115"><span class="linenos">3115</span></a>                <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3116"><a href="#PumpWoodMicroService.parallel_retrieve_file-3116"><span class="linenos">3116</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3117"><a href="#PumpWoodMicroService.parallel_retrieve_file-3117"><span class="linenos">3117</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3118"><a href="#PumpWoodMicroService.parallel_retrieve_file-3118"><span class="linenos">3118</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3119"><a href="#PumpWoodMicroService.parallel_retrieve_file-3119"><span class="linenos">3119</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3120"><a href="#PumpWoodMicroService.parallel_retrieve_file-3120"><span class="linenos">3120</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3121"><a href="#PumpWoodMicroService.parallel_retrieve_file-3121"><span class="linenos">3121</span></a>                    <span class="n">pool_arguments</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3122"><a href="#PumpWoodMicroService.parallel_retrieve_file-3122"><span class="linenos">3122</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3123"><a href="#PumpWoodMicroService.parallel_retrieve_file-3123"><span class="linenos">3123</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3124"><a href="#PumpWoodMicroService.parallel_retrieve_file-3124"><span class="linenos">3124</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3125"><a href="#PumpWoodMicroService.parallel_retrieve_file-3125"><span class="linenos">3125</span></a>
</span><span id="PumpWoodMicroService.parallel_retrieve_file-3126"><a href="#PumpWoodMicroService.parallel_retrieve_file-3126"><span class="linenos">3126</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Make many [n_parallel] retrieve request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to retrieve.</li>
<li><strong>list_pk:</strong>  List of the pks to retrieve.</li>
<li><strong>file_field:</strong>  Indicates the file field to download from.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>save_path:</strong>  Path to be used to save files.</li>
<li><strong>save_file:</strong>  True save file locally, False return file content as bites.</li>
<li><strong>list_file_name:</strong>  Set a file name for each file download.</li>
<li><strong>if_exists:</strong>  Set how treat when a file will be saved
and there is another at same path. "fail" will raise an error;
"overwrite" will overwrite the file with the new one; "skip"
when list_file_name is set, check before downloaded it file
already exists, if so skip the download.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the retrieve file request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'Lenght of list_file_name and list_pk are not equal:
len(list_file_name)={list_file_name}; len(list_pk)={list_pk}'.
Indicates that len(list_file_name) and len(list_pk) function
arguments are not equal.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_list" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_list</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_list-3128"><a href="#PumpWoodMicroService.parallel_list-3128"><span class="linenos">3128</span></a>    <span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_list-3129"><a href="#PumpWoodMicroService.parallel_list-3129"><span class="linenos">3129</span></a>                      <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list-3130"><a href="#PumpWoodMicroService.parallel_list-3130"><span class="linenos">3130</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list-3131"><a href="#PumpWoodMicroService.parallel_list-3131"><span class="linenos">3131</span></a>                      <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list-3132"><a href="#PumpWoodMicroService.parallel_list-3132"><span class="linenos">3132</span></a>                      <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_list-3133"><a href="#PumpWoodMicroService.parallel_list-3133"><span class="linenos">3133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list request.</span>
</span><span id="PumpWoodMicroService.parallel_list-3134"><a href="#PumpWoodMicroService.parallel_list-3134"><span class="linenos">3134</span></a>
</span><span id="PumpWoodMicroService.parallel_list-3135"><a href="#PumpWoodMicroService.parallel_list-3135"><span class="linenos">3135</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_list-3136"><a href="#PumpWoodMicroService.parallel_list-3136"><span class="linenos">3136</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService.parallel_list-3137"><a href="#PumpWoodMicroService.parallel_list-3137"><span class="linenos">3137</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_list-3138"><a href="#PumpWoodMicroService.parallel_list-3138"><span class="linenos">3138</span></a><span class="sd">            list_args (List[dict]):</span>
</span><span id="PumpWoodMicroService.parallel_list-3139"><a href="#PumpWoodMicroService.parallel_list-3139"><span class="linenos">3139</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="PumpWoodMicroService.parallel_list-3140"><a href="#PumpWoodMicroService.parallel_list-3140"><span class="linenos">3140</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="PumpWoodMicroService.parallel_list-3141"><a href="#PumpWoodMicroService.parallel_list-3141"><span class="linenos">3141</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="PumpWoodMicroService.parallel_list-3142"><a href="#PumpWoodMicroService.parallel_list-3142"><span class="linenos">3142</span></a><span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_list-3143"><a href="#PumpWoodMicroService.parallel_list-3143"><span class="linenos">3143</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_list-3144"><a href="#PumpWoodMicroService.parallel_list-3144"><span class="linenos">3144</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_list-3145"><a href="#PumpWoodMicroService.parallel_list-3145"><span class="linenos">3145</span></a><span class="sd">            auth_header (dict):</span>
</span><span id="PumpWoodMicroService.parallel_list-3146"><a href="#PumpWoodMicroService.parallel_list-3146"><span class="linenos">3146</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_list-3147"><a href="#PumpWoodMicroService.parallel_list-3147"><span class="linenos">3147</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_list-3148"><a href="#PumpWoodMicroService.parallel_list-3148"><span class="linenos">3148</span></a><span class="sd">            fields (List[str]):</span>
</span><span id="PumpWoodMicroService.parallel_list-3149"><a href="#PumpWoodMicroService.parallel_list-3149"><span class="linenos">3149</span></a><span class="sd">                Set the fields to be returned by the list end-point.</span>
</span><span id="PumpWoodMicroService.parallel_list-3150"><a href="#PumpWoodMicroService.parallel_list-3150"><span class="linenos">3150</span></a><span class="sd">            default_fields (bool):</span>
</span><span id="PumpWoodMicroService.parallel_list-3151"><a href="#PumpWoodMicroService.parallel_list-3151"><span class="linenos">3151</span></a><span class="sd">                Boolean, if true and fields arguments None will return the</span>
</span><span id="PumpWoodMicroService.parallel_list-3152"><a href="#PumpWoodMicroService.parallel_list-3152"><span class="linenos">3152</span></a><span class="sd">                default fields set for list by the backend.</span>
</span><span id="PumpWoodMicroService.parallel_list-3153"><a href="#PumpWoodMicroService.parallel_list-3153"><span class="linenos">3153</span></a><span class="sd">            limit (int):</span>
</span><span id="PumpWoodMicroService.parallel_list-3154"><a href="#PumpWoodMicroService.parallel_list-3154"><span class="linenos">3154</span></a><span class="sd">                Set the limit of elements of the returned query. By default,</span>
</span><span id="PumpWoodMicroService.parallel_list-3155"><a href="#PumpWoodMicroService.parallel_list-3155"><span class="linenos">3155</span></a><span class="sd">                backend usually return 50 elements.</span>
</span><span id="PumpWoodMicroService.parallel_list-3156"><a href="#PumpWoodMicroService.parallel_list-3156"><span class="linenos">3156</span></a><span class="sd">            foreign_key_fields (bool):</span>
</span><span id="PumpWoodMicroService.parallel_list-3157"><a href="#PumpWoodMicroService.parallel_list-3157"><span class="linenos">3157</span></a><span class="sd">                Return forenging key objects. It will return the fk</span>
</span><span id="PumpWoodMicroService.parallel_list-3158"><a href="#PumpWoodMicroService.parallel_list-3158"><span class="linenos">3158</span></a><span class="sd">                corresponding object. Ex: `created_by_id` reference to</span>
</span><span id="PumpWoodMicroService.parallel_list-3159"><a href="#PumpWoodMicroService.parallel_list-3159"><span class="linenos">3159</span></a><span class="sd">                a user `model_class` the correspondent to User will be</span>
</span><span id="PumpWoodMicroService.parallel_list-3160"><a href="#PumpWoodMicroService.parallel_list-3160"><span class="linenos">3160</span></a><span class="sd">                returned at `created_by`.</span>
</span><span id="PumpWoodMicroService.parallel_list-3161"><a href="#PumpWoodMicroService.parallel_list-3161"><span class="linenos">3161</span></a>
</span><span id="PumpWoodMicroService.parallel_list-3162"><a href="#PumpWoodMicroService.parallel_list-3162"><span class="linenos">3162</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_list-3163"><a href="#PumpWoodMicroService.parallel_list-3163"><span class="linenos">3163</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="PumpWoodMicroService.parallel_list-3164"><a href="#PumpWoodMicroService.parallel_list-3164"><span class="linenos">3164</span></a>
</span><span id="PumpWoodMicroService.parallel_list-3165"><a href="#PumpWoodMicroService.parallel_list-3165"><span class="linenos">3165</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_list-3166"><a href="#PumpWoodMicroService.parallel_list-3166"><span class="linenos">3166</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_list-3167"><a href="#PumpWoodMicroService.parallel_list-3167"><span class="linenos">3167</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService.parallel_list-3168"><a href="#PumpWoodMicroService.parallel_list-3168"><span class="linenos">3168</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="PumpWoodMicroService.parallel_list-3169"><a href="#PumpWoodMicroService.parallel_list-3169"><span class="linenos">3169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_list-3170"><a href="#PumpWoodMicroService.parallel_list-3170"><span class="linenos">3170</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list-3171"><a href="#PumpWoodMicroService.parallel_list-3171"><span class="linenos">3171</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list-3172"><a href="#PumpWoodMicroService.parallel_list-3172"><span class="linenos">3172</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list-3173"><a href="#PumpWoodMicroService.parallel_list-3173"><span class="linenos">3173</span></a>
</span><span id="PumpWoodMicroService.parallel_list-3174"><a href="#PumpWoodMicroService.parallel_list-3174"><span class="linenos">3174</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_list-3175"><a href="#PumpWoodMicroService.parallel_list-3175"><span class="linenos">3175</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list-3176"><a href="#PumpWoodMicroService.parallel_list-3176"><span class="linenos">3176</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list-3177"><a href="#PumpWoodMicroService.parallel_list-3177"><span class="linenos">3177</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list-3178"><a href="#PumpWoodMicroService.parallel_list-3178"><span class="linenos">3178</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_list-3179"><a href="#PumpWoodMicroService.parallel_list-3179"><span class="linenos">3179</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list-3180"><a href="#PumpWoodMicroService.parallel_list-3180"><span class="linenos">3180</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list-3181"><a href="#PumpWoodMicroService.parallel_list-3181"><span class="linenos">3181</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list-3182"><a href="#PumpWoodMicroService.parallel_list-3182"><span class="linenos">3182</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_list-3183"><a href="#PumpWoodMicroService.parallel_list-3183"><span class="linenos">3183</span></a>
</span><span id="PumpWoodMicroService.parallel_list-3184"><a href="#PumpWoodMicroService.parallel_list-3184"><span class="linenos">3184</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list-3185"><a href="#PumpWoodMicroService.parallel_list-3185"><span class="linenos">3185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list-3186"><a href="#PumpWoodMicroService.parallel_list-3186"><span class="linenos">3186</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list-3187"><a href="#PumpWoodMicroService.parallel_list-3187"><span class="linenos">3187</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel list request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class (str):</strong>  Model Class to retrieve.</li>
<li><strong>list_args (List[dict]):</strong>  A list of list request args (filter_dict,
exclude_dict, order_by, fields, default_fields, limit,
foreign_key_fields).</li>
<li><strong>n_parallel (int):</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header (dict):</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
<li><strong>fields (List[str]):</strong>  Set the fields to be returned by the list end-point.</li>
<li><strong>default_fields (bool):</strong>  Boolean, if true and fields arguments None will return the
default fields set for list by the backend.</li>
<li><strong>limit (int):</strong>  Set the limit of elements of the returned query. By default,
backend usually return 50 elements.</li>
<li><strong>foreign_key_fields (bool):</strong>  Return forenging key objects. It will return the fk
corresponding object. Ex: <code>created_by_id</code> reference to
a user <code>model_class</code> the correspondent to User will be
returned at <code>created_by</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Flatten List of the list request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class)[{}] != len(list_args)[{}]'. Indicates that
lenght of model_class and list_args arguments are not equal.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_list_without_pag" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_list_without_pag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_list_without_pag</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_list_without_pag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_list_without_pag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_list_without_pag-3189"><a href="#PumpWoodMicroService.parallel_list_without_pag-3189"><span class="linenos">3189</span></a>    <span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3190"><a href="#PumpWoodMicroService.parallel_list_without_pag-3190"><span class="linenos">3190</span></a>                                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3191"><a href="#PumpWoodMicroService.parallel_list_without_pag-3191"><span class="linenos">3191</span></a>                                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3192"><a href="#PumpWoodMicroService.parallel_list_without_pag-3192"><span class="linenos">3192</span></a>                                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3193"><a href="#PumpWoodMicroService.parallel_list_without_pag-3193"><span class="linenos">3193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_without_pag request.</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3194"><a href="#PumpWoodMicroService.parallel_list_without_pag-3194"><span class="linenos">3194</span></a>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3195"><a href="#PumpWoodMicroService.parallel_list_without_pag-3195"><span class="linenos">3195</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3196"><a href="#PumpWoodMicroService.parallel_list_without_pag-3196"><span class="linenos">3196</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3197"><a href="#PumpWoodMicroService.parallel_list_without_pag-3197"><span class="linenos">3197</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3198"><a href="#PumpWoodMicroService.parallel_list_without_pag-3198"><span class="linenos">3198</span></a><span class="sd">            list_args:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3199"><a href="#PumpWoodMicroService.parallel_list_without_pag-3199"><span class="linenos">3199</span></a><span class="sd">                A list of list request args (filter_dict,</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3200"><a href="#PumpWoodMicroService.parallel_list_without_pag-3200"><span class="linenos">3200</span></a><span class="sd">                exclude_dict, order_by, fields, default_fields, limit,</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3201"><a href="#PumpWoodMicroService.parallel_list_without_pag-3201"><span class="linenos">3201</span></a><span class="sd">                foreign_key_fields).</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3202"><a href="#PumpWoodMicroService.parallel_list_without_pag-3202"><span class="linenos">3202</span></a><span class="sd">            n_parallel (int):</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3203"><a href="#PumpWoodMicroService.parallel_list_without_pag-3203"><span class="linenos">3203</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3204"><a href="#PumpWoodMicroService.parallel_list_without_pag-3204"><span class="linenos">3204</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3205"><a href="#PumpWoodMicroService.parallel_list_without_pag-3205"><span class="linenos">3205</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3206"><a href="#PumpWoodMicroService.parallel_list_without_pag-3206"><span class="linenos">3206</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3207"><a href="#PumpWoodMicroService.parallel_list_without_pag-3207"><span class="linenos">3207</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3208"><a href="#PumpWoodMicroService.parallel_list_without_pag-3208"><span class="linenos">3208</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3209"><a href="#PumpWoodMicroService.parallel_list_without_pag-3209"><span class="linenos">3209</span></a>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3210"><a href="#PumpWoodMicroService.parallel_list_without_pag-3210"><span class="linenos">3210</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3211"><a href="#PumpWoodMicroService.parallel_list_without_pag-3211"><span class="linenos">3211</span></a><span class="sd">            Flatten List of the list request reponses.</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3212"><a href="#PumpWoodMicroService.parallel_list_without_pag-3212"><span class="linenos">3212</span></a>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3213"><a href="#PumpWoodMicroService.parallel_list_without_pag-3213"><span class="linenos">3213</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3214"><a href="#PumpWoodMicroService.parallel_list_without_pag-3214"><span class="linenos">3214</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3215"><a href="#PumpWoodMicroService.parallel_list_without_pag-3215"><span class="linenos">3215</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates that</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3216"><a href="#PumpWoodMicroService.parallel_list_without_pag-3216"><span class="linenos">3216</span></a><span class="sd">                lenght of model_class and list_args arguments are not equal.</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3217"><a href="#PumpWoodMicroService.parallel_list_without_pag-3217"><span class="linenos">3217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3218"><a href="#PumpWoodMicroService.parallel_list_without_pag-3218"><span class="linenos">3218</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3219"><a href="#PumpWoodMicroService.parallel_list_without_pag-3219"><span class="linenos">3219</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3220"><a href="#PumpWoodMicroService.parallel_list_without_pag-3220"><span class="linenos">3220</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3221"><a href="#PumpWoodMicroService.parallel_list_without_pag-3221"><span class="linenos">3221</span></a>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3222"><a href="#PumpWoodMicroService.parallel_list_without_pag-3222"><span class="linenos">3222</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3223"><a href="#PumpWoodMicroService.parallel_list_without_pag-3223"><span class="linenos">3223</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3224"><a href="#PumpWoodMicroService.parallel_list_without_pag-3224"><span class="linenos">3224</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3225"><a href="#PumpWoodMicroService.parallel_list_without_pag-3225"><span class="linenos">3225</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3226"><a href="#PumpWoodMicroService.parallel_list_without_pag-3226"><span class="linenos">3226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3227"><a href="#PumpWoodMicroService.parallel_list_without_pag-3227"><span class="linenos">3227</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3228"><a href="#PumpWoodMicroService.parallel_list_without_pag-3228"><span class="linenos">3228</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3229"><a href="#PumpWoodMicroService.parallel_list_without_pag-3229"><span class="linenos">3229</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3230"><a href="#PumpWoodMicroService.parallel_list_without_pag-3230"><span class="linenos">3230</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3231"><a href="#PumpWoodMicroService.parallel_list_without_pag-3231"><span class="linenos">3231</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3232"><a href="#PumpWoodMicroService.parallel_list_without_pag-3232"><span class="linenos">3232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3233"><a href="#PumpWoodMicroService.parallel_list_without_pag-3233"><span class="linenos">3233</span></a>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3234"><a href="#PumpWoodMicroService.parallel_list_without_pag-3234"><span class="linenos">3234</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3235"><a href="#PumpWoodMicroService.parallel_list_without_pag-3235"><span class="linenos">3235</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3236"><a href="#PumpWoodMicroService.parallel_list_without_pag-3236"><span class="linenos">3236</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list_without_pag-3237"><a href="#PumpWoodMicroService.parallel_list_without_pag-3237"><span class="linenos">3237</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel list_without_pag request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to retrieve.</li>
<li><strong>list_args:</strong>  A list of list request args (filter_dict,
exclude_dict, order_by, fields, default_fields, limit,
foreign_key_fields).</li>
<li><strong>n_parallel (int):</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Flatten List of the list request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class)[{}] != len(list_args)[{}]'. Indicates that
lenght of model_class and list_args arguments are not equal.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_list_one" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_list_one-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_list_one</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_list_one-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_list_one"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_list_one-3239"><a href="#PumpWoodMicroService.parallel_list_one-3239"><span class="linenos">3239</span></a>    <span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3240"><a href="#PumpWoodMicroService.parallel_list_one-3240"><span class="linenos">3240</span></a>                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3241"><a href="#PumpWoodMicroService.parallel_list_one-3241"><span class="linenos">3241</span></a>                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3242"><a href="#PumpWoodMicroService.parallel_list_one-3242"><span class="linenos">3242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel list_one request.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3243"><a href="#PumpWoodMicroService.parallel_list_one-3243"><span class="linenos">3243</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3244"><a href="#PumpWoodMicroService.parallel_list_one-3244"><span class="linenos">3244</span></a><span class="sd">        DEPRECTED user retrieve call with default_fields=True.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3245"><a href="#PumpWoodMicroService.parallel_list_one-3245"><span class="linenos">3245</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3246"><a href="#PumpWoodMicroService.parallel_list_one-3246"><span class="linenos">3246</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3247"><a href="#PumpWoodMicroService.parallel_list_one-3247"><span class="linenos">3247</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3248"><a href="#PumpWoodMicroService.parallel_list_one-3248"><span class="linenos">3248</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3249"><a href="#PumpWoodMicroService.parallel_list_one-3249"><span class="linenos">3249</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3250"><a href="#PumpWoodMicroService.parallel_list_one-3250"><span class="linenos">3250</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3251"><a href="#PumpWoodMicroService.parallel_list_one-3251"><span class="linenos">3251</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3252"><a href="#PumpWoodMicroService.parallel_list_one-3252"><span class="linenos">3252</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3253"><a href="#PumpWoodMicroService.parallel_list_one-3253"><span class="linenos">3253</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3254"><a href="#PumpWoodMicroService.parallel_list_one-3254"><span class="linenos">3254</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3255"><a href="#PumpWoodMicroService.parallel_list_one-3255"><span class="linenos">3255</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3256"><a href="#PumpWoodMicroService.parallel_list_one-3256"><span class="linenos">3256</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3257"><a href="#PumpWoodMicroService.parallel_list_one-3257"><span class="linenos">3257</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3258"><a href="#PumpWoodMicroService.parallel_list_one-3258"><span class="linenos">3258</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3259"><a href="#PumpWoodMicroService.parallel_list_one-3259"><span class="linenos">3259</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3260"><a href="#PumpWoodMicroService.parallel_list_one-3260"><span class="linenos">3260</span></a><span class="sd">            List of the list_one request data.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3261"><a href="#PumpWoodMicroService.parallel_list_one-3261"><span class="linenos">3261</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3262"><a href="#PumpWoodMicroService.parallel_list_one-3262"><span class="linenos">3262</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3263"><a href="#PumpWoodMicroService.parallel_list_one-3263"><span class="linenos">3263</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3264"><a href="#PumpWoodMicroService.parallel_list_one-3264"><span class="linenos">3264</span></a><span class="sd">                &#39;len(model_class) != len(list_pk)&#39;. Indicates that lenght</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3265"><a href="#PumpWoodMicroService.parallel_list_one-3265"><span class="linenos">3265</span></a><span class="sd">                of model_class and list_pk arguments are not equal.</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3266"><a href="#PumpWoodMicroService.parallel_list_one-3266"><span class="linenos">3266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3267"><a href="#PumpWoodMicroService.parallel_list_one-3267"><span class="linenos">3267</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3268"><a href="#PumpWoodMicroService.parallel_list_one-3268"><span class="linenos">3268</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3269"><a href="#PumpWoodMicroService.parallel_list_one-3269"><span class="linenos">3269</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3270"><a href="#PumpWoodMicroService.parallel_list_one-3270"><span class="linenos">3270</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3271"><a href="#PumpWoodMicroService.parallel_list_one-3271"><span class="linenos">3271</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3272"><a href="#PumpWoodMicroService.parallel_list_one-3272"><span class="linenos">3272</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3273"><a href="#PumpWoodMicroService.parallel_list_one-3273"><span class="linenos">3273</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3274"><a href="#PumpWoodMicroService.parallel_list_one-3274"><span class="linenos">3274</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3275"><a href="#PumpWoodMicroService.parallel_list_one-3275"><span class="linenos">3275</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3276"><a href="#PumpWoodMicroService.parallel_list_one-3276"><span class="linenos">3276</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3277"><a href="#PumpWoodMicroService.parallel_list_one-3277"><span class="linenos">3277</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3278"><a href="#PumpWoodMicroService.parallel_list_one-3278"><span class="linenos">3278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3279"><a href="#PumpWoodMicroService.parallel_list_one-3279"><span class="linenos">3279</span></a>                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3280"><a href="#PumpWoodMicroService.parallel_list_one-3280"><span class="linenos">3280</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3281"><a href="#PumpWoodMicroService.parallel_list_one-3281"><span class="linenos">3281</span></a>
</span><span id="PumpWoodMicroService.parallel_list_one-3282"><a href="#PumpWoodMicroService.parallel_list_one-3282"><span class="linenos">3282</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3283"><a href="#PumpWoodMicroService.parallel_list_one-3283"><span class="linenos">3283</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3284"><a href="#PumpWoodMicroService.parallel_list_one-3284"><span class="linenos">3284</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_list_one-3285"><a href="#PumpWoodMicroService.parallel_list_one-3285"><span class="linenos">3285</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel list_one request.</p>

<p>DEPRECTED user retrieve call with default_fields=True.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to list one.</li>
<li><strong>list_pk:</strong>  List of the pks to list one.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the list_one request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class) != len(list_pk)'. Indicates that lenght
of model_class and list_pk arguments are not equal.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_save" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_save</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_save-3287"><a href="#PumpWoodMicroService.parallel_save-3287"><span class="linenos">3287</span></a>    <span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.parallel_save-3288"><a href="#PumpWoodMicroService.parallel_save-3288"><span class="linenos">3288</span></a>                      <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_save-3289"><a href="#PumpWoodMicroService.parallel_save-3289"><span class="linenos">3289</span></a>                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_save-3290"><a href="#PumpWoodMicroService.parallel_save-3290"><span class="linenos">3290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel save requests.</span>
</span><span id="PumpWoodMicroService.parallel_save-3291"><a href="#PumpWoodMicroService.parallel_save-3291"><span class="linenos">3291</span></a>
</span><span id="PumpWoodMicroService.parallel_save-3292"><a href="#PumpWoodMicroService.parallel_save-3292"><span class="linenos">3292</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_save-3293"><a href="#PumpWoodMicroService.parallel_save-3293"><span class="linenos">3293</span></a><span class="sd">            list_obj_dict:</span>
</span><span id="PumpWoodMicroService.parallel_save-3294"><a href="#PumpWoodMicroService.parallel_save-3294"><span class="linenos">3294</span></a><span class="sd">                List of dictionaries containing PumpWood objects</span>
</span><span id="PumpWoodMicroService.parallel_save-3295"><a href="#PumpWoodMicroService.parallel_save-3295"><span class="linenos">3295</span></a><span class="sd">                (must have at least &#39;model_class&#39; key).</span>
</span><span id="PumpWoodMicroService.parallel_save-3296"><a href="#PumpWoodMicroService.parallel_save-3296"><span class="linenos">3296</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_save-3297"><a href="#PumpWoodMicroService.parallel_save-3297"><span class="linenos">3297</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_save-3298"><a href="#PumpWoodMicroService.parallel_save-3298"><span class="linenos">3298</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_save-3299"><a href="#PumpWoodMicroService.parallel_save-3299"><span class="linenos">3299</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_save-3300"><a href="#PumpWoodMicroService.parallel_save-3300"><span class="linenos">3300</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_save-3301"><a href="#PumpWoodMicroService.parallel_save-3301"><span class="linenos">3301</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_save-3302"><a href="#PumpWoodMicroService.parallel_save-3302"><span class="linenos">3302</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_save-3303"><a href="#PumpWoodMicroService.parallel_save-3303"><span class="linenos">3303</span></a>
</span><span id="PumpWoodMicroService.parallel_save-3304"><a href="#PumpWoodMicroService.parallel_save-3304"><span class="linenos">3304</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_save-3305"><a href="#PumpWoodMicroService.parallel_save-3305"><span class="linenos">3305</span></a><span class="sd">            List of the save request data.</span>
</span><span id="PumpWoodMicroService.parallel_save-3306"><a href="#PumpWoodMicroService.parallel_save-3306"><span class="linenos">3306</span></a>
</span><span id="PumpWoodMicroService.parallel_save-3307"><a href="#PumpWoodMicroService.parallel_save-3307"><span class="linenos">3307</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_save-3308"><a href="#PumpWoodMicroService.parallel_save-3308"><span class="linenos">3308</span></a><span class="sd">            No particular raises</span>
</span><span id="PumpWoodMicroService.parallel_save-3309"><a href="#PumpWoodMicroService.parallel_save-3309"><span class="linenos">3309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_save-3310"><a href="#PumpWoodMicroService.parallel_save-3310"><span class="linenos">3310</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_save-3311"><a href="#PumpWoodMicroService.parallel_save-3311"><span class="linenos">3311</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_save-3312"><a href="#PumpWoodMicroService.parallel_save-3312"><span class="linenos">3312</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_save-3313"><a href="#PumpWoodMicroService.parallel_save-3313"><span class="linenos">3313</span></a>
</span><span id="PumpWoodMicroService.parallel_save-3314"><a href="#PumpWoodMicroService.parallel_save-3314"><span class="linenos">3314</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_save-3315"><a href="#PumpWoodMicroService.parallel_save-3315"><span class="linenos">3315</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_save-3316"><a href="#PumpWoodMicroService.parallel_save-3316"><span class="linenos">3316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_save-3317"><a href="#PumpWoodMicroService.parallel_save-3317"><span class="linenos">3317</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_save-3318"><a href="#PumpWoodMicroService.parallel_save-3318"><span class="linenos">3318</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_save-3319"><a href="#PumpWoodMicroService.parallel_save-3319"><span class="linenos">3319</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel save requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>list_obj_dict:</strong>  List of dictionaries containing PumpWood objects
(must have at least 'model_class' key).</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the save request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_delete" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_delete</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_delete-3321"><a href="#PumpWoodMicroService.parallel_delete-3321"><span class="linenos">3321</span></a>    <span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_delete-3322"><a href="#PumpWoodMicroService.parallel_delete-3322"><span class="linenos">3322</span></a>                        <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_delete-3323"><a href="#PumpWoodMicroService.parallel_delete-3323"><span class="linenos">3323</span></a>                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_delete-3324"><a href="#PumpWoodMicroService.parallel_delete-3324"><span class="linenos">3324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make many [n_parallel] delete requests.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3325"><a href="#PumpWoodMicroService.parallel_delete-3325"><span class="linenos">3325</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3326"><a href="#PumpWoodMicroService.parallel_delete-3326"><span class="linenos">3326</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3327"><a href="#PumpWoodMicroService.parallel_delete-3327"><span class="linenos">3327</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3328"><a href="#PumpWoodMicroService.parallel_delete-3328"><span class="linenos">3328</span></a><span class="sd">                Model Class to list one.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3329"><a href="#PumpWoodMicroService.parallel_delete-3329"><span class="linenos">3329</span></a><span class="sd">            list_pk:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3330"><a href="#PumpWoodMicroService.parallel_delete-3330"><span class="linenos">3330</span></a><span class="sd">                List of the pks to list one.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3331"><a href="#PumpWoodMicroService.parallel_delete-3331"><span class="linenos">3331</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3332"><a href="#PumpWoodMicroService.parallel_delete-3332"><span class="linenos">3332</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_delete-3333"><a href="#PumpWoodMicroService.parallel_delete-3333"><span class="linenos">3333</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_delete-3334"><a href="#PumpWoodMicroService.parallel_delete-3334"><span class="linenos">3334</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3335"><a href="#PumpWoodMicroService.parallel_delete-3335"><span class="linenos">3335</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3336"><a href="#PumpWoodMicroService.parallel_delete-3336"><span class="linenos">3336</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_delete-3337"><a href="#PumpWoodMicroService.parallel_delete-3337"><span class="linenos">3337</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_delete-3338"><a href="#PumpWoodMicroService.parallel_delete-3338"><span class="linenos">3338</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3339"><a href="#PumpWoodMicroService.parallel_delete-3339"><span class="linenos">3339</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3340"><a href="#PumpWoodMicroService.parallel_delete-3340"><span class="linenos">3340</span></a><span class="sd">            List of the delete request data.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3341"><a href="#PumpWoodMicroService.parallel_delete-3341"><span class="linenos">3341</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3342"><a href="#PumpWoodMicroService.parallel_delete-3342"><span class="linenos">3342</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3343"><a href="#PumpWoodMicroService.parallel_delete-3343"><span class="linenos">3343</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3344"><a href="#PumpWoodMicroService.parallel_delete-3344"><span class="linenos">3344</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="PumpWoodMicroService.parallel_delete-3345"><a href="#PumpWoodMicroService.parallel_delete-3345"><span class="linenos">3345</span></a><span class="sd">                that length of model_class and list_args arguments are not</span>
</span><span id="PumpWoodMicroService.parallel_delete-3346"><a href="#PumpWoodMicroService.parallel_delete-3346"><span class="linenos">3346</span></a><span class="sd">                equal.</span>
</span><span id="PumpWoodMicroService.parallel_delete-3347"><a href="#PumpWoodMicroService.parallel_delete-3347"><span class="linenos">3347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_delete-3348"><a href="#PumpWoodMicroService.parallel_delete-3348"><span class="linenos">3348</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3349"><a href="#PumpWoodMicroService.parallel_delete-3349"><span class="linenos">3349</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete-3350"><a href="#PumpWoodMicroService.parallel_delete-3350"><span class="linenos">3350</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete-3351"><a href="#PumpWoodMicroService.parallel_delete-3351"><span class="linenos">3351</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3352"><a href="#PumpWoodMicroService.parallel_delete-3352"><span class="linenos">3352</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_delete-3353"><a href="#PumpWoodMicroService.parallel_delete-3353"><span class="linenos">3353</span></a>            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_delete-3354"><a href="#PumpWoodMicroService.parallel_delete-3354"><span class="linenos">3354</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_delete-3355"><a href="#PumpWoodMicroService.parallel_delete-3355"><span class="linenos">3355</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete-3356"><a href="#PumpWoodMicroService.parallel_delete-3356"><span class="linenos">3356</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete-3357"><a href="#PumpWoodMicroService.parallel_delete-3357"><span class="linenos">3357</span></a>            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_delete-3358"><a href="#PumpWoodMicroService.parallel_delete-3358"><span class="linenos">3358</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3359"><a href="#PumpWoodMicroService.parallel_delete-3359"><span class="linenos">3359</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_delete-3360"><a href="#PumpWoodMicroService.parallel_delete-3360"><span class="linenos">3360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.parallel_delete-3361"><a href="#PumpWoodMicroService.parallel_delete-3361"><span class="linenos">3361</span></a>                                           <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.parallel_delete-3362"><a href="#PumpWoodMicroService.parallel_delete-3362"><span class="linenos">3362</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
</span><span id="PumpWoodMicroService.parallel_delete-3363"><a href="#PumpWoodMicroService.parallel_delete-3363"><span class="linenos">3363</span></a>
</span><span id="PumpWoodMicroService.parallel_delete-3364"><a href="#PumpWoodMicroService.parallel_delete-3364"><span class="linenos">3364</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete-3365"><a href="#PumpWoodMicroService.parallel_delete-3365"><span class="linenos">3365</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete-3366"><a href="#PumpWoodMicroService.parallel_delete-3366"><span class="linenos">3366</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_delete-3367"><a href="#PumpWoodMicroService.parallel_delete-3367"><span class="linenos">3367</span></a>            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make many [n_parallel] delete requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to list one.</li>
<li><strong>list_pk:</strong>  List of the pks to list one.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the delete request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class)[{}] != len(list_args)[{}]'. Indicates
that length of model_class and list_args arguments are not
equal.</li>
</ul>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_delete_many" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_delete_many-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_delete_many</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_delete_many-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_delete_many"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_delete_many-3369"><a href="#PumpWoodMicroService.parallel_delete_many-3369"><span class="linenos">3369</span></a>    <span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3370"><a href="#PumpWoodMicroService.parallel_delete_many-3370"><span class="linenos">3370</span></a>                             <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3371"><a href="#PumpWoodMicroService.parallel_delete_many-3371"><span class="linenos">3371</span></a>                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3372"><a href="#PumpWoodMicroService.parallel_delete_many-3372"><span class="linenos">3372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel delete_many request.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3373"><a href="#PumpWoodMicroService.parallel_delete_many-3373"><span class="linenos">3373</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3374"><a href="#PumpWoodMicroService.parallel_delete_many-3374"><span class="linenos">3374</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3375"><a href="#PumpWoodMicroService.parallel_delete_many-3375"><span class="linenos">3375</span></a><span class="sd">            model_class (str):</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3376"><a href="#PumpWoodMicroService.parallel_delete_many-3376"><span class="linenos">3376</span></a><span class="sd">                Model Class to delete many.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3377"><a href="#PumpWoodMicroService.parallel_delete_many-3377"><span class="linenos">3377</span></a><span class="sd">            list_args (list):</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3378"><a href="#PumpWoodMicroService.parallel_delete_many-3378"><span class="linenos">3378</span></a><span class="sd">                A list of list request args (filter_dict, exclude_dict).</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3379"><a href="#PumpWoodMicroService.parallel_delete_many-3379"><span class="linenos">3379</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3380"><a href="#PumpWoodMicroService.parallel_delete_many-3380"><span class="linenos">3380</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3381"><a href="#PumpWoodMicroService.parallel_delete_many-3381"><span class="linenos">3381</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3382"><a href="#PumpWoodMicroService.parallel_delete_many-3382"><span class="linenos">3382</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3383"><a href="#PumpWoodMicroService.parallel_delete_many-3383"><span class="linenos">3383</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3384"><a href="#PumpWoodMicroService.parallel_delete_many-3384"><span class="linenos">3384</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3385"><a href="#PumpWoodMicroService.parallel_delete_many-3385"><span class="linenos">3385</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3386"><a href="#PumpWoodMicroService.parallel_delete_many-3386"><span class="linenos">3386</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3387"><a href="#PumpWoodMicroService.parallel_delete_many-3387"><span class="linenos">3387</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3388"><a href="#PumpWoodMicroService.parallel_delete_many-3388"><span class="linenos">3388</span></a><span class="sd">            List of the delete many request reponses.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3389"><a href="#PumpWoodMicroService.parallel_delete_many-3389"><span class="linenos">3389</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3390"><a href="#PumpWoodMicroService.parallel_delete_many-3390"><span class="linenos">3390</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3391"><a href="#PumpWoodMicroService.parallel_delete_many-3391"><span class="linenos">3391</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3392"><a href="#PumpWoodMicroService.parallel_delete_many-3392"><span class="linenos">3392</span></a><span class="sd">                &#39;len(model_class)[{}] != len(list_args)[{}]&#39;. Indicates</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3393"><a href="#PumpWoodMicroService.parallel_delete_many-3393"><span class="linenos">3393</span></a><span class="sd">                that length of model_class and list_args arguments</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3394"><a href="#PumpWoodMicroService.parallel_delete_many-3394"><span class="linenos">3394</span></a><span class="sd">                are not equal.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3395"><a href="#PumpWoodMicroService.parallel_delete_many-3395"><span class="linenos">3395</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3396"><a href="#PumpWoodMicroService.parallel_delete_many-3396"><span class="linenos">3396</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3397"><a href="#PumpWoodMicroService.parallel_delete_many-3397"><span class="linenos">3397</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3398"><a href="#PumpWoodMicroService.parallel_delete_many-3398"><span class="linenos">3398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3399"><a href="#PumpWoodMicroService.parallel_delete_many-3399"><span class="linenos">3399</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3400"><a href="#PumpWoodMicroService.parallel_delete_many-3400"><span class="linenos">3400</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3401"><a href="#PumpWoodMicroService.parallel_delete_many-3401"><span class="linenos">3401</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3402"><a href="#PumpWoodMicroService.parallel_delete_many-3402"><span class="linenos">3402</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3403"><a href="#PumpWoodMicroService.parallel_delete_many-3403"><span class="linenos">3403</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3404"><a href="#PumpWoodMicroService.parallel_delete_many-3404"><span class="linenos">3404</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3405"><a href="#PumpWoodMicroService.parallel_delete_many-3405"><span class="linenos">3405</span></a>            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3406"><a href="#PumpWoodMicroService.parallel_delete_many-3406"><span class="linenos">3406</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3407"><a href="#PumpWoodMicroService.parallel_delete_many-3407"><span class="linenos">3407</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3408"><a href="#PumpWoodMicroService.parallel_delete_many-3408"><span class="linenos">3408</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3409"><a href="#PumpWoodMicroService.parallel_delete_many-3409"><span class="linenos">3409</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(model_class)[</span><span class="si">{}</span><span class="s1">] != len(list_args)[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3410"><a href="#PumpWoodMicroService.parallel_delete_many-3410"><span class="linenos">3410</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3411"><a href="#PumpWoodMicroService.parallel_delete_many-3411"><span class="linenos">3411</span></a>                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3412"><a href="#PumpWoodMicroService.parallel_delete_many-3412"><span class="linenos">3412</span></a>            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3413"><a href="#PumpWoodMicroService.parallel_delete_many-3413"><span class="linenos">3413</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3414"><a href="#PumpWoodMicroService.parallel_delete_many-3414"><span class="linenos">3414</span></a>
</span><span id="PumpWoodMicroService.parallel_delete_many-3415"><a href="#PumpWoodMicroService.parallel_delete_many-3415"><span class="linenos">3415</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3416"><a href="#PumpWoodMicroService.parallel_delete_many-3416"><span class="linenos">3416</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3417"><a href="#PumpWoodMicroService.parallel_delete_many-3417"><span class="linenos">3417</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_delete_many-3418"><a href="#PumpWoodMicroService.parallel_delete_many-3418"><span class="linenos">3418</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel delete_many request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class (str):</strong>  Model Class to delete many.</li>
<li><strong>list_args (list):</strong>  A list of list request args (filter_dict, exclude_dict).</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the delete many request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'len(model_class)[{}] != len(list_args)[{}]'. Indicates
that length of model_class and list_args arguments
are not equal.</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example yet.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_execute_action" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_execute_action-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_execute_action</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_execute_action-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_execute_action"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_execute_action-3420"><a href="#PumpWoodMicroService.parallel_execute_action-3420"><span class="linenos">3420</span></a>    <span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3421"><a href="#PumpWoodMicroService.parallel_execute_action-3421"><span class="linenos">3421</span></a>                                <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3422"><a href="#PumpWoodMicroService.parallel_execute_action-3422"><span class="linenos">3422</span></a>                                <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3423"><a href="#PumpWoodMicroService.parallel_execute_action-3423"><span class="linenos">3423</span></a>                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3424"><a href="#PumpWoodMicroService.parallel_execute_action-3424"><span class="linenos">3424</span></a>                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3425"><a href="#PumpWoodMicroService.parallel_execute_action-3425"><span class="linenos">3425</span></a>                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3426"><a href="#PumpWoodMicroService.parallel_execute_action-3426"><span class="linenos">3426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel execute_action requests.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3427"><a href="#PumpWoodMicroService.parallel_execute_action-3427"><span class="linenos">3427</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3428"><a href="#PumpWoodMicroService.parallel_execute_action-3428"><span class="linenos">3428</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3429"><a href="#PumpWoodMicroService.parallel_execute_action-3429"><span class="linenos">3429</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3430"><a href="#PumpWoodMicroService.parallel_execute_action-3430"><span class="linenos">3430</span></a><span class="sd">                Model Class to perform action over,</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3431"><a href="#PumpWoodMicroService.parallel_execute_action-3431"><span class="linenos">3431</span></a><span class="sd">                or a list of model class o make diferent actions.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3432"><a href="#PumpWoodMicroService.parallel_execute_action-3432"><span class="linenos">3432</span></a><span class="sd">            pk:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3433"><a href="#PumpWoodMicroService.parallel_execute_action-3433"><span class="linenos">3433</span></a><span class="sd">                A list of the pks to perform action or a</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3434"><a href="#PumpWoodMicroService.parallel_execute_action-3434"><span class="linenos">3434</span></a><span class="sd">                single pk to perform action with different paraemters.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3435"><a href="#PumpWoodMicroService.parallel_execute_action-3435"><span class="linenos">3435</span></a><span class="sd">            action:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3436"><a href="#PumpWoodMicroService.parallel_execute_action-3436"><span class="linenos">3436</span></a><span class="sd">                A list of actions to perform or a single</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3437"><a href="#PumpWoodMicroService.parallel_execute_action-3437"><span class="linenos">3437</span></a><span class="sd">                action to perform over all pks and parameters.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3438"><a href="#PumpWoodMicroService.parallel_execute_action-3438"><span class="linenos">3438</span></a><span class="sd">            parameters:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3439"><a href="#PumpWoodMicroService.parallel_execute_action-3439"><span class="linenos">3439</span></a><span class="sd">                Parameters used to perform actions</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3440"><a href="#PumpWoodMicroService.parallel_execute_action-3440"><span class="linenos">3440</span></a><span class="sd">                or a single dict to be used in all actions.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3441"><a href="#PumpWoodMicroService.parallel_execute_action-3441"><span class="linenos">3441</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3442"><a href="#PumpWoodMicroService.parallel_execute_action-3442"><span class="linenos">3442</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3443"><a href="#PumpWoodMicroService.parallel_execute_action-3443"><span class="linenos">3443</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3444"><a href="#PumpWoodMicroService.parallel_execute_action-3444"><span class="linenos">3444</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3445"><a href="#PumpWoodMicroService.parallel_execute_action-3445"><span class="linenos">3445</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3446"><a href="#PumpWoodMicroService.parallel_execute_action-3446"><span class="linenos">3446</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3447"><a href="#PumpWoodMicroService.parallel_execute_action-3447"><span class="linenos">3447</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3448"><a href="#PumpWoodMicroService.parallel_execute_action-3448"><span class="linenos">3448</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3449"><a href="#PumpWoodMicroService.parallel_execute_action-3449"><span class="linenos">3449</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3450"><a href="#PumpWoodMicroService.parallel_execute_action-3450"><span class="linenos">3450</span></a><span class="sd">            List of the execute_action request data.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3451"><a href="#PumpWoodMicroService.parallel_execute_action-3451"><span class="linenos">3451</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3452"><a href="#PumpWoodMicroService.parallel_execute_action-3452"><span class="linenos">3452</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3453"><a href="#PumpWoodMicroService.parallel_execute_action-3453"><span class="linenos">3453</span></a><span class="sd">            PumpWoodException:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3454"><a href="#PumpWoodMicroService.parallel_execute_action-3454"><span class="linenos">3454</span></a><span class="sd">                &#39;parallel_length != len([argument])&#39;. Indicates that function</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3455"><a href="#PumpWoodMicroService.parallel_execute_action-3455"><span class="linenos">3455</span></a><span class="sd">                arguments does not have all the same lenght.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3456"><a href="#PumpWoodMicroService.parallel_execute_action-3456"><span class="linenos">3456</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3457"><a href="#PumpWoodMicroService.parallel_execute_action-3457"><span class="linenos">3457</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3458"><a href="#PumpWoodMicroService.parallel_execute_action-3458"><span class="linenos">3458</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3459"><a href="#PumpWoodMicroService.parallel_execute_action-3459"><span class="linenos">3459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3460"><a href="#PumpWoodMicroService.parallel_execute_action-3460"><span class="linenos">3460</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3461"><a href="#PumpWoodMicroService.parallel_execute_action-3461"><span class="linenos">3461</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3462"><a href="#PumpWoodMicroService.parallel_execute_action-3462"><span class="linenos">3462</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3463"><a href="#PumpWoodMicroService.parallel_execute_action-3463"><span class="linenos">3463</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3464"><a href="#PumpWoodMicroService.parallel_execute_action-3464"><span class="linenos">3464</span></a>        <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3465"><a href="#PumpWoodMicroService.parallel_execute_action-3465"><span class="linenos">3465</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3466"><a href="#PumpWoodMicroService.parallel_execute_action-3466"><span class="linenos">3466</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3467"><a href="#PumpWoodMicroService.parallel_execute_action-3467"><span class="linenos">3467</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3468"><a href="#PumpWoodMicroService.parallel_execute_action-3468"><span class="linenos">3468</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3469"><a href="#PumpWoodMicroService.parallel_execute_action-3469"><span class="linenos">3469</span></a>                        <span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3470"><a href="#PumpWoodMicroService.parallel_execute_action-3470"><span class="linenos">3470</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3471"><a href="#PumpWoodMicroService.parallel_execute_action-3471"><span class="linenos">3471</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3472"><a href="#PumpWoodMicroService.parallel_execute_action-3472"><span class="linenos">3472</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3473"><a href="#PumpWoodMicroService.parallel_execute_action-3473"><span class="linenos">3473</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3474"><a href="#PumpWoodMicroService.parallel_execute_action-3474"><span class="linenos">3474</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3475"><a href="#PumpWoodMicroService.parallel_execute_action-3475"><span class="linenos">3475</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3476"><a href="#PumpWoodMicroService.parallel_execute_action-3476"><span class="linenos">3476</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3477"><a href="#PumpWoodMicroService.parallel_execute_action-3477"><span class="linenos">3477</span></a>                        <span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3478"><a href="#PumpWoodMicroService.parallel_execute_action-3478"><span class="linenos">3478</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3479"><a href="#PumpWoodMicroService.parallel_execute_action-3479"><span class="linenos">3479</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3480"><a href="#PumpWoodMicroService.parallel_execute_action-3480"><span class="linenos">3480</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3481"><a href="#PumpWoodMicroService.parallel_execute_action-3481"><span class="linenos">3481</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3482"><a href="#PumpWoodMicroService.parallel_execute_action-3482"><span class="linenos">3482</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3483"><a href="#PumpWoodMicroService.parallel_execute_action-3483"><span class="linenos">3483</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3484"><a href="#PumpWoodMicroService.parallel_execute_action-3484"><span class="linenos">3484</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3485"><a href="#PumpWoodMicroService.parallel_execute_action-3485"><span class="linenos">3485</span></a>                        <span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3486"><a href="#PumpWoodMicroService.parallel_execute_action-3486"><span class="linenos">3486</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3487"><a href="#PumpWoodMicroService.parallel_execute_action-3487"><span class="linenos">3487</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3488"><a href="#PumpWoodMicroService.parallel_execute_action-3488"><span class="linenos">3488</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3489"><a href="#PumpWoodMicroService.parallel_execute_action-3489"><span class="linenos">3489</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3490"><a href="#PumpWoodMicroService.parallel_execute_action-3490"><span class="linenos">3490</span></a>            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3491"><a href="#PumpWoodMicroService.parallel_execute_action-3491"><span class="linenos">3491</span></a>                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3492"><a href="#PumpWoodMicroService.parallel_execute_action-3492"><span class="linenos">3492</span></a>                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3493"><a href="#PumpWoodMicroService.parallel_execute_action-3493"><span class="linenos">3493</span></a>                        <span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3494"><a href="#PumpWoodMicroService.parallel_execute_action-3494"><span class="linenos">3494</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3495"><a href="#PumpWoodMicroService.parallel_execute_action-3495"><span class="linenos">3495</span></a>                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3496"><a href="#PumpWoodMicroService.parallel_execute_action-3496"><span class="linenos">3496</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3497"><a href="#PumpWoodMicroService.parallel_execute_action-3497"><span class="linenos">3497</span></a>        <span class="n">model_class</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3498"><a href="#PumpWoodMicroService.parallel_execute_action-3498"><span class="linenos">3498</span></a>            <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3499"><a href="#PumpWoodMicroService.parallel_execute_action-3499"><span class="linenos">3499</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3500"><a href="#PumpWoodMicroService.parallel_execute_action-3500"><span class="linenos">3500</span></a>        <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3501"><a href="#PumpWoodMicroService.parallel_execute_action-3501"><span class="linenos">3501</span></a>            <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3502"><a href="#PumpWoodMicroService.parallel_execute_action-3502"><span class="linenos">3502</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3503"><a href="#PumpWoodMicroService.parallel_execute_action-3503"><span class="linenos">3503</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3504"><a href="#PumpWoodMicroService.parallel_execute_action-3504"><span class="linenos">3504</span></a>            <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3505"><a href="#PumpWoodMicroService.parallel_execute_action-3505"><span class="linenos">3505</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3506"><a href="#PumpWoodMicroService.parallel_execute_action-3506"><span class="linenos">3506</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3507"><a href="#PumpWoodMicroService.parallel_execute_action-3507"><span class="linenos">3507</span></a>            <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3508"><a href="#PumpWoodMicroService.parallel_execute_action-3508"><span class="linenos">3508</span></a>            <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span> <span class="o">*</span> <span class="n">parallel_length</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3509"><a href="#PumpWoodMicroService.parallel_execute_action-3509"><span class="linenos">3509</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3510"><a href="#PumpWoodMicroService.parallel_execute_action-3510"><span class="linenos">3510</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3511"><a href="#PumpWoodMicroService.parallel_execute_action-3511"><span class="linenos">3511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3512"><a href="#PumpWoodMicroService.parallel_execute_action-3512"><span class="linenos">3512</span></a>                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3513"><a href="#PumpWoodMicroService.parallel_execute_action-3513"><span class="linenos">3513</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3514"><a href="#PumpWoodMicroService.parallel_execute_action-3514"><span class="linenos">3514</span></a>
</span><span id="PumpWoodMicroService.parallel_execute_action-3515"><a href="#PumpWoodMicroService.parallel_execute_action-3515"><span class="linenos">3515</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3516"><a href="#PumpWoodMicroService.parallel_execute_action-3516"><span class="linenos">3516</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3517"><a href="#PumpWoodMicroService.parallel_execute_action-3517"><span class="linenos">3517</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_execute_action-3518"><a href="#PumpWoodMicroService.parallel_execute_action-3518"><span class="linenos">3518</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel execute_action requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to perform action over,
or a list of model class o make diferent actions.</li>
<li><strong>pk:</strong>  A list of the pks to perform action or a
single pk to perform action with different paraemters.</li>
<li><strong>action:</strong>  A list of actions to perform or a single
action to perform over all pks and parameters.</li>
<li><strong>parameters:</strong>  Parameters used to perform actions
or a single dict to be used in all actions.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the execute_action request data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>PumpWoodException:</strong>  'parallel_length != len([argument])'. Indicates that function
arguments does not have all the same lenght.</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example yet.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_bulk_save" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_bulk_save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_bulk_save</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data_to_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_bulk_save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_bulk_save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_bulk_save-3520"><a href="#PumpWoodMicroService.parallel_bulk_save-3520"><span class="linenos">3520</span></a>    <span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3521"><a href="#PumpWoodMicroService.parallel_bulk_save-3521"><span class="linenos">3521</span></a>                           <span class="n">data_to_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]],</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3522"><a href="#PumpWoodMicroService.parallel_bulk_save-3522"><span class="linenos">3522</span></a>                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3523"><a href="#PumpWoodMicroService.parallel_bulk_save-3523"><span class="linenos">3523</span></a>                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3524"><a href="#PumpWoodMicroService.parallel_bulk_save-3524"><span class="linenos">3524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Break data_to_save in many parallel bulk_save requests.</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3525"><a href="#PumpWoodMicroService.parallel_bulk_save-3525"><span class="linenos">3525</span></a>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3526"><a href="#PumpWoodMicroService.parallel_bulk_save-3526"><span class="linenos">3526</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3527"><a href="#PumpWoodMicroService.parallel_bulk_save-3527"><span class="linenos">3527</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3528"><a href="#PumpWoodMicroService.parallel_bulk_save-3528"><span class="linenos">3528</span></a><span class="sd">                Model class of the data that will be saved.</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3529"><a href="#PumpWoodMicroService.parallel_bulk_save-3529"><span class="linenos">3529</span></a><span class="sd">            data_to_save:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3530"><a href="#PumpWoodMicroService.parallel_bulk_save-3530"><span class="linenos">3530</span></a><span class="sd">                Data that will be saved</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3531"><a href="#PumpWoodMicroService.parallel_bulk_save-3531"><span class="linenos">3531</span></a><span class="sd">            chunksize:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3532"><a href="#PumpWoodMicroService.parallel_bulk_save-3532"><span class="linenos">3532</span></a><span class="sd">                Length of each parallel bulk save chunk.</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3533"><a href="#PumpWoodMicroService.parallel_bulk_save-3533"><span class="linenos">3533</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3534"><a href="#PumpWoodMicroService.parallel_bulk_save-3534"><span class="linenos">3534</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3535"><a href="#PumpWoodMicroService.parallel_bulk_save-3535"><span class="linenos">3535</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3536"><a href="#PumpWoodMicroService.parallel_bulk_save-3536"><span class="linenos">3536</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3537"><a href="#PumpWoodMicroService.parallel_bulk_save-3537"><span class="linenos">3537</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3538"><a href="#PumpWoodMicroService.parallel_bulk_save-3538"><span class="linenos">3538</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3539"><a href="#PumpWoodMicroService.parallel_bulk_save-3539"><span class="linenos">3539</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3540"><a href="#PumpWoodMicroService.parallel_bulk_save-3540"><span class="linenos">3540</span></a>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3541"><a href="#PumpWoodMicroService.parallel_bulk_save-3541"><span class="linenos">3541</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3542"><a href="#PumpWoodMicroService.parallel_bulk_save-3542"><span class="linenos">3542</span></a><span class="sd">            List of the responses of bulk_save.</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3543"><a href="#PumpWoodMicroService.parallel_bulk_save-3543"><span class="linenos">3543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3544"><a href="#PumpWoodMicroService.parallel_bulk_save-3544"><span class="linenos">3544</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3545"><a href="#PumpWoodMicroService.parallel_bulk_save-3545"><span class="linenos">3545</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3546"><a href="#PumpWoodMicroService.parallel_bulk_save-3546"><span class="linenos">3546</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3547"><a href="#PumpWoodMicroService.parallel_bulk_save-3547"><span class="linenos">3547</span></a>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3548"><a href="#PumpWoodMicroService.parallel_bulk_save-3548"><span class="linenos">3548</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3549"><a href="#PumpWoodMicroService.parallel_bulk_save-3549"><span class="linenos">3549</span></a>            <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3550"><a href="#PumpWoodMicroService.parallel_bulk_save-3550"><span class="linenos">3550</span></a>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3551"><a href="#PumpWoodMicroService.parallel_bulk_save-3551"><span class="linenos">3551</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3552"><a href="#PumpWoodMicroService.parallel_bulk_save-3552"><span class="linenos">3552</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3553"><a href="#PumpWoodMicroService.parallel_bulk_save-3553"><span class="linenos">3553</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3554"><a href="#PumpWoodMicroService.parallel_bulk_save-3554"><span class="linenos">3554</span></a>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3555"><a href="#PumpWoodMicroService.parallel_bulk_save-3555"><span class="linenos">3555</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3556"><a href="#PumpWoodMicroService.parallel_bulk_save-3556"><span class="linenos">3556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3557"><a href="#PumpWoodMicroService.parallel_bulk_save-3557"><span class="linenos">3557</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_bulk_save-3558"><a href="#PumpWoodMicroService.parallel_bulk_save-3558"><span class="linenos">3558</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Break data_to_save in many parallel bulk_save requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model class of the data that will be saved.</li>
<li><strong>data_to_save:</strong>  Data that will be saved</li>
<li><strong>chunksize:</strong>  Length of each parallel bulk save chunk.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the responses of bulk_save.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.parallel_pivot" class="classattr">
                                        <input id="PumpWoodMicroService.parallel_pivot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parallel_pivot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="nb">format</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">variables</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#PumpWoodMicroService.list">PumpWoodMicroService.list</a></span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.parallel_pivot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.parallel_pivot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.parallel_pivot-3560"><a href="#PumpWoodMicroService.parallel_pivot-3560"><span class="linenos">3560</span></a>    <span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3561"><a href="#PumpWoodMicroService.parallel_pivot-3561"><span class="linenos">3561</span></a>                       <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3562"><a href="#PumpWoodMicroService.parallel_pivot-3562"><span class="linenos">3562</span></a>                       <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3563"><a href="#PumpWoodMicroService.parallel_pivot-3563"><span class="linenos">3563</span></a>                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3564"><a href="#PumpWoodMicroService.parallel_pivot-3564"><span class="linenos">3564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make [n_parallel] parallel pivot request.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3565"><a href="#PumpWoodMicroService.parallel_pivot-3565"><span class="linenos">3565</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3566"><a href="#PumpWoodMicroService.parallel_pivot-3566"><span class="linenos">3566</span></a><span class="sd">        Args:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3567"><a href="#PumpWoodMicroService.parallel_pivot-3567"><span class="linenos">3567</span></a><span class="sd">            model_class:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3568"><a href="#PumpWoodMicroService.parallel_pivot-3568"><span class="linenos">3568</span></a><span class="sd">                Model Class to retrieve.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3569"><a href="#PumpWoodMicroService.parallel_pivot-3569"><span class="linenos">3569</span></a><span class="sd">            list_args:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3570"><a href="#PumpWoodMicroService.parallel_pivot-3570"><span class="linenos">3570</span></a><span class="sd">                A list of list request args (filter_dict,exclude_dict,</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3571"><a href="#PumpWoodMicroService.parallel_pivot-3571"><span class="linenos">3571</span></a><span class="sd">                order_by).</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3572"><a href="#PumpWoodMicroService.parallel_pivot-3572"><span class="linenos">3572</span></a><span class="sd">            columns:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3573"><a href="#PumpWoodMicroService.parallel_pivot-3573"><span class="linenos">3573</span></a><span class="sd">                List of columns at the pivoted table.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3574"><a href="#PumpWoodMicroService.parallel_pivot-3574"><span class="linenos">3574</span></a><span class="sd">            format:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3575"><a href="#PumpWoodMicroService.parallel_pivot-3575"><span class="linenos">3575</span></a><span class="sd">                Format of returned table. See pandas.DataFrame</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3576"><a href="#PumpWoodMicroService.parallel_pivot-3576"><span class="linenos">3576</span></a><span class="sd">                to_dict args.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3577"><a href="#PumpWoodMicroService.parallel_pivot-3577"><span class="linenos">3577</span></a><span class="sd">            n_parallel:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3578"><a href="#PumpWoodMicroService.parallel_pivot-3578"><span class="linenos">3578</span></a><span class="sd">                Number of simultaneus get requests, if not set</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3579"><a href="#PumpWoodMicroService.parallel_pivot-3579"><span class="linenos">3579</span></a><span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3580"><a href="#PumpWoodMicroService.parallel_pivot-3580"><span class="linenos">3580</span></a><span class="sd">                not set then 4 will be considered.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3581"><a href="#PumpWoodMicroService.parallel_pivot-3581"><span class="linenos">3581</span></a><span class="sd">            variables:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3582"><a href="#PumpWoodMicroService.parallel_pivot-3582"><span class="linenos">3582</span></a><span class="sd">                Restrict the fields that will be returned at the query.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3583"><a href="#PumpWoodMicroService.parallel_pivot-3583"><span class="linenos">3583</span></a><span class="sd">            show_deleted:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3584"><a href="#PumpWoodMicroService.parallel_pivot-3584"><span class="linenos">3584</span></a><span class="sd">                If results should include data with deleted=True. This will</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3585"><a href="#PumpWoodMicroService.parallel_pivot-3585"><span class="linenos">3585</span></a><span class="sd">                be ignored if model class does not have deleted field.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3586"><a href="#PumpWoodMicroService.parallel_pivot-3586"><span class="linenos">3586</span></a><span class="sd">            auth_header:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3587"><a href="#PumpWoodMicroService.parallel_pivot-3587"><span class="linenos">3587</span></a><span class="sd">                Auth header to substitute the microservice original</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3588"><a href="#PumpWoodMicroService.parallel_pivot-3588"><span class="linenos">3588</span></a><span class="sd">                at the request (user impersonation).</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3589"><a href="#PumpWoodMicroService.parallel_pivot-3589"><span class="linenos">3589</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3590"><a href="#PumpWoodMicroService.parallel_pivot-3590"><span class="linenos">3590</span></a><span class="sd">        Returns:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3591"><a href="#PumpWoodMicroService.parallel_pivot-3591"><span class="linenos">3591</span></a><span class="sd">            List of the pivot request reponses.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3592"><a href="#PumpWoodMicroService.parallel_pivot-3592"><span class="linenos">3592</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3593"><a href="#PumpWoodMicroService.parallel_pivot-3593"><span class="linenos">3593</span></a><span class="sd">        Raises:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3594"><a href="#PumpWoodMicroService.parallel_pivot-3594"><span class="linenos">3594</span></a><span class="sd">            No particular raises.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3595"><a href="#PumpWoodMicroService.parallel_pivot-3595"><span class="linenos">3595</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3596"><a href="#PumpWoodMicroService.parallel_pivot-3596"><span class="linenos">3596</span></a><span class="sd">        Example:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3597"><a href="#PumpWoodMicroService.parallel_pivot-3597"><span class="linenos">3597</span></a><span class="sd">            No example yet.</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3598"><a href="#PumpWoodMicroService.parallel_pivot-3598"><span class="linenos">3598</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3599"><a href="#PumpWoodMicroService.parallel_pivot-3599"><span class="linenos">3599</span></a>        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3600"><a href="#PumpWoodMicroService.parallel_pivot-3600"><span class="linenos">3600</span></a>            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3601"><a href="#PumpWoodMicroService.parallel_pivot-3601"><span class="linenos">3601</span></a>                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3602"><a href="#PumpWoodMicroService.parallel_pivot-3602"><span class="linenos">3602</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3603"><a href="#PumpWoodMicroService.parallel_pivot-3603"><span class="linenos">3603</span></a>        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3604"><a href="#PumpWoodMicroService.parallel_pivot-3604"><span class="linenos">3604</span></a>        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3605"><a href="#PumpWoodMicroService.parallel_pivot-3605"><span class="linenos">3605</span></a>        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3606"><a href="#PumpWoodMicroService.parallel_pivot-3606"><span class="linenos">3606</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3607"><a href="#PumpWoodMicroService.parallel_pivot-3607"><span class="linenos">3607</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3608"><a href="#PumpWoodMicroService.parallel_pivot-3608"><span class="linenos">3608</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3609"><a href="#PumpWoodMicroService.parallel_pivot-3609"><span class="linenos">3609</span></a>            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3610"><a href="#PumpWoodMicroService.parallel_pivot-3610"><span class="linenos">3610</span></a>
</span><span id="PumpWoodMicroService.parallel_pivot-3611"><a href="#PumpWoodMicroService.parallel_pivot-3611"><span class="linenos">3611</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3612"><a href="#PumpWoodMicroService.parallel_pivot-3612"><span class="linenos">3612</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3613"><a href="#PumpWoodMicroService.parallel_pivot-3613"><span class="linenos">3613</span></a>            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.parallel_pivot-3614"><a href="#PumpWoodMicroService.parallel_pivot-3614"><span class="linenos">3614</span></a>            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make [n_parallel] parallel pivot request.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_class:</strong>  Model Class to retrieve.</li>
<li><strong>list_args:</strong>  A list of list request args (filter_dict,exclude_dict,
order_by).</li>
<li><strong>columns:</strong>  List of columns at the pivoted table.</li>
<li><strong>format:</strong>  Format of returned table. See pandas.DataFrame
to_dict args.</li>
<li><strong>n_parallel:</strong>  Number of simultaneus get requests, if not set
get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
not set then 4 will be considered.</li>
<li><strong>variables:</strong>  Restrict the fields that will be returned at the query.</li>
<li><strong>show_deleted:</strong>  If results should include data with deleted=True. This will
be ignored if model class does not have deleted field.</li>
<li><strong>auth_header:</strong>  Auth header to substitute the microservice original
at the request (user impersonation).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List of the pivot request reponses.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li>No particular raises.</li>
</ul>

<h6 id="example">Example:</h6>

<blockquote>
  <p>No example yet.</p>
</blockquote>
</div>


                            </div>
                            <div id="PumpWoodMicroService.get_queue_matrix" class="classattr">
                                        <input id="PumpWoodMicroService.get_queue_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_queue_matrix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PumpWoodMicroService.get_queue_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PumpWoodMicroService.get_queue_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PumpWoodMicroService.get_queue_matrix-3616"><a href="#PumpWoodMicroService.get_queue_matrix-3616"><span class="linenos">3616</span></a>    <span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3617"><a href="#PumpWoodMicroService.get_queue_matrix-3617"><span class="linenos">3617</span></a>                         <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3618"><a href="#PumpWoodMicroService.get_queue_matrix-3618"><span class="linenos">3618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix. In development...&quot;&quot;&quot;</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3619"><a href="#PumpWoodMicroService.get_queue_matrix-3619"><span class="linenos">3619</span></a>        <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3620"><a href="#PumpWoodMicroService.get_queue_matrix-3620"><span class="linenos">3620</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3621"><a href="#PumpWoodMicroService.get_queue_matrix-3621"><span class="linenos">3621</span></a>            <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3622"><a href="#PumpWoodMicroService.get_queue_matrix-3622"><span class="linenos">3622</span></a>            <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3623"><a href="#PumpWoodMicroService.get_queue_matrix-3623"><span class="linenos">3623</span></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3624"><a href="#PumpWoodMicroService.get_queue_matrix-3624"><span class="linenos">3624</span></a>            <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3625"><a href="#PumpWoodMicroService.get_queue_matrix-3625"><span class="linenos">3625</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3626"><a href="#PumpWoodMicroService.get_queue_matrix-3626"><span class="linenos">3626</span></a>        <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3627"><a href="#PumpWoodMicroService.get_queue_matrix-3627"><span class="linenos">3627</span></a>        <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3628"><a href="#PumpWoodMicroService.get_queue_matrix-3628"><span class="linenos">3628</span></a>
</span><span id="PumpWoodMicroService.get_queue_matrix-3629"><a href="#PumpWoodMicroService.get_queue_matrix-3629"><span class="linenos">3629</span></a>        <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3630"><a href="#PumpWoodMicroService.get_queue_matrix-3630"><span class="linenos">3630</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3631"><a href="#PumpWoodMicroService.get_queue_matrix-3631"><span class="linenos">3631</span></a>            <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3632"><a href="#PumpWoodMicroService.get_queue_matrix-3632"><span class="linenos">3632</span></a>            <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3633"><a href="#PumpWoodMicroService.get_queue_matrix-3633"><span class="linenos">3633</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3634"><a href="#PumpWoodMicroService.get_queue_matrix-3634"><span class="linenos">3634</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3635"><a href="#PumpWoodMicroService.get_queue_matrix-3635"><span class="linenos">3635</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3636"><a href="#PumpWoodMicroService.get_queue_matrix-3636"><span class="linenos">3636</span></a>                <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
</span><span id="PumpWoodMicroService.get_queue_matrix-3637"><a href="#PumpWoodMicroService.get_queue_matrix-3637"><span class="linenos">3637</span></a>                <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Download model queue estimation matrix. In development...</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>