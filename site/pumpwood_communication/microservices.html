<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

  
  <title>pumpwood_communication.microservices API documentation</title>
  <meta name="description" content="Module microservice.py.

Class and functions to help communication between PumpWood like systems." />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">
  


















  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3>Super-module</h3>
      <ul>
        <li class="mono"><a href="index.html">pumpwood_communication</a></li>
      </ul>
    </li>
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#pumpwood_communication.microservices.Log_Format">Log_Format</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.exceptions_dict">exceptions_dict</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.microservice_logger">microservice_logger</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#pumpwood_communication.microservices.break_in_chunks">break_in_chunks</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#pumpwood_communication.microservices.PumpWoodMicroService">PumpWoodMicroService</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.angular_json">angular_json</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.flatten_parallel">flatten_parallel</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.is_invalid_token_response">is_invalid_token_response</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.bulk_save">bulk_save</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.check_if_logged">check_if_logged</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.confirm_mfa_code">confirm_mfa_code</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.delete">delete</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.delete_many">delete_many</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.dummy_call">dummy_call</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.dummy_raise">dummy_raise</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.error_handler">error_handler</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.execute_action">execute_action</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.fill_options">fill_options</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.fill_validation">fill_validation</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.flat_list_by_chunks">flat_list_by_chunks</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.get_auth_header">get_auth_header</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.get_pks_from_unique_field">get_pks_from_unique_field</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.get_queue_matrix">get_queue_matrix</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.get_user_info">get_user_info</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.init">init</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.is_credential_set">is_credential_set</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.is_microservice_registered">is_microservice_registered</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list">list</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_actions">list_actions</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_by_chunks">list_by_chunks</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_dimension_values">list_dimension_values</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_dimensions">list_dimensions</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_one">list_one</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_options">list_options</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_registered_endpoints">list_registered_endpoints</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_registered_routes">list_registered_routes</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.list_without_pag">list_without_pag</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.login">login</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.logout">logout</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.logout_all">logout_all</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_delete">paralell_request_delete</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_post">paralell_request_post</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_bulk_save">parallel_bulk_save</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete">parallel_delete</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete_many">parallel_delete_many</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_execute_action">parallel_execute_action</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_list">parallel_list</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_one">parallel_list_one</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_without_pag">parallel_list_without_pag</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_pivot">parallel_pivot</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_request_get">parallel_request_get</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve">parallel_retrieve</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve_file">parallel_retrieve_file</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.parallel_save">parallel_save</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.pivot">pivot</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.remove_file_field">remove_file_field</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.request_delete">request_delete</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.request_get">request_get</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.request_post">request_post</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.retrieve">retrieve</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.retrieve_file">retrieve_file</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.retrieve_options">retrieve_options</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.retrieve_streaming_file">retrieve_streaming_file</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.save">save</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.save_streaming_file">save_streaming_file</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.search_options">search_options</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.set_auth_header">set_auth_header</a></li>
    <li class="mono"><a href="#pumpwood_communication.microservices.PumpWoodMicroService.time_to_expiry">time_to_expiry</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

<article id="content">
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pumpwood_communication.microservices</span> module</h1>
  <p>Module microservice.py.</p>
<p>Class and functions to help communication between PumpWood like systems.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module microservice.py.</span>

<span class="sd">Class and functions to help communication between PumpWood like systems.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">simplejson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">geopd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">ExcelWriter</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">secure_filename</span>
<span class="kn">from</span> <span class="nn">pumpwood_communication.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">exceptions_dict</span><span class="p">,</span> <span class="n">PumpWoodException</span><span class="p">,</span> <span class="n">PumpWoodUnauthorized</span><span class="p">,</span>
    <span class="n">PumpWoodObjectSavingException</span><span class="p">,</span> <span class="n">PumpWoodOtherException</span><span class="p">,</span>
    <span class="n">PumpWoodQueryException</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pumpwood_communication.serializers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">pumpJsonDump</span><span class="p">,</span> <span class="n">CompositePkBase64Converter</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pumpwood_communication.misc</span> <span class="kn">import</span> <span class="n">unpack_dict_columns</span>

<span class="c1"># Creating logger for MicroService calls</span>
<span class="n">Log_Format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">Log_Format</span><span class="p">)</span>
<span class="n">microservice_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pumpwood_comunication&#39;</span><span class="p">)</span>
<span class="n">microservice_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Break a dataframe in chunks of chunksize.&quot;&quot;&quot;</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_to_break</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">))</span> <span class="o">//</span> <span class="n">chunksize</span><span class="p">):</span>
        <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_return</span>


<span class="k">class</span> <span class="nc">PumpWoodMicroService</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to define an inter-pumpwood MicroService.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">server_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">server_url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">server_url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">server_url</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">auth_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new PumpWoodMicroService object.</span>

<span class="sd">        Creates a new microservice object. If just name is passed, object must</span>
<span class="sd">        be initiate after with init() method.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the microservice, helps when exceptions</span>
<span class="sd">                        are raised.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            server_url (str): url of the server that will be connected.</span>
<span class="sd">            username (str): Username that will be logged on.</span>
<span class="sd">            password (str): Variable to be converted to JSON and posted along</span>
<span class="sd">            with the request</span>
<span class="sd">            verify_ssl (bool): Set if microservice will verify ssl certificate</span>
<span class="sd">        Returns:</span>
<span class="sd">            PumpWoodMicroService: New PumpWoodMicroService object</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="o">=</span> <span class="n">auth_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mfa_login</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">auth_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a microservice after creation.</span>

<span class="sd">        Usefull in flask app config.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the microservice, helps when exceptions</span>
<span class="sd">                        are raised.</span>
<span class="sd">            server_url (str): url of the server that will be connected.</span>
<span class="sd">            user_name (str): Username that will be logged on.</span>
<span class="sd">            password (str): Variable to be converted to JSON and posted along</span>
<span class="sd">            with the request</span>
<span class="sd">            verify_ssl (bool): Set if microservice will verify ssl certificate</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_suffix (str): Add a suffix to auth end-point in case of</span>
<span class="sd">                authentication end-point have any suffix.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="o">=</span> <span class="n">auth_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert text to Json removing any XSSI at the beging of JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            request_result (Request): JSON Request to be converted</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return time to token expiry.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return time until token expiration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
        <span class="k">return</span> <span class="n">time_to_expiry</span>

    <span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if username and password are set on object.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            True if usename and password were set during object creation or</span>
<span class="sd">            later with init function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log microservice in using username and password provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            force_refresh [bool]: Force token refresh despise still valid</span>
<span class="sd">                according to self.__token_expiry.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: If login response has status diferent from 200.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>

        <span class="c1"># Check if expiry time is 1h from now</span>
        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># When if debug always refresh token</span>
        <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>

        <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
            <span class="n">login_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">registration/login/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">temp_url</span><span class="p">)</span>

            <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
                    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>

            <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
                <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ask user to confirm MFA code to login.</span>

<span class="sd">        Args:</span>
<span class="sd">            mfa_login_data [dict]: Result from login request with &#39;mfa_token&#39;</span>
<span class="sd">                as key.</span>
<span class="sd">        Return [dict]:</span>
<span class="sd">            Return login returned with MFA confimation.</span>
<span class="sd">        Raise:</span>
<span class="sd">            Raise error if reponse is not valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
        <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>

        <span class="c1"># Set is_mfa_login true to indicate that login required MFA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logout token.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            auth_header [dict] Authentication header.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            True if logout was ok.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logout all tokens from user.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            auth_header [dict] Authentication header.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            True if logout all was ok.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                        <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set auth_header and token_expiry date.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header [dict]: Authentication header to be set.</span>
<span class="sd">            token_expiry [pd.Timestamp]: Token expiry datetime to be set.</span>
<span class="sd">        Return [None]:</span>
<span class="sd">            No return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve auth_header and token_expiry from object.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return authorization header and token_expiry datetime from object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
            <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">check_if_logged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if user is logged.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header (dict): AuthHeader to substitute the</span>
<span class="sd">                microservice original</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            Return True if auth_header is looged and False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/check/&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">PumpWoodUnauthorized</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">check</span>

    <span class="k">def</span> <span class="nf">get_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get user info.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args:</span>

<span class="sd">        Return [dict]:</span>
<span class="sd">            A serialized user object with information of the logged user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/retrieveauthenticateduser/&quot;</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user_info</span>

    <span class="k">def</span> <span class="nf">_check__auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if auth_header is set or auth_header if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header (dict): AuthHeader to substitute the</span>
<span class="sd">                                microservice original</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Return a header dict to be used in requests.</span>
<span class="sd">        Raises:</span>
<span class="sd">            PumpWoodUnauthorized: If microservice is not logged and a</span>
<span class="sd">                                  auth_header method argument is not provided.</span>
<span class="sd">            PumpWoodUnauthorized: If microservice is logged and a auth_header</span>
<span class="sd">                                  method argument is provided.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Login will refresh token if it is 1h to expire, it will also</span>
            <span class="c1"># check if credentials are set.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
                <span class="n">msg_tmp</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;MicroService </span><span class="si">{name}</span><span class="s1"> already looged and &#39;</span>
                    <span class="s1">&#39;auth_header was provided&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                    <span class="n">msg_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="c1"># Set base header as JSON since unserialization is done using</span>
            <span class="c1"># Pumpwood Communication serialization funciton</span>
            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>

    <span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle request error.</span>

<span class="sd">        Check if is a Json and propagate the error with</span>
<span class="sd">        same type if possible. If not Json raises the content.</span>

<span class="sd">        Arg:</span>
<span class="sd">            response (Response): response to be handled.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No kwargs.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return.</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: If content-type is not application/json.</span>
<span class="sd">            Exception: If content-type is application/json, but type not</span>
<span class="sd">                       present or not recognisable.</span>
<span class="sd">            Other Exception: If content-type is application/json if type is</span>
<span class="sd">                             present and recognisable.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>

            <span class="c1"># Request information</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="c1"># Raise the exception as first in exception deep.</span>
                <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
                    <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                    <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>

            <span class="c1"># Build error stack</span>
            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="c1"># Removing previus error stack</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>

            <span class="c1"># Propagate error</span>
            <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exceptions_dict</span><span class="p">[</span><span class="n">exception_type</span><span class="p">](</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
                <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
                        <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
                        <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                                  <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if reponse has invalid token error.</span>

<span class="sd">        Args:</span>
<span class="sd">            response [requests.models.Response]: Request reponse to check for</span>
<span class="sd">                invalid token.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            Return True if response has an invalid token status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a POST a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">            data (any); Data to be used as Json payload.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            files(list of tuples): A list of tuples with</span>
<span class="sd">                                   (file name, [file1, file2, ...]).</span>
<span class="sd">            params [dict]: Url parameters.</span>
<span class="sd">            auth_header(dict): Auth data to overhide microservice&#39;s.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If parameters are not none convert them to json before</span>
        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
        <span class="c1"># for exemple</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

            <span class="c1"># Retry request if token is not valid forcing token renew</span>
            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

        <span class="c1"># Request with files are done using multipart serializing all fields</span>
        <span class="c1"># as json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

        <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="c1"># Check if reponse is a file</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a GET a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict): Url parameters to make the request.</span>
<span class="sd">            auth_header (dict): Authentication dictionary.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1"># If parameters are not none convert them to json before</span>
        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
        <span class="c1"># for example</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Re-raise Pumpwood exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a DELETE a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict): Dictionary with Urls parameters.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Retry request if token is not valid forcing token renew</span>
        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Re-raise Pumpwood Exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/routes/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">routes</span>

    <span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List routes that have been registed at Kong.</span>

<span class="sd">        Args:</span>
<span class="sd">            microservice [str]: Service associated with microservice</span>
<span class="sd">                registered on Pumpwood Kong.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return true if microservice is registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/endpoints/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">routes</span>

    <span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dummy call to ensure headers and payload reaching app.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">                end-point.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>

<span class="sd">        Return:</span>
<span class="sd">            Return a dictonary with:</span>
<span class="sd">            - full_path (dict): Full path of the request.</span>
<span class="sd">            - method (dict): Method used at the call</span>
<span class="sd">            - headers (dict): Headers at the request.</span>
<span class="sd">            - data (dict): Post payload sent at the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/dummy-call/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise an Pumpwood error with the payload.</span>

<span class="sd">        Can be used for debug purposes.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception_class (str): Class of the exception to be raised.</span>
<span class="sd">            exception_deep (int): Deep of the exception in microservice</span>
<span class="sd">                calls.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">                end-point.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">        Return:</span>
<span class="sd">            Should not return any results, all possible call should result</span>
<span class="sd">            in raising the correspondent error.</span>
<span class="sd">        Exceptions:</span>
<span class="sd">            Should raise the correspondent error passed on exception_class</span>
<span class="sd">            arg, with payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get pk using unique fields values.</span>

<span class="sd">        Use unique field values to retrieve pk of the objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class [str]: Model class of the objects.</span>
<span class="sd">            field [str]: Unique field to fetch pk.</span>
<span class="sd">            values [List[Any]]: List of the unique fields used to fetch</span>
<span class="sd">                primary keys.</span>
<span class="sd">        Return [pd.DataFrame]:</span>
<span class="sd">            Return a dataframe in same order as values with columns:</span>
<span class="sd">                - pk: correspondent primary key of the unique value.</span>
<span class="sd">                - [field]: Column with same name of field argument,</span>
<span class="sd">                    correspondent to pk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
            <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
            <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
                    <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>

            <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>

        <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
        <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>

        <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
            <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>

        <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
        <span class="p">})</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
             <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List objects with pagination.</span>

<span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">        systems, results will be paginated. To get next pag, send recived pk at</span>
<span class="sd">        exclude dict (ex.: exclude_dict={id__in: [1,2,...,30]}).</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments).</span>
<span class="sd">          exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments).</span>
<span class="sd">          order_by (list): Ordering list to be used at the query</span>
<span class="sd">            (objects.order_by arguments).</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">            end-point.</span>
<span class="sd">          default_fields [bool]: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          limit [int]: Set the limit of elements of the returned query.</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                       <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List object fetching them by chucks using pk to paginate.</span>

<span class="sd">        List data by chunck to load by datasets without breaking the backend</span>
<span class="sd">        or receive server timeout. It load chunks orderring the results using</span>
<span class="sd">        id of the tables, it can be changed but it should be unique otherwise</span>
<span class="sd">        unexpected results may occur.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict) = {}: Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments).</span>
<span class="sd">          exclude_dict (dict) = {}:  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments).</span>
<span class="sd">          auth_header (dict) = None: Dictionary containing the auth header.</span>
<span class="sd">          fields (list[str]) = None: Select the fields to be returned by the</span>
<span class="sd">            list end-point.</span>
<span class="sd">          default_fields (bool) = False: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          chuck_size [int]: Number of objects to be fetched each query.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>

        <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
            <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
            <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
                <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>

            <span class="c1"># Break if results is empty</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
            <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">list_all_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-without-pag/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                         <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List object without pagination.</span>

<span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">        systems, results won&#39;t be paginated.</span>
<span class="sd">        **Be carefull with large returns.**</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments)</span>
<span class="sd">          exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments)</span>
<span class="sd">          order_by (list): Ordering list to be used at the query</span>
<span class="sd">            (objects.order_by arguments)</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          return_type(str): Set the return type, can be [list, dataframe].</span>
<span class="sd">          convert_geometry(bool) = True: Covert geometry to shapely.</span>
<span class="sd">          fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">            end-point.</span>
<span class="sd">          default_fields [bool]: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
            <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1">##################################################</span>
        <span class="c1"># Converting geometry to Shapely objects in Python</span>
        <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
                    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">##################################################</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">geometry_in_results</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimensions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Args:</span>
<span class="sd">          model_class: str</span>
<span class="sd">            model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict: dict = {}</span>
<span class="sd">            Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">          exclude_dict: dict = {}</span>
<span class="sd">            Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">          auth_header: dict= {}</span>
<span class="sd">            Dictionary containing the auth header.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of keys avaiable in results from the query dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimension-values/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Args:</span>
<span class="sd">          model_class: str</span>
<span class="sd">            Model class of the end-point.</span>
<span class="sd">          key: str</span>
<span class="sd">            Key to list the avaiable values using the query filter and exclude.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict: dict = {}</span>
<span class="sd">            Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">          exclude_dict: dict = {}</span>
<span class="sd">            Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">          auth_header: dict= {}</span>
<span class="sd">            Dictionary containing the auth header.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of keys avaiable in results from the query dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                     <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an object using list serializer (simple).</span>

<span class="sd">        Function to get object serialized by retrieve end-point with list</span>
<span class="sd">        serializer.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>
<span class="sd">          pk (int): Object pk</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an object from PumpWood.</span>

<span class="sd">        Function to get object serialized by retrieve end-point</span>
<span class="sd">        (more detailed data).</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>
<span class="sd">          pk (int): Object pk</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">          related_fields [bool]: Return related fields information.</span>
<span class="sd">          fields [list]:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a file from PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Class of the model to retrieve file.</span>
<span class="sd">          pk (int): Pk of the object associeted file.</span>
<span class="sd">          file_field (str): Field of the file to be downloaded.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          save_file (bool): If data is to be saved as file or return get</span>
<span class="sd">            response.</span>
<span class="sd">          save_path (str): Path of the directory to save file.</span>
<span class="sd">          file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">                saved in PumpWood.</span>
<span class="sd">          if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}: Set what to</span>
<span class="sd">            do if there is a file with same name. Skip will not download file</span>
<span class="sd">            if there is already with same os.path.join(save_path, file_name),</span>
<span class="sd">            file_name must be set for skip argument.</span>
<span class="sd">        Returns:</span>
<span class="sd">          requset.response or str</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
                <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">file_path</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">file_response</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">save_path</span><span class="p">))</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                    <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                        <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">file_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_file_straming_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file-streaming/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
                                <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a file from PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Class of the model to retrieve file.</span>
<span class="sd">          pk (int): Pk of the object associeted file.</span>
<span class="sd">          file_field (str): Field of the file to be downloaded.</span>
<span class="sd">          file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">                saved in PumpWood.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          save_path (str): Path of the directory to save file.</span>
<span class="sd">          if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}: Set what to do if</span>
<span class="sd">            there is a file with same name.</span>

<span class="sd">        Returns:</span>
<span class="sd">          requset.response or str</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1"># begin Args check</span>
        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">save_path</span><span class="p">))</span>
        <span class="c1"># end Args check</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save or Update a new object.</span>

<span class="sd">        Function to save or update a new model_class object. If obj_dict{&#39;pk&#39;}</span>
<span class="sd">        is None or not defined a new object will be created. The obj</span>
<span class="sd">        model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
<span class="sd">        PumpWoodObjectSavingException will be raised.</span>

<span class="sd">        Args:</span>
<span class="sd">          obj_dict (dict): Model data dictionary. It must have &#39;model_class&#39;</span>
<span class="sd">                           key and if &#39;pk&#39; key is not defined a new object will</span>
<span class="sd">                           be created, else object with pk will be updated.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          files (dict): A dictionary of files to be added to as a multi-part</span>
<span class="sd">                        post request.</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Updated/Created object data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          PumpWoodObjectSavingException(</span>
<span class="sd">              &#39;To save an object obj_dict must have model_class defined.&#39;):</span>
<span class="sd">            Will be raised if model_class key is not present on</span>
<span class="sd">            obj_dict dictionary</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
                <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_save_streaming_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">{model_class}</span><span class="s2">/save-file-streaming/</span><span class="si">{pk}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stream file to PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class of the object.</span>
<span class="sd">            pk (int): pk of the object.</span>
<span class="sd">            file_field (str): File field that will receive file stream.</span>
<span class="sd">            file (io.BufferedReader): File to upload.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            file_name (str): Name of the file, is not set it will be saved as</span>
<span class="sd">                {pk}__{file_field}.{extension at permited extension}</span>
<span class="sd">            auth_header (dict): Authentication dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span> \
                <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send delete request to a PumpWood object.</span>

<span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">        object with the specified pk.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">            have been implemented)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/remove-file-field/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send delete request to a PumpWood object.</span>

<span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">        object with the specified pk.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">                have been implemented)</span>
<span class="sd">            file_field (str): File field to be removed.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a post request to a delete objects in a query.</span>

<span class="sd">        Delete objects in the results of a query.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            filter_dict (dict): Dictionary to make filter query.</span>
<span class="sd">            exclude_dict (dict): Dictionary to make exclude query.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header (dict): Dictionary containing the auth header</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if delete is ok.</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all actions avaiable at this model class.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to list possible actions.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: List of possible actions and its descriptions</span>

<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_execute_action_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">return</span> <span class="n">url_str</span>

    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute action.</span>

<span class="sd">        If action is static or classfunction no pk</span>
<span class="sd">        is necessary.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to run action the object</span>
<span class="sd">          action (str): Action that will be performed.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          parameters(dict): Dictionary with the function parameters.</span>
<span class="sd">          files(list of tuples): A list of tuples with</span>
<span class="sd">                                 (file name, [file1, file2, ...]).</span>

<span class="sd">        Returns:</span>
<span class="sd">          pk (int): Pk of the object that action will be performed over.</span>
<span class="sd">          parameters (dict): Parameter dictionary to use in the action.</span>

<span class="sd">        Raises:</span>
<span class="sd">          dict: Return a dict with four keys:</span>
<span class="sd">            - result: Result of the action.</span>
<span class="sd">            - action: Action description.</span>
<span class="sd">            - parameters: Parameters used to perform action.</span>
<span class="sd">            - obj: Object over which were performed the action.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return search options.</span>

<span class="sd">        Returns options to search, like forenging keys and choice fields.</span>
<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to check search parameters</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary with search parameters</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                     <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options for object fields.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          parcial_obj_dict (dict): Partial object data</span>
<span class="sd">          field (str): Get an specific field information</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options to render list views.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options to render retrieve views.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options for object fields.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          parcial_obj_dict (dict): Partial object data</span>
<span class="sd">          field (str): Get an specific field information</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/pivot/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
              <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pivot object data acording to columns specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to be pivoted.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            columns (str): Fields to be used as columns.</span>
<span class="sd">            format (str): Format to be used to convert pandas.DataFrame to</span>
<span class="sd">                          dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
<span class="sd">                          &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
<span class="sd">            filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                                argument (Same as list end-point).</span>
<span class="sd">            exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                                 argument (Same as list end-point).</span>
<span class="sd">            order_by (list): Dictionary to to be used in objects.order_by</span>
<span class="sd">                             argument (Same as list end-point).</span>
<span class="sd">            variables (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">                if None, the default variables will be returned.</span>
<span class="sd">            show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict or list: Depends on format type used to convert</span>
<span class="sd">                          pandas.DataFrame</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flat_list_by_chunks_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Unpacking arguments</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]</span>
            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;filter_dict&quot;</span><span class="p">]</span>
            <span class="n">exclude_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;exclude_dict&quot;</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
            <span class="n">show_deleted</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span>
            <span class="n">auth_header</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;auth_header&quot;</span><span class="p">]</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>

            <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
            <span class="n">max_pk</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Fetch data until an empty result is returned</span>
            <span class="n">list_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">temp_filter_dict</span><span class="p">[</span><span class="s2">&quot;id__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_pk</span>
                <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
                    <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                    <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="n">temp_dateframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">))</span>

                <span class="c1"># Break if results are less than chunk size, so no more results</span>
                <span class="c1"># are avaiable</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chunk_size</span><span class="p">:</span>
                    <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">max_pk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at flat_list_by_chunks:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                            <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the same end-point as pivot which does not unserialize results.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to be pivoted.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                                argument (Same as list end-point).</span>
<span class="sd">            exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                                 argument (Same as list end-point).</span>
<span class="sd">            fields (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">                if None, the default variables will be returned.</span>
<span class="sd">            show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">            chunk_size (int): Limit of data to fetch per call.</span>
<span class="sd">            n_parallel (int): Number of parallel process to perform.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict or list: Depends on format type used to convert</span>
<span class="sd">                          pandas.DataFrame</span>

<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>

<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Create a list of month and include start and end dates if not at</span>
        <span class="c1"># the beginning of a month</span>
        <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
            <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
            <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
            <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
                <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>

        <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1">##########################################################</span>
        <span class="c1"># If table have more than one partition, run in parallel #</span>
        <span class="c1"># the {partition}__in elements along with dates          #</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
            <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Validating query for partitioned tables</span>
            <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
                    <span class="s2">&quot;queries without at least first level partition will &quot;</span>
                    <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
                    <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
                    <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
                    <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1"># Parallelizing query using partition columns</span>
            <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
                <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
                <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
                <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
                        <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                            <span class="n">request_filter_dict</span><span class="p">)</span>
                        <span class="c1"># If is not the last interval, query using open</span>
                        <span class="c1"># right interval so subsequence querys does</span>
                        <span class="c1"># not overlap</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

                        <span class="c1"># At the last interaval use closed right interval so</span>
                        <span class="c1"># last element is also included in the interval</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

                        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                            <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
                            <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                            <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>

            <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
                        <span class="n">pool_arguments</span><span class="p">)</span>
                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>

        <span class="c1">############################################</span>
        <span class="c1"># If table have partition, run in parallel #</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
            <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
                <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/bulk-save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a list of objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class(str): Data model class.</span>
<span class="sd">            data_to_save(list): A list of objects to be saved.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): A dictionary with authorization headers.</span>
<span class="sd">        Return:</span>
<span class="sd">            dict[&#39;saved_count&#39;]: Number of saved objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                                 <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1"># Paralell aux functions</span>
    <span class="k">def</span> <span class="nf">_request_get_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error on parallel get: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concat all parallel return to one list.</span>

<span class="sd">        Args:</span>
<span class="sd">            parallel_result (list): A list of lists to be flated (concatenate</span>
<span class="sd">                all lists into one).</span>
<span class="sd">        Return:</span>
<span class="sd">            A list with all sub list itens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] get request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list): List of urls to make get requests.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the get request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_request_post_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel post: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] post request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list&lt;str&gt;): List of urls to make get requests.</span>
<span class="sd">            data_list (list&lt;any&gt;): List of data to be used as post payloads.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the post request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;len(urls_list) must be equal to len(data_list)&#39;</span><span class="p">)</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                 <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_request_delete_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel delete: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] delete request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list): List of urls to make get requests.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the get request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="c1">####################</span>
    <span class="c1"># Paralell functions</span>
    <span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] retrieve request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">            list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request_retrieve_file_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel retrieve_file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
                               <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] retrieve request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">            list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">            file_field (str): Indicates the file field to download from.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            save_path (str) = &quot;./&quot;</span>
<span class="sd">            save_file (bool) = True: True save file locally, False return</span>
<span class="sd">                file content as bites.</span>
<span class="sd">            list_file_name (List[str]) = None: Set a file name for each file</span>
<span class="sd">                download.</span>
<span class="sd">            if_exists (str) = &quot;fail&quot;: Set how treat when a file will be saved</span>
<span class="sd">                and there is another at same path. &quot;fail&quot; will raise an error;</span>
<span class="sd">                &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
<span class="sd">                when list_file_name is set, check before downloaded it file</span>
<span class="sd">                already exists, if so skip the download.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
                    <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
                        <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
            <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
                <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
                <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
                    <span class="n">pool_arguments</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                      <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args_list (list): A list of list request args (filter_dict,</span>
<span class="sd">                                   exclude_dict, order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_without_pag request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_one request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str or list&lt;str&gt;): Model Class to retrieve.</span>
<span class="sd">            list_pk (list): List of the pks to retrieve.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                      <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] save requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">                PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                        <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] delete requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">                PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                           <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                             <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_without_pag request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
                                <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] execute_action requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, list(str)): Model Class to perform action over,</span>
<span class="sd">                or a list of model class o make diferent actions.</span>
<span class="sd">            pk (int, list[int]): A list of the pks to perform action or a</span>
<span class="sd">                single pk to perform action with different paraemters.</span>
<span class="sd">            action (str, list[str]): A list of actions to perform or a single</span>
<span class="sd">                action to perform over all pks and parameters.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict, list[dict]): Parameters used to perform actions</span>
<span class="sd">                or a single dict to be used in all actions.</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">model_class</span> <span class="o">=</span> <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">,</span>
                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Break data_to_save in many parallel requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class: Model class of the data that will be saved.</span>
<span class="sd">            data_to_save(list or pandas.DataFrame): Data that will be saved</span>
<span class="sd">        Kwards:</span>
<span class="sd">            n_parallel(int)=10: Number of parallel jobs to be used.</span>
<span class="sd">            chunksize(int)=1000: Length of each parallel post chunk.</span>
<span class="sd">            auth_header(dict)=None: Dictionary containing the auth header.</span>
<span class="sd">        Return:</span>
<span class="sd">            list: List of the responses of bulk_save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                                 <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                       <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] pivot request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">            columns (List[str]): List of columns at the pivoted table.</span>
<span class="sd">            format (str): Format of returned table. See pandas.DataFrame</span>
<span class="sd">                to_dict args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the pivot request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix.&quot;&quot;&quot;</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
            <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
            <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
            <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
        <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
            <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
                <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="pumpwood_communication.microservices.Log_Format" class="name">var <span class="ident">Log_Format</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pumpwood_communication.microservices.exceptions_dict" class="name">var <span class="ident">exceptions_dict</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pumpwood_communication.microservices.microservice_logger" class="name">var <span class="ident">microservice_logger</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.break_in_chunks">
    <p>def <span class="ident">break_in_chunks</span>(</p><p>df_to_break: pandas.core.frame.DataFrame, chunksize: int = 1000)</p>
    </div>
    

    
  
    <div class="desc"><p>Break a dataframe in chunks of chunksize.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.break_in_chunks', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.break_in_chunks" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Break a dataframe in chunks of chunksize.&quot;&quot;&quot;</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_to_break</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_break</span><span class="p">))</span> <span class="o">//</span> <span class="n">chunksize</span><span class="p">):</span>
        <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_return</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="pumpwood_communication.microservices.PumpWoodMicroService" class="name">class <span class="ident">PumpWoodMicroService</span></p>
      
  
    <div class="desc"><p>Class to define an inter-pumpwood MicroService.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PumpWoodMicroService</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to define an inter-pumpwood MicroService.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">server_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">server_url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">server_url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">server_url</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">auth_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new PumpWoodMicroService object.</span>

<span class="sd">        Creates a new microservice object. If just name is passed, object must</span>
<span class="sd">        be initiate after with init() method.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the microservice, helps when exceptions</span>
<span class="sd">                        are raised.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            server_url (str): url of the server that will be connected.</span>
<span class="sd">            username (str): Username that will be logged on.</span>
<span class="sd">            password (str): Variable to be converted to JSON and posted along</span>
<span class="sd">            with the request</span>
<span class="sd">            verify_ssl (bool): Set if microservice will verify ssl certificate</span>
<span class="sd">        Returns:</span>
<span class="sd">            PumpWoodMicroService: New PumpWoodMicroService object</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="o">=</span> <span class="n">auth_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mfa_login</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">auth_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a microservice after creation.</span>

<span class="sd">        Usefull in flask app config.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the microservice, helps when exceptions</span>
<span class="sd">                        are raised.</span>
<span class="sd">            server_url (str): url of the server that will be connected.</span>
<span class="sd">            user_name (str): Username that will be logged on.</span>
<span class="sd">            password (str): Variable to be converted to JSON and posted along</span>
<span class="sd">            with the request</span>
<span class="sd">            verify_ssl (bool): Set if microservice will verify ssl certificate</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_suffix (str): Add a suffix to auth end-point in case of</span>
<span class="sd">                authentication end-point have any suffix.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="o">=</span> <span class="n">auth_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert text to Json removing any XSSI at the beging of JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            request_result (Request): JSON Request to be converted</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular Raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return time to token expiry.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return time until token expiration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
        <span class="k">return</span> <span class="n">time_to_expiry</span>

    <span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if username and password are set on object.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            True if usename and password were set during object creation or</span>
<span class="sd">            later with init function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log microservice in using username and password provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            force_refresh [bool]: Force token refresh despise still valid</span>
<span class="sd">                according to self.__token_expiry.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: If login response has status diferent from 200.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>

        <span class="c1"># Check if expiry time is 1h from now</span>
        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># When if debug always refresh token</span>
        <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>

        <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
            <span class="n">login_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">registration/login/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">temp_url</span><span class="p">)</span>

            <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
                    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>

            <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
                <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ask user to confirm MFA code to login.</span>

<span class="sd">        Args:</span>
<span class="sd">            mfa_login_data [dict]: Result from login request with &#39;mfa_token&#39;</span>
<span class="sd">                as key.</span>
<span class="sd">        Return [dict]:</span>
<span class="sd">            Return login returned with MFA confimation.</span>
<span class="sd">        Raise:</span>
<span class="sd">            Raise error if reponse is not valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
        <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>

        <span class="c1"># Set is_mfa_login true to indicate that login required MFA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logout token.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            auth_header [dict] Authentication header.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            True if logout was ok.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logout all tokens from user.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            auth_header [dict] Authentication header.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            True if logout all was ok.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                        <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set auth_header and token_expiry date.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header [dict]: Authentication header to be set.</span>
<span class="sd">            token_expiry [pd.Timestamp]: Token expiry datetime to be set.</span>
<span class="sd">        Return [None]:</span>
<span class="sd">            No return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve auth_header and token_expiry from object.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return authorization header and token_expiry datetime from object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
            <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">check_if_logged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if user is logged.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header (dict): AuthHeader to substitute the</span>
<span class="sd">                microservice original</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            Return True if auth_header is looged and False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/check/&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">PumpWoodUnauthorized</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">check</span>

    <span class="k">def</span> <span class="nf">get_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get user info.</span>

<span class="sd">        Args:</span>
<span class="sd">            No Args:</span>

<span class="sd">        Return [dict]:</span>
<span class="sd">            A serialized user object with information of the logged user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/retrieveauthenticateduser/&quot;</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user_info</span>

    <span class="k">def</span> <span class="nf">_check__auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if auth_header is set or auth_header if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_header (dict): AuthHeader to substitute the</span>
<span class="sd">                                microservice original</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Return a header dict to be used in requests.</span>
<span class="sd">        Raises:</span>
<span class="sd">            PumpWoodUnauthorized: If microservice is not logged and a</span>
<span class="sd">                                  auth_header method argument is not provided.</span>
<span class="sd">            PumpWoodUnauthorized: If microservice is logged and a auth_header</span>
<span class="sd">                                  method argument is provided.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Login will refresh token if it is 1h to expire, it will also</span>
            <span class="c1"># check if credentials are set.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
                <span class="n">msg_tmp</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;MicroService </span><span class="si">{name}</span><span class="s1"> already looged and &#39;</span>
                    <span class="s1">&#39;auth_header was provided&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                    <span class="n">msg_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="c1"># Set base header as JSON since unserialization is done using</span>
            <span class="c1"># Pumpwood Communication serialization funciton</span>
            <span class="n">temp__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">multipart</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp__auth_header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__base_header</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">temp__auth_header</span>

    <span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle request error.</span>

<span class="sd">        Check if is a Json and propagate the error with</span>
<span class="sd">        same type if possible. If not Json raises the content.</span>

<span class="sd">        Arg:</span>
<span class="sd">            response (Response): response to be handled.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No kwargs.</span>
<span class="sd">        Returns:</span>
<span class="sd">            No return.</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: If content-type is not application/json.</span>
<span class="sd">            Exception: If content-type is application/json, but type not</span>
<span class="sd">                       present or not recognisable.</span>
<span class="sd">            Other Exception: If content-type is application/json if type is</span>
<span class="sd">                             present and recognisable.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>

            <span class="c1"># Request information</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="c1"># Raise the exception as first in exception deep.</span>
                <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
                    <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                    <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>

            <span class="c1"># Build error stack</span>
            <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="c1"># Removing previus error stack</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>

            <span class="c1"># Propagate error</span>
            <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exceptions_dict</span><span class="p">[</span><span class="n">exception_type</span><span class="p">](</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
                <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
                        <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
                        <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                                  <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if reponse has invalid token error.</span>

<span class="sd">        Args:</span>
<span class="sd">            response [requests.models.Response]: Request reponse to check for</span>
<span class="sd">                invalid token.</span>
<span class="sd">        Return [bool]:</span>
<span class="sd">            Return True if response has an invalid token status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a POST a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">            data (any); Data to be used as Json payload.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            files(list of tuples): A list of tuples with</span>
<span class="sd">                                   (file name, [file1, file2, ...]).</span>
<span class="sd">            params [dict]: Url parameters.</span>
<span class="sd">            auth_header(dict): Auth data to overhide microservice&#39;s.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If parameters are not none convert them to json before</span>
        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
        <span class="c1"># for exemple</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

            <span class="c1"># Retry request if token is not valid forcing token renew</span>
            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

        <span class="c1"># Request with files are done using multipart serializing all fields</span>
        <span class="c1"># as json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

            <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                    <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>

        <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="c1"># Check if reponse is a file</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a GET a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict): Url parameters to make the request.</span>
<span class="sd">            auth_header (dict): Authentication dictionary.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1"># If parameters are not none convert them to json before</span>
        <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
        <span class="c1"># for example</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Re-raise Pumpwood exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a DELETE a request to url with data as Json payload.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url to make the request.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict): Dictionary with Urls parameters.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">        Returns:</span>
<span class="sd">            any: Return the post result</span>
<span class="sd">        Raises:</span>
<span class="sd">            Response is passed to error_handler function.</span>
<span class="sd">        Example:</span>
<span class="sd">            No example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Retry request if token is not valid forcing token renew</span>
        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Re-raise Pumpwood Exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/routes/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">routes</span>

    <span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List routes that have been registed at Kong.</span>

<span class="sd">        Args:</span>
<span class="sd">            microservice [str]: Service associated with microservice</span>
<span class="sd">                registered on Pumpwood Kong.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            No Kwargs.</span>
<span class="sd">        Return:</span>
<span class="sd">            Return true if microservice is registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/endpoints/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">routes</span>

    <span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dummy call to ensure headers and payload reaching app.</span>

<span class="sd">        Args:</span>
<span class="sd">            No args.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">                end-point.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>

<span class="sd">        Return:</span>
<span class="sd">            Return a dictonary with:</span>
<span class="sd">            - full_path (dict): Full path of the request.</span>
<span class="sd">            - method (dict): Method used at the call</span>
<span class="sd">            - headers (dict): Headers at the request.</span>
<span class="sd">            - data (dict): Post payload sent at the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/dummy-call/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise an Pumpwood error with the payload.</span>

<span class="sd">        Can be used for debug purposes.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception_class (str): Class of the exception to be raised.</span>
<span class="sd">            exception_deep (int): Deep of the exception in microservice</span>
<span class="sd">                calls.</span>
<span class="sd">        Kwards:</span>
<span class="sd">            payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">                end-point.</span>
<span class="sd">            auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">        Return:</span>
<span class="sd">            Should not return any results, all possible call should result</span>
<span class="sd">            in raising the correspondent error.</span>
<span class="sd">        Exceptions:</span>
<span class="sd">            Should raise the correspondent error passed on exception_class</span>
<span class="sd">            arg, with payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get pk using unique fields values.</span>

<span class="sd">        Use unique field values to retrieve pk of the objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class [str]: Model class of the objects.</span>
<span class="sd">            field [str]: Unique field to fetch pk.</span>
<span class="sd">            values [List[Any]]: List of the unique fields used to fetch</span>
<span class="sd">                primary keys.</span>
<span class="sd">        Return [pd.DataFrame]:</span>
<span class="sd">            Return a dataframe in same order as values with columns:</span>
<span class="sd">                - pk: correspondent primary key of the unique value.</span>
<span class="sd">                - [field]: Column with same name of field argument,</span>
<span class="sd">                    correspondent to pk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
            <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
            <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
                    <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>

            <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
                <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>

        <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
        <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>

        <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
            <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>

        <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
        <span class="p">})</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
             <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List objects with pagination.</span>

<span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">        systems, results will be paginated. To get next pag, send recived pk at</span>
<span class="sd">        exclude dict (ex.: exclude_dict={id__in: [1,2,...,30]}).</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments).</span>
<span class="sd">          exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments).</span>
<span class="sd">          order_by (list): Ordering list to be used at the query</span>
<span class="sd">            (objects.order_by arguments).</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">            end-point.</span>
<span class="sd">          default_fields [bool]: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          limit [int]: Set the limit of elements of the returned query.</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                       <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List object fetching them by chucks using pk to paginate.</span>

<span class="sd">        List data by chunck to load by datasets without breaking the backend</span>
<span class="sd">        or receive server timeout. It load chunks orderring the results using</span>
<span class="sd">        id of the tables, it can be changed but it should be unique otherwise</span>
<span class="sd">        unexpected results may occur.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict) = {}: Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments).</span>
<span class="sd">          exclude_dict (dict) = {}:  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments).</span>
<span class="sd">          auth_header (dict) = None: Dictionary containing the auth header.</span>
<span class="sd">          fields (list[str]) = None: Select the fields to be returned by the</span>
<span class="sd">            list end-point.</span>
<span class="sd">          default_fields (bool) = False: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          chuck_size [int]: Number of objects to be fetched each query.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>

        <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
            <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
            <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
                <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>

            <span class="c1"># Break if results is empty</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
            <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">list_all_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-without-pag/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                         <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List object without pagination.</span>

<span class="sd">        Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">        systems, results won&#39;t be paginated.</span>
<span class="sd">        **Be carefull with large returns.**</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">            (objects.filter arguments)</span>
<span class="sd">          exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">            (objects.exclude arguments)</span>
<span class="sd">          order_by (list): Ordering list to be used at the query</span>
<span class="sd">            (objects.order_by arguments)</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          return_type(str): Set the return type, can be [list, dataframe].</span>
<span class="sd">          convert_geometry(bool) = True: Covert geometry to shapely.</span>
<span class="sd">          fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">            end-point.</span>
<span class="sd">          default_fields [bool]: Return the fields specified at</span>
<span class="sd">              self.list_fields.</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by list Serializer.</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
            <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1">##################################################</span>
        <span class="c1"># Converting geometry to Shapely objects in Python</span>
        <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
                    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">##################################################</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">geometry_in_results</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimensions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Args:</span>
<span class="sd">          model_class: str</span>
<span class="sd">            model_class (str): Model class of the end-point</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict: dict = {}</span>
<span class="sd">            Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">          exclude_dict: dict = {}</span>
<span class="sd">            Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">          auth_header: dict= {}</span>
<span class="sd">            Dictionary containing the auth header.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of keys avaiable in results from the query dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/list-dimension-values/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Args:</span>
<span class="sd">          model_class: str</span>
<span class="sd">            Model class of the end-point.</span>
<span class="sd">          key: str</span>
<span class="sd">            Key to list the avaiable values using the query filter and exclude.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          filter_dict: dict = {}</span>
<span class="sd">            Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">          exclude_dict: dict = {}</span>
<span class="sd">            Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">          auth_header: dict= {}</span>
<span class="sd">            Dictionary containing the auth header.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of keys avaiable in results from the query dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                     <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an object using list serializer (simple).</span>

<span class="sd">        Function to get object serialized by retrieve end-point with list</span>
<span class="sd">        serializer.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>
<span class="sd">          pk (int): Object pk</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an object from PumpWood.</span>

<span class="sd">        Function to get object serialized by retrieve end-point</span>
<span class="sd">        (more detailed data).</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class of the end-point</span>
<span class="sd">          pk (int): Object pk</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">          related_fields [bool]: Return related fields information.</span>
<span class="sd">          fields [list]:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
                <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
            <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a file from PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Class of the model to retrieve file.</span>
<span class="sd">          pk (int): Pk of the object associeted file.</span>
<span class="sd">          file_field (str): Field of the file to be downloaded.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          save_file (bool): If data is to be saved as file or return get</span>
<span class="sd">            response.</span>
<span class="sd">          save_path (str): Path of the directory to save file.</span>
<span class="sd">          file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">                saved in PumpWood.</span>
<span class="sd">          if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}: Set what to</span>
<span class="sd">            do if there is a file with same name. Skip will not download file</span>
<span class="sd">            if there is already with same os.path.join(save_path, file_name),</span>
<span class="sd">            file_name must be set for skip argument.</span>
<span class="sd">        Returns:</span>
<span class="sd">          requset.response or str</span>
<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
                <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">file_path</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">file_response</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">save_path</span><span class="p">))</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                    <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                        <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">file_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_retrieve_file_straming_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/retrieve-file-streaming/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
                                <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a file from PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Class of the model to retrieve file.</span>
<span class="sd">          pk (int): Pk of the object associeted file.</span>
<span class="sd">          file_field (str): Field of the file to be downloaded.</span>
<span class="sd">          file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">                saved in PumpWood.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          save_path (str): Path of the directory to save file.</span>
<span class="sd">          if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}: Set what to do if</span>
<span class="sd">            there is a file with same name.</span>

<span class="sd">        Returns:</span>
<span class="sd">          requset.response or str</span>

<span class="sd">        Raises:</span>
<span class="sd">          No especific raises.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>

        <span class="c1"># begin Args check</span>
        <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">save_path</span><span class="p">))</span>
        <span class="c1"># end Args check</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save or Update a new object.</span>

<span class="sd">        Function to save or update a new model_class object. If obj_dict{&#39;pk&#39;}</span>
<span class="sd">        is None or not defined a new object will be created. The obj</span>
<span class="sd">        model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
<span class="sd">        PumpWoodObjectSavingException will be raised.</span>

<span class="sd">        Args:</span>
<span class="sd">          obj_dict (dict): Model data dictionary. It must have &#39;model_class&#39;</span>
<span class="sd">                           key and if &#39;pk&#39; key is not defined a new object will</span>
<span class="sd">                           be created, else object with pk will be updated.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          files (dict): A dictionary of files to be added to as a multi-part</span>
<span class="sd">                        post request.</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Updated/Created object data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          PumpWoodObjectSavingException(</span>
<span class="sd">              &#39;To save an object obj_dict must have model_class defined.&#39;):</span>
<span class="sd">            Will be raised if model_class key is not present on</span>
<span class="sd">            obj_dict dictionary</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
                <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>

        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_save_streaming_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">{model_class}</span><span class="s2">/save-file-streaming/</span><span class="si">{pk}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stream file to PumpWood.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class of the object.</span>
<span class="sd">            pk (int): pk of the object.</span>
<span class="sd">            file_field (str): File field that will receive file stream.</span>
<span class="sd">            file (io.BufferedReader): File to upload.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            file_name (str): Name of the file, is not set it will be saved as</span>
<span class="sd">                {pk}__{file_field}.{extension at permited extension}</span>
<span class="sd">            auth_header (dict): Authentication dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
        <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span> \
                <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send delete request to a PumpWood object.</span>

<span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">        object with the specified pk.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">            have been implemented)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/remove-file-field/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send delete request to a PumpWood object.</span>

<span class="sd">        Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">        object with the specified pk.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">                have been implemented)</span>
<span class="sd">            file_field (str): File field to be removed.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/delete/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a post request to a delete objects in a query.</span>

<span class="sd">        Delete objects in the results of a query.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to delete the object</span>
<span class="sd">            filter_dict (dict): Dictionary to make filter query.</span>
<span class="sd">            exclude_dict (dict): Dictionary to make exclude query.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header (dict): Dictionary containing the auth header</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if delete is ok.</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all actions avaiable at this model class.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to list possible actions.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>

<span class="sd">        Returns:</span>
<span class="sd">          list: List of possible actions and its descriptions</span>

<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_execute_action_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/</span><span class="si">%s</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">return</span> <span class="n">url_str</span>

    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute action.</span>

<span class="sd">        If action is static or classfunction no pk</span>
<span class="sd">        is necessary.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to run action the object</span>
<span class="sd">          action (str): Action that will be performed.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">          parameters(dict): Dictionary with the function parameters.</span>
<span class="sd">          files(list of tuples): A list of tuples with</span>
<span class="sd">                                 (file name, [file1, file2, ...]).</span>

<span class="sd">        Returns:</span>
<span class="sd">          pk (int): Pk of the object that action will be performed over.</span>
<span class="sd">          parameters (dict): Parameter dictionary to use in the action.</span>

<span class="sd">        Raises:</span>
<span class="sd">          dict: Return a dict with four keys:</span>
<span class="sd">            - result: Result of the action.</span>
<span class="sd">            - action: Action description.</span>
<span class="sd">            - parameters: Parameters used to perform action.</span>
<span class="sd">            - obj: Object over which were performed the action.</span>

<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return search options.</span>

<span class="sd">        Returns options to search, like forenging keys and choice fields.</span>
<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to check search parameters</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary with search parameters</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                     <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options for object fields.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          parcial_obj_dict (dict): Partial object data</span>
<span class="sd">          field (str): Get an specific field information</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options to render list views.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options to render retrieve views.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation.</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return options for object fields.</span>

<span class="sd">        This function send partial object data and return options to finish</span>
<span class="sd">        object fillment.</span>

<span class="sd">        Args:</span>
<span class="sd">          model_class (str): Model class to check filment options.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">          parcial_obj_dict (dict): Partial object data</span>
<span class="sd">          field (str): Get an specific field information</span>
<span class="sd">          auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">          dict: Dictionary with possible data.</span>
<span class="sd">        Raises:</span>
<span class="sd">          Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">          No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/pivot/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
              <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
              <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pivot object data acording to columns specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to be pivoted.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            columns (str): Fields to be used as columns.</span>
<span class="sd">            format (str): Format to be used to convert pandas.DataFrame to</span>
<span class="sd">                          dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
<span class="sd">                          &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
<span class="sd">            filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                                argument (Same as list end-point).</span>
<span class="sd">            exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                                 argument (Same as list end-point).</span>
<span class="sd">            order_by (list): Dictionary to to be used in objects.order_by</span>
<span class="sd">                             argument (Same as list end-point).</span>
<span class="sd">            variables (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">                if None, the default variables will be returned.</span>
<span class="sd">            show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict or list: Depends on format type used to convert</span>
<span class="sd">                          pandas.DataFrame</span>
<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
            <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
            <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flat_list_by_chunks_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Unpacking arguments</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]</span>
            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;filter_dict&quot;</span><span class="p">]</span>
            <span class="n">exclude_dict</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;exclude_dict&quot;</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
            <span class="n">show_deleted</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span>
            <span class="n">auth_header</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;auth_header&quot;</span><span class="p">]</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;chunk_size&quot;</span><span class="p">]</span>

            <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
            <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
            <span class="n">max_pk</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Fetch data until an empty result is returned</span>
            <span class="n">list_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">temp_filter_dict</span><span class="p">[</span><span class="s2">&quot;id__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_pk</span>
                <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
                    <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                    <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">,</span>
                    <span class="s2">&quot;add_pk_column&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="n">temp_dateframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">))</span>

                <span class="c1"># Break if results are less than chunk size, so no more results</span>
                <span class="c1"># are avaiable</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chunk_size</span><span class="p">:</span>
                    <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">max_pk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">list_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dateframe</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dataframes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exception at flat_list_by_chunks:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                            <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the same end-point as pivot which does not unserialize results.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model class to be pivoted.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                                argument (Same as list end-point).</span>
<span class="sd">            exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                                 argument (Same as list end-point).</span>
<span class="sd">            fields (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">                if None, the default variables will be returned.</span>
<span class="sd">            show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">            chunk_size (int): Limit of data to fetch per call.</span>
<span class="sd">            n_parallel (int): Number of parallel process to perform.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict or list: Depends on format type used to convert</span>
<span class="sd">                          pandas.DataFrame</span>

<span class="sd">        Raises:</span>
<span class="sd">            Dependends on backend implementation</span>

<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Create a list of month and include start and end dates if not at</span>
        <span class="c1"># the beginning of a month</span>
        <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
            <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
            <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
            <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
            <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
                <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>

        <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1">##########################################################</span>
        <span class="c1"># If table have more than one partition, run in parallel #</span>
        <span class="c1"># the {partition}__in elements along with dates          #</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
            <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
                    <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                        <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Validating query for partitioned tables</span>
            <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
                    <span class="s2">&quot;queries without at least first level partition will &quot;</span>
                    <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
                    <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
                    <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
                    <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1"># Parallelizing query using partition columns</span>
            <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
                <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
                <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
                <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
                        <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                            <span class="n">request_filter_dict</span><span class="p">)</span>
                        <span class="c1"># If is not the last interval, query using open</span>
                        <span class="c1"># right interval so subsequence querys does</span>
                        <span class="c1"># not overlap</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

                        <span class="c1"># At the last interaval use closed right interval so</span>
                        <span class="c1"># last element is also included in the interval</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                            <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

                        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                            <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
                            <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                            <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                            <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                            <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>

            <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
                        <span class="n">pool_arguments</span><span class="p">)</span>
                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>

        <span class="c1">############################################</span>
        <span class="c1"># If table have partition, run in parallel #</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
                <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
            <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
                <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/bulk-save/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a list of objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class(str): Data model class.</span>
<span class="sd">            data_to_save(list): A list of objects to be saved.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            auth_header(dict): A dictionary with authorization headers.</span>
<span class="sd">        Return:</span>
<span class="sd">            dict[&#39;saved_count&#39;]: Number of saved objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                                 <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1"># Paralell aux functions</span>
    <span class="k">def</span> <span class="nf">_request_get_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error on parallel get: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concat all parallel return to one list.</span>

<span class="sd">        Args:</span>
<span class="sd">            parallel_result (list): A list of lists to be flated (concatenate</span>
<span class="sd">                all lists into one).</span>
<span class="sd">        Return:</span>
<span class="sd">            A list with all sub list itens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] get request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list): List of urls to make get requests.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the get request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_request_post_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel post: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] post request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list&lt;str&gt;): List of urls to make get requests.</span>
<span class="sd">            data_list (list&lt;any&gt;): List of data to be used as post payloads.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the post request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;len(urls_list) must be equal to len(data_list)&#39;</span><span class="p">)</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                 <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_request_delete_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel delete: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] delete request.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls_list (list): List of urls to make get requests.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the get request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="c1">####################</span>
    <span class="c1"># Paralell functions</span>
    <span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] retrieve request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">            list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request_retrieve_file_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in parallel retrieve_file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
                               <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] retrieve request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">            list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">            file_field (str): Indicates the file field to download from.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            save_path (str) = &quot;./&quot;</span>
<span class="sd">            save_file (bool) = True: True save file locally, False return</span>
<span class="sd">                file content as bites.</span>
<span class="sd">            list_file_name (List[str]) = None: Set a file name for each file</span>
<span class="sd">                download.</span>
<span class="sd">            if_exists (str) = &quot;fail&quot;: Set how treat when a file will be saved</span>
<span class="sd">                and there is another at same path. &quot;fail&quot; will raise an error;</span>
<span class="sd">                &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
<span class="sd">                when list_file_name is set, check before downloaded it file</span>
<span class="sd">                already exists, if so skip the download.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
                    <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
                        <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>

        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
            <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
                <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
                <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
                    <span class="n">pool_arguments</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                      <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args_list (list): A list of list request args (filter_dict,</span>
<span class="sd">                                   exclude_dict, order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_without_pag request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                          <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_one request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str or list&lt;str&gt;): Model Class to retrieve.</span>
<span class="sd">            list_pk (list): List of the pks to retrieve.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                      <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] save requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">                PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                        <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] delete requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">                PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                           <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                             <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] list_without_pag request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
            <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
                                <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                                <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
                                <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] execute_action requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str, list(str)): Model Class to perform action over,</span>
<span class="sd">                or a list of model class o make diferent actions.</span>
<span class="sd">            pk (int, list[int]): A list of the pks to perform action or a</span>
<span class="sd">                single pk to perform action with different paraemters.</span>
<span class="sd">            action (str, list[str]): A list of actions to perform or a single</span>
<span class="sd">                action to perform over all pks and parameters.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            parameters (dict, list[dict]): Parameters used to perform actions</span>
<span class="sd">                or a single dict to be used in all actions.</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the retrieve request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">model_class</span> <span class="o">=</span> <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>

        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">,</span>
                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Break data_to_save in many parallel requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class: Model class of the data that will be saved.</span>
<span class="sd">            data_to_save(list or pandas.DataFrame): Data that will be saved</span>
<span class="sd">        Kwards:</span>
<span class="sd">            n_parallel(int)=10: Number of parallel jobs to be used.</span>
<span class="sd">            chunksize(int)=1000: Length of each parallel post chunk.</span>
<span class="sd">            auth_header(dict)=None: Dictionary containing the auth header.</span>
<span class="sd">        Return:</span>
<span class="sd">            list: List of the responses of bulk_save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                                 <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                       <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make many [n_parallel] pivot request.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_class (str): Model Class to retrieve.</span>
<span class="sd">            list_args (list): A list of list request args</span>
<span class="sd">                                               (filter_dict,exclude_dict,</span>
<span class="sd">                                               order_by).</span>
<span class="sd">            columns (List[str]): List of columns at the pivoted table.</span>
<span class="sd">            format (str): Format of returned table. See pandas.DataFrame</span>
<span class="sd">                to_dict args.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">                get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">                not set then 4 will be considered.</span>
<span class="sd">            auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of the pivot request reponses.</span>
<span class="sd">        Raises:</span>
<span class="sd">            No particular raises</span>
<span class="sd">        Example:</span>
<span class="sd">            No example yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
            <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
            <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix.&quot;&quot;&quot;</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
            <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
            <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
            <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
        <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
            <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
                <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.angular_json">
    <p>def <span class="ident">angular_json</span>(</p><p>request_result)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert text to Json removing any XSSI at the beging of JSON.</p>
<p>Args:
    request_result (Request): JSON Request to be converted
Kwargs:
    No Kwargs
Returns:
    No return
Raises:
    No particular Raises
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.angular_json', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.angular_json" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">angular_json</span><span class="p">(</span><span class="n">request_result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert text to Json removing any XSSI at the beging of JSON.</span>
<span class="sd">    Args:</span>
<span class="sd">        request_result (Request): JSON Request to be converted</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No Kwargs</span>
<span class="sd">    Returns:</span>
<span class="sd">        No return</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular Raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">string_start</span> <span class="o">=</span> <span class="s2">&quot;)]}&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">string_start</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not decode to Json&quot;</span><span class="p">,</span>
                <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">request_result</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.flatten_parallel">
    <p>def <span class="ident">flatten_parallel</span>(</p><p>parallel_result: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;)</p>
    </div>
    

    
  
    <div class="desc"><p>Concat all parallel return to one list.</p>
<p>Args:
    parallel_result (list): A list of lists to be flated (concatenate
        all lists into one).
Return:
    A list with all sub list itens.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.flatten_parallel', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.flatten_parallel" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">flatten_parallel</span><span class="p">(</span><span class="n">parallel_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concat all parallel return to one list.</span>
<span class="sd">    Args:</span>
<span class="sd">        parallel_result (list): A list of lists to be flated (concatenate</span>
<span class="sd">            all lists into one).</span>
<span class="sd">    Return:</span>
<span class="sd">        A list with all sub list itens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">parallel_result</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.is_invalid_token_response">
    <p>def <span class="ident">is_invalid_token_response</span>(</p><p>response: requests.models.Response)</p>
    </div>
    

    
  
    <div class="desc"><p>Check if reponse has invalid token error.</p>
<p>Args:
    response [requests.models.Response]: Request reponse to check for
        invalid token.
Return [bool]:
    Return True if response has an invalid token status.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.is_invalid_token_response', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.is_invalid_token_response" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_invalid_token_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                              <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if reponse has invalid token error.</span>
<span class="sd">    Args:</span>
<span class="sd">        response [requests.models.Response]: Request reponse to check for</span>
<span class="sd">            invalid token.</span>
<span class="sd">    Return [bool]:</span>
<span class="sd">        Return True if response has an invalid token status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.bulk_save">
    <p>def <span class="ident">bulk_save</span>(</p><p>self, model_class: str, data_to_save: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Save a list of objects.</p>
<p>Args:
    model_class(str): Data model class.
    data_to_save(list): A list of objects to be saved.
Kwargs:
    auth_header(dict): A dictionary with authorization headers.
Return:
    dict['saved_count']: Number of saved objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.bulk_save', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.bulk_save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a list of objects.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class(str): Data model class.</span>
<span class="sd">        data_to_save(list): A list of objects to be saved.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_header(dict): A dictionary with authorization headers.</span>
<span class="sd">    Return:</span>
<span class="sd">        dict[&#39;saved_count&#39;]: Number of saved objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                             <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.check_if_logged">
    <p>def <span class="ident">check_if_logged</span>(</p><p>self, auth_header: dict)</p>
    </div>
    

    
  
    <div class="desc"><p>Check if user is logged.</p>
<p>Args:
    auth_header (dict): AuthHeader to substitute the
        microservice original
Return [bool]:
    Return True if auth_header is looged and False if not</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.check_if_logged', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.check_if_logged" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">check_if_logged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if user is logged.</span>
<span class="sd">    Args:</span>
<span class="sd">        auth_header (dict): AuthHeader to substitute the</span>
<span class="sd">            microservice original</span>
<span class="sd">    Return [bool]:</span>
<span class="sd">        Return True if auth_header is looged and False if not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/check/&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PumpWoodUnauthorized</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">check</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.confirm_mfa_code">
    <p>def <span class="ident">confirm_mfa_code</span>(</p><p>self, mfa_login_data: dict)</p>
    </div>
    

    
  
    <div class="desc"><p>Ask user to confirm MFA code to login.</p>
<p>Args:
    mfa_login_data [dict]: Result from login request with 'mfa_token'
        as key.
Return [dict]:
    Return login returned with MFA confimation.
Raise:
    Raise error if reponse is not valid.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.confirm_mfa_code', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.confirm_mfa_code" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">confirm_mfa_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfa_login_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ask user to confirm MFA code to login.</span>
<span class="sd">    Args:</span>
<span class="sd">        mfa_login_data [dict]: Result from login request with &#39;mfa_token&#39;</span>
<span class="sd">            as key.</span>
<span class="sd">    Return [dict]:</span>
<span class="sd">        Return login returned with MFA confimation.</span>
<span class="sd">    Raise:</span>
<span class="sd">        Raise error if reponse is not valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;## Please enter MFA code: &quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/mfa-validate-code/&#39;</span><span class="p">)</span>
    <span class="n">mfa_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;X-PUMPWOOD-MFA-Autorization&quot;</span><span class="p">:</span> <span class="n">mfa_login_data</span><span class="p">[</span><span class="s1">&#39;mfa_token&#39;</span><span class="p">]},</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mfa_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
    <span class="c1"># Set is_mfa_login true to indicate that login required MFA</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_mfa_login</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">mfa_response</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.delete">
    <p>def <span class="ident">delete</span>(</p><p>self, model_class: str, pk: int, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Send delete request to a PumpWood object.</p>
<p>Delete (or whatever the PumpWood system have been implemented) the
object with the specified pk.</p>
<p>Args:
    model_class (str): Model class to delete the object
    pk (int): Object pk to be deleted (or whatever the PumpWood system
    have been implemented)
Kwargs:
    auth_header(dict): Dictionary containing the auth header.s
Returns:
    Dependends on backend implementation
Raises:
    Dependends on backend implementation
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.delete', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.delete" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send delete request to a PumpWood object.</span>
<span class="sd">    Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">    object with the specified pk.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to delete the object</span>
<span class="sd">        pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">        have been implemented)</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.delete_many">
    <p>def <span class="ident">delete_many</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Send a post request to a delete objects in a query.</p>
<p>Delete objects in the results of a query.</p>
<p>Args:
    model_class (str): Model class to delete the object
    filter_dict (dict): Dictionary to make filter query.
    exclude_dict (dict): Dictionary to make exclude query.
Kwargs:
    auth_header (dict): Dictionary containing the auth header
Returns:
    bool: True if delete is ok.
Raises:
    Dependends on backend implementation
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.delete_many', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.delete_many" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send a post request to a delete objects in a query.</span>
<span class="sd">    Delete objects in the results of a query.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to delete the object</span>
<span class="sd">        filter_dict (dict): Dictionary to make filter query.</span>
<span class="sd">        exclude_dict (dict): Dictionary to make exclude query.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_header (dict): Dictionary containing the auth header</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if delete is ok.</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">},</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.dummy_call">
    <p>def <span class="ident">dummy_call</span>(</p><p>self, payload: dict = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a dummy call to ensure headers and payload reaching app.</p>
<p>Args:
    No args.
Kwards:
    payload (dict]): Payload to be returned by the dummy call
        end-point.
    auth_header (dict): Auth header if microservice not logged.</p>
<p>Return:
    Return a dictonary with:
    - full_path (dict): Full path of the request.
    - method (dict): Method used at the call
    - headers (dict): Headers at the request.
    - data (dict): Post payload sent at the request.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.dummy_call', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.dummy_call" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dummy_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dummy call to ensure headers and payload reaching app.</span>
<span class="sd">    Args:</span>
<span class="sd">        No args.</span>
<span class="sd">    Kwards:</span>
<span class="sd">        payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">            end-point.</span>
<span class="sd">        auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">    Return:</span>
<span class="sd">        Return a dictonary with:</span>
<span class="sd">        - full_path (dict): Full path of the request.</span>
<span class="sd">        - method (dict): Method used at the call</span>
<span class="sd">        - headers (dict): Headers at the request.</span>
<span class="sd">        - data (dict): Post payload sent at the request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-call/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/dummy-call/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.dummy_raise">
    <p>def <span class="ident">dummy_raise</span>(</p><p>self, exception_class: str, exception_deep: int, payload: dict = {}, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Raise an Pumpwood error with the payload.</p>
<p>Can be used for debug purposes.</p>
<p>Args:
    exception_class (str): Class of the exception to be raised.
    exception_deep (int): Deep of the exception in microservice
        calls.
Kwards:
    payload (dict]): Payload to be returned by the dummy call
        end-point.
    auth_header (dict): Auth header if microservice not logged.
Return:
    Should not return any results, all possible call should result
    in raising the correspondent error.
Exceptions:
    Should raise the correspondent error passed on exception_class
    arg, with payload.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.dummy_raise', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.dummy_raise" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dummy_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exception_deep</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raise an Pumpwood error with the payload.</span>
<span class="sd">    Can be used for debug purposes.</span>
<span class="sd">    Args:</span>
<span class="sd">        exception_class (str): Class of the exception to be raised.</span>
<span class="sd">        exception_deep (int): Deep of the exception in microservice</span>
<span class="sd">            calls.</span>
<span class="sd">    Kwards:</span>
<span class="sd">        payload (dict]): Payload to be returned by the dummy call</span>
<span class="sd">            end-point.</span>
<span class="sd">        auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">    Return:</span>
<span class="sd">        Should not return any results, all possible call should result</span>
<span class="sd">        in raising the correspondent error.</span>
<span class="sd">    Exceptions:</span>
<span class="sd">        Should raise the correspondent error passed on exception_class</span>
<span class="sd">        arg, with payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/dummy-raise/&#39;</span>
    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_class</span>
    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;exception_deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_deep</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.error_handler">
    <p>def <span class="ident">error_handler</span>(</p><p>cls, response)</p>
    </div>
    

    
  
    <div class="desc"><p>Handle request error.</p>
<p>Check if is a Json and propagate the error with
same type if possible. If not Json raises the content.</p>
<p>Arg:
    response (Response): response to be handled.
Kwargs:
    No kwargs.
Returns:
    No return.
Raises:
    Exception: If content-type is not application/json.
    Exception: If content-type is application/json, but type not
               present or not recognisable.
    Other Exception: If content-type is application/json if type is
                     present and recognisable.
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.error_handler', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.error_handler" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle request error.</span>
<span class="sd">    Check if is a Json and propagate the error with</span>
<span class="sd">    same type if possible. If not Json raises the content.</span>
<span class="sd">    Arg:</span>
<span class="sd">        response (Response): response to be handled.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No kwargs.</span>
<span class="sd">    Returns:</span>
<span class="sd">        No return.</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception: If content-type is not application/json.</span>
<span class="sd">        Exception: If content-type is application/json, but type not</span>
<span class="sd">                   present or not recognisable.</span>
<span class="sd">        Other Exception: If content-type is application/json if type is</span>
<span class="sd">                         present and recognisable.</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">response_content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span>
        <span class="c1"># Request information</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
        <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="c1"># Raise the exception as first in exception deep.</span>
            <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">[{</span>
                <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
            <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;!exception_stack!&quot;</span><span class="p">:</span> <span class="n">exception_dict</span><span class="p">})</span>
        <span class="c1"># Build error stack</span>
        <span class="n">response_dict</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="c1"># Removing previus error stack</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="n">exception_stack</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">exception_deep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exception_stack</span><span class="p">)</span>
        <span class="n">exception_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;exception_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;exception_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;exception_utcnow&quot;</span><span class="p">:</span> <span class="n">utcnow</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;exception_deep&quot;</span><span class="p">:</span> <span class="n">exception_deep</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="n">exception_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_dict</span><span class="p">)</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
        <span class="c1"># Propagate error</span>
        <span class="n">exception_message</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">exception_type</span> <span class="o">=</span> <span class="n">response_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions_dict</span><span class="p">[</span><span class="n">exception_type</span><span class="p">](</span>
                <span class="n">message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_invalid_token</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;!exception_stack!&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exception_stack</span>
            <span class="k">if</span> <span class="n">is_invalid_token</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid token.&quot;</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodOtherException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Not mapped exception JSON&quot;</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">response_dict</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.execute_action">
    <p>def <span class="ident">execute_action</span>(</p><p>self, model_class: str, action: str, pk: int = None, parameters: dict = {}, files: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Execute action.</p>
<p>If action is static or classfunction no pk
is necessary.</p>
<p>Args:
  model_class (str): Model class to run action the object
  action (str): Action that will be performed.</p>
<p>Kwargs:
  auth_header(dict): Dictionary containing the auth header.
  parameters(dict): Dictionary with the function parameters.
  files(list of tuples): A list of tuples with
                         (file name, [file1, file2, &hellip;]).</p>
<p>Returns:
  pk (int): Pk of the object that action will be performed over.
  parameters (dict): Parameter dictionary to use in the action.</p>
<p>Raises:
  dict: Return a dict with four keys:
    - result: Result of the action.
    - action: Action description.
    - parameters: Parameters used to perform action.
    - obj: Object over which were performed the action.</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.execute_action', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.execute_action" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute action.</span>
<span class="sd">    If action is static or classfunction no pk</span>
<span class="sd">    is necessary.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to run action the object</span>
<span class="sd">      action (str): Action that will be performed.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">      parameters(dict): Dictionary with the function parameters.</span>
<span class="sd">      files(list of tuples): A list of tuples with</span>
<span class="sd">                             (file name, [file1, file2, ...]).</span>
<span class="sd">    Returns:</span>
<span class="sd">      pk (int): Pk of the object that action will be performed over.</span>
<span class="sd">      parameters (dict): Parameter dictionary to use in the action.</span>
<span class="sd">    Raises:</span>
<span class="sd">      dict: Return a dict with four keys:</span>
<span class="sd">        - result: Result of the action.</span>
<span class="sd">        - action: Action description.</span>
<span class="sd">        - parameters: Parameters used to perform action.</span>
<span class="sd">        - obj: Object over which were performed the action.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
        <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.fill_options">
    <p>def <span class="ident">fill_options</span>(</p><p>self, model_class, parcial_obj_dict: dict = {}, field: str = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return options for object fields.</p>
<p>This function send partial object data and return options to finish
object fillment.</p>
<p>Args:
  model_class (str): Model class to check filment options.
Kwargs:
  parcial_obj_dict (dict): Partial object data
  field (str): Get an specific field information
  auth_header(dict): Dictionary containing the auth header.
Returns:
  dict: Dictionary with possible data.
Raises:
  Dependends on backend implementation
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.fill_options', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.fill_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fill_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return options for object fields.</span>
<span class="sd">    This function send partial object data and return options to finish</span>
<span class="sd">    object fillment.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to check filment options.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      parcial_obj_dict (dict): Partial object data</span>
<span class="sd">      field (str): Get an specific field information</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      dict: Dictionary with possible data.</span>
<span class="sd">    Raises:</span>
<span class="sd">      Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">url_str</span> <span class="o">=</span> <span class="n">url_str</span> <span class="o">+</span> <span class="n">field</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.fill_validation">
    <p>def <span class="ident">fill_validation</span>(</p><p>self, model_class: str, parcial_obj_dict: dict = {}, field: str = None, auth_header: dict = None, user_type: str = &#39;api&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Return options for object fields.</p>
<p>This function send partial object data and return options to finish
object fillment.</p>
<p>Args:
  model_class (str): Model class to check filment options.
Kwargs:
  parcial_obj_dict (dict): Partial object data
  field (str): Get an specific field information
  auth_header(dict): Dictionary containing the auth header.
Returns:
  dict: Dictionary with possible data.
Raises:
  Dependends on backend implementation
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.fill_validation', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.fill_validation" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fill_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parcial_obj_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">user_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;api&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return options for object fields.</span>
<span class="sd">    This function send partial object data and return options to finish</span>
<span class="sd">    object fillment.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to check filment options.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      parcial_obj_dict (dict): Partial object data</span>
<span class="sd">      field (str): Get an specific field information</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      dict: Dictionary with possible data.</span>
<span class="sd">    Raises:</span>
<span class="sd">      Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_type&quot;</span><span class="p">:</span> <span class="n">user_type</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parcial_obj_dict</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.flat_list_by_chunks">
    <p>def <span class="ident">flat_list_by_chunks</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, fields: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, show_deleted: bool = False, auth_header: dict = None, chunk_size: int = 1000000, n_parallel: int = None, create_composite_pk: bool = False, start_date: str = None, end_date: str = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the same end-point as pivot which does not unserialize results.</p>
<p>Args:
    model_class (str): Model class to be pivoted.</p>
<p>Kwargs:
    filter_dict (dict): Dictionary to to be used in objects.filter
                        argument (Same as list end-point).
    exclude_dict (dict): Dictionary to to be used in objects.exclude
                         argument (Same as list end-point).
    fields (list[str]) = None: List of the variables to be returned,
        if None, the default variables will be returned.
    show_deleted (bool): If deleted data should be returned.
    auth_header(dict): Dictionary containing the auth header.
    chunk_size (int): Limit of data to fetch per call.
    n_parallel (int): Number of parallel process to perform.</p>
<p>Returns:
    dict or list: Depends on format type used to convert
                  pandas.DataFrame</p>
<p>Raises:
    Dependends on backend implementation</p>
<p>Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.flat_list_by_chunks', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.flat_list_by_chunks" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">flat_list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">show_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
                        <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">create_composite_pk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the same end-point as pivot which does not unserialize results.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to be pivoted.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                            argument (Same as list end-point).</span>
<span class="sd">        exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                             argument (Same as list end-point).</span>
<span class="sd">        fields (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">            if None, the default variables will be returned.</span>
<span class="sd">        show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">        chunk_size (int): Limit of data to fetch per call.</span>
<span class="sd">        n_parallel (int): Number of parallel process to perform.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict or list: Depends on format type used to convert</span>
<span class="sd">                      pandas.DataFrame</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">temp_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
    <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span>
        <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="n">primary_keys</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
    <span class="n">partition</span> <span class="o">=</span> <span class="n">fill_options</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="c1"># Create a list of month and include start and end dates if not at</span>
    <span class="c1"># the beginning of a month</span>
    <span class="n">month_sequence</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
        <span class="n">list_month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_date</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_month_sequence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_date</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">month_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">month_sequence</span><span class="p">})</span>
        <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month_df</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
        <span class="n">month_df</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">month_sequence</span> <span class="o">=</span> <span class="n">month_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;To break query in chunks using start_date and end_date &quot;</span>
            <span class="s2">&quot;both must be set.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;start_date: </span><span class="si">{start_date}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;end_date: </span><span class="si">{end_date}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
                <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">})</span>
    <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">##########################################################</span>
    <span class="c1"># If table have more than one partition, run in parallel #</span>
    <span class="c1"># the {partition}__in elements along with dates          #</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">):</span>
        <span class="n">partition_col_1st</span> <span class="o">=</span> <span class="n">partition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filter_dict_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">partition_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_dict_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">partition_col_1st</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">partition_filter</span> <span class="o">=</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">partition_col_1st</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">partition_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
                <span class="k">del</span> <span class="n">temp_filter_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="n">count_partition_col_1st_filters</span> <span class="o">=</span> \
                    <span class="n">count_partition_col_1st_filters</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># Validating query for partitioned tables</span>
        <span class="k">if</span> <span class="n">partition_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Table is partitioned with sub-partitions, running &quot;</span>
                <span class="s2">&quot;queries without at least first level partition will &quot;</span>
                <span class="s2">&quot;lead to long waiting times or hanging queries. Please &quot;</span>
                <span class="s2">&quot;use first partition level in filter_dict with equal &quot;</span>
                <span class="s2">&quot;or in operators. Table partitions: </span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">count_partition_col_1st_filters</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Please give some help for the dev here, use just one &quot;</span>
                <span class="s2">&quot;filter_dict entry for first partition...&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Parallelizing query using partition columns</span>
        <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filter_key</span> <span class="ow">in</span> <span class="n">partition_filter</span><span class="p">:</span>
            <span class="n">request_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_filter_dict</span><span class="p">)</span>
            <span class="n">request_filter_dict</span><span class="p">[</span><span class="n">partition_col_1st</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_key</span>
            <span class="k">if</span> <span class="n">month_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                    <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict</span><span class="p">,</span>
                    <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                    <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                    <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)):</span>
                    <span class="n">request_filter_dict_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                        <span class="n">request_filter_dict</span><span class="p">)</span>
                    <span class="c1"># If is not the last interval, query using open</span>
                    <span class="c1"># right interval so subsequence querys does</span>
                    <span class="c1"># not overlap</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">month_sequence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                        <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lt&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                    <span class="c1"># At the last interaval use closed right interval so</span>
                    <span class="c1"># last element is also included in the interval</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__gte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
                        <span class="n">request_filter_dict_t</span><span class="p">[</span><span class="s2">&quot;time__lte&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">month_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                    <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                        <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">request_filter_dict_t</span><span class="p">,</span>
                        <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                        <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
        <span class="c1"># Perform parallel calls to backend each chucked by chunk_size</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">,</span>
                    <span class="n">pool_arguments</span><span class="p">)</span>
            <span class="n">resp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Finished parallel flat list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool_arguments</span><span class="p">))</span>
    <span class="c1">############################################</span>
    <span class="c1"># If table have partition, run in parallel #</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results_key_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_list_by_chunks_helper</span><span class="p">({</span>
                <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span>
                <span class="s2">&quot;filter_dict&quot;</span><span class="p">:</span> <span class="n">temp_filter_dict</span><span class="p">,</span>
                <span class="s2">&quot;exclude_dict&quot;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">,</span>
                <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
                <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">chunk_size</span><span class="p">})</span>
            <span class="n">resp_df</span> <span class="o">=</span> <span class="n">results_key_data</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">PumpWoodException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">))</span> <span class="ow">and</span> <span class="n">create_composite_pk</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Creating composite pk&quot;</span><span class="p">)</span>
        <span class="n">resp_df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp_df</span><span class="p">[</span><span class="n">primary_keys</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">CompositePkBase64Converter</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span>
            <span class="n">primary_keys</span><span class="o">=</span><span class="n">primary_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp_df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.get_auth_header">
    <p>def <span class="ident">get_auth_header</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve auth_header and token_expiry from object.</p>
<p>Args:
    No Args.
Kwargs:
    No Kwargs.
Return:
    Return authorization header and token_expiry datetime from object.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.get_auth_header', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.get_auth_header" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve auth_header and token_expiry from object.</span>
<span class="sd">    Args:</span>
<span class="sd">        No Args.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No Kwargs.</span>
<span class="sd">    Return:</span>
<span class="sd">        Return authorization header and token_expiry datetime from object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span><span class="p">,</span>
        <span class="s2">&quot;token_expiry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.get_pks_from_unique_field">
    <p>def <span class="ident">get_pks_from_unique_field</span>(</p><p>self, model_class: str, field: str, values: List[Any])</p>
    </div>
    

    
  
    <div class="desc"><p>Get pk using unique fields values.</p>
<p>Use unique field values to retrieve pk of the objects.</p>
<p>Args:
    model_class [str]: Model class of the objects.
    field [str]: Unique field to fetch pk.
    values [List[Any]]: List of the unique fields used to fetch
        primary keys.
Return [pd.DataFrame]:
    Return a dataframe in same order as values with columns:
        - pk: correspondent primary key of the unique value.
        - [field]: Column with same name of field argument,
            correspondent to pk.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.get_pks_from_unique_field', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.get_pks_from_unique_field" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pks_from_unique_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get pk using unique fields values.</span>
<span class="sd">    Use unique field values to retrieve pk of the objects.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class [str]: Model class of the objects.</span>
<span class="sd">        field [str]: Unique field to fetch pk.</span>
<span class="sd">        values [List[Any]]: List of the unique fields used to fetch</span>
<span class="sd">            primary keys.</span>
<span class="sd">    Return [pd.DataFrame]:</span>
<span class="sd">        Return a dataframe in same order as values with columns:</span>
<span class="sd">            - pk: correspondent primary key of the unique value.</span>
<span class="sd">            - [field]: Column with same name of field argument,</span>
<span class="sd">                correspondent to pk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_dimension_tag</span> <span class="o">=</span> <span class="s1">&#39;dimensions-&gt;&#39;</span> <span class="ow">in</span> <span class="n">field</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
        <span class="n">fill_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_options</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">)</span>
        <span class="n">field_details</span> <span class="o">=</span> <span class="n">fill_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Field is not a dimension tag and not found on model &quot;</span>
                <span class="s2">&quot;fields. Field [</span><span class="si">{field}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
        <span class="n">is_unique_field</span> <span class="o">=</span> <span class="n">field_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_unique_field</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Field [</span><span class="si">{}</span><span class="s2">] to get pk from is not unique&quot;</span>
            <span class="k">raise</span> <span class="n">PumpWoodQueryException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">})</span>
    <span class="n">filter_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;__in&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
    <span class="n">pk_map</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension_tag</span><span class="p">:</span>
        <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">])</span>
        <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
    <span class="c1"># If is dimension tag, fetch dimension and unpack it</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dimension_tag</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">list_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_without_pag</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">]))</span>
        <span class="n">pk_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pk_map</span> <span class="o">=</span> <span class="n">list_results</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">unpack_dict_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>\
                <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dimension_tag</span><span class="p">)[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
    <span class="n">values_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">values_series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pk_map</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">values_series</span>
    <span class="p">})</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.get_queue_matrix">
    <p>def <span class="ident">get_queue_matrix</span>(</p><p>self, queue_pk: int, auth_header: dict = None, save_as_excel: str = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Download model queue estimation matrix.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.get_queue_matrix', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.get_queue_matrix" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_queue_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">save_as_excel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download model queue estimation matrix.&quot;&quot;&quot;</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span>
        <span class="n">model_class</span><span class="o">=</span><span class="s2">&quot;ModelQueue&quot;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">queue_pk</span><span class="p">,</span>
        <span class="n">file_field</span><span class="o">=</span><span class="s2">&quot;model_matrix_file&quot;</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
        <span class="n">save_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span>
        <span class="n">fileobj</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="n">columns_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;columns_info&quot;</span><span class="p">])</span>
    <span class="n">model_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_as_excel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">save_as_excel</span><span class="p">)</span>
        <span class="n">columns_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;columns_info&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">model_matrix</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s1">&#39;model_matrix&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;columns_info&quot;</span><span class="p">:</span> <span class="n">columns_info</span><span class="p">,</span>
            <span class="s2">&quot;model_matrix&quot;</span><span class="p">:</span> <span class="n">model_matrix</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.get_user_info">
    <p>def <span class="ident">get_user_info</span>(</p><p>self, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Get user info.</p>
<p>Args:
    No Args:</p>
<p>Return [dict]:
    A serialized user object with information of the logged user.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.get_user_info', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.get_user_info" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get user info.</span>
<span class="sd">    Args:</span>
<span class="sd">        No Args:</span>
<span class="sd">    Return [dict]:</span>
<span class="sd">        A serialized user object with information of the logged user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;rest/registration/retrieveauthenticateduser/&quot;</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user_info</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.init">
    <p>def <span class="ident">init</span>(</p><p>self, name: str, server_url: str, username: str, password: str, verify_ssl: bool = True, auth_suffix: str = None, debug: bool = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Start a microservice after creation.</p>
<p>Usefull in flask app config.</p>
<p>Args:
    name (str): Name of the microservice, helps when exceptions
                are raised.
    server_url (str): url of the server that will be connected.
    user_name (str): Username that will be logged on.
    password (str): Variable to be converted to JSON and posted along
    with the request
    verify_ssl (bool): Set if microservice will verify ssl certificate
Kwargs:
    auth_suffix (str): Add a suffix to auth end-point in case of
        authentication end-point have any suffix.
Returns:
    No return
Raises:
    No particular Raises
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.init', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.init" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
         <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">auth_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start a microservice after creation.</span>
<span class="sd">    Usefull in flask app config.</span>
<span class="sd">    Args:</span>
<span class="sd">        name (str): Name of the microservice, helps when exceptions</span>
<span class="sd">                    are raised.</span>
<span class="sd">        server_url (str): url of the server that will be connected.</span>
<span class="sd">        user_name (str): Username that will be logged on.</span>
<span class="sd">        password (str): Variable to be converted to JSON and posted along</span>
<span class="sd">        with the request</span>
<span class="sd">        verify_ssl (bool): Set if microservice will verify ssl certificate</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_suffix (str): Add a suffix to auth end-point in case of</span>
<span class="sd">            authentication end-point have any suffix.</span>
<span class="sd">    Returns:</span>
<span class="sd">        No return</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular Raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="o">=</span> <span class="n">username</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="o">=</span> <span class="n">password</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ajust_server_url</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="o">=</span> <span class="n">auth_suffix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.is_credential_set">
    <p>def <span class="ident">is_credential_set</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Check if username and password are set on object.</p>
<p>Args:
    No Args.
Kwargs:
    No Kwargs.
Return:
    True if usename and password were set during object creation or
    later with init function.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.is_credential_set', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.is_credential_set" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_credential_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if username and password are set on object.</span>
<span class="sd">    Args:</span>
<span class="sd">        No Args.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No Kwargs.</span>
<span class="sd">    Return:</span>
<span class="sd">        True if usename and password were set during object creation or</span>
<span class="sd">        later with init function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.is_microservice_registered">
    <p>def <span class="ident">is_microservice_registered</span>(</p><p>self, microservice: str, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>List routes that have been registed at Kong.</p>
<p>Args:
    microservice [str]: Service associated with microservice
        registered on Pumpwood Kong.
Kwargs:
    No Kwargs.
Return:
    Return true if microservice is registered.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.is_microservice_registered', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.is_microservice_registered" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_microservice_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microservice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List routes that have been registed at Kong.</span>
<span class="sd">    Args:</span>
<span class="sd">        microservice [str]: Service associated with microservice</span>
<span class="sd">            registered on Pumpwood Kong.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No Kwargs.</span>
<span class="sd">    Return:</span>
<span class="sd">        Return true if microservice is registered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_registered_routes</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">microservice</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list">
    <p>def <span class="ident">list</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, order_by: list = [], auth_header: dict = None, fields: list = None, default_fields: bool = False, limit: int = None, foreign_key_fields: bool = False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>List objects with pagination.</p>
<p>Function to post at list end-point (resumed data) of PumpWood like
systems, results will be paginated. To get next pag, send recived pk at
exclude dict (ex.: exclude_dict={id__in: [1,2,&hellip;,30]}).</p>
<p>Args:
  model_class (str): Model class of the end-point</p>
<p>Kwargs:
  filter_dict (dict): Filter dict to be used at the query
    (objects.filter arguments).
  exclude_dict (dict):  Exclude dict to be used at the query
    (objects.exclude arguments).
  order_by (list): Ordering list to be used at the query
    (objects.order_by arguments).
  auth_header(dict): Dictionary containing the auth header.
  fields(list[str]): Select the fields to be returned by the list
    end-point.
  default_fields [bool]: Return the fields specified at
      self.list_fields.
  limit [int]: Set the limit of elements of the returned query.
  foreign_key_fields [bool]: Return forenging key objects.</p>
<p>Returns:
  list: Contaiing objects serialized by list Serializer.</p>
<p>Raises:
  No especific raises.</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
         <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List objects with pagination.</span>
<span class="sd">    Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">    systems, results will be paginated. To get next pag, send recived pk at</span>
<span class="sd">    exclude dict (ex.: exclude_dict={id__in: [1,2,...,30]}).</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class of the end-point</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">        (objects.filter arguments).</span>
<span class="sd">      exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">        (objects.exclude arguments).</span>
<span class="sd">      order_by (list): Ordering list to be used at the query</span>
<span class="sd">        (objects.order_by arguments).</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">      fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">        end-point.</span>
<span class="sd">      default_fields [bool]: Return the fields specified at</span>
<span class="sd">          self.list_fields.</span>
<span class="sd">      limit [int]: Set the limit of elements of the returned query.</span>
<span class="sd">      foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: Contaiing objects serialized by list Serializer.</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
        <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
        <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_actions">
    <p>def <span class="ident">list_actions</span>(</p><p>self, model_class: str, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a list of all actions avaiable at this model class.</p>
<p>Args:
  model_class (str): Model class to list possible actions.</p>
<p>Kwargs:
  auth_header(dict): Dictionary containing the auth header.</p>
<p>Returns:
  list: List of possible actions and its descriptions</p>
<p>Raises:
  Dependends on backend implementation</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_actions', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_actions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of all actions avaiable at this model class.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to list possible actions.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: List of possible actions and its descriptions</span>
<span class="sd">    Raises:</span>
<span class="sd">      Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/actions/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_by_chunks">
    <p>def <span class="ident">list_by_chunks</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, auth_header: dict = None, fields: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, default_fields: bool = False, chunk_size: int = 50000, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>List object fetching them by chucks using pk to paginate.</p>
<p>List data by chunck to load by datasets without breaking the backend
or receive server timeout. It load chunks orderring the results using
id of the tables, it can be changed but it should be unique otherwise
unexpected results may occur.</p>
<p>Args:
  model_class (str): Model class of the end-point</p>
<p>Kwargs:
  filter_dict (dict) = {}: Filter dict to be used at the query
    (objects.filter arguments).
  exclude_dict (dict) = {}:  Exclude dict to be used at the query
    (objects.exclude arguments).
  auth_header (dict) = None: Dictionary containing the auth header.
  fields (list[str]) = None: Select the fields to be returned by the
    list end-point.
  default_fields (bool) = False: Return the fields specified at
      self.list_fields.
  chuck_size [int]: Number of objects to be fetched each query.</p>
<p>Returns:
  list: Contaiing objects serialized by list Serializer.</p>
<p>Raises:
  No especific raises.</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_by_chunks', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_by_chunks" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_by_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                   <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List object fetching them by chucks using pk to paginate.</span>
<span class="sd">    List data by chunck to load by datasets without breaking the backend</span>
<span class="sd">    or receive server timeout. It load chunks orderring the results using</span>
<span class="sd">    id of the tables, it can be changed but it should be unique otherwise</span>
<span class="sd">    unexpected results may occur.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class of the end-point</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      filter_dict (dict) = {}: Filter dict to be used at the query</span>
<span class="sd">        (objects.filter arguments).</span>
<span class="sd">      exclude_dict (dict) = {}:  Exclude dict to be used at the query</span>
<span class="sd">        (objects.exclude arguments).</span>
<span class="sd">      auth_header (dict) = None: Dictionary containing the auth header.</span>
<span class="sd">      fields (list[str]) = None: Select the fields to be returned by the</span>
<span class="sd">        list end-point.</span>
<span class="sd">      default_fields (bool) = False: Return the fields specified at</span>
<span class="sd">          self.list_fields.</span>
<span class="sd">      chuck_size [int]: Number of objects to be fetched each query.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: Contaiing objects serialized by list Serializer.</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">copy_filter_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">filter_dict</span><span class="p">)</span>
    <span class="n">list_all_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_order_col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- fetching chunk [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_order_col</span><span class="p">))</span>
        <span class="n">copy_filter_dict</span><span class="p">[</span><span class="s2">&quot;pk__gt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_order_col</span>
        <span class="n">temp_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">copy_filter_dict</span><span class="p">,</span>
            <span class="n">exclude_dict</span><span class="o">=</span><span class="n">exclude_dict</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">],</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">default_fields</span><span class="o">=</span><span class="n">default_fields</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="c1"># Break if results is empty</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">max_order_col</span> <span class="o">=</span> <span class="n">temp_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span>
        <span class="n">list_all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">list_all_results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_dimension_values">
    <p>def <span class="ident">list_dimension_values</span>(</p><p>self, model_class: str, key: str, filter_dict: dict = {}, exclude_dict: dict = {}, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>List dimensions avaiable for model_class with the filters.</p>
<h2 id="parameters">Parameters</h2>
<p>Args:
  model_class: str
    Model class of the end-point.
  key: str
    Key to list the avaiable values using the query filter and exclude.
Kwargs:
  filter_dict: dict = {}
    Filter dict to be used at the query (objects.filter arguments).
  exclude_dict: dict = {}
    Exclude dict to be used at the query (objects.exclude arguments).
  auth_header: dict= {}
    Dictionary containing the auth header.</p>
<h2 id="returns">Returns</h2>
<p>list
    List of keys avaiable in results from the query dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_dimension_values', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_dimension_values" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_dimension_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class: str</span>
<span class="sd">        Model class of the end-point.</span>
<span class="sd">      key: str</span>
<span class="sd">        Key to list the avaiable values using the query filter and exclude.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      filter_dict: dict = {}</span>
<span class="sd">        Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">      exclude_dict: dict = {}</span>
<span class="sd">        Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">      auth_header: dict= {}</span>
<span class="sd">        Dictionary containing the auth header.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of keys avaiable in results from the query dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimension_values</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
                 <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_dimensions">
    <p>def <span class="ident">list_dimensions</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>List dimensions avaiable for model_class with the filters.</p>
<h2 id="parameters">Parameters</h2>
<p>Args:
  model_class: str
    model_class (str): Model class of the end-point</p>
<p>Kwargs:
  filter_dict: dict = {}
    Filter dict to be used at the query (objects.filter arguments).
  exclude_dict: dict = {}
    Exclude dict to be used at the query (objects.exclude arguments).
  auth_header: dict= {}
    Dictionary containing the auth header.</p>
<h2 id="returns">Returns</h2>
<p>list
    List of keys avaiable in results from the query dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_dimensions', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_dimensions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List dimensions avaiable for model_class with the filters.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class: str</span>
<span class="sd">        model_class (str): Model class of the end-point</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      filter_dict: dict = {}</span>
<span class="sd">        Filter dict to be used at the query (objects.filter arguments).</span>
<span class="sd">      exclude_dict: dict = {}</span>
<span class="sd">        Exclude dict to be used at the query (objects.exclude arguments).</span>
<span class="sd">      auth_header: dict= {}</span>
<span class="sd">        Dictionary containing the auth header.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of keys avaiable in results from the query dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_dimensions</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_one">
    <p>def <span class="ident">list_one</span>(</p><p>self, model_class: str, pk: int, fields: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, default_fields: bool = True, foreign_key_fields: bool = False, related_fields: bool = False, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve an object using list serializer (simple).</p>
<p>Function to get object serialized by retrieve end-point with list
serializer.</p>
<p>Args:
  model_class (str): Model class of the end-point
  pk (int): Object pk
Kwargs:
  auth_header(dict): Dictionary containing the auth header.
Returns:
  list: Contaiing objects serialized by retrieve Serializer.
Raises:
  No especific raises.
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_one', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_one" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an object using list serializer (simple).</span>
<span class="sd">    Function to get object serialized by retrieve end-point with list</span>
<span class="sd">    serializer.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class of the end-point</span>
<span class="sd">      pk (int): Object pk</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s2">&quot;default_fields&quot;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
            <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
            <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
        <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_options">
    <p>def <span class="ident">list_options</span>(</p><p>self, model_class: str, auth_header: dict)</p>
    </div>
    

    
  
    <div class="desc"><p>Return options to render list views.</p>
<p>This function send partial object data and return options to finish
object fillment.</p>
<p>Args:
  model_class (str): Model class to check filment options.
Kwargs:
  auth_header(dict): Dictionary containing the auth header.
Returns:
  dict: Dictionary with possible data.
Raises:
  Dependends on backend implementation.
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_options', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return options to render list views.</span>
<span class="sd">    This function send partial object data and return options to finish</span>
<span class="sd">    object fillment.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to check filment options.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      dict: Dictionary with possible data.</span>
<span class="sd">    Raises:</span>
<span class="sd">      Dependends on backend implementation.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/list-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_registered_endpoints">
    <p>def <span class="ident">list_registered_endpoints</span>(</p><p>self, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>List routes that have been registed at Kong.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_registered_endpoints', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_registered_endpoints" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_registered_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
    <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/endpoints/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/endpoints/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">routes</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_registered_routes">
    <p>def <span class="ident">list_registered_routes</span>(</p><p>self, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>List routes that have been registed at Kong.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_registered_routes', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_registered_routes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_registered_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List routes that have been registed at Kong.&quot;&quot;&quot;</span>
    <span class="n">list_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/pumpwood/routes/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">pumpwood/routes/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">list_url</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">item</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">routes</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.list_without_pag">
    <p>def <span class="ident">list_without_pag</span>(</p><p>self, model_class: str, filter_dict: dict = {}, exclude_dict: dict = {}, order_by: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = [], auth_header: dict = None, return_type: str = &#39;list&#39;, convert_geometry: bool = True, fields: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, default_fields: bool = False, foreign_key_fields: bool = False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>List object without pagination.</p>
<p>Function to post at list end-point (resumed data) of PumpWood like
systems, results won't be paginated.
<strong>Be carefull with large returns.</strong></p>
<p>Args:
  model_class (str): Model class of the end-point</p>
<p>Kwargs:
  filter_dict (dict): Filter dict to be used at the query
    (objects.filter arguments)
  exclude_dict (dict):  Exclude dict to be used at the query
    (objects.exclude arguments)
  order_by (list): Ordering list to be used at the query
    (objects.order_by arguments)
  auth_header(dict): Dictionary containing the auth header.
  return_type(str): Set the return type, can be [list, dataframe].
  convert_geometry(bool) = True: Covert geometry to shapely.
  fields(list[str]): Select the fields to be returned by the list
    end-point.
  default_fields [bool]: Return the fields specified at
      self.list_fields.
  foreign_key_fields [bool]: Return forenging key objects.
Returns:
  list: Contaiing objects serialized by list Serializer.</p>
<p>Raises:
  No especific raises.</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.list_without_pag', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.list_without_pag" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                     <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
                     <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                     <span class="n">convert_geometry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">default_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List object without pagination.</span>
<span class="sd">    Function to post at list end-point (resumed data) of PumpWood like</span>
<span class="sd">    systems, results won&#39;t be paginated.</span>
<span class="sd">    **Be carefull with large returns.**</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class of the end-point</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      filter_dict (dict): Filter dict to be used at the query</span>
<span class="sd">        (objects.filter arguments)</span>
<span class="sd">      exclude_dict (dict):  Exclude dict to be used at the query</span>
<span class="sd">        (objects.exclude arguments)</span>
<span class="sd">      order_by (list): Ordering list to be used at the query</span>
<span class="sd">        (objects.order_by arguments)</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">      return_type(str): Set the return type, can be [list, dataframe].</span>
<span class="sd">      convert_geometry(bool) = True: Covert geometry to shapely.</span>
<span class="sd">      fields(list[str]): Select the fields to be returned by the list</span>
<span class="sd">        end-point.</span>
<span class="sd">      default_fields [bool]: Return the fields specified at</span>
<span class="sd">          self.list_fields.</span>
<span class="sd">      foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: Contaiing objects serialized by list Serializer.</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
        <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s1">&#39;default_fields&#39;</span><span class="p">:</span> <span class="n">default_fields</span><span class="p">,</span>
        <span class="s1">&#39;foreign_key_fields&#39;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">post_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="c1">##################################################</span>
    <span class="c1"># Converting geometry to Shapely objects in Python</span>
    <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">convert_geometry</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">geometry_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">geometry_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geometry_value</span><span class="p">)</span>
                <span class="n">geometry_in_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">##################################################</span>
    <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;descriptiongeoarea&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">geometry_in_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">geopd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;return_type must be &#39;list&#39; or &#39;dataframe&#39;&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.login">
    <p>def <span class="ident">login</span>(</p><p>self, force_refresh: bool = False)</p>
    </div>
    

    
  
    <div class="desc"><p>Log microservice in using username and password provided.</p>
<p>Args:
    No Args.
Kwargs:
    force_refresh [bool]: Force token refresh despise still valid
        according to self.__token_expiry.
Returns:
    No return
Raises:
    Exception: If login response has status diferent from 200.
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.login', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.login" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log microservice in using username and password provided.</span>
<span class="sd">    Args:</span>
<span class="sd">        No Args.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        force_refresh [bool]: Force token refresh despise still valid</span>
<span class="sd">            according to self.__token_expiry.</span>
<span class="sd">    Returns:</span>
<span class="sd">        No return</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception: If login response has status diferent from 200.</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_credential_set</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Microservice username or/and password not set&quot;</span><span class="p">)</span>
    <span class="c1"># Check if expiry time is 1h from now</span>
    <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_expiry</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time_to_expiry</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">refresh_expiry</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># When if debug always refresh token</span>
    <span class="n">is_debug</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">is_debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
    <span class="k">if</span> <span class="n">refresh_expiry</span> <span class="ow">or</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="n">is_debug</span><span class="p">:</span>
        <span class="n">login_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="s1">&#39;rest/registration/login/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_url</span> <span class="o">=</span> <span class="s1">&#39;rest/</span><span class="si">{suffix}</span><span class="s1">registration/login/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">login_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">temp_url</span><span class="p">)</span>
        <span class="n">login_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">login_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__password</span><span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>
        <span class="n">login_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">login_data</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">login_result</span><span class="p">)</span>
            <span class="n">login_result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodUnauthorized</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Login not possible.</span><span class="se">\n</span><span class="s2">Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mfa_token&#39;</span> <span class="ow">in</span> <span class="n">login_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">login_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_mfa_code</span><span class="p">(</span><span class="n">mfa_login_data</span><span class="o">=</span><span class="n">login_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token &#39;</span> <span class="o">+</span> <span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__user</span> <span class="o">=</span> <span class="n">login_data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">login_data</span><span class="p">[</span><span class="s1">&#39;expiry&#39;</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.logout">
    <p>def <span class="ident">logout</span>(</p><p>self, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Logout token.</p>
<p>Args:
    No args.
Kwards:
    auth_header [dict] Authentication header.
Return [bool]:
    True if logout was ok.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.logout', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.logout" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logout token.</span>
<span class="sd">    Args:</span>
<span class="sd">        No args.</span>
<span class="sd">    Kwards:</span>
<span class="sd">        auth_header [dict] Authentication header.</span>
<span class="sd">    Return [bool]:</span>
<span class="sd">        True if logout was ok.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logout/&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.logout_all">
    <p>def <span class="ident">logout_all</span>(</p><p>self, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Logout all tokens from user.</p>
<p>Args:
    No args.
Kwards:
    auth_header [dict] Authentication header.
Return [bool]:
    True if logout all was ok.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.logout_all', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.logout_all" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">logout_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logout all tokens from user.</span>
<span class="sd">    Args:</span>
<span class="sd">        No args.</span>
<span class="sd">    Kwards:</span>
<span class="sd">        auth_header [dict] Authentication header.</span>
<span class="sd">    Return [bool]:</span>
<span class="sd">        True if logout all was ok.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;rest/registration/logoutall/&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_delete">
    <p>def <span class="ident">paralell_request_delete</span>(</p><p>self, urls_list: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;, n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] delete request.</p>
<p>Args:
    urls_list (list): List of urls to make get requests.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the get request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_delete', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_delete" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">paralell_request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] delete request.</span>
<span class="sd">    Args:</span>
<span class="sd">        urls_list (list): List of urls to make get requests.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the get request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_delete_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_post">
    <p>def <span class="ident">paralell_request_post</span>(</p><p>self, urls_list: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;, data_list: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;, n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] post request.</p>
<p>Args:
    urls_list (list<str>): List of urls to make get requests.
    data_list (list<any>): List of data to be used as post payloads.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the post request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_post', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.paralell_request_post" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">paralell_request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                          <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] post request.</span>
<span class="sd">    Args:</span>
<span class="sd">        urls_list (list&lt;str&gt;): List of urls to make get requests.</span>
<span class="sd">        data_list (list&lt;any&gt;): List of data to be used as post payloads.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the post request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s1">&#39;len(urls_list) must be equal to len(data_list)&#39;</span><span class="p">)</span>
    <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">)):</span>
        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">urls_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
             <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">})</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_post_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_bulk_save">
    <p>def <span class="ident">parallel_bulk_save</span>(</p><p>self, model_class, data_to_save, n_parallel: int = None, chunksize: int = 1000, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Break data_to_save in many parallel requests.</p>
<p>Args:
    model_class: Model class of the data that will be saved.
    data_to_save(list or pandas.DataFrame): Data that will be saved
Kwards:
    n_parallel(int)=10: Number of parallel jobs to be used.
    chunksize(int)=1000: Length of each parallel post chunk.
    auth_header(dict)=None: Dictionary containing the auth header.
Return:
    list: List of the responses of bulk_save.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_bulk_save', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_bulk_save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_bulk_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">data_to_save</span><span class="p">,</span>
                       <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                       <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Break data_to_save in many parallel requests.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class: Model class of the data that will be saved.</span>
<span class="sd">        data_to_save(list or pandas.DataFrame): Data that will be saved</span>
<span class="sd">    Kwards:</span>
<span class="sd">        n_parallel(int)=10: Number of parallel jobs to be used.</span>
<span class="sd">        chunksize(int)=1000: Length of each parallel post chunk.</span>
<span class="sd">        auth_header(dict)=None: Dictionary containing the auth header.</span>
<span class="sd">    Return:</span>
<span class="sd">        list: List of the responses of bulk_save.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">data_to_save</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">)</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="n">break_in_chunks</span><span class="p">(</span><span class="n">df_to_break</span><span class="o">=</span><span class="n">data_to_save</span><span class="p">,</span>
                             <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_bulk_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_bulk_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete">
    <p>def <span class="ident">parallel_delete</span>(</p><p>self, model_class: Union[str, List[str]], list_pk: List[int], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] delete requests.</p>
<p>Args:
    model_class (str): Model Class to retrieve.
    list_obj_dict (list<dict>): List of dictionaries containing
        PumpWood objects (must have at least 'model_class' key)
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                    <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] delete requests.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model Class to retrieve.</span>
<span class="sd">        list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">            PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete_many">
    <p>def <span class="ident">parallel_delete_many</span>(</p><p>self, model_class: Union[str, List[str]], list_args: List[dict], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] list_without_pag request.</p>
<p>Args:
    model_class (str): Model Class to retrieve.
    list_args (list): A list of list request args
                                       (filter_dict,exclude_dict,
                                       order_by).
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete_many', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_delete_many" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_delete_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                         <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] list_without_pag request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model Class to retrieve.</span>
<span class="sd">        list_args (list): A list of list request args</span>
<span class="sd">                                           (filter_dict,exclude_dict,</span>
<span class="sd">                                           order_by).</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_delete_many_request_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_delete_many: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_execute_action">
    <p>def <span class="ident">parallel_execute_action</span>(</p><p>self, model_class: Union[str, List[str]], pk: Union[int, List[int]], action: Union[str, List[str]], parameters: Union[dict, List[dict]] = {}, n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] execute_action requests.</p>
<p>Args:
    model_class (str, list(str)): Model Class to perform action over,
        or a list of model class o make diferent actions.
    pk (int, list[int]): A list of the pks to perform action or a
        single pk to perform action with different paraemters.
    action (str, list[str]): A list of actions to perform or a single
        action to perform over all pks and parameters.
Kwargs:
    parameters (dict, list[dict]): Parameters used to perform actions
        or a single dict to be used in all actions.
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_execute_action', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_execute_action" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                            <span class="n">pk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
                            <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                            <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
                            <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] execute_action requests.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str, list(str)): Model Class to perform action over,</span>
<span class="sd">            or a list of model class o make diferent actions.</span>
<span class="sd">        pk (int, list[int]): A list of the pks to perform action or a</span>
<span class="sd">            single pk to perform action with different paraemters.</span>
<span class="sd">        action (str, list[str]): A list of actions to perform or a single</span>
<span class="sd">            action to perform over all pks and parameters.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        parameters (dict, list[dict]): Parameters used to perform actions</span>
<span class="sd">            or a single dict to be used in all actions.</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">parallel_length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(model_class)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(pk)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(action)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parallel_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parallel_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;parallel_length != len(parameters)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parallel_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">model_class</span> <span class="o">=</span> <span class="n">model_class</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
        <span class="k">else</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
    <span class="n">pk</span> <span class="o">=</span> <span class="n">pk</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
        <span class="k">else</span> <span class="p">[</span><span class="n">pk</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
        <span class="k">else</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> \
        <span class="k">else</span> <span class="p">[</span><span class="n">parameters</span><span class="p">]</span><span class="o">*</span><span class="n">parallel_length</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_execute_action_url</span><span class="p">(</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_length</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_execute_action: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_list">
    <p>def <span class="ident">parallel_list</span>(</p><p>self, model_class: Union[str, List[str]], list_args: List[dict], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] list request.</p>
<p>Args:
    model_class (str): Model Class to retrieve.
    list_args_list (list): A list of list request args (filter_dict,
                           exclude_dict, order_by).
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                  <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] list request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model Class to retrieve.</span>
<span class="sd">        list_args_list (list): A list of list request args (filter_dict,</span>
<span class="sd">                               exclude_dict, order_by).</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_one">
    <p>def <span class="ident">parallel_list_one</span>(</p><p>self, model_class: Union[str, List[str]], list_pk: List[int], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] list_one request.</p>
<p>Args:
    model_class (str or list<str>): Model Class to retrieve.
    list_pk (list): List of the pks to retrieve.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_one', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_one" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_list_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                      <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] list_one request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str or list&lt;str&gt;): Model Class to retrieve.</span>
<span class="sd">        list_pk (list): List of the pks to retrieve.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_one_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                 <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_one: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_without_pag">
    <p>def <span class="ident">parallel_list_without_pag</span>(</p><p>self, model_class: Union[str, List[str]], list_args: List[dict], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] list_without_pag request.</p>
<p>Args:
    model_class (str): Model Class to retrieve.
    list_args (list): A list of list request args
                                       (filter_dict,exclude_dict,
                                       order_by).
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_without_pag', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_list_without_pag" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_list_without_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                              <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                              <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] list_without_pag request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model Class to retrieve.</span>
<span class="sd">        list_args (list): A list of list request args</span>
<span class="sd">                                           (filter_dict,exclude_dict,</span>
<span class="sd">                                           order_by).</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;len(model_class) != len(list_args)&#39;</span><span class="p">)</span>
        <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_list_without_pag_url</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_class</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_list_without_pag: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_pivot">
    <p>def <span class="ident">parallel_pivot</span>(</p><p>self, model_class: str, list_args: List[dict], columns: List[str], format: str, n_parallel: int = None, variables: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, show_deleted=False, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] pivot request.</p>
<p>Args:
    model_class (str): Model Class to retrieve.
    list_args (list): A list of list request args
                                       (filter_dict,exclude_dict,
                                       order_by).
    columns (List[str]): List of columns at the pivoted table.
    format (str): Format of returned table. See pandas.DataFrame
        to_dict args.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the pivot request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_pivot', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_pivot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                   <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] pivot request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model Class to retrieve.</span>
<span class="sd">        list_args (list): A list of list request args</span>
<span class="sd">                                           (filter_dict,exclude_dict,</span>
<span class="sd">                                           order_by).</span>
<span class="sd">        columns (List[str]): List of columns at the pivoted table.</span>
<span class="sd">        format (str): Format of returned table. See pandas.DataFrame</span>
<span class="sd">            to_dict args.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the pivot request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">url_temp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)]</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="n">url_temp</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">list_args</span><span class="p">:</span>
        <span class="n">q</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">q</span><span class="p">[</span><span class="s2">&quot;show_deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">show_deleted</span>
        <span class="n">q</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="n">q</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_pivot: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_args</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_request_get">
    <p>def <span class="ident">parallel_request_get</span>(</p><p>self, urls_list: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt;, n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] get request.</p>
<p>Args:
    urls_list (list): List of urls to make get requests.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the get request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_request_get', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_request_get" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] get request.</span>
<span class="sd">    Args:</span>
<span class="sd">        urls_list (list): List of urls to make get requests.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the get request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;auth_header&#39;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls_list</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_get_wrapper</span><span class="p">,</span> <span class="n">pool_arguments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve">
    <p>def <span class="ident">parallel_retrieve</span>(</p><p>self, model_class: Union[str, List[str]], list_pk: List[int], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] retrieve request.</p>
<p>Args:
    model_class (str, List[str]): Model Class to retrieve.
    list_pk (List[int]): List of the pks to retrieve.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                      <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] retrieve request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">        list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">model_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_class</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;len(model_class) != len(list_pk)&#39;</span><span class="p">)</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                 <span class="n">pk</span><span class="o">=</span><span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_class</span><span class="p">))]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_request_get</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve_file">
    <p>def <span class="ident">parallel_retrieve_file</span>(</p><p>self, model_class: str, list_pk: List[int], file_field: str = None, save_path: str = &#39;./&#39;, save_file: bool = True, list_file_name: List[str] = None, if_exists: str = &#39;fail&#39;, n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] retrieve request.</p>
<p>Args:
    model_class (str, List[str]): Model Class to retrieve.
    list_pk (List[int]): List of the pks to retrieve.
    file_field (str): Indicates the file field to download from.
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    save_path (str) = "./"
    save_file (bool) = True: True save file locally, False return
        file content as bites.
    list_file_name (List[str]) = None: Set a file name for each file
        download.
    if_exists (str) = "fail": Set how treat when a file will be saved
        and there is another at same path. "fail" will raise an error;
        "overwrite" will overwrite the file with the new one; "skip"
        when list_file_name is set, check before downloaded it file
        already exists, if so skip the download.
    auth_header(dict): Dictionary containing the auth header.</p>
<p>Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve_file', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_retrieve_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">list_pk</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                           <span class="n">list_file_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">,</span>
                           <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] retrieve request.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str, List[str]): Model Class to retrieve.</span>
<span class="sd">        list_pk (List[int]): List of the pks to retrieve.</span>
<span class="sd">        file_field (str): Indicates the file field to download from.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        save_path (str) = &quot;./&quot;</span>
<span class="sd">        save_file (bool) = True: True save file locally, False return</span>
<span class="sd">            file content as bites.</span>
<span class="sd">        list_file_name (List[str]) = None: Set a file name for each file</span>
<span class="sd">            download.</span>
<span class="sd">        if_exists (str) = &quot;fail&quot;: Set how treat when a file will be saved</span>
<span class="sd">            and there is another at same path. &quot;fail&quot; will raise an error;</span>
<span class="sd">            &quot;overwrite&quot; will overwrite the file with the new one; &quot;skip&quot;</span>
<span class="sd">            when list_file_name is set, check before downloaded it file</span>
<span class="sd">            already exists, if so skip the download.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">((</span>
                <span class="s2">&quot;Lenght of list_file_name and list_pk are not equal:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;len(list_file_name)=</span><span class="si">{list_file_name}</span><span class="s2">; &quot;</span>
                <span class="s2">&quot;len(list_pk)=</span><span class="si">{list_pk}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">list_file_name</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_file_name</span><span class="p">),</span>
                    <span class="n">list_pk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)))</span>
    <span class="n">pool_arguments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_pk</span><span class="p">)):</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="n">list_pk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">list_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">list_file_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pool_arguments</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">,</span> <span class="s2">&quot;auth_header&quot;</span><span class="p">:</span> <span class="n">auth_header</span><span class="p">,</span>
            <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="n">save_file</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
            <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;if_exists&quot;</span><span class="p">:</span> <span class="n">if_exists</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_parallel</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_request_retrieve_file_wrapper</span><span class="p">,</span>
                <span class="n">pool_arguments</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.parallel_save">
    <p>def <span class="ident">parallel_save</span>(</p><p>self, list_obj_dict: List[dict], n_parallel: int = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make many [n_parallel] save requests.</p>
<p>Args:
    list_obj_dict (list<dict>): List of dictionaries containing
        PumpWood objects (must have at least 'model_class' key)
Kwargs:
    n_parallel (int): Number of simultaneus get requests, if not set
        get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if
        not set then 4 will be considered.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    list: List of the retrieve request reponses.
Raises:
    No particular raises
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_save', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.parallel_save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parallel_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_obj_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                  <span class="n">n_parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make many [n_parallel] save requests.</span>
<span class="sd">    Args:</span>
<span class="sd">        list_obj_dict (list&lt;dict&gt;): List of dictionaries containing</span>
<span class="sd">            PumpWood objects (must have at least &#39;model_class&#39; key)</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        n_parallel (int): Number of simultaneus get requests, if not set</span>
<span class="sd">            get from PUMPWOOD_COMUNICATION__N_PARALLEL env variable, if</span>
<span class="sd">            not set then 4 will be considered.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of the retrieve request reponses.</span>
<span class="sd">    Raises:</span>
<span class="sd">        No particular raises</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_parallel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;PUMPWOOD_COMUNICATION__N_PARALLEL&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">urls_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;model_class&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_obj_dict</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;## Starting parallel_save: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralell_request_post</span><span class="p">(</span>
        <span class="n">urls_list</span><span class="o">=</span><span class="n">urls_list</span><span class="p">,</span> <span class="n">data_list</span><span class="o">=</span><span class="n">list_obj_dict</span><span class="p">,</span>
        <span class="n">n_parallel</span><span class="o">=</span><span class="n">n_parallel</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.pivot">
    <p>def <span class="ident">pivot</span>(</p><p>self, model_class: str, columns: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = [], format: str = &#39;list&#39;, filter_dict: dict = {}, exclude_dict: dict = {}, order_by: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = [], variables: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, show_deleted=False, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Pivot object data acording to columns specified.</p>
<p>Args:
    model_class (str): Model class to be pivoted.
Kwargs:
    columns (str): Fields to be used as columns.
    format (str): Format to be used to convert pandas.DataFrame to
                  dictionary, must be in ['dict','list','series',
                  'split', 'records','index'].
    filter_dict (dict): Dictionary to to be used in objects.filter
                        argument (Same as list end-point).
    exclude_dict (dict): Dictionary to to be used in objects.exclude
                         argument (Same as list end-point).
    order_by (list): Dictionary to to be used in objects.order_by
                     argument (Same as list end-point).
    variables (list[str]) = None: List of the variables to be returned,
        if None, the default variables will be returned.
    show_deleted (bool): If deleted data should be returned.
    auth_header(dict): Dictionary containing the auth header.
Returns:
    dict or list: Depends on format type used to convert
                  pandas.DataFrame
Raises:
    Dependends on backend implementation
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.pivot', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.pivot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
          <span class="n">filter_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">exclude_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
          <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">show_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pivot object data acording to columns specified.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to be pivoted.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        columns (str): Fields to be used as columns.</span>
<span class="sd">        format (str): Format to be used to convert pandas.DataFrame to</span>
<span class="sd">                      dictionary, must be in [&#39;dict&#39;,&#39;list&#39;,&#39;series&#39;,</span>
<span class="sd">                      &#39;split&#39;, &#39;records&#39;,&#39;index&#39;].</span>
<span class="sd">        filter_dict (dict): Dictionary to to be used in objects.filter</span>
<span class="sd">                            argument (Same as list end-point).</span>
<span class="sd">        exclude_dict (dict): Dictionary to to be used in objects.exclude</span>
<span class="sd">                             argument (Same as list end-point).</span>
<span class="sd">        order_by (list): Dictionary to to be used in objects.order_by</span>
<span class="sd">                         argument (Same as list end-point).</span>
<span class="sd">        variables (list[str]) = None: List of the variables to be returned,</span>
<span class="sd">            if None, the default variables will be returned.</span>
<span class="sd">        show_deleted (bool): If deleted data should be returned.</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict or list: Depends on format type used to convert</span>
<span class="sd">                      pandas.DataFrame</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pivot_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
        <span class="s1">&#39;filter_dict&#39;</span><span class="p">:</span> <span class="n">filter_dict</span><span class="p">,</span> <span class="s1">&#39;exclude_dict&#39;</span><span class="p">:</span> <span class="n">exclude_dict</span><span class="p">,</span>
        <span class="s1">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
        <span class="s2">&quot;show_deleted&quot;</span><span class="p">:</span> <span class="n">show_deleted</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.remove_file_field">
    <p>def <span class="ident">remove_file_field</span>(</p><p>self, model_class: str, pk: int, file_field: str, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Send delete request to a PumpWood object.</p>
<p>Delete (or whatever the PumpWood system have been implemented) the
object with the specified pk.</p>
<p>Args:
    model_class (str): Model class to delete the object
    pk (int): Object pk to be deleted (or whatever the PumpWood system
        have been implemented)
    file_field (str): File field to be removed.
Kwargs:
    auth_header(dict): Dictionary containing the auth header.s
Returns:
    Dependends on backend implementation
Raises:
    Dependends on backend implementation
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.remove_file_field', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.remove_file_field" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send delete request to a PumpWood object.</span>
<span class="sd">    Delete (or whatever the PumpWood system have been implemented) the</span>
<span class="sd">    object with the specified pk.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to delete the object</span>
<span class="sd">        pk (int): Object pk to be deleted (or whatever the PumpWood system</span>
<span class="sd">            have been implemented)</span>
<span class="sd">        file_field (str): File field to be removed.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.s</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_remove_file_field</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delete</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file_field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.request_delete">
    <p>def <span class="ident">request_delete</span>(</p><p>self, url, parameters: dict = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make a DELETE a request to url with data as Json payload.</p>
<p>Args:
    url (str): Url to make the request.
Kwargs:
    parameters (dict): Dictionary with Urls parameters.
    auth_header (dict): Auth header if microservice not logged.
Returns:
    any: Return the post result
Raises:
    Response is passed to error_handler function.
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.request_delete', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.request_delete" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">request_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a DELETE a request to url with data as Json payload.</span>
<span class="sd">    Args:</span>
<span class="sd">        url (str): Url to make the request.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        parameters (dict): Dictionary with Urls parameters.</span>
<span class="sd">        auth_header (dict): Auth header if microservice not logged.</span>
<span class="sd">    Returns:</span>
<span class="sd">        any: Return the post result</span>
<span class="sd">    Raises:</span>
<span class="sd">        Response is passed to error_handler function.</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
        <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="c1"># Retry request if token is not valid forcing token renew</span>
    <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">post_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="c1"># Re-raise Pumpwood Exceptions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.request_get">
    <p>def <span class="ident">request_get</span>(</p><p>self, url, parameters: dict = {}, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Make a GET a request to url with data as Json payload.</p>
<p>Args:
    url (str): Url to make the request.
Kwargs:
    parameters (dict): Url parameters to make the request.
    auth_header (dict): Authentication dictionary.
Returns:
    any: Return the post result
Raises:
    Response is passed to error_handler function.
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.request_get', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.request_get" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">request_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a GET a request to url with data as Json payload.</span>
<span class="sd">    Args:</span>
<span class="sd">        url (str): Url to make the request.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        parameters (dict): Url parameters to make the request.</span>
<span class="sd">        auth_header (dict): Authentication dictionary.</span>
<span class="sd">    Returns:</span>
<span class="sd">        any: Return the post result</span>
<span class="sd">    Raises:</span>
<span class="sd">        Response is passed to error_handler function.</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="c1"># If parameters are not none convert them to json before</span>
    <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
    <span class="c1"># for example</span>
    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">get_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="c1"># Re-raise Pumpwood exceptions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
    <span class="n">json_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">json_types</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;filename=(.+)&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">fname</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.request_post">
    <p>def <span class="ident">request_post</span>(</p><p>self, url: str, data: &lt;built-in function any&gt;, files: list = None, auth_header: dict = None, parameters: dict = {})</p>
    </div>
    

    
  
    <div class="desc"><p>Make a POST a request to url with data as Json payload.</p>
<p>Args:
    url (str): Url to make the request.
    data (any); Data to be used as Json payload.
Kwargs:
    files(list of tuples): A list of tuples with
                           (file name, [file1, file2, &hellip;]).
    params [dict]: Url parameters.
    auth_header(dict): Auth data to overhide microservice's.
Returns:
    any: Return the post result
Raises:
    Response is passed to error_handler function.
Example:
    No example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.request_post', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.request_post" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">request_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a POST a request to url with data as Json payload.</span>
<span class="sd">    Args:</span>
<span class="sd">        url (str): Url to make the request.</span>
<span class="sd">        data (any); Data to be used as Json payload.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        files(list of tuples): A list of tuples with</span>
<span class="sd">                               (file name, [file1, file2, ...]).</span>
<span class="sd">        params [dict]: Url parameters.</span>
<span class="sd">        auth_header(dict): Auth data to overhide microservice&#39;s.</span>
<span class="sd">    Returns:</span>
<span class="sd">        any: Return the post result</span>
<span class="sd">    Raises:</span>
<span class="sd">        Response is passed to error_handler function.</span>
<span class="sd">    Example:</span>
<span class="sd">        No example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If parameters are not none convert them to json before</span>
    <span class="c1"># sending information on query string, &#39;True&#39; is &#39;true&#39; on javascript</span>
    <span class="c1"># for exemple</span>
    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Do not convert str to json, it put extra &quot;&quot; araound string</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
        <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>
        <span class="c1"># Retry request if token is not valid forcing token renew</span>
        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>
    <span class="c1"># Request with files are done using multipart serializing all fields</span>
    <span class="c1"># as json</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
            <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">multipart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">post_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__json__&#39;</span><span class="p">:</span> <span class="n">pumpJsonDump</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>
        <span class="n">retry_with_login</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_invalid_token_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">auth_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_with_login</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span>
                <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">)</span>
    <span class="c1"># Handle errors and re-raise if Pumpwood Exceptions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="c1"># Check if reponse is a file</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
    <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">content_disposition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;filename=(.+)&#39;</span><span class="p">,</span> <span class="n">content_disposition</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;__file_name__&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;__content__&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.retrieve">
    <p>def <span class="ident">retrieve</span>(</p><p>self, model_class: str, pk: int, foreign_key_fields: bool = False, related_fields: bool = False, fields: &lt;function PumpWoodMicroService.list at 0x7002f863f940&gt; = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve an object from PumpWood.</p>
<p>Function to get object serialized by retrieve end-point
(more detailed data).</p>
<p>Args:
  model_class (str): Model class of the end-point
  pk (int): Object pk
Kwargs:
  foreign_key_fields [bool]: Return forenging key objects.
  related_fields [bool]: Return related fields information.
  fields [list]:
  auth_header(dict): Dictionary containing the auth header.
Returns:
  list: Contaiing objects serialized by retrieve Serializer.
Raises:
  No especific raises.
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">foreign_key_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">related_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an object from PumpWood.</span>
<span class="sd">    Function to get object serialized by retrieve end-point</span>
<span class="sd">    (more detailed data).</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class of the end-point</span>
<span class="sd">      pk (int): Object pk</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      foreign_key_fields [bool]: Return forenging key objects.</span>
<span class="sd">      related_fields [bool]: Return related fields information.</span>
<span class="sd">      fields [list]:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      list: Contaiing objects serialized by retrieve Serializer.</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
            <span class="s2">&quot;foreign_key_fields&quot;</span><span class="p">:</span> <span class="n">foreign_key_fields</span><span class="p">,</span>
            <span class="s2">&quot;related_fields&quot;</span><span class="p">:</span> <span class="n">related_fields</span><span class="p">,</span>
        <span class="p">},</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.retrieve_file">
    <p>def <span class="ident">retrieve_file</span>(</p><p>self, model_class: str, pk: int, file_field: str, auth_header: dict = None, save_file: bool = True, save_path: str = &#39;./&#39;, file_name: str = None, if_exists: str = &#39;fail&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve a file from PumpWood.</p>
<p>Args:
  model_class (str): Class of the model to retrieve file.
  pk (int): Pk of the object associeted file.
  file_field (str): Field of the file to be downloaded.
Kwargs:
  auth_header(dict): Dictionary containing the auth header.
  save_file (bool): If data is to be saved as file or return get
    response.
  save_path (str): Path of the directory to save file.
  file_name (str): Name of the file, if None it will have same name as
        saved in PumpWood.
  if_exists {'fail', 'change_name', 'overwrite', 'skip'}: Set what to
    do if there is a file with same name. Skip will not download file
    if there is already with same os.path.join(save_path, file_name),
    file_name must be set for skip argument.
Returns:
  requset.response or str
Raises:
  No especific raises.
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_file', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">retrieve_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a file from PumpWood.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Class of the model to retrieve file.</span>
<span class="sd">      pk (int): Pk of the object associeted file.</span>
<span class="sd">      file_field (str): Field of the file to be downloaded.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">      save_file (bool): If data is to be saved as file or return get</span>
<span class="sd">        response.</span>
<span class="sd">      save_path (str): Path of the directory to save file.</span>
<span class="sd">      file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">            saved in PumpWood.</span>
<span class="sd">      if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &#39;skip&#39;}: Set what to</span>
<span class="sd">        do if there is a file with same name. Skip will not download file</span>
<span class="sd">        if there is already with same os.path.join(save_path, file_name),</span>
<span class="sd">        file_name must be set for skip argument.</span>
<span class="sd">    Returns:</span>
<span class="sd">      requset.response or str</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;, &quot;</span>
            <span class="s2">&quot;&#39;skip&#39;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skiping file already exists: &quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">file_path</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_url</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">file_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">},</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">file_response</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">save_path</span><span class="p">))</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_name</span> <span class="ow">or</span> <span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">is_file_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_file_already</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                    <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">too_many_tries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                     <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
                 <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">file_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.retrieve_options">
    <p>def <span class="ident">retrieve_options</span>(</p><p>self, model_class: str, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return options to render retrieve views.</p>
<p>Args:
  model_class (str): Model class to check filment options.
Kwargs:
  auth_header(dict): Dictionary containing the auth header.
Returns:
  dict: Dictionary with possible data.
Raises:
  Dependends on backend implementation.
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_options', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">retrieve_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return options to render retrieve views.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Model class to check filment options.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      dict: Dictionary with possible data.</span>
<span class="sd">    Raises:</span>
<span class="sd">      Dependends on backend implementation.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">{basename}</span><span class="s2">/retrieve-options/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">basename</span><span class="o">=</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.retrieve_streaming_file">
    <p>def <span class="ident">retrieve_streaming_file</span>(</p><p>self, model_class: str, pk: int, file_field: str, file_name: str, auth_header: dict = None, save_path: str = &#39;./&#39;, if_exists: str = &#39;fail&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve a file from PumpWood.</p>
<p>Args:
  model_class (str): Class of the model to retrieve file.
  pk (int): Pk of the object associeted file.
  file_field (str): Field of the file to be downloaded.
  file_name (str): Name of the file, if None it will have same name as
        saved in PumpWood.</p>
<p>Kwargs:
  auth_header(dict): Dictionary containing the auth header.
  save_path (str): Path of the directory to save file.
  if_exists {'fail', 'change_name', 'overwrite'}: Set what to do if
    there is a file with same name.</p>
<p>Returns:
  requset.response or str</p>
<p>Raises:
  No especific raises.</p>
<p>Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_streaming_file', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.retrieve_streaming_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">retrieve_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
                            <span class="n">if_exists</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a file from PumpWood.</span>
<span class="sd">    Args:</span>
<span class="sd">      model_class (str): Class of the model to retrieve file.</span>
<span class="sd">      pk (int): Pk of the object associeted file.</span>
<span class="sd">      file_field (str): Field of the file to be downloaded.</span>
<span class="sd">      file_name (str): Name of the file, if None it will have same name as</span>
<span class="sd">            saved in PumpWood.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">      save_path (str): Path of the directory to save file.</span>
<span class="sd">      if_exists {&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;}: Set what to do if</span>
<span class="sd">        there is a file with same name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      requset.response or str</span>
<span class="sd">    Raises:</span>
<span class="sd">      No especific raises.</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="c1"># begin Args check</span>
    <span class="k">if</span> <span class="n">if_exists</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s2">&quot;change_name&quot;</span><span class="p">,</span> <span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="s2">&quot;if_exists must be in [&#39;fail&#39;, &#39;change_name&#39;, &#39;overwrite&#39;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="s2">&quot;Path to save retrieved file [</span><span class="si">{}</span><span class="s2">] does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">save_path</span><span class="p">))</span>
    <span class="c1"># end Args check</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;change_name&quot;</span><span class="p">:</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{filename}</span><span class="s2">__</span><span class="si">{count}{extension}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">file_extension</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_path</span>
                <span class="n">too_many_tries</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">too_many_tries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Too many tries to find a not used file name.&quot;</span> <span class="o">+</span>
                 <span class="s2">&quot; file_path[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_exists</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;if_exists set as &#39;fail&#39; and there is a file with same&quot;</span> <span class="o">+</span>
             <span class="s2">&quot;name. file_path [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_retrieve_file_straming_url</span><span class="p">(</span>
        <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">get_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="n">url_str</span>
    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">get_url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file-field&quot;</span><span class="p">:</span> <span class="n">file_field</span><span class="p">})</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.save">
    <p>def <span class="ident">save</span>(</p><p>self, obj_dict, files: dict = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Save or Update a new object.</p>
<p>Function to save or update a new model_class object. If obj_dict{'pk'}
is None or not defined a new object will be created. The obj
model class is defided at obj_dict['model_class'] and if not defined an
PumpWoodObjectSavingException will be raised.</p>
<p>Args:
  obj_dict (dict): Model data dictionary. It must have 'model_class'
                   key and if 'pk' key is not defined a new object will
                   be created, else object with pk will be updated.
Kwargs:
  files (dict): A dictionary of files to be added to as a multi-part
                post request.
  auth_header(dict): Dictionary containing the auth header.
Returns:
  dict: Updated/Created object data.
Raises:
  PumpWoodObjectSavingException(
      'To save an object obj_dict must have model_class defined.'):
    Will be raised if model_class key is not present on
    obj_dict dictionary
Example:
  No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.save', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save or Update a new object.</span>
<span class="sd">    Function to save or update a new model_class object. If obj_dict{&#39;pk&#39;}</span>
<span class="sd">    is None or not defined a new object will be created. The obj</span>
<span class="sd">    model class is defided at obj_dict[&#39;model_class&#39;] and if not defined an</span>
<span class="sd">    PumpWoodObjectSavingException will be raised.</span>
<span class="sd">    Args:</span>
<span class="sd">      obj_dict (dict): Model data dictionary. It must have &#39;model_class&#39;</span>
<span class="sd">                       key and if &#39;pk&#39; key is not defined a new object will</span>
<span class="sd">                       be created, else object with pk will be updated.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      files (dict): A dictionary of files to be added to as a multi-part</span>
<span class="sd">                    post request.</span>
<span class="sd">      auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">      dict: Updated/Created object data.</span>
<span class="sd">    Raises:</span>
<span class="sd">      PumpWoodObjectSavingException(</span>
<span class="sd">          &#39;To save an object obj_dict must have model_class defined.&#39;):</span>
<span class="sd">        Will be raised if model_class key is not present on</span>
<span class="sd">        obj_dict dictionary</span>
<span class="sd">    Example:</span>
<span class="sd">      No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model_class&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PumpWoodObjectSavingException</span><span class="p">(</span>
            <span class="s1">&#39;To save an object obj_dict must have model_class defined.&#39;</span><span class="p">)</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_url</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj_dict</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
        <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.save_streaming_file">
    <p>def <span class="ident">save_streaming_file</span>(</p><p>self, model_class: str, pk: int, file_field: str, file: _io.BufferedReader, file_name: str = None, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Stream file to PumpWood.</p>
<p>Args:
    model_class (str): Model class of the object.
    pk (int): pk of the object.
    file_field (str): File field that will receive file stream.
    file (io.BufferedReader): File to upload.</p>
<p>Kwargs:
    file_name (str): Name of the file, is not set it will be saved as
        {pk}__{file_field}.{extension at permited extension}
    auth_header (dict): Authentication dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.save_streaming_file', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.save_streaming_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_streaming_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stream file to PumpWood.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class of the object.</span>
<span class="sd">        pk (int): pk of the object.</span>
<span class="sd">        file_field (str): File field that will receive file stream.</span>
<span class="sd">        file (io.BufferedReader): File to upload.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        file_name (str): Name of the file, is not set it will be saved as</span>
<span class="sd">            {pk}__{file_field}.{extension at permited extension}</span>
<span class="sd">        auth_header (dict): Authentication dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check__auth_header</span><span class="p">(</span><span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
    <span class="n">request_header</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span>
    <span class="n">post_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_save_streaming_file_url</span><span class="p">(</span>
        <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_field</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">post_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_header</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file_last_bite</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">json_response</span> <span class="o">=</span> <span class="n">PumpWoodMicroService</span><span class="o">.</span><span class="n">angular_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_last_bite</span> <span class="o">!=</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">]:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;Saved bytes in streaming [</span><span class="si">{}</span><span class="s2">] differ from file &quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;bites [</span><span class="si">{}</span><span class="s2">].&quot;</span>
        <span class="k">raise</span> <span class="n">PumpWoodException</span><span class="p">(</span>
                <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;bytes_uploaded&quot;</span><span class="p">],</span> <span class="n">file_last_bite</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.search_options">
    <p>def <span class="ident">search_options</span>(</p><p>self, model_class: str, auth_header: dict = None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return search options.</p>
<p>Returns options to search, like forenging keys and choice fields.
Args:
    model_class (str): Model class to check search parameters
Kwargs:
    auth_header(dict): Dictionary containing the auth header.
Returns:
    dict: Dictionary with search parameters
Raises:
    Dependends on backend implementation
Example:
    No example yet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.search_options', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.search_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">search_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return search options.</span>
<span class="sd">    Returns options to search, like forenging keys and choice fields.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_class (str): Model class to check search parameters</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        auth_header(dict): Dictionary containing the auth header.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary with search parameters</span>
<span class="sd">    Raises:</span>
<span class="sd">        Dependends on backend implementation</span>
<span class="sd">    Example:</span>
<span class="sd">        No example yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url_str</span> <span class="o">=</span> <span class="s2">&quot;rest/</span><span class="si">%s</span><span class="s2">/options/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_class</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_str</span><span class="p">,</span> <span class="n">auth_header</span><span class="o">=</span><span class="n">auth_header</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.set_auth_header">
    <p>def <span class="ident">set_auth_header</span>(</p><p>self, auth_header: dict, token_expiry: pandas._libs.tslibs.timestamps.Timestamp)</p>
    </div>
    

    
  
    <div class="desc"><p>Set auth_header and token_expiry date.</p>
<p>Args:
    auth_header [dict]: Authentication header to be set.
    token_expiry [pd.Timestamp]: Token expiry datetime to be set.
Return [None]:
    No return.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.set_auth_header', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.set_auth_header" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                    <span class="n">token_expiry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set auth_header and token_expiry date.</span>
<span class="sd">    Args:</span>
<span class="sd">        auth_header [dict]: Authentication header to be set.</span>
<span class="sd">        token_expiry [pd.Timestamp]: Token expiry datetime to be set.</span>
<span class="sd">    Return [None]:</span>
<span class="sd">        No return.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">token_expiry</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pumpwood_communication.microservices.PumpWoodMicroService.time_to_expiry">
    <p>def <span class="ident">time_to_expiry</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return time to token expiry.</p>
<p>Args:
    No Args.
Kwargs:
    No Kwargs.
Return:
    Return time until token expiration.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pumpwood_communication.microservices.PumpWoodMicroService.time_to_expiry', this);">Show source &equiv;</a></p>
  <div id="source-pumpwood_communication.microservices.PumpWoodMicroService.time_to_expiry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">time_to_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return time to token expiry.</span>
<span class="sd">    Args:</span>
<span class="sd">        No Args.</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        No Kwargs.</span>
<span class="sd">    Return:</span>
<span class="sd">        Return time until token expiration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">now_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time_to_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token_expiry</span> <span class="o">-</span> <span class="n">now_datetime</span>
    <span class="k">return</span> <span class="n">time_to_expiry</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.2.0</a>
    </p>
  </footer>
</div>
</body>
</html>